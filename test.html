<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BudgetFlow - Modern Dashboard</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

  <!-- Chart.js for budget visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* All previous styles remain the same... */
    
    /* ========== BUDGET FEATURES STYLES ========== */
    
    /* Budget Section */
    .budget-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
      margin-top: 25px;
    }
    
    .budget-section:hover {
      transform: translateY(-5px);
    }
    
    .budget-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .budget-header h3 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .budget-header h3 i {
      color: var(--primary);
    }
    
    .budget-actions {
      display: flex;
      gap: 10px;
    }
    
    .budget-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .budget-btn:hover {
      background: var(--success-dark);
      transform: translateY(-2px);
    }
    
    .budget-btn.warning {
      background: var(--warning);
    }
    
    .budget-btn.warning:hover {
      background: var(--warning-dark);
    }
    
    .budget-btn.danger {
      background: var(--danger);
    }
    
    .budget-btn.danger:hover {
      background: var(--danger-dark);
    }
    
    /* Budget Stats */
    .budget-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .budget-stat-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: var(--card-border);
      transition: all 0.3s;
    }
    
    .budget-stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .budget-stat-card.overbudget {
      border-left: 4px solid var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }
    
    .budget-stat-card.withinbudget {
      border-left: 4px solid var(--success);
      background: rgba(16, 185, 129, 0.05);
    }
    
    .budget-stat-title {
      font-size: 14px;
      color: var(--text-light);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .budget-stat-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--text);
    }
    
    .budget-stat-subtitle {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 5px;
    }
    
    /* Budget Table */
    .budget-table-container {
      overflow-x: auto;
      margin-top: 20px;
    }
    
    .budget-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .budget-table th {
      background: var(--primary);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .budget-table td {
      padding: 15px;
      border-bottom: 1px solid var(--light-dark);
    }
    
    [data-theme="dark"] .budget-table td {
      border-bottom: 1px solid var(--dark-light);
    }
    
    .budget-table tr:hover {
      background: var(--light-dark);
    }
    
    [data-theme="dark"] .budget-table tr:hover {
      background: var(--dark-light);
    }
    
    .budget-table tr.overbudget-row {
      background: rgba(239, 68, 68, 0.1);
    }
    
    .budget-table tr.overbudget-row:hover {
      background: rgba(239, 68, 68, 0.2);
    }
    
    .budget-table tr.withinbudget-row {
      background: rgba(16, 185, 129, 0.1);
    }
    
    .budget-table tr.withinbudget-row:hover {
      background: rgba(16, 185, 129, 0.2);
    }
    
    .account-name {
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .budget-amount {
      font-weight: 700;
      color: var(--text);
    }
    
    .actual-amount {
      font-weight: 700;
    }
    
    .actual-amount.over {
      color: var(--danger);
    }
    
    .actual-amount.under {
      color: var(--success);
    }
    
    .budget-progress {
      width: 100%;
      height: 8px;
      background: var(--light-dark);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    [data-theme="dark"] .budget-progress {
      background: var(--dark-light);
    }
    
    .progress-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }
    
    .progress-bar.over {
      background: var(--danger);
    }
    
    .progress-bar.under {
      background: var(--success);
    }
    
    .progress-bar.warning {
      background: var(--warning);
    }
    
    .budget-percentage {
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      margin-top: 4px;
    }
    
    .budget-actions-cell {
      display: flex;
      gap: 8px;
    }
    
    .action-icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: none;
      background: var(--light-dark);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    [data-theme="dark"] .action-icon-btn {
      background: var(--dark-light);
    }
    
    .action-icon-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }
    
    .action-icon-btn.edit:hover {
      background: var(--info);
    }
    
    .action-icon-btn.delete:hover {
      background: var(--danger);
    }
    
    /* Budget Charts */
    .budget-charts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .budget-chart-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: var(--card-border);
    }
    
    .budget-chart-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .budget-chart-title i {
      color: var(--primary);
    }
    
    /* Budget Modal */
    .budget-modal {
      max-width: 600px;
    }
    
    .budget-form {
      margin: 20px 0;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group-full {
      grid-column: span 2;
    }
    
    .budget-preview {
      background: var(--light-dark);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 1px dashed var(--border-dark);
    }
    
    [data-theme="dark"] .budget-preview {
      background: var(--dark-light);
    }
    
    .budget-preview h4 {
      margin-bottom: 15px;
      color: var(--text);
      font-size: 16px;
    }
    
    .preview-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .preview-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .preview-label {
      color: var(--text-light);
      font-weight: 500;
    }
    
    .preview-value {
      font-weight: 600;
      color: var(--text);
    }
    
    .preview-value.limit {
      color: var(--primary);
    }
    
    .preview-value.over {
      color: var(--danger);
    }
    
    .preview-value.under {
      color: var(--success);
    }
    
    /* Budget Empty State */
    .budget-empty {
      text-align: center;
      padding: 40px;
      color: var(--text-light);
    }
    
    .budget-empty i {
      font-size: 48px;
      margin-bottom: 20px;
      color: var(--primary);
      opacity: 0.5;
    }
    
    .budget-empty h4 {
      font-size: 18px;
      margin-bottom: 10px;
      color: var(--text);
    }
    
    .budget-empty p {
      font-size: 14px;
      margin-bottom: 20px;
    }
    
    /* Budget Period Selector */
    .budget-period-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .period-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-dark);
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .period-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .period-btn:hover:not(.active) {
      background: var(--light-dark);
    }
    
    [data-theme="dark"] .period-btn:hover:not(.active) {
      background: var(--dark-light);
    }
    
    /* Budget Summary Cards */
    .budget-summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .summary-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: var(--card-border);
      text-align: center;
    }
    
    .summary-card.red {
      border-top: 4px solid var(--danger);
    }
    
    .summary-card.green {
      border-top: 4px solid var(--success);
    }
    
    .summary-card.blue {
      border-top: 4px solid var(--primary);
    }
    
    .summary-card.orange {
      border-top: 4px solid var(--warning);
    }
    
    .summary-icon {
      font-size: 32px;
      margin-bottom: 15px;
    }
    
    .summary-icon.red {
      color: var(--danger);
    }
    
    .summary-icon.green {
      color: var(--success);
    }
    
    .summary-icon.blue {
      color: var(--primary);
    }
    
    .summary-icon.orange {
      color: var(--warning);
    }
    
    .summary-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 5px;
      color: var(--text);
    }
    
    .summary-label {
      font-size: 14px;
      color: var(--text-light);
    }
    
    /* Budget Alert Badge */
    .budget-alert-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 20px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* Responsive Adjustments for Budget Section */
    @media (max-width: 768px) {
      .budget-stats {
        grid-template-columns: 1fr;
      }
      
      .budget-summary-cards {
        grid-template-columns: 1fr;
      }
      
      .budget-charts {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .form-group-full {
        grid-column: span 1;
      }
      
      .budget-actions-cell {
        flex-direction: column;
      }
      
      .action-icon-btn {
        width: 100%;
      }
      
      .budget-table th,
      .budget-table td {
        padding: 10px;
        font-size: 13px;
      }
      
      .budget-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .budget-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .budget-btn {
        flex: 1;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .budget-section {
        padding: 20px;
      }
      
      .budget-stat-card {
        padding: 15px;
      }
      
      .budget-stat-value {
        font-size: 24px;
      }
      
      .period-btn {
        padding: 6px 12px;
        font-size: 14px;
      }
    }
    
    /* ========== END OF BUDGET FEATURES STYLES ========== */

    /* AI Chat Interface Styles */
    .ai-chat-container {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 400px;
      height: 600px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      border: var(--card-border);
      z-index: 9999;
      display: none;
      flex-direction: column;
      overflow: hidden;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .ai-chat-container.active {
      display: flex;
    }
    
    .ai-chat-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: var(--card-border);
    }
    
    .ai-chat-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 18px;
    }
    
    .ai-chat-title i {
      font-size: 24px;
    }
    
    .close-chat {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .close-chat:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
    
    .ai-chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: var(--card-bg);
    }
    
    .message {
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message.ai {
      flex-direction: row;
    }
    
    .message.user {
      flex-direction: row-reverse;
    }
    
    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 18px;
    }
    
    .message.ai .message-avatar {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .message.user .message-avatar {
      background: var(--success);
      color: white;
    }
    
    .message-content {
      max-width: 280px;
      padding: 15px;
      border-radius: 18px;
      position: relative;
      word-wrap: break-word;
    }
    
    .message.ai .message-content {
      background: var(--light-dark);
      color: var(--text);
      border-top-left-radius: 4px;
    }
    
    .message.user .message-content {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border-top-right-radius: 4px;
    }
    
    .message-time {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 5px;
      text-align: right;
    }
    
    .message.ai .message-time {
      text-align: left;
    }
    
    .ai-chat-input-container {
      padding: 20px;
      border-top: var(--card-border);
      background: var(--card-bg);
    }
    
    .ai-chat-input-wrapper {
      display: flex;
      gap: 10px;
    }
    
    .ai-chat-input {
      flex: 1;
      padding: 15px 20px;
      border-radius: 25px;
      border: var(--card-border);
      background: var(--card-bg);
      color: var(--text);
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .ai-chat-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .ai-send-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .ai-send-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 20px rgba(79, 70, 229, 0.4);
    }
    
    .ai-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .ai-typing-indicator {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 10px 20px;
      background: var(--light-dark);
      border-radius: 20px;
      width: fit-content;
      margin-left: 52px;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--primary);
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }
    
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .quick-action-btn {
      padding: 10px 15px;
      background: var(--light-dark);
      border: none;
      border-radius: 12px;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .quick-action-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }
    
    .ai-thinking {
      font-style: italic;
      color: var(--text-light);
      padding: 10px 0;
      text-align: center;
      font-size: 13px;
    }
    
    .web-results {
      margin-top: 15px;
      padding: 15px;
      background: rgba(var(--primary-rgb), 0.05);
      border-radius: 12px;
      border-left: 4px solid var(--primary);
    }
    
    .web-result-item {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .web-result-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .web-result-title {
      font-weight: 600;
      color: var(--primary);
      font-size: 14px;
      margin-bottom: 5px;
      display: block;
    }
    
    .web-result-snippet {
      font-size: 13px;
      color: var(--text-light);
      line-height: 1.4;
    }
    
    .web-result-url {
      font-size: 11px;
      color: var(--success);
      margin-top: 3px;
      display: block;
    }
    
    .ai-suggestion {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 12px;
      margin-top: 10px;
      font-size: 13px;
    }
    
    .ai-suggestion-title {
      font-weight: 600;
      color: var(--success);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .transaction-preview {
      background: var(--light-dark);
      border-radius: 12px;
      padding: 15px;
      margin-top: 10px;
      border: 1px dashed var(--border-dark);
    }
    
    .transaction-preview-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
    }
    
    .transaction-preview-item:last-child {
      margin-bottom: 0;
    }
    
    .transaction-preview-label {
      color: var(--text-light);
    }
    
    .transaction-preview-value {
      font-weight: 600;
      color: var(--text);
    }
    
    .confirm-transaction-btn {
      background: var(--success);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 15px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .confirm-transaction-btn:hover {
      background: var(--success-dark);
    }
    
    .ai-fab {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 800;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .ai-fab:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
    }
    
    .ai-fab-pulse {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    
    /* Remove split transaction styles and add AI chat responsive styles */
    @media (max-width: 768px) {
      .ai-chat-container {
        width: 90vw;
        height: 70vh;
        right: 5vw;
        bottom: 80px;
      }
      
      .ai-fab {
        bottom: 20px;
        right: 20px;
        width: 55px;
        height: 55px;
        font-size: 20px;
      }
      
      .message-content {
        max-width: 200px;
      }
      
      .quick-actions {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 480px) {
      .ai-chat-container {
        width: 95vw;
        height: 75vh;
        right: 2.5vw;
        bottom: 70px;
      }
      
      .ai-fab {
        bottom: 15px;
        right: 15px;
        width: 50px;
        height: 50px;
        font-size: 18px;
      }
      
      .message-content {
        max-width: 180px;
        padding: 12px;
      }
    }

    /* Auto Logout Modal Styles */
    .auto-logout-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }
    
    .auto-logout-modal.active {
      display: flex;
    }
    
    .auto-logout-content {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      border: var(--card-border);
      animation: pulseWarning 1.5s infinite alternate;
    }
    
    @keyframes pulseWarning {
      from {
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      }
      to {
        box-shadow: 0 25px 50px rgba(239, 68, 68, 0.4);
      }
    }
    
    .auto-logout-icon {
      font-size: 64px;
      color: var(--danger);
      margin-bottom: 20px;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }
    
    .auto-logout-content h2 {
      color: var(--danger);
      margin-bottom: 15px;
      font-size: 28px;
    }
    
    .auto-logout-content p {
      color: var(--text);
      margin-bottom: 25px;
      font-size: 16px;
      line-height: 1.5;
    }
    
    .countdown-timer {
      font-size: 48px;
      font-weight: 800;
      color: var(--danger);
      margin: 20px 0;
      font-family: monospace;
      text-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
    }
    
    .auto-logout-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }
    
    .auto-logout-buttons button {
      flex: 1;
      padding: 15px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .stay-logged-in-btn {
      background: var(--success);
      color: white;
    }
    
    .stay-logged-in-btn:hover {
      background: var(--success-dark);
      transform: translateY(-2px);
    }
    
    .logout-now-btn {
      background: var(--danger);
      color: white;
    }
    
    .logout-now-btn:hover {
      background: var(--danger-dark);
      transform: translateY(-2px);
    }
    
    .session-warning {
      position: fixed;
      top: 80px;
      right: 20px;
      background: var(--warning);
      color: var(--dark);
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 9998;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .session-warning.active {
      display: flex;
    }

    :root {
      --primary: #4f46e5;
      --primary-light: #6366f1;
      --primary-dark: #4338ca;
      --secondary: #8b5cf6;
      --secondary-light: #a78bfa;
      --secondary-dark: #7c3aed;
      --success: #10b981;
      --success-light: #34d399;
      --success-dark: #059669;
      --danger: #ef4444;
      --danger-light: #f87171;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-light: #fbbf24;
      --warning-dark: #d97706;
      --info: #06b6d4;
      --info-light: #22d3ee;
      --info-dark: #0891b2;
      --dark: #1e293b;
      --dark-light: #334155;
      --dark-lighter: #475569;
      --light: #f8fafc;
      --light-dark: #f1f5f9;
      --text: #1e293b;
      --text-light: #64748b;
      --card-bg: #ffffff;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      --card-border: 1px solid #f1f5f9;
      
      /* 3D effect variables */
      --card-depth: 10px;
      --card-3d-shadow: 0 10px 25px rgba(0, 0, 0, 0.08), 0 5px 10px rgba(0, 0, 0, 0.05);
      
      /* Dark mode variables */
      --bg-dark: #0f172a;
      --card-bg-dark: #1e293b;
      --text-dark: #f1f5f9;
      --text-muted-dark: #94a3b8;
      --border-dark: #334155;
    }

    /* Dark mode */
    [data-theme="dark"] {
      --primary: #6366f1;
      --secondary: #8b5cf6;
      --success: #10b981;
      --danger: #f87171;
      --warning: #fbbf24;
      --info: #22d3ee;
      --dark: #1e293b;
      --light: #0f172a;
      --text: #f1f5f9;
      --card-bg: #1e293b;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      --card-border: 1px solid #334155;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--light);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Dashboard */
    .dashboard {
      display: none;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--dark);
      color: #fff;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 20px;
      z-index: 999;
      transform: translateX(-260px);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
    }

    .sidebar.visible {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
    }

    .sidebar-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 20px;
      font-weight: 700;
    }

    .sidebar-title i {
      color: var(--primary-light);
      font-size: 24px;
    }

    .sidebar-nav {
      padding: 10px 0;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar ul li {
      padding: 12px 20px;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border-radius: 8px;
      margin: 4px 15px;
    }

    .sidebar ul li i {
      width: 20px;
      text-align: center;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.7);
      transition: color 0.2s;
    }

    .sidebar ul li span {
      font-weight: 500;
      font-size: 14px;
    }

    .sidebar ul li:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .sidebar ul li:hover i {
      color: white;
    }

    .sidebar ul li.active {
      background: var(--primary);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .sidebar ul li.active i {
      color: white;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      font-size: 14px;
    }

    .user-email {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      box-shadow: var(--card-shadow);
      z-index: 900;
      transition: left 0.3s, background-color 0.3s;
      border-bottom: var(--card-border);
    }

    header.sidebar-visible {
      left: 260px;
    }

    #menuToggle {
      font-size: 20px;
      cursor: pointer;
      color: var(--text);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    #menuToggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] #menuToggle:hover {
      background: var(--dark-light);
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    /* Date and time display */
    .datetime-display {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 14px;
    }

    .current-date {
      font-weight: 600;
    }

    .current-time {
      color: var(--text-light);
      font-size: 12px;
    }

    [data-theme="dark"] .current-time {
      color: var(--text-muted-dark);
    }

    /* Theme toggle */
    .theme-toggle {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 8px;
      border-radius: 10px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .theme-toggle:hover {
      background: var(--dark-light);
    }

    /* Profile */
    .profile {
      display: flex;
      align-items: center;
      position: relative;
      cursor: pointer;
    }

    .profile-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .dropdown {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      display: none;
      min-width: 180px;
      overflow: hidden;
      z-index: 1000;
      border: var(--card-border);
    }

    .dropdown a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      text-decoration: none;
      color: var(--text);
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .dropdown a:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .dropdown a:hover {
      background: var(--dark-light);
    }

    .profile.active .dropdown {
      display: block;
    }

    /* Notification Bell */
    .notification-bell {
      position: relative;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .notification-bell:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .notification-bell:hover {
      background: var(--dark-light);
    }

    .notification-bell i {
      font-size: 1.2rem;
      color: var(--text);
    }

    .notification-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Notification Panel */
    .notification-panel {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      display: none;
      width: 350px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 1000;
      border: var(--card-border);
    }

    .notification-panel.active {
      display: block;
    }

    .notification-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--light-dark);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    [data-theme="dark"] .notification-header {
      border-bottom: 1px solid var(--dark-light);
    }

    .notification-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .clear-notifications {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
    }

    .clear-notifications:hover {
      text-decoration: underline;
    }

    .notification-list {
      padding: 10px 0;
    }

    .notification-item {
      padding: 12px 20px;
      border-bottom: 1px solid var(--light-dark);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    [data-theme="dark"] .notification-item {
      border-bottom: 1px solid var(--dark-light);
    }

    .notification-item:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .notification-item:hover {
      background: var(--dark-light);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .notification-message {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    [data-theme="dark"] .notification-message {
      color: var(--text-muted-dark);
    }

    .notification-time {
      font-size: 11px;
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    [data-theme="dark"] .notification-time {
      color: var(--text-muted-dark);
    }

    .notification-icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .notification-icon.bill {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .notification-icon.reminder {
      background: rgba(6, 182, 212, 0.2);
      color: var(--info);
    }

    .notification-icon.birthday {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .notification-icon.meeting {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .no-notifications {
      padding: 30px 20px;
      text-align: center;
      color: var(--text-light);
      font-size: 14px;
    }

    [data-theme="dark"] .no-notifications {
      color: var(--text-muted-dark);
    }

    /* Main */
    .main {
      margin-left: 0;
      margin-top: 80px;
      padding: 25px;
      transition: margin-left 0.3s;
    }

    .main.sidebar-visible {
      margin-left: 260px;
    }

    /* Dashboard grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 25px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      perspective: 1000px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .card h3 {
      margin: 0 0 15px;
      font-size: 16px;
      color: var(--text-light);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h3 i {
      font-size: 18px;
    }

    [data-theme="dark"] .card h3 {
      color: var(--text-muted-dark);
    }

    .card .value {
      font-size: 32px;
      font-weight: 800;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card .balance-hidden {
      filter: blur(8px);
      user-select: none;
    }

    .balance-toggle {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-light);
      font-size: 16px;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .balance-toggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .balance-toggle {
      color: var(--text-muted-dark);
    }

    [data-theme="dark"] .balance-toggle:hover {
      background: var(--dark-light);
    }

    .card.green {
      background: linear-gradient(135deg, var(--success), var(--success-dark));
      color: white;
    }

    .card.purple {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .card.dark {
      background: linear-gradient(135deg, var(--dark), var(--dark-light));
      color: white;
    }

    .card.orange {
      background: linear-gradient(135deg, var(--warning), var(--warning-dark));
      color: white;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-btn {
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      border: var(--card-border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .filter-btn:hover {
      background: var(--light-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .filter-btn:hover {
      background: var(--dark-light);
    }

    /* Calendar */
    #calendar {
      margin-top: 20px;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 16px;
      box-shadow: var(--card-3d-shadow);
      min-height: 450px;
      border: var(--card-border);
      transition: all 0.3s ease;
    }

    #calendar:hover {
      transform: translateY(-5px);
    }

    /* Additional dashboard sections */
    .dashboard-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }

    .dashboard-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
    }

    .dashboard-section:hover {
      transform: translateY(-5px);
    }

    .dashboard-section h3 {
      margin: 0 0 20px;
      font-size: 18px;
      color: var(--text);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .dashboard-section h3 i {
      color: var(--primary);
      font-size: 20px;
    }

    .section-content {
      color: var(--text-light);
      line-height: 1.6;
    }

    [data-theme="dark"] .section-content {
      color: var(--text-muted-dark);
    }

    /* Quick stats */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .quick-stat {
      background: var(--light-dark);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      transition: all 0.2s;
    }

    [data-theme="dark"] .quick-stat {
      background: var(--dark-light);
    }

    .quick-stat:hover {
      transform: scale(1.05);
    }

    .quick-stat .value {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .quick-stat .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 500;
    }

    [data-theme="dark"] .quick-stat .label {
      color: var(--text-muted-dark);
    }

    /* Floating Action Buttons */
    .fab-container {
      position: fixed;
      right: 30px;
      bottom: 100px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 800;
    }

    .fab {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .fab:hover {
      transform: scale(1.1);
      background: var(--primary-dark);
      box-shadow: 0 12px 30px rgba(79, 70, 229, 0.4);
    }

    .fab-secondary {
      background: var(--info);
      box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
    }

    .fab-secondary:hover {
      background: var(--info-dark);
      box-shadow: 0 12px 30px rgba(6, 182, 212, 0.4);
    }

    /* Popup/Modal */
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .popup.active {
      display: flex;
    }

    .popup-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      max-height: 90vh;
      overflow-y: auto;
      border: var(--card-border);
      transform-style: preserve-3d;
      perspective: 1000px;
      animation: modalAppear 0.3s ease-out;
    }

    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: translateY(30px) rotateX(-15deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotateX(0);
      }
    }

    .popup-content h2 {
      margin-bottom: 25px;
      color: var(--text);
      font-weight: 700;
      font-size: 24px;
    }

    .popup-content button {
      display: block;
      width: 100%;
      margin: 12px 0;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #fff;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .popup-content button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }

    .classic-btn {
      background: var(--primary);
    }

    .compact-btn {
      background: var(--secondary);
    }

    .report-btn {
      background: var(--info);
    }

    .trial-balance-btn {
      background: var(--warning);
    }

    .close-btn {
      background: var(--danger);
    }

    /* Form elements in modals */
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-family: inherit;
      background: var(--card-bg);
      color: var(--text);
      border: var(--card-border);
      transition: all 0.2s;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    /* Reminder Detail Modal */
    .reminder-detail-modal {
      max-width: 600px;
      text-align: left;
    }
    
    .reminder-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .reminder-detail-content {
      margin-bottom: 25px;
    }
    
    .reminder-detail-item {
      display: flex;
      margin-bottom: 15px;
      align-items: flex-start;
    }
    
    .reminder-detail-label {
      font-weight: 600;
      width: 120px;
      flex-shrink: 0;
    }
    
    .reminder-detail-value {
      flex: 1;
    }
    
    .reminder-type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: capitalize;
    }
    
    .reminder-type-badge.reminder {
      background: rgba(6, 182, 212, 0.2);
      color: var(--info);
    }
    
    .reminder-type-badge.bill {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }
    
    .reminder-type-badge.birthday {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .reminder-type-badge.meeting {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }
    
    .reminder-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }
    
    .reminder-actions button {
      flex: 1;
    }

    /* New Features Section */
    .new-features {
      margin-top: 25px;
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .feature-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
      cursor: pointer;
      text-align: center;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    .feature-icon {
      font-size: 32px;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .feature-title {
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .feature-description {
      font-size: 14px;
      color: var(--text-light);
    }

    /* Bill Reminder Specific Styles */
    .recurrence-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .recurrence-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      border: 1px solid var(--light-dark);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    [data-theme="dark"] .recurrence-option {
      border: 1px solid var(--dark-light);
    }
    
    .recurrence-option:hover {
      background: var(--light-dark);
    }
    
    [data-theme="dark"] .recurrence-option:hover {
      background: var(--dark-light);
    }
    
    .recurrence-option.active {
      border-color: var(--primary);
      background: rgba(79, 70, 229, 0.1);
    }
    
    .recurrence-option input {
      margin: 0;
    }

    /* Loading spinner */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    
    .loading-overlay.active {
      display: flex;
    }
    
    .loading-content {
      background: var(--card-bg);
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .loading-content p {
      margin-top: 20px;
      color: var(--text);
      font-weight: 600;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--card-bg);
      color: var(--text);
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      border: var(--card-border);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
    }
    
    .toast.active {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning);
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .sidebar {
        width: 240px;
        transform: translateX(-240px);
      }
      
      header.sidebar-visible {
        left: 240px;
      }
      
      .main.sidebar-visible {
        margin-left: 240px;
      }
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .sidebar.visible {
        transform: translateX(0);
        z-index: 1000;
      }

      header.sidebar-visible {
        left: 0;
      }

      .main.sidebar-visible {
        margin-left: 0;
      }
      
      .fab-container {
        right: 20px;
        bottom: 90px;
      }
      
      .fab {
        width: 55px;
        height: 55px;
        font-size: 20px;
      }
      
      .popup-content {
        max-width: 90%;
        padding: 25px;
      }
      
      .popup {
        padding: 15px;
      }

      .filters {
        flex-direction: column;
        align-items: flex-start;
      }

      .dashboard-sections {
        grid-template-columns: 1fr;
      }

      .datetime-display {
        display: none;
      }
      
      .header-title {
        font-size: 18px;
      }
      
      .reminder-actions {
        flex-direction: column;
      }
      
      .feature-grid {
        grid-template-columns: 1fr;
      }
      
      .notification-panel {
        width: 300px;
        right: -50px;
      }
      
      .recurrence-options {
        grid-template-columns: 1fr;
      }
      
      .auto-logout-buttons {
        flex-direction: column;
      }
      
      .session-warning {
        top: 70px;
        right: 10px;
        left: 10px;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .grid {
        gap: 20px;
      }
      
      .card {
        padding: 20px;
      }
      
      .main {
        padding: 20px;
        margin-top: 70px;
      }
      
      .fab-container {
        right: 15px;
        bottom: 85px;
      }
      
      .fab {
        width: 50px;
        height: 50px;
        font-size: 18px;
      }

      header {
        padding: 0 20px;
        height: 65px;
      }

      .quick-stats {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        width: 280px;
        transform: translateX(-280px);
      }
      
      .notification-panel {
        width: 280px;
        right: -80px;
      }
      
      .auto-logout-content {
        padding: 30px 20px;
      }
      
      .countdown-timer {
        font-size: 36px;
      }
    }
  </style>
</head>
<body>
  <!-- AI Chat Interface -->
  <div class="ai-chat-container" id="aiChatContainer">
    <div class="ai-chat-header">
      <div class="ai-chat-title">
        <i class="fas fa-robot"></i>
        <span>BudgetFlow AI Assistant</span>
      </div>
      <button class="close-chat" id="closeChatBtn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="ai-chat-messages" id="aiChatMessages">
      <div class="message ai">
        <div class="message-avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="message-content">
          Hello! I'm your BudgetFlow AI Assistant. I can help you with:
          <div class="quick-actions" id="quickActions">
            <button class="quick-action-btn" onclick="askAI('How can I save more money?')">
               Saving Tips
            </button>
            <button class="quick-action-btn" onclick="askAI('Show me recent transactions')">
               Transactions
            </button>
            <button class="quick-action-btn" onclick="askAI('Create a budget plan')">
               Budget Planning
            </button>
            <button class="quick-action-btn" onclick="askAI('Financial advice for beginners')">
               Financial Advice
            </button>
          </div>
          <div class="message-time">Just now</div>
        </div>
      </div>
    </div>
    
    <div class="ai-chat-input-container">
      <div class="ai-chat-input-wrapper">
        <input type="text" class="ai-chat-input" id="aiChatInput" 
               placeholder="Ask me anything about your finances..." 
               onkeypress="handleChatInputKeypress(event)">
        <button class="ai-send-btn" id="aiSendBtn" onclick="sendAIMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <div class="ai-thinking" id="aiThinking" style="display: none;">
        <div class="typing-indicator">
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
        </div>
        AI is thinking...
      </div>
    </div>
  </div>

  <!-- Auto Logout Modal -->
  <div class="auto-logout-modal" id="autoLogoutModal">
    <div class="auto-logout-content">
      <div class="auto-logout-icon">
        <i class="fas fa-clock"></i>
      </div>
      <h2>Session About to Expire</h2>
      <p>Your session will expire due to inactivity. Please click below to stay logged in.</p>
      <div class="countdown-timer" id="countdownTimer">05:00</div>
      <p>You will be automatically logged out in <span id="countdownText">5 minutes</span></p>
      <div class="auto-logout-buttons">
        <button class="stay-logged-in-btn" id="stayLoggedInBtn">
          <i class="fas fa-user-clock"></i>
          Stay Logged In
        </button>
        <button class="logout-now-btn" id="logoutNowBtn">
          <i class="fas fa-sign-out-alt"></i>
          Logout Now
        </button>
      </div>
    </div>
  </div>

  <!-- Session Warning -->
  <div class="session-warning" id="sessionWarning">
    <i class="fas fa-exclamation-triangle"></i>
    <span>You will be logged out in <span id="warningTimer">5:00</span> due to inactivity</span>
  </div>

  <!-- Budget Modal -->
  <div class="popup" id="budgetModal">
    <div class="popup-content budget-modal">
      <h2><i class="fas fa-wallet"></i> Set Budget Limit</h2>
      
      <div class="budget-form">
        <div class="form-row">
          <div class="form-group">
            <label for="budgetAccount">Account Header</label>
            <select id="budgetAccount" class="form-control">
              <option value="">Select Account Header</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="budgetPeriod">Period</label>
            <select id="budgetPeriod" class="form-control">
              <option value="weekly">Weekly</option>
              <option value="monthly" selected>Monthly</option>
              <option value="quarterly">Quarterly</option>
              <option value="yearly">Yearly</option>
              <option value="custom">Custom</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="budgetLimit">Budget Limit ($)</label>
            <input type="number" id="budgetLimit" class="form-control" placeholder="0.00" step="0.01" min="0">
          </div>
          
          <div class="form-group">
            <label for="budgetAction">When limit crosses</label>
            <select id="budgetAction" class="form-control">
              <option value="alert">Show Alert (Red Color)</option>
              <option value="tally">Tally and Continue</option>
              <option value="carryforward">Carry Forward to Next Period</option>
              <option value="freshstart">Fresh Start (Reset)</option>
            </select>
          </div>
        </div>
        
        <div class="form-group-full" id="customDateRange" style="display: none;">
          <label for="customStartDate">Custom Date Range</label>
          <div style="display: flex; gap: 10px;">
            <input type="date" id="customStartDate" class="form-control" style="flex: 1;">
            <input type="date" id="customEndDate" class="form-control" style="flex: 1;">
          </div>
        </div>
        
        <div class="form-group-full">
          <label for="budgetNotes">Notes (Optional)</label>
          <textarea id="budgetNotes" class="form-control" rows="3" placeholder="Add notes about this budget..."></textarea>
        </div>
      </div>
      
      <div class="budget-preview" id="budgetPreview" style="display: none;">
        <h4>Budget Preview</h4>
        <div class="preview-item">
          <span class="preview-label">Account:</span>
          <span class="preview-value" id="previewAccount"></span>
        </div>
        <div class="preview-item">
          <span class="preview-label">Period:</span>
          <span class="preview-value" id="previewPeriod"></span>
        </div>
        <div class="preview-item">
          <span class="preview-label">Limit:</span>
          <span class="preview-value limit" id="previewLimit"></span>
        </div>
        <div class="preview-item">
          <span class="preview-label">Action on Exceed:</span>
          <span class="preview-value" id="previewAction"></span>
        </div>
        <div class="preview-item" id="previewStatusItem" style="display: none;">
          <span class="preview-label">Status:</span>
          <span class="preview-value" id="previewStatus"></span>
        </div>
      </div>
      
      <button class="classic-btn" id="saveBudgetBtn">
        <i class="fas fa-save"></i> Save Budget
      </button>
      <button class="close-btn" onclick="closeBudgetModal()">
        <i class="fas fa-times"></i> Cancel
      </button>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <i class="fas fa-chart-pie"></i>
          <span>BudgetFlow</span>
        </div>
      </div>
      
      <div class="sidebar-nav">
        <ul>
          <li class="active" onclick="location.href='home.html'">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </li>
          <li onclick="openExpensePopup()">
            <i class="fas fa-wallet"></i>
            <span>Transactions Tracker</span>
          </li>
          <li onclick="location.href='coa.html'">
            <i class="fas fa-book"></i>
            <span>Chart of Accounts</span>
          </li>
          <li onclick="location.href='calculate.html'">
            <i class="fas fa-calculator"></i>
            <span>Financial Calculator</span>
          </li>
          <li onclick="location.href='Debt & Credit Card Tracker.html'">
            <i class="fas fa-credit-card"></i>
            <span>Debt & Credit Card Tracker</span>
          </li>
          <li onclick="location.href='Assets Tracker.html'">
            <i class="fas fa-chart-line"></i>
            <span>Asset Tracker</span>
          </li>
          <li onclick="location.href='Section.html'">
            <i class="fas fa-file-alt"></i>
            <span>Financial Reports</span>
          </li>
          <li onclick="location.href='Genrate Invoice.html'">
            <i class="fas fa-file-invoice-dollar"></i>
            <span>Invoice Generator</span>
          </li>
          <li onclick="location.href='chart.html'">
            <i class="fas fa-chart-pie"></i>
            <span>Analytics & Charts</span>
          </li>
          <li onclick="location.href='Garage.html'">
            <i class="fas fa-car"></i>
            <span>Vehicle Management</span>
          </li>
          <li onclick="location.href='inventory-dashboard.html'">
            <i class="fas fa-table"></i>
            <span>Inventory</span>
          </li>   
          <li onclick="location.href='Appsheet.html'">
            <i class="fas fa-table"></i>
            <span>AppSheet Integration</span>
          </li>   
          <li onclick="location.href='investment.html'">
            <i class="fas fa-chart-bar"></i>
            <span>Investment Portfolio</span>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="userInitials">U</div>
          <div class="user-details">
            <div class="user-name" id="userName">User Name</div>
            <div class="user-email" id="userEmail">user@example.com</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header id="header">
      <i id="menuToggle" class="fa fa-bars"></i>
      <div class="header-title">Dashboard Overview</div>
      <div class="header-controls">
        <div class="datetime-display">
          <div class="current-date" id="currentDate">Monday, January 1, 2023</div>
          <div class="current-time" id="currentTime">12:00:00 PM</div>
        </div>
        
        <!-- Notification Bell -->
        <div class="notification-bell" id="notificationBell">
          <i class="fa fa-bell"></i>
          <div class="notification-badge" id="notificationBadge">0</div>
          <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="clear-notifications" id="clearNotifications">Clear All</button>
            </div>
            <div class="notification-list" id="notificationList">
              <!-- Notifications will be populated here -->
            </div>
          </div>
        </div>
        
        <button class="theme-toggle" id="themeToggle">
          <i class="fa fa-moon"></i>
        </button>
        <div class="profile" id="profileMenu">
          <div class="profile-circle" id="headerUserInitials">U</div>
          <div class="dropdown">
            <a href="#" onclick="openProfile()">
              <i class="fa fa-user"></i> 
              Profile
            </a>
            <a href="#" onclick="logout()">
              <i class="fa fa-sign-out-alt"></i> 
              Logout
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <div class="main" id="main">
      <!-- Filters -->
      <div class="filters">
        <button class="filter-btn active" data-filter="today">
          <i class="fas fa-calendar-day"></i>
          Today
        </button>
        <button class="filter-btn" data-filter="week">
          <i class="fas fa-calendar-week"></i>
          This Week
        </button>
        <button class="filter-btn" data-filter="month">
          <i class="fas fa-calendar-alt"></i>
          This Month
        </button>
        <button class="filter-btn" data-filter="year">
          <i class="fas fa-calendar"></i>
          This Year
        </button>
        <button class="filter-btn" data-filter="all">
          <i class="fas fa-infinity"></i>
          All Time
        </button>
      </div>

      <div class="grid">
        <div class="card dark">
          <h3><i class="fas fa-exchange-alt"></i> Total Transactions</h3>
          <div class="value" id="totalTransactions">0</div>
        </div>
        <div class="card green">
          <h3><i class="fas fa-piggy-bank"></i> Current Balance</h3>
          <div class="value">
            <span id="currentBalance" class="balance-hidden">$0.00</span>
            <button class="balance-toggle" id="balanceToggle">
              <i class="fa fa-eye-slash"></i>
            </button>
          </div>
        </div>
        <div class="card purple">
          <h3><i class="fas fa-arrow-down"></i> Total Income</h3>
          <div class="value" id="totalIncome">$0.00</div>
        </div>
        <div class="card orange">
          <h3><i class="fas fa-arrow-up"></i> Total Expenses</h3>
          <div class="value" id="totalExpenses">$0.00</div>
        </div>
      </div>

      <!-- Calendar -->
      <div class="card">
        <h3><i class="fas fa-calendar-check"></i> Reminders & Events</h3>
        <div id="calendar"></div>
      </div>

      <!-- ========== BUDGET SECTION (ADDED AFTER CALENDAR) ========== -->
      <div class="budget-section">
        <div class="budget-header">
          <h3><i class="fas fa-wallet"></i> Budget Management</h3>
          <div class="budget-actions">
            <button class="budget-btn" onclick="openBudgetModal()">
              <i class="fas fa-plus"></i> Set Budget
            </button>
            <button class="budget-btn warning" onclick="refreshBudgetData()">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
        
        <!-- Budget Period Selector -->
        <div class="budget-period-selector">
          <button class="period-btn active" data-period="monthly">Monthly</button>
          <button class="period-btn" data-period="weekly">Weekly</button>
          <button class="period-btn" data-period="quarterly">Quarterly</button>
          <button class="period-btn" data-period="yearly">Yearly</button>
          <button class="period-btn" data-period="all">All Time</button>
        </div>
        
        <!-- Budget Summary Cards -->
        <div class="budget-summary-cards">
          <div class="summary-card blue">
            <div class="summary-icon blue">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="summary-value" id="totalBudgetLimit">$0.00</div>
            <div class="summary-label">Total Budget Limit</div>
          </div>
          
          <div class="summary-card green">
            <div class="summary-icon green">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="summary-value" id="totalActualSpending">$0.00</div>
            <div class="summary-label">Actual Spending</div>
          </div>
          
          <div class="summary-card red">
            <div class="summary-icon red">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="summary-value" id="overBudgetCount">0</div>
            <div class="summary-label">Accounts Over Budget</div>
          </div>
          
          <div class="summary-card orange">
            <div class="summary-icon orange">
              <i class="fas fa-percentage"></i>
            </div>
            <div class="summary-value" id="avgBudgetUsage">0%</div>
            <div class="summary-label">Average Budget Usage</div>
          </div>
        </div>
        
        <!-- Budget Table -->
        <div class="budget-table-container">
          <table class="budget-table" id="budgetTable">
            <thead>
              <tr>
                <th>Account Header</th>
                <th>Budget Limit</th>
                <th>Actual Spending</th>
                <th>Progress</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="budgetTableBody">
              <tr>
                <td colspan="6" style="text-align: center; padding: 40px;">
                  <div class="budget-empty">
                    <i class="fas fa-wallet"></i>
                    <h4>No Budgets Set Yet</h4>
                    <p>Set budget limits for your account headers to track spending</p>
                    <button class="budget-btn" onclick="openBudgetModal()">
                      <i class="fas fa-plus"></i> Set Your First Budget
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Budget Charts -->
        <div class="budget-charts">
          <div class="budget-chart-card">
            <div class="budget-chart-title">
              <i class="fas fa-chart-pie"></i> Budget Usage
            </div>
            <canvas id="budgetChart" height="250"></canvas>
          </div>
          
          <div class="budget-chart-card">
            <div class="budget-chart-title">
              <i class="fas fa-chart-bar"></i> Top Categories
            </div>
            <canvas id="categoryChart" height="250"></canvas>
          </div>
        </div>
      </div>
      <!-- ========== END OF BUDGET SECTION ========== -->

      <!-- Additional Dashboard Sections -->
      <div class="dashboard-sections">
        <div class="dashboard-section">
          <h3><i class="fas fa-chart-line"></i> Financial Overview</h3>
          <div class="section-content">
            <p>Track your income and expenses with detailed charts and analytics to better understand your financial health.</p>
            <div class="quick-stats">
              <div class="quick-stat">
                <div class="value">$2,540</div>
                <div class="label">Monthly Income</div>
              </div>
              <div class="quick-stat">
                <div class="value">$1,890</div>
                <div class="label">Monthly Expenses</div>
              </div>
              <div class="quick-stat">
                <div class="value">$650</div>
                <div class="label">Monthly Savings</div>
              </div>
              <div class="quick-stat">
                <div class="value">25.6%</div>
                <div class="label">Savings Rate</div>
              </div>
            </div>
          </div>
        </div>

        <div class="dashboard-section">
          <h3><i class="fas fa-bell"></i> Recent Activity</h3>
          <div class="section-content">
            <p>Your most recent transactions and activities at a glance.</p>
            <div class="quick-stats">
              <div class="quick-stat">
                <div class="value">12</div>
                <div class="label">This Week</div>
              </div>
              <div class="quick-stat">
                <div class="value">42</div>
                <div class="label">This Month</div>
              </div>
              <div class="quick-stat">
                <div class="value">5</div>
                <div class="label">Pending</div>
              </div>
              <div class="quick-stat">
                <div class="value">3</div>
                <div class="label">Upcoming</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- New Features Section -->
      <div class="dashboard-section new-features">
        <h3><i class="fas fa-rocket"></i> New Features</h3>
        <div class="section-content">
          <p>Explore these new features to enhance your financial management experience.</p>
          <div class="feature-grid">
            <div class="feature-card" onclick="openBudgetPlanner()">
              <div class="feature-icon">
                <i class="fas fa-chart-pie"></i>
              </div>
              <div class="feature-title">Budget Planner</div>
              <div class="feature-description">Plan and track your monthly budget with visual insights</div>
            </div>
            <div class="feature-card" onclick="openGoalTracker()">
              <div class="feature-icon">
                <i class="fas fa-bullseye"></i>
              </div>
              <div class="feature-title">Goal Tracker</div>
              <div class="feature-description">Set and monitor financial goals with progress tracking</div>
            </div>
            <div class="feature-card" onclick="openBillReminders()">
              <div class="feature-icon">
                <i class="fas fa-file-invoice-dollar"></i>
              </div>
              <div class="feature-title">Bill Reminders</div>
              <div class="feature-description">Never miss a payment with automated bill reminders</div>
            </div>
            <div class="feature-card" onclick="openFinancialInsights()">
              <div class="feature-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="feature-title">Financial Insights</div>
              <div class="feature-description">Get personalized insights to improve your finances</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
      <button class="fab fab-secondary" id="addReminderBtn">
        <i class="fa fa-plus"></i>
      </button>
    </div>

    <!-- AI FAB Button -->
    <button class="ai-fab" id="aiFabBtn">
      <div class="ai-fab-pulse"></div>
      <i class="fas fa-robot"></i>
    </button>

    <!-- Transaction Type Popup -->
    <div class="popup" id="transactionTypePopup">
      <div class="popup-content">
        <h2>Select Transaction View</h2>
        <button class="classic-btn" onclick="location.href='transaction-classic.html'">
          <i class="fas fa-list"></i>
          Classic View
        </button>
        <button class="compact-btn" onclick="location.href='transaction-compact.html'">
          <i class="fas fa-th"></i>
          Compact View
        </button>
        <button class="close-btn" onclick="closeTransactionTypePopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Expense Tracker Popup -->
    <div class="popup" id="expensePopup">
      <div class="popup-content">
        <h2>Select Expense Tracker</h2>
        <button class="classic-btn" onclick="location.href='exp.html'">
          <i class="fas fa-list"></i>
          Classic View
        </button>
        <button class="compact-btn" onclick="location.href='expensemanager.html'">
          <i class="fas fa-th"></i>
          Compact View
        </button>
        <button class="close-btn" onclick="closeExpensePopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Income/Expense Report Popup -->
    <div class="popup" id="reportPopup">
      <div class="popup-content">
        <h2>Select Report Type</h2>
        <button class="trial-balance-btn" onclick="location.href='trialbalance.html'">
          <i class="fas fa-balance-scale"></i>
          Trial Balance
        </button>
        <button class="report-btn" onclick="location.href='Section.html'">
          <i class="fas fa-file-alt"></i>
          Financial Reports
        </button>
        <button class="close-btn" onclick="closeReportPopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Reminder Modal -->
    <div class="popup" id="reminderModal">
      <div class="popup-content">
        <h2>Add Reminder</h2>
        <div class="form-group">
          <label for="reminderType">Type</label>
          <select id="reminderType">
            <option value="reminder">Reminder</option>
            <option value="bill">Bill Payment</option>
            <option value="birthday">Birthday</option>
            <option value="meeting">Meeting</option>
          </select>
        </div>
        <div class="form-group">
          <label for="reminderTitle">Title</label>
          <input type="text" id="reminderTitle" placeholder="Enter title">
        </div>
        <div class="form-group">
          <label for="reminderDate">Date</label>
          <input type="date" id="reminderDate">
        </div>
        <div class="form-group">
          <label for="reminderTime">Time (optional)</label>
          <input type="time" id="reminderTime">
        </div>
        
        <!-- Bill-specific fields -->
        <div class="form-group" id="billAmountGroup" style="display: none;">
          <label for="billAmount">Bill Amount</label>
          <input type="number" id="billAmount" placeholder="0.00" step="0.01" min="0">
        </div>
        
        <div class="form-group" id="recurrenceGroup" style="display: none;">
          <label>Recurrence</label>
          <div class="recurrence-options">
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="none" checked> None
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="daily"> Daily
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="weekly"> Weekly
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="monthly"> Monthly
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="yearly"> Yearly
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="reminderNotes">Notes (optional)</label>
          <textarea id="reminderNotes" rows="3" placeholder="Add notes"></textarea>
        </div>
        <button class="classic-btn" id="saveReminderBtn">
          <i class="fas fa-save"></i>
          Save Reminder
        </button>
        <button class="close-btn" onclick="closeReminderModal()">
          <i class="fas fa-times"></i>
          Cancel
        </button>
      </div>
    </div>

    <!-- Reminder Detail Modal -->
    <div class="popup" id="reminderDetailModal">
      <div class="popup-content reminder-detail-modal">
        <div class="reminder-detail-header">
          <h2>Reminder Details</h2>
        </div>
        <div class="reminder-detail-content">
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Type:</div>
            <div class="reminder-detail-value">
              <span class="reminder-type-badge" id="detailType">Reminder</span>
            </div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Title:</div>
            <div class="reminder-detail-value" id="detailTitle">Title</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Date:</div>
            <div class="reminder-detail-value" id="detailDate">Date</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Time:</div>
            <div class="reminder-detail-value" id="detailTime">Time</div>
          </div>
          <div class="reminder-detail-item" id="detailBillAmountItem" style="display: none;">
            <div class="reminder-detail-label">Amount:</div>
            <div class="reminder-detail-value" id="detailBillAmount">$0.00</div>
          </div>
          <div class="reminder-detail-item" id="detailRecurrenceItem" style="display: none;">
            <div class="reminder-detail-label">Recurrence:</div>
            <div class="reminder-detail-value" id="detailRecurrence">None</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Notes:</div>
            <div class="reminder-detail-value" id="detailNotes">Notes</div>
          </div>
        </div>
        <div class="reminder-actions">
          <button class="classic-btn" id="editReminderBtn">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="close-btn" id="deleteReminderBtn">
            <i class="fas fa-trash"></i> Delete
          </button>
          <button class="close-btn" onclick="closeReminderDetailModal()">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p id="loadingText">Processing...</p>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

  </div>

  <script>
    // ========== BUDGET MANAGEMENT FEATURE ==========
    
    // Budget Elements
    const budgetModal = document.getElementById('budgetModal');
    const budgetTableBody = document.getElementById('budgetTableBody');
    const budgetChartCanvas = document.getElementById('budgetChart');
    const categoryChartCanvas = document.getElementById('categoryChart');
    const periodButtons = document.querySelectorAll('.period-btn');
    const saveBudgetBtn = document.getElementById('saveBudgetBtn');
    
    // Budget State
    let budgetChart = null;
    let categoryChart = null;
    let currentPeriod = 'monthly';
    let budgets = [];
    let transactionsByAccount = {};
    let accountHeaders = [];
    
    // Initialize Budget Management
    async function initBudgetManagement() {
      await loadAccountHeaders();
      await loadBudgets();
      await loadTransactionsForBudget();
      updateBudgetTable();
      updateBudgetSummary();
      createBudgetCharts();
      
      // Set up period selector
      periodButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          periodButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentPeriod = this.dataset.period;
          updateBudgetTable();
          updateBudgetSummary();
        });
      });
      
      // Set up budget modal form
      setupBudgetForm();
    }
    
    // Load account headers from transactions
    async function loadAccountHeaders() {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        const snapshot = await db.collection("users").doc(user.uid).collection("transactions").get();
        accountHeaders = new Set();
        
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.ACCOUNT_HEADER) {
            accountHeaders.add(data.ACCOUNT_HEADER);
          }
        });
        
        // Populate account dropdown in budget modal
        const accountSelect = document.getElementById('budgetAccount');
        accountSelect.innerHTML = '<option value="">Select Account Header</option>';
        accountHeaders.forEach(account => {
          const option = document.createElement('option');
          option.value = account;
          option.textContent = account;
          accountSelect.appendChild(option);
        });
        
      } catch (error) {
        console.error("Error loading account headers:", error);
      }
    }
    
    // Load budgets from Firestore
    async function loadBudgets() {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        const snapshot = await db.collection("users").doc(user.uid).collection("budgets").get();
        budgets = [];
        
        snapshot.forEach(doc => {
          budgets.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
      } catch (error) {
        console.error("Error loading budgets:", error);
      }
    }
    
    // Load transactions for budget calculation
    async function loadTransactionsForBudget() {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        const snapshot = await db.collection("users").doc(user.uid).collection("transactions").get();
        transactionsByAccount = {};
        
        snapshot.forEach(doc => {
          const data = doc.data();
          const account = data.ACCOUNT_HEADER || "Uncategorized";
          const expense = parseFloat(data.EXPENSE) || 0;
          
          if (!transactionsByAccount[account]) {
            transactionsByAccount[account] = 0;
          }
          
          transactionsByAccount[account] += expense;
        });
        
      } catch (error) {
        console.error("Error loading transactions:", error);
      }
    }
    
    // Setup budget form
    function setupBudgetForm() {
      const budgetAccount = document.getElementById('budgetAccount');
      const budgetLimit = document.getElementById('budgetLimit');
      const budgetPeriod = document.getElementById('budgetPeriod');
      const budgetAction = document.getElementById('budgetAction');
      const customDateRange = document.getElementById('customDateRange');
      
      // Show/hide custom date range
      budgetPeriod.addEventListener('change', function() {
        if (this.value === 'custom') {
          customDateRange.style.display = 'block';
          
          // Set default dates
          const today = new Date();
          const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
          document.getElementById('customStartDate').valueAsDate = firstDayOfMonth;
          document.getElementById('customEndDate').valueAsDate = today;
        } else {
          customDateRange.style.display = 'none';
        }
        
        updateBudgetPreview();
      });
      
      // Update preview when form changes
      budgetAccount.addEventListener('change', updateBudgetPreview);
      budgetLimit.addEventListener('input', updateBudgetPreview);
      budgetAction.addEventListener('change', updateBudgetPreview);
      
      // Save budget
      saveBudgetBtn.addEventListener('click', saveBudget);
    }
    
    // Update budget preview
    function updateBudgetPreview() {
      const account = document.getElementById('budgetAccount').value;
      const limit = document.getElementById('budgetLimit').value;
      const period = document.getElementById('budgetPeriod').value;
      const action = document.getElementById('budgetAction').value;
      
      if (account && limit) {
        const preview = document.getElementById('budgetPreview');
        preview.style.display = 'block';
        
        document.getElementById('previewAccount').textContent = account;
        document.getElementById('previewPeriod').textContent = period.charAt(0).toUpperCase() + period.slice(1);
        document.getElementById('previewLimit').textContent = '$' + parseFloat(limit).toFixed(2);
        document.getElementById('previewAction').textContent = action;
        
        // Show current spending if available
        const currentSpending = transactionsByAccount[account] || 0;
        if (currentSpending > 0) {
          const statusItem = document.getElementById('previewStatusItem');
          const status = document.getElementById('previewStatus');
          
          statusItem.style.display = 'flex';
          
          if (currentSpending > parseFloat(limit)) {
            status.textContent = 'Over Budget';
            status.className = 'preview-value over';
          } else {
            status.textContent = 'Under Budget';
            status.className = 'preview-value under';
          }
        }
      } else {
        document.getElementById('budgetPreview').style.display = 'none';
      }
    }
    
    // Open budget modal
    function openBudgetModal() {
      budgetModal.classList.add('active');
    }
    
    // Close budget modal
    function closeBudgetModal() {
      budgetModal.classList.remove('active');
      resetBudgetForm();
    }
    
    // Reset budget form
    function resetBudgetForm() {
      document.getElementById('budgetAccount').value = '';
      document.getElementById('budgetLimit').value = '';
      document.getElementById('budgetPeriod').value = 'monthly';
      document.getElementById('budgetAction').value = 'alert';
      document.getElementById('budgetNotes').value = '';
      document.getElementById('customDateRange').style.display = 'none';
      document.getElementById('budgetPreview').style.display = 'none';
    }
    
    // Save budget to Firestore
    async function saveBudget() {
      const user = auth.currentUser;
      if (!user) return;
      
      const account = document.getElementById('budgetAccount').value;
      const limit = parseFloat(document.getElementById('budgetLimit').value);
      const period = document.getElementById('budgetPeriod').value;
      const action = document.getElementById('budgetAction').value;
      const notes = document.getElementById('budgetNotes').value;
      
      if (!account || !limit || limit <= 0) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      
      try {
        showLoading('Saving budget...');
        
        const budgetData = {
          account: account,
          limit: limit,
          period: period,
          action: action,
          notes: notes,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        // If custom period, add date range
        if (period === 'custom') {
          budgetData.startDate = document.getElementById('customStartDate').value;
          budgetData.endDate = document.getElementById('customEndDate').value;
        }
        
        // Use account as document ID for easy lookup
        const budgetRef = db.collection("users").doc(user.uid).collection("budgets").doc(account);
        await budgetRef.set(budgetData);
        
        closeBudgetModal();
        showToast('Budget saved successfully!', 'success');
        
        // Refresh budget data
        await loadBudgets();
        updateBudgetTable();
        updateBudgetSummary();
        createBudgetCharts();
        
      } catch (error) {
        console.error("Error saving budget:", error);
        showToast('Error saving budget', 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Delete budget
    async function deleteBudget(account) {
      const user = auth.currentUser;
      if (!user) return;
      
      const confirmDelete = confirm(`Are you sure you want to delete the budget for ${account}?`);
      if (!confirmDelete) return;
      
      try {
        showLoading('Deleting budget...');
        
        await db.collection("users").doc(user.uid).collection("budgets").doc(account).delete();
        
        showToast('Budget deleted successfully!', 'success');
        
        // Refresh budget data
        await loadBudgets();
        updateBudgetTable();
        updateBudgetSummary();
        createBudgetCharts();
        
      } catch (error) {
        console.error("Error deleting budget:", error);
        showToast('Error deleting budget', 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Update budget table
    function updateBudgetTable() {
      if (budgets.length === 0) {
        budgetTableBody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px;">
              <div class="budget-empty">
                <i class="fas fa-wallet"></i>
                <h4>No Budgets Set Yet</h4>
                <p>Set budget limits for your account headers to track spending</p>
                <button class="budget-btn" onclick="openBudgetModal()">
                  <i class="fas fa-plus"></i> Set Your First Budget
                </button>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      let html = '';
      let overBudgetCount = 0;
      
      // Filter budgets by current period
      const filteredBudgets = budgets.filter(budget => 
        budget.period === currentPeriod || budget.period === 'all' || currentPeriod === 'all'
      );
      
      if (filteredBudgets.length === 0) {
        html = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px;">
              <div class="budget-empty">
                <i class="fas fa-calendar"></i>
                <h4>No Budgets for ${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)} Period</h4>
                <p>Set budgets for this period or switch to another period view</p>
              </div>
            </td>
          </tr>
        `;
      } else {
        filteredBudgets.forEach(budget => {
          const account = budget.account;
          const limit = budget.limit;
          const actual = transactionsByAccount[account] || 0;
          const percentage = limit > 0 ? Math.min((actual / limit) * 100, 100) : 0;
          const isOverBudget = actual > limit;
          const status = isOverBudget ? 'Over Budget' : 'Under Budget';
          
          if (isOverBudget) overBudgetCount++;
          
          // Determine row class and progress bar color
          const rowClass = isOverBudget ? 'overbudget-row' : 'withinbudget-row';
          const progressBarClass = isOverBudget ? 'over' : (percentage > 80 ? 'warning' : 'under');
          
          html += `
            <tr class="${rowClass}">
              <td>
                <div class="account-name">
                  <i class="fas fa-tag"></i>
                  ${account}
                </div>
              </td>
              <td>
                <div class="budget-amount">$${limit.toFixed(2)}</div>
              </td>
              <td>
                <div class="actual-amount ${isOverBudget ? 'over' : 'under'}">$${actual.toFixed(2)}</div>
              </td>
              <td>
                <div class="budget-progress">
                  <div class="progress-bar ${progressBarClass}" style="width: ${percentage}%"></div>
                </div>
                <div class="budget-percentage">${percentage.toFixed(1)}%</div>
              </td>
              <td>
                <span class="budget-status ${isOverBudget ? 'over' : 'under'}">${status}</span>
              </td>
              <td>
                <div class="budget-actions-cell">
                  <button class="action-icon-btn edit" onclick="editBudget('${account}')" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="action-icon-btn delete" onclick="deleteBudget('${account}')" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        });
      }
      
      budgetTableBody.innerHTML = html;
      
      // Update over budget count
      document.getElementById('overBudgetCount').textContent = overBudgetCount;
    }
    
    // Edit budget
    async function editBudget(account) {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        showLoading('Loading budget details...');
        
        const budgetDoc = await db.collection("users").doc(user.uid).collection("budgets").doc(account).get();
        
        if (budgetDoc.exists) {
          const budget = budgetDoc.data();
          
          // Populate form with existing data
          document.getElementById('budgetAccount').value = budget.account;
          document.getElementById('budgetLimit').value = budget.limit;
          document.getElementById('budgetPeriod').value = budget.period;
          document.getElementById('budgetAction').value = budget.action || 'alert';
          document.getElementById('budgetNotes').value = budget.notes || '';
          
          if (budget.period === 'custom' && budget.startDate && budget.endDate) {
            document.getElementById('customStartDate').value = budget.startDate;
            document.getElementById('customEndDate').value = budget.endDate;
            document.getElementById('customDateRange').style.display = 'block';
          }
          
          // Change save button text
          saveBudgetBtn.innerHTML = '<i class="fas fa-save"></i> Update Budget';
          saveBudgetBtn.onclick = function() { updateExistingBudget(account); };
          
          // Show modal
          openBudgetModal();
          updateBudgetPreview();
        }
        
      } catch (error) {
        console.error("Error loading budget:", error);
        showToast('Error loading budget', 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Update existing budget
    async function updateExistingBudget(account) {
      const user = auth.currentUser;
      if (!user) return;
      
      const limit = parseFloat(document.getElementById('budgetLimit').value);
      const period = document.getElementById('budgetPeriod').value;
      const action = document.getElementById('budgetAction').value;
      const notes = document.getElementById('budgetNotes').value;
      
      if (!limit || limit <= 0) {
        showToast('Please enter a valid budget limit', 'error');
        return;
      }
      
      try {
        showLoading('Updating budget...');
        
        const updateData = {
          limit: limit,
          period: period,
          action: action,
          notes: notes,
          updatedAt: new Date().toISOString()
        };
        
        // If custom period, add date range
        if (period === 'custom') {
          updateData.startDate = document.getElementById('customStartDate').value;
          updateData.endDate = document.getElementById('customEndDate').value;
        }
        
        await db.collection("users").doc(user.uid).collection("budgets").doc(account).update(updateData);
        
        closeBudgetModal();
        showToast('Budget updated successfully!', 'success');
        
        // Reset save button
        saveBudgetBtn.innerHTML = '<i class="fas fa-save"></i> Save Budget';
        saveBudgetBtn.onclick = saveBudget;
        
        // Refresh budget data
        await loadBudgets();
        updateBudgetTable();
        updateBudgetSummary();
        createBudgetCharts();
        
      } catch (error) {
        console.error("Error updating budget:", error);
        showToast('Error updating budget', 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Update budget summary
    function updateBudgetSummary() {
      let totalLimit = 0;
      let totalActual = 0;
      let overBudgetCount = 0;
      let totalPercentage = 0;
      let budgetCount = 0;
      
      // Filter budgets by current period
      const filteredBudgets = budgets.filter(budget => 
        budget.period === currentPeriod || budget.period === 'all' || currentPeriod === 'all'
      );
      
      filteredBudgets.forEach(budget => {
        const account = budget.account;
        const limit = budget.limit;
        const actual = transactionsByAccount[account] || 0;
        const percentage = limit > 0 ? (actual / limit) * 100 : 0;
        
        totalLimit += limit;
        totalActual += actual;
        totalPercentage += percentage;
        budgetCount++;
        
        if (actual > limit) {
          overBudgetCount++;
        }
      });
      
      // Update summary cards
      document.getElementById('totalBudgetLimit').textContent = '$' + totalLimit.toFixed(2);
      document.getElementById('totalActualSpending').textContent = '$' + totalActual.toFixed(2);
      document.getElementById('overBudgetCount').textContent = overBudgetCount;
      
      const avgUsage = budgetCount > 0 ? (totalPercentage / budgetCount) : 0;
      document.getElementById('avgBudgetUsage').textContent = avgUsage.toFixed(1) + '%';
    }
    
    // Create budget charts
    function createBudgetCharts() {
      // Destroy existing charts
      if (budgetChart) budgetChart.destroy();
      if (categoryChart) categoryChart.destroy();
      
      // Filter budgets by current period
      const filteredBudgets = budgets.filter(budget => 
        budget.period === currentPeriod || budget.period === 'all' || currentPeriod === 'all'
      );
      
      if (filteredBudgets.length === 0) {
        // Show placeholder message
        budgetChartCanvas.parentElement.innerHTML = `
          <div class="budget-empty" style="padding: 20px;">
            <i class="fas fa-chart-pie"></i>
            <p>No budget data available for this period</p>
          </div>
        `;
        
        categoryChartCanvas.parentElement.innerHTML = `
          <div class="budget-empty" style="padding: 20px;">
            <i class="fas fa-chart-bar"></i>
            <p>No spending data available</p>
          </div>
        `;
        return;
      }
      
      // Prepare data for budget chart
      const budgetLabels = filteredBudgets.map(b => b.account);
      const budgetLimits = filteredBudgets.map(b => b.limit);
      const budgetActuals = filteredBudgets.map(b => transactionsByAccount[b.account] || 0);
      const budgetColors = filteredBudgets.map((b, i) => {
        const actual = transactionsByAccount[b.account] || 0;
        return actual > b.limit ? '#ef4444' : (actual > b.limit * 0.8 ? '#f59e0b' : '#10b981');
      });
      
      // Create budget chart
      budgetChart = new Chart(budgetChartCanvas, {
        type: 'doughnut',
        data: {
          labels: budgetLabels,
          datasets: [{
            data: budgetActuals,
            backgroundColor: budgetColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                font: {
                  size: 10
                }
              }
            },
            title: {
              display: true,
              text: 'Budget Usage by Account',
              font: {
                size: 14
              }
            }
          }
        }
      });
      
      // Prepare data for category chart (top 5 spending categories)
      const spendingCategories = Object.entries(transactionsByAccount)
        .filter(([account, amount]) => amount > 0)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      const categoryLabels = spendingCategories.map(([account]) => account);
      const categoryAmounts = spendingCategories.map(([, amount]) => amount);
      const categoryColors = ['#4f46e5', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
      
      // Create category chart
      categoryChart = new Chart(categoryChartCanvas, {
        type: 'bar',
        data: {
          labels: categoryLabels,
          datasets: [{
            label: 'Spending',
            data: categoryAmounts,
            backgroundColor: categoryColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: 'Top Spending Categories',
              font: {
                size: 14
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '$' + value;
                }
              }
            }
          }
        }
      });
    }
    
    // Refresh budget data
    async function refreshBudgetData() {
      showLoading('Refreshing budget data...');
      await loadBudgets();
      await loadTransactionsForBudget();
      updateBudgetTable();
      updateBudgetSummary();
      createBudgetCharts();
      hideLoading();
      showToast('Budget data refreshed', 'success');
    }
    
    // Initialize budget management when page loads
    window.addEventListener('load', () => {
      setTimeout(initBudgetManagement, 2000);
    });
    
    // ========== END OF BUDGET MANAGEMENT FEATURE ==========
    
    // All previous JavaScript code remains the same...
    // (Only showing the budget section integration above)
    
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
      authDomain: "budget-app-1365f.firebaseapp.com",
      projectId: "budget-app-1365f",
      storageBucket: "budget-app-1365f.firebasestorage.app",
      messagingSenderId: "1036194450411",
      appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
      measurementId: "G-YFFJL2H54X"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ========== AUTO LOGOUT FEATURE ==========
    // ... (all existing auto logout code remains the same) ...
    // ========== END OF AUTO LOGOUT FEATURE ==========

    // DOM Elements
    const dashboard = document.getElementById("dashboard");
    const sidebar = document.getElementById("sidebar");
    const menuToggle = document.getElementById("menuToggle");
    const header = document.getElementById("header");
    const main = document.getElementById("main");
    const profileMenu = document.getElementById("profileMenu");
    const userInitials = document.getElementById("userInitials");
    const headerUserInitials = document.getElementById("headerUserInitials");
    const userName = document.getElementById("userName");
    const userEmail = document.getElementById("userEmail");
    const addReminderBtn = document.getElementById("addReminderBtn");
    const expensePopup = document.getElementById("expensePopup");
    const reportPopup = document.getElementById("reportPopup");
    const transactionTypePopup = document.getElementById("transactionTypePopup");
    const reminderModal = document.getElementById("reminderModal");
    const reminderDetailModal = document.getElementById("reminderDetailModal");
    const saveReminderBtn = document.getElementById("saveReminderBtn");
    const editReminderBtn = document.getElementById("editReminderBtn");
    const deleteReminderBtn = document.getElementById("deleteReminderBtn");
    const themeToggle = document.getElementById("themeToggle");
    const balanceToggle = document.getElementById("balanceToggle");
    const currentBalanceEl = document.getElementById("currentBalance");
    const filterButtons = document.querySelectorAll('.filter-btn');
    const currentDateEl = document.getElementById("currentDate");
    const currentTimeEl = document.getElementById("currentTime");
    
    // Notification elements
    const notificationBell = document.getElementById("notificationBell");
    const notificationBadge = document.getElementById("notificationBadge");
    const notificationPanel = document.getElementById("notificationPanel");
    const notificationList = document.getElementById("notificationList");
    const clearNotifications = document.getElementById("clearNotifications");
    
    // Reminder detail modal elements
    const detailType = document.getElementById("detailType");
    const detailTitle = document.getElementById("detailTitle");
    const detailDate = document.getElementById("detailDate");
    const detailTime = document.getElementById("detailTime");
    const detailNotes = document.getElementById("detailNotes");
    const detailBillAmount = document.getElementById("detailBillAmount");
    const detailBillAmountItem = document.getElementById("detailBillAmountItem");
    const detailRecurrence = document.getElementById("detailRecurrence");
    const detailRecurrenceItem = document.getElementById("detailRecurrenceItem");
    
    // Bill reminder specific elements
    const reminderType = document.getElementById("reminderType");
    const billAmountGroup = document.getElementById("billAmountGroup");
    const recurrenceGroup = document.getElementById("recurrenceGroup");
    const billAmount = document.getElementById("billAmount");
    
    // New elements
    const loadingOverlay = document.getElementById("loadingOverlay");
    const loadingText = document.getElementById("loadingText");
    const toast = document.getElementById("toast");
    
    // Stats elements
    const totalTransactionsEl = document.getElementById("totalTransactions");
    const totalIncomeEl = document.getElementById("totalIncome");
    const totalExpensesEl = document.getElementById("totalExpenses");

    // Store the currently selected reminder
    let currentReminderId = null;
    let balanceVisible = false;
    let currentFilter = 'today';
    let allTransactions = [];
    let filteredTransactions = [];
    let notifications = [];

    // COA data
    let coaAccounts = [];
    let coaBanks = [];

    // Update date and time
    function updateDateTime() {
      const now = new Date();
      
      // Format date
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      currentDateEl.textContent = now.toLocaleDateString('en-US', options);
      
      // Format time
      currentTimeEl.textContent = now.toLocaleTimeString('en-US');
    }

    // Update date and time immediately and then every second
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // Calendar initialization
    let calendar;
    let selectedDate = null;
    
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: [],
        height: 'auto',
        dateClick: function(info) {
          // When a date is clicked, open reminder modal with that date
          selectedDate = info.dateStr;
          openReminderModalWithDate(selectedDate);
        },
        eventClick: function(info) {
          // When a reminder is clicked, show the detail modal
          showReminderDetails(info.event);
        },
        eventDidMount: function(info) {
          // Add tooltip to events
          info.el.title = info.event.title;
        }
      });
      calendar.render();
    });

    // ... (all other existing functions remain the same) ...

    // Make functions available globally for HTML onclick handlers
    window.openExpensePopup = openExpensePopup;
    window.closeExpensePopup = closeExpensePopup;
    window.closeReportPopup = closeReportPopup;
    window.closeTransactionTypePopup = closeTransactionTypePopup;
    window.closeReminderModal = closeReminderModal;
    window.closeReminderDetailModal = closeReminderDetailModal;
    window.openBudgetPlanner = openBudgetPlanner;
    window.openGoalTracker = openGoalTracker;
    window.openBillReminders = openBillReminders;
    window.openFinancialInsights = openFinancialInsights;
    window.askAI = askAI;
    window.stayLoggedIn = stayLoggedIn;
    window.logoutNow = logoutNow;
    window.toggleAIChat = toggleAIChat;
    
    // Budget functions
    window.openBudgetModal = openBudgetModal;
    window.closeBudgetModal = closeBudgetModal;
    window.refreshBudgetData = refreshBudgetData;
    window.editBudget = editBudget;
    window.deleteBudget = deleteBudget;
  </script>
</body>
</html>