<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>✨ Advanced Budget Analytics & Forecasting</title>

  <!-- CSS libs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --danger-gradient: linear-gradient(135deg, #f83600 0%, #f9d423 100%);
      --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      
      --card-bg: rgba(255, 255, 255, 0.95);
      --sidebar-bg: linear-gradient(180deg, #2c3e50 0%, #1a1a2e 100%);
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --bg-primary: #f7fafc;
      --border-color: rgba(0, 0, 0, 0.08);
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.12);
      --radius: 20px;
      --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="dark"] {
      --primary-gradient: linear-gradient(135deg, #8a2be2 0%, #4a00e0 100%);
      --secondary-gradient: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
      --success-gradient: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
      --warning-gradient: linear-gradient(135deg, #ff5e62 0%, #ff9966 100%);
      --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
      --info-gradient: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%);
      
      --card-bg: rgba(30, 33, 57, 0.95);
      --sidebar-bg: linear-gradient(180deg, #0f0c29 0%, #302b63 100%);
      --text-primary: #f7fafc;
      --text-secondary: #a0aec0;
      --bg-primary: #1a202c;
      --border-color: rgba(255, 255, 255, 0.08);
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: var(--bg-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      color: var(--text-primary);
      transition: var(--transition);
      overflow-x: hidden;
    }

    .glass-effect {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
    }

    .page-wrapper {
      display: flex;
      min-height: 100vh;
      position: relative;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      padding: 30px 20px;
      position: fixed;
      height: 100vh;
      z-index: 1000;
      box-shadow: var(--shadow);
      transition: var(--transition);
      overflow-y: auto;
    }

    .sidebar-header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h2 {
      color: white;
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(45deg, #fff, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
      to { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
    }

    .nav-item {
      margin-bottom: 10px;
      transition: var(--transition);
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 12px 20px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(5px);
    }

    .nav-link.active {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .nav-link i {
      width: 20px;
      text-align: center;
    }

    .theme-switch {
      position: absolute;
      bottom: 30px;
      left: 20px;
      right: 20px;
    }

    .theme-toggle-btn {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 15px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      transition: var(--transition);
    }

    .theme-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 30px;
      transition: var(--transition);
    }

    /* Header */
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      border-radius: var(--radius);
      background: var(--primary-gradient);
      box-shadow: var(--shadow);
      color: white;
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .main-header h1 {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 20px;
      backdrop-filter: blur(10px);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease-out;
      animation-fill-mode: both;
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stat-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--shadow-hover);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: var(--primary-gradient);
    }

    .stat-card.income::before { background: var(--success-gradient); }
    .stat-card.expense::before { background: var(--danger-gradient); }
    .stat-card.savings::before { background: var(--info-gradient); }
    .stat-card.avg-spend::before { background: var(--warning-gradient); }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      margin-bottom: 20px;
      background: var(--primary-gradient);
    }

    .stat-card.income .stat-icon { background: var(--success-gradient); }
    .stat-card.expense .stat-icon { background: var(--danger-gradient); }
    .stat-card.savings .stat-icon { background: var(--info-gradient); }
    .stat-card.avg-spend .stat-icon { background: var(--warning-gradient); }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 5px;
      background: linear-gradient(45deg, var(--text-primary), var(--text-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .stat-trend {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(75, 192, 192, 0.1);
    }

    .trend-up { color: #10b981; background: rgba(16, 185, 129, 0.1); }
    .trend-down { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
    .trend-neutral { color: #6b7280; background: rgba(107, 114, 128, 0.1); }

    /* Charts Section */
    .charts-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .chart-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Analysis Grid */
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .analysis-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      animation: slideInLeft 0.6s ease-out;
    }

    @keyframes slideInLeft {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .analysis-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    /* Expense Items */
    .expense-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
      transition: var(--transition);
      animation: fadeInRight 0.5s ease-out;
    }

    [data-theme="dark"] .expense-item {
      background: rgba(255, 255, 255, 0.05);
    }

    @keyframes fadeInRight {
      from { transform: translateX(20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .expense-item:hover {
      background: rgba(0, 0, 0, 0.05);
      transform: translateX(5px);
    }

    [data-theme="dark"] .expense-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .expense-category {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(99, 102, 241, 0.1);
      color: #6366f1;
    }

    /* Limit Cards */
    .limit-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 15px;
      border-left: 5px solid #6366f1;
      transition: var(--transition);
      animation: bounceIn 0.6s ease-out;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }

    .limit-card.over-limit {
      border-left-color: #ef4444;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    .limit-progress {
      height: 10px;
      border-radius: 5px;
      background: rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin: 10px 0;
    }

    .limit-progress-bar {
      height: 100%;
      border-radius: 5px;
      transition: width 1s ease-in-out;
      background: linear-gradient(90deg, #10b981, #34d399);
    }

    .limit-progress-bar.warning {
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
    }

    .limit-progress-bar.danger {
      background: linear-gradient(90deg, #ef4444, #f87171);
    }

    /* Forecast Card */
    .forecast-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: var(--radius);
      padding: 30px;
      color: white;
      position: relative;
      overflow: hidden;
      animation: slideInRight 0.6s ease-out;
    }

    .forecast-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      transition: var(--transition);
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .btn-success {
      background: var(--success-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .btn-warning {
      background: var(--warning-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }

    /* Modal */
    .modal-content {
      background: var(--card-bg);
      border-radius: var(--radius);
      border: none;
      box-shadow: var(--shadow-hover);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .analysis-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(45deg, #764ba2, #667eea);
    }

    /* Floating Elements */
    .floating-element {
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0) 70%);
      z-index: -1;
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }

    /* Loading Animation */
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(102, 126, 234, 0.1);
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Tooltips */
    [data-tooltip] {
      position: relative;
      cursor: help;
    }

    [data-tooltip]:before {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      font-size: 12px;
      border-radius: 6px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    [data-tooltip]:hover:before {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-5px);
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <!-- Sidebar -->
    <div class="sidebar glass-effect">
      <div class="sidebar-header">
        <h2><i class="fas fa-chart-pie"></i> BudgetMaster</h2>
        <p class="text-muted mt-2" style="color: rgba(255,255,255,0.6); font-size: 14px;">Advanced Analytics Dashboard</p>
      </div>
      
      <nav class="nav flex-column">
        <div class="nav-item">
          <a href="#" class="nav-link active" data-section="overview">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="analytics">
            <i class="fas fa-chart-line"></i>
            <span>Analytics</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="forecasting">
            <i class="fas fa-crystal-ball"></i>
            <span>Forecasting</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="limits">
            <i class="fas fa-tachometer-alt"></i>
            <span>Budget Limits</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="savings">
            <i class="fas fa-piggy-bank"></i>
            <span>Savings Tips</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="reports">
            <i class="fas fa-file-alt"></i>
            <span>Reports</span>
          </a>
        </div>
      </nav>
      
      <div class="theme-switch">
        <button class="theme-toggle-btn glass-effect">
          <i class="fas fa-moon"></i>
          <span>Switch Theme</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="main-header">
        <div>
          <h1 id="pageTitle">Budget Analytics Dashboard</h1>
          <p class="mb-0" style="opacity: 0.9;" id="lastUpdated">Loading data...</p>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div>
            <h6 class="mb-0" id="userName">User</h6>
            <small style="opacity: 0.8;">Premium Member</small>
          </div>
          <button class="btn btn-light btn-sm ms-3" id="refreshBtn">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card income animate__animated animate__fadeInUp">
          <div class="stat-icon">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="stat-value" id="totalIncome">$0.00</div>
          <div class="stat-label">Total Income</div>
          <div class="stat-trend trend-up" id="incomeTrend">
            <i class="fas fa-arrow-up"></i> 12% increase
          </div>
        </div>
        
        <div class="stat-card expense animate__animated animate__fadeInUp">
          <div class="stat-icon">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="stat-value" id="totalExpenses">$0.00</div>
          <div class="stat-label">Total Expenses</div>
          <div class="stat-trend trend-down" id="expenseTrend">
            <i class="fas fa-arrow-down"></i> 8% decrease
          </div>
        </div>
        
        <div class="stat-card savings animate__animated animate__fadeInUp">
          <div class="stat-icon">
            <i class="fas fa-piggy-bank"></i>
          </div>
          <div class="stat-value" id="netSavings">$0.00</div>
          <div class="stat-label">Net Savings</div>
          <div class="stat-trend trend-up" id="savingsRate">
            <i class="fas fa-chart-line"></i> 24% rate
          </div>
        </div>
        
        <div class="stat-card avg-spend animate__animated animate__fadeInUp">
          <div class="stat-icon">
            <i class="fas fa-calendar-day"></i>
          </div>
          <div class="stat-value" id="avgDailySpend">$0.00</div>
          <div class="stat-label">Avg Daily Spend</div>
          <div class="stat-trend trend-neutral" id="spendTrend">
            <i class="fas fa-minus"></i> Stable
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-grid">
        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Income vs Expenses Trend</h3>
            <select class="form-select form-select-sm" style="width: 150px;" id="trendPeriod">
              <option value="month">Last Month</option>
              <option value="quarter">Last Quarter</option>
              <option value="year" selected>Last Year</option>
            </select>
          </div>
          <div class="chart-wrapper">
            <canvas id="trendChart" height="300"></canvas>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Expense Categories</h3>
            <button class="btn btn-sm btn-outline-primary" id="refreshCategories">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
          <div class="chart-wrapper">
            <canvas id="categoryChart" height="300"></canvas>
          </div>
        </div>
      </div>

      <!-- Analysis Grid -->
      <div class="analysis-grid">
        <!-- Top Expenses -->
        <div class="analysis-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="fas fa-fire text-danger me-2"></i>Top 5 Expenses
            </h3>
            <span class="badge bg-primary" id="expenseCount">0</span>
          </div>
          <div id="topExpensesList">
            <div class="expense-item">
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <i class="fas fa-utensils text-warning"></i>
                </div>
                <div>
                  <div class="fw-bold">Loading expenses...</div>
                  <small class="text-muted">Just a moment</small>
                </div>
              </div>
              <div class="expense-category">Loading</div>
            </div>
          </div>
        </div>

        <!-- Budget Limits -->
        <div class="analysis-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="fas fa-tachometer-alt text-info me-2"></i>Active Limits
            </h3>
            <button class="btn btn-sm btn-primary" id="addLimitBtn">
              <i class="fas fa-plus"></i> Add Limit
            </button>
          </div>
          <div id="budgetLimits">
            <div class="limit-card">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <h6 class="mb-0">Food & Dining</h6>
                  <small class="text-muted">Weekly Limit</small>
                </div>
                <span class="badge bg-success">Active</span>
              </div>
              <div class="limit-progress">
                <div class="limit-progress-bar" style="width: 65%"></div>
              </div>
              <div class="d-flex justify-content-between">
                <small>$195 / $300</small>
                <small>65% used</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Savings Suggestions -->
        <div class="analysis-card">
          <div class="chart-header">
            <h3 class="chart-title">
              <i class="fas fa-lightbulb text-warning me-2"></i>Savings Suggestions
            </h3>
            <button class="btn btn-sm btn-outline-warning" id="refreshSuggestions">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
          <div id="savingsSuggestions">
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              Analyzing your spending patterns...
            </div>
          </div>
        </div>

        <!-- Forecast -->
        <div class="forecast-card">
          <div class="chart-header">
            <h3 class="chart-title text-white">
              <i class="fas fa-crystal-ball me-2"></i>Next Month Forecast
            </h3>
            <button class="btn btn-sm btn-light" id="runForecastBtn">
              <i class="fas fa-play"></i> Run
            </button>
          </div>
          <div class="mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <div style="font-size: 12px; opacity: 0.9;">Projected Savings</div>
                <div id="forecastSavings" style="font-size: 28px; font-weight: 700;">$0.00</div>
              </div>
              <div class="stat-trend trend-up bg-white bg-opacity-10">
                <i class="fas fa-arrow-up"></i> Optimistic
              </div>
            </div>
            <div class="progress" style="height: 6px; background: rgba(255,255,255,0.2);">
              <div id="forecastProgress" class="progress-bar bg-success" style="width: 0%"></div>
            </div>
            <div class="row mt-3" style="font-size: 13px;">
              <div class="col-6">
                <div>Projected Income</div>
                <div id="forecastIncome" class="fw-bold">$0.00</div>
              </div>
              <div class="col-6 text-end">
                <div>Projected Expenses</div>
                <div id="forecastExpenses" class="fw-bold">$0.00</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="mt-4 text-center text-muted">
        <small>© 2024 BudgetMaster Analytics | Real-time data analytics</small>
      </div>
    </div>
  </div>

  <!-- Set Limit Modal -->
  <div class="modal fade" id="limitModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-tachometer-alt me-2"></i>Set Budget Limit
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Select Account Header</label>
              <select id="limitAccount" class="form-select">
                <option value="all">All Expenses</option>
                <option value="food">Food & Dining</option>
                <option value="transportation">Transportation</option>
                <option value="shopping">Shopping</option>
                <option value="entertainment">Entertainment</option>
                <option value="utilities">Utilities</option>
                <option value="housing">Housing</option>
                <option value="health">Health & Medical</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Period</label>
              <select id="limitPeriod" class="form-select">
                <option value="weekly">Weekly</option>
                <option value="monthly" selected>Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Limit Amount ($)</label>
              <input type="number" id="limitAmount" class="form-control" placeholder="e.g., 500" min="1" step="0.01">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Alert Threshold (%)</label>
              <div class="d-flex align-items-center gap-3">
                <input type="range" id="alertThreshold" class="form-range" min="50" max="100" step="5" value="80">
                <span class="badge bg-primary" id="thresholdValue">80%</span>
              </div>
              <small class="text-muted">Get notified when you reach this percentage</small>
            </div>
          </div>
          
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            This limit will be applied to all transactions under the selected category for the chosen period.
          </div>
          
          <div class="mt-4">
            <h6>Current Active Limits</h6>
            <div id="activeLimitsList" class="mt-2">
              <!-- Active limits will be listed here -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveLimitBtn">
            <i class="fas fa-save me-1"></i> Save Limit
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Transaction Modal -->
  <div class="modal fade" id="transactionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-plus-circle me-2"></i>Add Transaction
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Description</label>
            <input type="text" id="transDescription" class="form-control" placeholder="e.g., Grocery shopping">
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Type</label>
              <select id="transType" class="form-select">
                <option value="expense">Expense</option>
                <option value="income">Income</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Amount ($)</label>
              <input type="number" id="transAmount" class="form-control" placeholder="0.00" step="0.01" min="0.01">
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select id="transCategory" class="form-select">
              <option value="food">Food & Dining</option>
              <option value="transportation">Transportation</option>
              <option value="shopping">Shopping</option>
              <option value="entertainment">Entertainment</option>
              <option value="utilities">Utilities</option>
              <option value="housing">Housing</option>
              <option value="health">Health & Medical</option>
              <option value="income">Income</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Date</label>
            <input type="date" id="transDate" class="form-control" value="">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="saveTransactionBtn">
            <i class="fas fa-save me-1"></i> Save Transaction
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Modal -->
  <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center py-4">
          <div class="loading-spinner mb-3"></div>
          <p id="loadingMessage" class="mb-0">Loading dashboard...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Main JavaScript Application -->
  <script>
    // ============================================
    // MAIN APPLICATION CLASS
    // ============================================
    class BudgetAnalyticsDashboard {
      constructor() {
        this.currentUser = null;
        this.transactions = [];
        this.budgetLimits = [];
        this.analysisData = {};
        this.trendChart = null;
        this.categoryChart = null;
        this.theme = 'light';
        
        // Initialize demo data
        this.initializeDemoData();
        
        // Initialize the application
        this.init();
      }

      // ============================================
      // INITIALIZATION METHODS
      // ============================================
      init() {
        this.initializeEventListeners();
        this.loadThemePreference();
        this.createFloatingElements();
        this.initializeCharts();
        this.loadDashboard();
        this.setupPeriodicUpdates();
      }

      initializeDemoData() {
        // Sample transactions data
        this.transactions = [
          { id: 1, description: "Salary", type: "income", category: "income", amount: 3500, date: new Date(2024, 0, 15) },
          { id: 2, description: "Freelance Work", type: "income", category: "income", amount: 800, date: new Date(2024, 0, 20) },
          { id: 3, description: "Grocery Shopping", type: "expense", category: "food", amount: 150, date: new Date(2024, 0, 5) },
          { id: 4, description: "Restaurant Dinner", type: "expense", category: "food", amount: 75, date: new Date(2024, 0, 10) },
          { id: 5, description: "Gas Station", type: "expense", category: "transportation", amount: 45, date: new Date(2024, 0, 8) },
          { id: 6, description: "Netflix Subscription", type: "expense", category: "entertainment", amount: 15.99, date: new Date(2024, 0, 1) },
          { id: 7, description: "Electric Bill", type: "expense", category: "utilities", amount: 120, date: new Date(2024, 0, 3) },
          { id: 8, description: "Amazon Purchase", type: "expense", category: "shopping", amount: 89.99, date: new Date(2024, 0, 12) },
          { id: 9, description: "Gym Membership", type: "expense", category: "health", amount: 50, date: new Date(2024, 0, 2) },
          { id: 10, description: "Coffee Shop", type: "expense", category: "food", amount: 5.5, date: new Date(2024, 0, 18) },
          { id: 11, description: "Uber Ride", type: "expense", category: "transportation", amount: 25, date: new Date(2024, 0, 14) },
          { id: 12, description: "Movie Tickets", type: "expense", category: "entertainment", amount: 40, date: new Date(2024, 0, 16) }
        ];

        // Sample budget limits
        this.budgetLimits = [
          { id: 1, category: "food", period: "monthly", amount: 300, alertThreshold: 80, currentSpending: 230.5 },
          { id: 2, category: "transportation", period: "monthly", amount: 200, alertThreshold: 75, currentSpending: 70 },
          { id: 3, category: "entertainment", period: "monthly", amount: 100, alertThreshold: 90, currentSpending: 55.99 }
        ];
      }

      initializeEventListeners() {
        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            this.showSection(link.dataset.section);
          });
        });

        // Theme toggle
        document.querySelector('.theme-toggle-btn').addEventListener('click', () => this.toggleTheme());

        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', () => this.refreshDashboard());

        // Add limit button
        document.getElementById('addLimitBtn').addEventListener('click', () => this.showLimitModal());

        // Save limit button
        document.getElementById('saveLimitBtn').addEventListener('click', () => this.saveBudgetLimit());

        // Alert threshold slider
        document.getElementById('alertThreshold').addEventListener('input', function() {
          document.getElementById('thresholdValue').textContent = `${this.value}%`;
        });

        // Forecast button
        document.getElementById('runForecastBtn').addEventListener('click', () => this.runAdvancedForecast());

        // Refresh categories
        document.getElementById('refreshCategories').addEventListener('click', () => this.updateCategoryChart());

        // Refresh suggestions
        document.getElementById('refreshSuggestions').addEventListener('click', () => this.generateSavingsSuggestions());

        // Add transaction button (if exists)
        const addTransactionBtn = document.getElementById('addTransactionBtn');
        if (addTransactionBtn) {
          addTransactionBtn.addEventListener('click', () => this.showTransactionModal());
        }

        // Save transaction button
        const saveTransactionBtn = document.getElementById('saveTransactionBtn');
        if (saveTransactionBtn) {
          saveTransactionBtn.addEventListener('click', () => this.saveTransaction());
        }

        // Trend period selector
        document.getElementById('trendPeriod').addEventListener('change', () => this.updateTrendChart());
      }

      // ============================================
      // DASHBOARD METHODS
      // ============================================
      loadDashboard() {
        this.showLoading('Analyzing your finances...');
        
        setTimeout(() => {
          this.performComprehensiveAnalysis();
          this.updateAllCharts();
          this.updateBudgetLimitsDisplay();
          this.generateSavingsSuggestions();
          this.updateForecast();
          
          this.hideLoading();
          
          // Show welcome message
          Swal.fire({
            title: 'Welcome to BudgetMaster!',
            text: 'Your dashboard is ready with advanced analytics',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false,
            toast: true,
            position: 'top-end'
          });
        }, 1500);
      }

      refreshDashboard() {
        // Animate refresh button
        const refreshBtn = document.getElementById('refreshBtn');
        refreshBtn.classList.add('animate__animated', 'animate__rotateIn');
        setTimeout(() => {
          refreshBtn.classList.remove('animate__animated', 'animate__rotateIn');
        }, 500);
        
        // Show loading
        Swal.fire({
          title: 'Refreshing Data',
          html: '<div class="loading-spinner"></div>',
          showConfirmButton: false,
          allowOutsideClick: false,
          timer: 1000
        });
        
        // Re-analyze data
        setTimeout(() => {
          this.performComprehensiveAnalysis();
          this.updateAllCharts();
          
          Swal.fire({
            icon: 'success',
            title: 'Dashboard Updated!',
            text: 'All analytics have been refreshed',
            timer: 2000,
            showConfirmButton: false,
            toast: true,
            position: 'top-end'
          });
        }, 1000);
      }

      performComprehensiveAnalysis() {
        // Calculate total income
        const totalIncome = this.transactions
          .filter(t => t.type === 'income')
          .reduce((sum, t) => sum + t.amount, 0);
        
        // Calculate total expenses
        const totalExpenses = this.transactions
          .filter(t => t.type === 'expense')
          .reduce((sum, t) => sum + t.amount, 0);
        
        // Calculate net savings
        const netSavings = totalIncome - totalExpenses;
        
        // Calculate savings rate
        const savingsRate = totalIncome > 0 ? (netSavings / totalIncome) * 100 : 0;
        
        // Calculate average daily spend (last 30 days)
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        
        const recentExpenses = this.transactions.filter(t => 
          t.type === 'expense' && t.date >= thirtyDaysAgo
        );
        const avgDailySpend = recentExpenses.length > 0 
          ? recentExpenses.reduce((sum, t) => sum + t.amount, 0) / 30 
          : 0;
        
        // Categorize expenses
        const categories = {};
        this.transactions
          .filter(t => t.type === 'expense')
          .forEach(t => {
            categories[t.category] = (categories[t.category] || 0) + t.amount;
          });
        
        // Get top 5 expenses
        const topExpenses = [...this.transactions]
          .filter(t => t.type === 'expense')
          .sort((a, b) => b.amount - a.amount)
          .slice(0, 5);
        
        // Update analysis data
        this.analysisData = {
          totalIncome,
          totalExpenses,
          netSavings,
          savingsRate,
          avgDailySpend,
          categories,
          topExpenses
        };
        
        // Update UI
        this.updateMetrics();
        this.updateTopExpenses();
      }

      updateMetrics() {
        // Animate value changes
        this.animateValueChange('totalIncome', this.analysisData.totalIncome);
        this.animateValueChange('totalExpenses', this.analysisData.totalExpenses);
        this.animateValueChange('netSavings', this.analysisData.netSavings);
        this.animateValueChange('avgDailySpend', this.analysisData.avgDailySpend);
        
        // Update trends
        this.updateTrendIndicators();
        
        // Update expense count
        document.getElementById('expenseCount').textContent = 
          this.analysisData.topExpenses.length > 5 ? '5+' : this.analysisData.topExpenses.length;
      }

      animateValueChange(elementId, targetValue) {
        const element = document.getElementById(elementId);
        const currentValue = parseFloat(element.textContent.replace(/[^0-9.-]+/g, '')) || 0;
        const duration = 1000;
        const steps = 60;
        const stepValue = (targetValue - currentValue) / steps;
        let currentStep = 0;
        
        const interval = setInterval(() => {
          if (currentStep >= steps) {
            element.textContent = `$${targetValue.toFixed(2)}`;
            clearInterval(interval);
            return;
          }
          
          const newValue = currentValue + (stepValue * currentStep);
          element.textContent = `$${newValue.toFixed(2)}`;
          currentStep++;
        }, duration / steps);
      }

      updateTrendIndicators() {
        // Calculate mock trends (in real app, compare with previous period)
        const incomeTrend = this.analysisData.totalIncome > 3000 ? 'up' : 'neutral';
        const expenseTrend = this.analysisData.totalExpenses < 2000 ? 'down' : 'neutral';
        const savingsTrend = this.analysisData.savingsRate > 20 ? 'up' : 'neutral';
        const spendTrend = this.analysisData.avgDailySpend < 100 ? 'down' : 'neutral';
        
        this.updateTrendElement('incomeTrend', incomeTrend, '12% increase');
        this.updateTrendElement('expenseTrend', expenseTrend, '8% decrease');
        this.updateTrendElement('savingsRate', savingsTrend, `${this.analysisData.savingsRate.toFixed(1)}% rate`);
        this.updateTrendElement('spendTrend', spendTrend, 'Stable');
      }

      updateTrendElement(elementId, trend, text) {
        const element = document.getElementById(elementId);
        const icon = trend === 'up' ? 'fa-arrow-up' : trend === 'down' ? 'fa-arrow-down' : 'fa-minus';
        const trendClass = trend === 'up' ? 'trend-up' : trend === 'down' ? 'trend-down' : 'trend-neutral';
        
        element.className = `stat-trend ${trendClass}`;
        element.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
      }

      // ============================================
      // CHART METHODS
      // ============================================
      initializeCharts() {
        this.createTrendChart();
        this.createCategoryChart();
      }

      updateAllCharts() {
        this.updateTrendChart();
        this.updateCategoryChart();
      }

      createTrendChart() {
        const ctx = document.getElementById('trendChart').getContext('2d');
        
        // Sample monthly data
        const months = ['Oct', 'Nov', 'Dec', 'Jan', 'Feb'];
        const incomeData = [3200, 3500, 3800, 4300, 3500];
        const expenseData = [2800, 3000, 3200, 3500, 2500];
        
        // Create gradient
        const incomeGradient = ctx.createLinearGradient(0, 0, 0, 400);
        incomeGradient.addColorStop(0, 'rgba(16, 185, 129, 0.8)');
        incomeGradient.addColorStop(1, 'rgba(16, 185, 129, 0.1)');
        
        const expenseGradient = ctx.createLinearGradient(0, 0, 0, 400);
        expenseGradient.addColorStop(0, 'rgba(239, 68, 68, 0.8)');
        expenseGradient.addColorStop(1, 'rgba(239, 68, 68, 0.1)');
        
        this.trendChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: months,
            datasets: [
              {
                label: 'Income',
                data: incomeData,
                borderColor: '#10b981',
                backgroundColor: incomeGradient,
                tension: 0.4,
                fill: true,
                borderWidth: 3,
                pointBackgroundColor: '#10b981',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
              },
              {
                label: 'Expenses',
                data: expenseData,
                borderColor: '#ef4444',
                backgroundColor: expenseGradient,
                tension: 0.4,
                fill: true,
                borderWidth: 3,
                pointBackgroundColor: '#ef4444',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
              }
            ]
          },
          options: this.getChartOptions('Income vs Expenses Trend')
        });
      }

      updateTrendChart() {
        if (!this.trendChart) return;
        
        const period = document.getElementById('trendPeriod').value;
        let months, incomeData, expenseData;
        
        switch(period) {
          case 'month':
            months = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            incomeData = [800, 850, 900, 950];
            expenseData = [700, 750, 800, 650];
            break;
          case 'quarter':
            months = ['Oct', 'Nov', 'Dec'];
            incomeData = [3200, 3500, 3800];
            expenseData = [2800, 3000, 3200];
            break;
          default: // year
            months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            incomeData = [3200, 3500, 3400, 3600, 3800, 4000, 4200, 4100, 4300, 4200, 4400, 4500];
            expenseData = [2800, 3000, 2900, 3100, 3200, 3300, 3400, 3300, 3500, 3400, 3600, 3700];
        }
        
        this.trendChart.data.labels = months;
        this.trendChart.data.datasets[0].data = incomeData;
        this.trendChart.data.datasets[1].data = expenseData;
        this.trendChart.update();
      }

      createCategoryChart() {
        const ctx = document.getElementById('categoryChart').getContext('2d');
        
        // Get category data from analysis
        const categories = this.analysisData.categories;
        const labels = Object.keys(categories).map(key => 
          key.charAt(0).toUpperCase() + key.slice(1)
        );
        const data = Object.values(categories);
        
        // Colors
        const colors = [
          '#ef4444', // Red - Food
          '#f59e0b', // Yellow - Transportation
          '#10b981', // Green - Shopping
          '#3b82f6', // Blue - Entertainment
          '#8b5cf6', // Purple - Utilities
          '#ec4899', // Pink - Health
          '#14b8a6'  // Teal - Housing
        ];
        
        this.categoryChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: colors.slice(0, labels.length),
              borderColor: this.theme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 1)',
              borderWidth: 2,
              hoverOffset: 20
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                  font: {
                    size: 11,
                    family: 'Inter'
                  },
                  padding: 20
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const value = context.parsed;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${context.label}: $${value.toFixed(2)} (${percentage}%)`;
                  }
                }
              }
            },
            animation: {
              animateScale: true,
              animateRotate: true,
              duration: 2000
            }
          }
        });
      }

      updateCategoryChart() {
        if (!this.categoryChart) return;
        
        // Update with current category data
        const categories = this.analysisData.categories;
        const labels = Object.keys(categories).map(key => 
          key.charAt(0).toUpperCase() + key.slice(1)
        );
        const data = Object.values(categories);
        
        this.categoryChart.data.labels = labels;
        this.categoryChart.data.datasets[0].data = data;
        this.categoryChart.update();
      }

      getChartOptions(title) {
        return {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                font: {
                  size: 13,
                  family: 'Inter'
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#fff',
              bodyColor: '#fff',
              borderColor: '#667eea',
              borderWidth: 1,
              cornerRadius: 8,
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color'),
                drawBorder: false
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                font: {
                  size: 11
                }
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color'),
                drawBorder: false
              },
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary'),
                font: {
                  size: 11
                },
                callback: function(value) {
                  return '$' + value;
                }
              }
            }
          },
          animation: {
            duration: 2000,
            easing: 'easeOutQuart'
          }
        };
      }

      // ============================================
      // BUDGET LIMITS METHODS
      // ============================================
      showLimitModal() {
        const modal = new bootstrap.Modal(document.getElementById('limitModal'));
        this.updateActiveLimitsList();
        modal.show();
      }

      saveBudgetLimit() {
        const category = document.getElementById('limitAccount').value;
        const period = document.getElementById('limitPeriod').value;
        const amount = parseFloat(document.getElementById('limitAmount').value);
        const alertThreshold = parseInt(document.getElementById('alertThreshold').value);
        
        // Validation
        if (!category) {
          Swal.fire({
            icon: 'error',
            title: 'Missing Category',
            text: 'Please select a category for this limit'
          });
          return;
        }
        
        if (!amount || amount <= 0) {
          Swal.fire({
            icon: 'error',
            title: 'Invalid Amount',
            text: 'Please enter a valid limit amount greater than 0'
          });
          return;
        }
        
        // Create new limit
        const newLimit = {
          id: Date.now(),
          category,
          period,
          amount,
          alertThreshold,
          currentSpending: 0
        };
        
        // Calculate current spending for this category
        const currentSpending = this.transactions
          .filter(t => t.type === 'expense' && t.category === category)
          .reduce((sum, t) => sum + t.amount, 0);
        
        newLimit.currentSpending = currentSpending;
        
        // Add to limits
        this.budgetLimits.push(newLimit);
        
        // Reset form
        document.getElementById('limitAmount').value = '';
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('limitModal')).hide();
        
        // Update display
        this.updateBudgetLimitsDisplay();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Limit Saved!',
          text: `Budget limit set for ${category} (${period})`,
          showConfirmButton: false,
          timer: 2000,
          position: 'top-end',
          toast: true
        });
      }

      updateBudgetLimitsDisplay() {
        const container = document.getElementById('budgetLimits');
        
        if (this.budgetLimits.length === 0) {
          container.innerHTML = `
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              No budget limits set. Click "Add Limit" to create your first limit.
            </div>
          `;
          return;
        }
        
        let html = '';
        this.budgetLimits.forEach((limit, index) => {
          const percentage = (limit.currentSpending / limit.amount) * 100;
          const isOverLimit = limit.currentSpending > limit.amount;
          const isNearLimit = percentage >= limit.alertThreshold && !isOverLimit;
          
          // Progress bar color
          let progressClass = '';
          if (isOverLimit) {
            progressClass = 'danger';
          } else if (isNearLimit) {
            progressClass = 'warning';
          } else {
            progressClass = 'success';
          }
          
          // Period badge
          const periodBadges = {
            'weekly': 'primary',
            'monthly': 'success',
            'quarterly': 'info',
            'yearly': 'warning'
          };
          
          const periodBadge = periodBadges[limit.period] || 'secondary';
          
          // Category display name
          const categoryNames = {
            'food': 'Food & Dining',
            'transportation': 'Transportation',
            'shopping': 'Shopping',
            'entertainment': 'Entertainment',
            'utilities': 'Utilities',
            'housing': 'Housing',
            'health': 'Health & Medical',
            'all': 'All Expenses'
          };
          
          const categoryName = categoryNames[limit.category] || limit.category;
          
          // Add animation
          const animationDelay = index * 0.1;
          
          html += `
            <div class="limit-card animate__animated animate__fadeInUp ${isOverLimit ? 'over-limit' : ''}"
                 style="animation-delay: ${animationDelay}s">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <h6 class="mb-0">${categoryName}</h6>
                  <small class="text-muted">${limit.period.charAt(0).toUpperCase() + limit.period.slice(1)} Limit</small>
                </div>
                <span class="badge bg-${periodBadge}">${limit.period}</span>
              </div>
              <div class="limit-progress">
                <div class="limit-progress-bar ${progressClass}" style="width: ${Math.min(percentage, 100)}%"></div>
              </div>
              <div class="d-flex justify-content-between">
                <small>$${limit.currentSpending.toFixed(2)} / $${limit.amount.toFixed(2)}</small>
                <small class="${isOverLimit ? 'text-danger' : isNearLimit ? 'text-warning' : 'text-success'}">
                  ${percentage.toFixed(1)}% used
                </small>
              </div>
              ${isOverLimit ? `
                <div class="mt-2 alert alert-danger py-1">
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  Over limit by $${(limit.currentSpending - limit.amount).toFixed(2)}
                </div>
              ` : ''}
              <button class="btn btn-sm btn-outline-danger mt-2 delete-limit" data-id="${limit.id}">
                <i class="fas fa-trash me-1"></i> Remove Limit
              </button>
            </div>
          `;
        });
        
        container.innerHTML = html;
        
        // Add delete event listeners
        document.querySelectorAll('.delete-limit').forEach(button => {
          button.addEventListener('click', (e) => {
            const limitId = parseInt(e.target.closest('button').dataset.id);
            this.deleteBudgetLimit(limitId);
          });
        });
        
        // Also update active limits in modal
        this.updateActiveLimitsList();
      }

      updateActiveLimitsList() {
        const container = document.getElementById('activeLimitsList');
        
        if (this.budgetLimits.length === 0) {
          container.innerHTML = '<div class="text-muted text-center py-3">No active limits</div>';
          return;
        }
        
        let html = '<div class="list-group">';
        this.budgetLimits.forEach(limit => {
          const percentage = (limit.currentSpending / limit.amount) * 100;
          
          html += `
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-bold">${limit.category}</div>
                <small class="text-muted">${limit.period} • Alert at ${limit.alertThreshold}%</small>
              </div>
              <div>
                <span class="badge bg-${percentage > 100 ? 'danger' : percentage > 80 ? 'warning' : 'primary'}">
                  ${percentage.toFixed(1)}%
                </span>
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
      }

      deleteBudgetLimit(limitId) {
        Swal.fire({
          title: 'Delete Limit?',
          text: 'Are you sure you want to delete this budget limit?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          confirmButtonText: 'Yes, delete it',
          cancelButtonText: 'Cancel',
          reverseButtons: true
        }).then((result) => {
          if (result.isConfirmed) {
            // Remove limit
            this.budgetLimits = this.budgetLimits.filter(limit => limit.id !== limitId);
            
            // Update display
            this.updateBudgetLimitsDisplay();
            
            Swal.fire({
              icon: 'success',
              title: 'Deleted!',
              text: 'Budget limit has been deleted',
              timer: 2000,
              showConfirmButton: false,
              toast: true,
              position: 'top-end'
            });
          }
        });
      }

      // ============================================
      // EXPENSE METHODS
      // ============================================
      updateTopExpenses() {
        const container = document.getElementById('topExpensesList');
        const topExpenses = this.analysisData.topExpenses;
        
        if (topExpenses.length === 0) {
          container.innerHTML = `
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              No expenses recorded yet. Add transactions to see your top expenses.
            </div>
          `;
          return;
        }
        
        let html = '';
        topExpenses.forEach((expense, index) => {
          const date = expense.date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric' 
          });
          
          const categoryColors = {
            'food': 'warning',
            'transportation': 'info',
            'shopping': 'success',
            'entertainment': 'primary',
            'utilities': 'purple',
            'health': 'danger',
            'housing': 'teal',
            'other': 'secondary'
          };
          
          const categoryColor = categoryColors[expense.category] || 'secondary';
          const categoryNames = {
            'food': 'Food',
            'transportation': 'Transport',
            'shopping': 'Shopping',
            'entertainment': 'Entertainment',
            'utilities': 'Utilities',
            'health': 'Health',
            'housing': 'Housing',
            'other': 'Other'
          };
          
          // Add animation delay
          const animationDelay = index * 0.1;
          
          html += `
            <div class="expense-item animate__animated animate__fadeInRight" 
                 style="animation-delay: ${animationDelay}s">
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <div class="rounded-circle bg-${categoryColor} bg-opacity-10 p-2">
                    <i class="fas fa-${this.getCategoryIcon(expense.category)} text-${categoryColor}"></i>
                  </div>
                </div>
                <div>
                  <div class="fw-bold">${this.escapeHtml(expense.description)}</div>
                  <small class="text-muted">${date}</small>
                </div>
              </div>
              <div>
                <div class="fw-bold text-danger">$${expense.amount.toFixed(2)}</div>
                <span class="badge bg-${categoryColor} bg-opacity-10 text-${categoryColor}">
                  ${categoryNames[expense.category] || expense.category}
                </span>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      }

      getCategoryIcon(category) {
        const icons = {
          'food': 'utensils',
          'transportation': 'car',
          'shopping': 'shopping-bag',
          'entertainment': 'film',
          'utilities': 'bolt',
          'health': 'heartbeat',
          'housing': 'home',
          'income': 'money-bill-wave',
          'other': 'tag'
        };
        return icons[category] || 'tag';
      }

      // ============================================
      // SAVINGS SUGGESTIONS
      // ============================================
      generateSavingsSuggestions() {
        const container = document.getElementById('savingsSuggestions');
        
        if (this.analysisData.topExpenses.length === 0) {
          container.innerHTML = `
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              Add more transactions to get personalized savings suggestions.
            </div>
          `;
          return;
        }
        
        const suggestions = this.getSavingsSuggestions();
        
        let html = '';
        suggestions.forEach((suggestion, index) => {
          const animationDelay = index * 0.2;
          
          html += `
            <div class="alert alert-${suggestion.type} animate__animated animate__fadeInLeft"
                 style="animation-delay: ${animationDelay}s">
              <div class="d-flex align-items-start">
                <div class="me-3">
                  <i class="fas fa-${suggestion.icon} fa-lg"></i>
                </div>
                <div>
                  <h6 class="mb-1">${suggestion.title}</h6>
                  <p class="mb-0" style="font-size: 13px;">${suggestion.message}</p>
                </div>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      }

      getSavingsSuggestions() {
        const suggestions = [];
        
        // Check for high food spending
        const foodSpending = this.analysisData.categories.food || 0;
        if (foodSpending > 300) {
          suggestions.push({
            title: 'Reduce Food Spending',
            message: `You're spending $${foodSpending.toFixed(2)} on food. Consider meal prepping to save money.`,
            type: 'warning',
            icon: 'utensils'
          });
        }
        
        // Check for high daily spending
        if (this.analysisData.avgDailySpend > 75) {
          suggestions.push({
            title: 'High Daily Spending',
            message: `Your average daily spend is $${this.analysisData.avgDailySpend.toFixed(2)}. Try setting a daily budget.`,
            type: 'danger',
            icon: 'calendar-day'
          });
        }
        
        // Check for low savings rate
        if (this.analysisData.savingsRate < 20) {
          suggestions.push({
            title: 'Increase Savings Rate',
            message: `Your savings rate is ${this.analysisData.savingsRate.toFixed(1)}%. Aim for at least 20%.`,
            type: 'warning',
            icon: 'chart-line'
          });
        }
        
        // Check for subscription services
        const entertainmentSpending = this.analysisData.categories.entertainment || 0;
        if (entertainmentSpending > 50) {
          suggestions.push({
            title: 'Review Subscriptions',
            message: `You're spending $${entertainmentSpending.toFixed(2)} on entertainment. Cancel unused subscriptions.`,
            type: 'info',
            icon: 'tv'
          });
        }
        
        // Positive reinforcement for good savings
        if (this.analysisData.savingsRate >= 30) {
          suggestions.push({
            title: 'Great Savings Rate!',
            message: `Your savings rate of ${this.analysisData.savingsRate.toFixed(1)}% is excellent!`,
            type: 'success',
            icon: 'trophy'
          });
        }
        
        // If no specific suggestions, provide general advice
        if (suggestions.length === 0) {
          suggestions.push({
            title: 'Track Your Spending',
            message: 'Continue tracking all expenses to identify more savings opportunities.',
            type: 'info',
            icon: 'chart-bar'
          });
        }
        
        return suggestions.slice(0, 3);
      }

      // ============================================
      // FORECASTING METHODS
      // ============================================
      updateForecast() {
        // Calculate forecast based on historical data
        const forecastIncome = this.analysisData.totalIncome * 1.05; // 5% growth
        const forecastExpenses = this.analysisData.totalExpenses * 0.95; // 5% reduction
        const forecastSavings = forecastIncome - forecastExpenses;
        const forecastSavingsRate = forecastIncome > 0 ? (forecastSavings / forecastIncome) * 100 : 0;
        
        // Update forecast display
        document.getElementById('forecastIncome').textContent = `$${forecastIncome.toFixed(2)}`;
        document.getElementById('forecastExpenses').textContent = `$${forecastExpenses.toFixed(2)}`;
        document.getElementById('forecastSavings').textContent = `$${forecastSavings.toFixed(2)}`;
        
        // Update progress bar
        const progress = Math.min(Math.max(forecastSavingsRate, 0), 100);
        document.getElementById('forecastProgress').style.width = `${progress}%`;
        
        // Update last updated time
        document.getElementById('lastUpdated').textContent = 
          `Updated: ${new Date().toLocaleTimeString()}`;
      }

      runAdvancedForecast() {
        Swal.fire({
          title: 'Running Advanced Forecast',
          html: `
            <div class="text-center py-3">
              <div class="loading-spinner mb-3"></div>
              <p>Analyzing patterns and trends with machine learning...</p>
            </div>
          `,
          showConfirmButton: false,
          allowOutsideClick: false
        });
        
        setTimeout(() => {
          // Advanced forecast calculation
          const historicalMonths = 6;
          const incomeGrowth = 1.08; // 8% growth
          const expenseReduction = 0.92; // 8% reduction
          
          const forecastIncome = this.analysisData.totalIncome * incomeGrowth;
          const forecastExpenses = this.analysisData.totalExpenses * expenseReduction;
          const forecastSavings = forecastIncome - forecastExpenses;
          const confidence = 85; // Confidence percentage
          
          Swal.fire({
            title: 'Advanced Forecast Complete!',
            html: `
              <div class="text-center">
                <i class="fas fa-brain fa-3x text-primary mb-3"></i>
                <h4>AI-Powered Projection</h4>
                <div class="row mt-3">
                  <div class="col-6">
                    <div class="text-success">Income</div>
                    <div class="h4">$${forecastIncome.toFixed(2)}</div>
                  </div>
                  <div class="col-6">
                    <div class="text-danger">Expenses</div>
                    <div class="h4">$${forecastExpenses.toFixed(2)}</div>
                  </div>
                </div>
                <div class="mt-3 p-3 bg-primary bg-opacity-10 rounded">
                  <div>Projected Savings (${confidence}% confidence)</div>
                  <div class="h3 text-success">$${forecastSavings.toFixed(2)}</div>
                </div>
                <small class="text-muted mt-2 d-block">Based on ${historicalMonths} months of data analysis</small>
              </div>
            `,
            confirmButtonText: 'Apply Forecast',
            showCancelButton: true
          }).then((result) => {
            if (result.isConfirmed) {
              this.updateForecastWithAdvancedData(forecastIncome, forecastExpenses, forecastSavings);
            }
          });
        }, 2000);
      }

      updateForecastWithAdvancedData(income, expenses, savings) {
        document.getElementById('forecastIncome').textContent = `$${income.toFixed(2)}`;
        document.getElementById('forecastExpenses').textContent = `$${expenses.toFixed(2)}`;
        document.getElementById('forecastSavings').textContent = `$${savings.toFixed(2)}`;
        
        const savingsRate = income > 0 ? (savings / income) * 100 : 0;
        const progress = Math.min(Math.max(savingsRate, 0), 100);
        document.getElementById('forecastProgress').style.width = `${progress}%`;
        
        // Update trend indicator
        const trendElement = document.querySelector('.forecast-card .stat-trend');
        if (savingsRate > 25) {
          trendElement.className = 'stat-trend trend-up bg-white bg-opacity-10';
          trendElement.innerHTML = '<i class="fas fa-arrow-up"></i> Strong Growth';
        } else if (savingsRate < 15) {
          trendElement.className = 'stat-trend trend-down bg-white bg-opacity-10';
          trendElement.innerHTML = '<i class="fas fa-arrow-down"></i> Needs Improvement';
        } else {
          trendElement.className = 'stat-trend trend-neutral bg-white bg-opacity-10';
          trendElement.innerHTML = '<i class="fas fa-minus"></i> Stable';
        }
        
        // Animate update
        const forecastCard = document.querySelector('.forecast-card');
        forecastCard.classList.add('animate__animated', 'animate__pulse');
        setTimeout(() => {
          forecastCard.classList.remove('animate__animated', 'animate__pulse');
        }, 1000);
      }

      // ============================================
      // TRANSACTION METHODS
      // ============================================
      showTransactionModal() {
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('transDate').value = today;
        
        const modal = new bootstrap.Modal(document.getElementById('transactionModal'));
        modal.show();
      }

      saveTransaction() {
        const description = document.getElementById('transDescription').value;
        const type = document.getElementById('transType').value;
        const amount = parseFloat(document.getElementById('transAmount').value);
        const category = document.getElementById('transCategory').value;
        const date = new Date(document.getElementById('transDate').value);
        
        // Validation
        if (!description || !amount) {
          Swal.fire({
            icon: 'error',
            title: 'Missing Information',
            text: 'Please fill in all required fields'
          });
          return;
        }
        
        if (amount <= 0) {
          Swal.fire({
            icon: 'error',
            title: 'Invalid Amount',
            text: 'Please enter a valid amount greater than 0'
          });
          return;
        }
        
        // Create new transaction
        const newTransaction = {
          id: Date.now(),
          description,
          type,
          category,
          amount,
          date
        };
        
        // Add to transactions
        this.transactions.push(newTransaction);
        
        // Update current spending in relevant budget limits
        if (type === 'expense') {
          this.budgetLimits.forEach(limit => {
            if (limit.category === category || limit.category === 'all') {
              limit.currentSpending += amount;
            }
          });
        }
        
        // Reset form
        document.getElementById('transDescription').value = '';
        document.getElementById('transAmount').value = '';
        document.getElementById('transDescription').focus();
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('transactionModal')).hide();
        
        // Update dashboard
        this.performComprehensiveAnalysis();
        this.updateAllCharts();
        this.updateBudgetLimitsDisplay();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Transaction Saved!',
          text: `${type === 'income' ? 'Income' : 'Expense'} of $${amount.toFixed(2)} added`,
          timer: 2000,
          showConfirmButton: false,
          toast: true,
          position: 'top-end'
        });
      }

      // ============================================
      // UI/UX METHODS
      // ============================================
      showSection(section) {
        // Update page title
        const sectionTitles = {
          'overview': 'Budget Analytics Dashboard',
          'analytics': 'Advanced Analytics',
          'forecasting': 'Financial Forecasting',
          'limits': 'Budget Limits Manager',
          'savings': 'Savings Optimization',
          'reports': 'Detailed Reports'
        };
        
        document.getElementById('pageTitle').textContent = 
          sectionTitles[section] || 'Budget Analytics Dashboard';
        
        // Add animation to current content
        const mainContent = document.querySelector('.main-content');
        mainContent.classList.add('animate__animated', 'animate__fadeIn');
        setTimeout(() => {
          mainContent.classList.remove('animate__animated', 'animate__fadeIn');
        }, 500);
      }

      toggleTheme() {
        this.theme = this.theme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', this.theme);
        localStorage.setItem('theme', this.theme);
        
        // Update theme toggle button
        const themeBtn = document.querySelector('.theme-toggle-btn');
        const icon = this.theme === 'light' ? 'fa-moon' : 'fa-sun';
        themeBtn.innerHTML = `<i class="fas ${icon}"></i> Switch Theme`;
        
        // Animate theme change
        document.body.classList.add('animate__animated', 'animate__fadeIn');
        setTimeout(() => {
          document.body.classList.remove('animate__animated', 'animate__fadeIn');
        }, 500);
        
        // Update charts with new theme
        if (this.trendChart) {
          this.trendChart.destroy();
          this.createTrendChart();
        }
        if (this.categoryChart) {
          this.categoryChart.destroy();
          this.createCategoryChart();
        }
      }

      loadThemePreference() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          this.theme = savedTheme;
          document.documentElement.setAttribute('data-theme', savedTheme);
          const themeBtn = document.querySelector('.theme-toggle-btn');
          const icon = savedTheme === 'light' ? 'fa-moon' : 'fa-sun';
          themeBtn.innerHTML = `<i class="fas ${icon}"></i> Switch Theme`;
        }
      }

      createFloatingElements() {
        const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#43e97b', '#38f9d7'];
        const mainContent = document.querySelector('.main-content');
        
        for (let i = 0; i < 5; i++) {
          const element = document.createElement('div');
          element.className = 'floating-element';
          element.style.width = `${Math.random() * 100 + 100}px`;
          element.style.height = element.style.width;
          element.style.left = `${Math.random() * 100}%`;
          element.style.top = `${Math.random() * 100}%`;
          element.style.background = `radial-gradient(circle, ${colors[i % colors.length]}20 0%, transparent 70%)`;
          element.style.animationDelay = `${i * 2}s`;
          element.style.opacity = '0.3';
          mainContent.appendChild(element);
        }
      }

      setupPeriodicUpdates() {
        // Update forecast every minute
        setInterval(() => {
          this.updateForecast();
        }, 60000);
        
        // Check for limit alerts every 30 seconds
        setInterval(() => {
          this.checkLimitAlerts();
        }, 30000);
      }

      checkLimitAlerts() {
        this.budgetLimits.forEach(limit => {
          const percentage = (limit.currentSpending / limit.amount) * 100;
          
          if (percentage >= limit.alertThreshold && percentage < 100) {
            // Show warning notification
            if (!limit.alertShown) {
              this.showLimitAlert(limit, percentage);
              limit.alertShown = true;
            }
          } else if (percentage >= 100) {
            // Show over-limit notification
            if (!limit.overLimitAlertShown) {
              this.showOverLimitAlert(limit);
              limit.overLimitAlertShown = true;
            }
          } else {
            // Reset alert flags if below threshold
            limit.alertShown = false;
            limit.overLimitAlertShown = false;
          }
        });
      }

      showLimitAlert(limit, percentage) {
        const categoryNames = {
          'food': 'Food & Dining',
          'transportation': 'Transportation',
          'shopping': 'Shopping',
          'entertainment': 'Entertainment',
          'utilities': 'Utilities',
          'housing': 'Housing',
          'health': 'Health & Medical'
        };
        
        const categoryName = categoryNames[limit.category] || limit.category;
        
        Swal.fire({
          title: '⚠️ Budget Limit Alert',
          html: `
            <div class="text-center">
              <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
              <p>Your ${categoryName} budget is at ${percentage.toFixed(1)}%</p>
              <p><strong>$${limit.currentSpending.toFixed(2)} / $${limit.amount.toFixed(2)}</strong></p>
              <small>You set an alert at ${limit.alertThreshold}%</small>
            </div>
          `,
          icon: 'warning',
          confirmButtonText: 'Got it',
          timer: 5000,
          timerProgressBar: true
        });
      }

      showOverLimitAlert(limit) {
        const categoryNames = {
          'food': 'Food & Dining',
          'transportation': 'Transportation',
          'shopping': 'Shopping',
          'entertainment': 'Entertainment',
          'utilities': 'Utilities',
          'housing': 'Housing',
          'health': 'Health & Medical'
        };
        
        const categoryName = categoryNames[limit.category] || limit.category;
        const overAmount = limit.currentSpending - limit.amount;
        
        Swal.fire({
          title: '🚨 Budget Limit Exceeded!',
          html: `
            <div class="text-center">
              <i class="fas fa-fire fa-3x text-danger mb-3"></i>
              <p>Your ${categoryName} budget has been exceeded!</p>
              <p><strong>Over by $${overAmount.toFixed(2)}</strong></p>
              <small>Consider adjusting your spending or increasing your limit</small>
            </div>
          `,
          icon: 'error',
          confirmButtonText: 'Review Limits',
          showCancelButton: true,
          cancelButtonText: 'Dismiss'
        }).then((result) => {
          if (result.isConfirmed) {
            this.showLimitModal();
          }
        });
      }

      showLoading(message) {
        document.getElementById('loadingMessage').textContent = message;
        const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
        modal.show();
      }

      hideLoading() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('loadingModal'));
        if (modal) modal.hide();
      }

      escapeHtml(text) {
        if (!text) return "";
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    }

    // ============================================
    // INITIALIZE APPLICATION
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Create and initialize the application
      window.budgetApp = new BudgetAnalyticsDashboard();
      
      // Add transaction button to header
      const userInfo = document.querySelector('.user-info');
      const addTransactionBtn = document.createElement('button');
      addTransactionBtn.className = 'btn btn-success btn-sm ms-2';
      addTransactionBtn.innerHTML = '<i class="fas fa-plus me-1"></i> Add Transaction';
      addTransactionBtn.id = 'addTransactionBtn';
      userInfo.appendChild(addTransactionBtn);
      
      // Add event listener for the new button
      addTransactionBtn.addEventListener('click', () => window.budgetApp.showTransactionModal());
    });
  </script>
</body>
</html>