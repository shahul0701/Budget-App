<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --sidebar-width: 250px;
            --header-height: 70px;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            margin: 0;
            padding: 0;
            color: #495057;
        }
        
        /* Sidebar styling */
        #sidebar {
            position: fixed;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            color: white;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        #sidebar .sidebar-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        #sidebar ul li a {
            padding: 15px 25px;
            display: block;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        #sidebar ul li a:hover, 
        #sidebar ul li a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid white;
        }
        
        #sidebar ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main content */
        #content {
            margin-left: var(--sidebar-width);
            padding: 20px;
            padding-top: calc(var(--header-height) + 20px);
            min-height: 100vh;
        }
        
        /* Header */
        #header {
            position: fixed;
            top: 0;
            right: 0;
            left: var(--sidebar-width);
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .page-title {
            font-weight: 600;
            font-size: 1.5rem;
            margin: 0;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0 !important;
        }
        
        /* Stats cards */
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Filter buttons */
        .filter-btn {
            border: none;
            background: #f1f5f9;
            color: #64748b;
            padding: 5px 15px;
            border-radius: 20px;
            margin: 0 5px;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* Calendar */
        .calendar {
            padding: 15px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .calendar-days div {
            text-align: center;
            padding: 10px 0;
            font-weight: 600;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-date {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .calendar-date:hover {
            background: #f1f5f9;
        }
        
        .calendar-date.today {
            background: var(--primary-color);
            color: white;
        }
        
        .calendar-date.has-reminder:after {
            content: '';
            position: absolute;
            bottom: 5px;
            width: 6px;
            height: 6px;
            background: var(--success-color);
            border-radius: 50%;
        }
        
        /* Reminder list */
        .reminder-item {
            padding: 10px 15px;
            border-left: 3px solid var(--primary-color);
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .reminder-item .reminder-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .reminder-item .reminder-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .reminder-actions {
            margin-top: 5px;
        }
        
        .reminder-actions button {
            background: none;
            border: none;
            padding: 0 5px;
            color: #6c757d;
            cursor: pointer;
        }
        
        .reminder-actions button:hover {
            color: var(--primary-color);
        }
        
        /* Quick add button */
        .quick-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.3);
            z-index: 1000;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            #sidebar {
                width: 70px;
                text-align: center;
            }
            
            #sidebar .sidebar-header h3 {
                display: none;
            }
            
            #sidebar ul li a {
                text-align: center;
                padding: 15px 10px;
                font-size: 0.7rem;
            }
            
            #sidebar ul li a i {
                margin-right: 0;
                display: block;
                font-size: 1.2rem;
                margin-bottom: 5px;
            }
            
            #sidebar ul li a span {
                display: block;
            }
            
            #content, #header {
                margin-left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            #sidebar {
                width: 0;
                overflow: hidden;
            }
            
            #content, #header {
                margin-left: 0;
            }
            
            .sidebar-collapse {
                width: var(--sidebar-width) !important;
            }
            
            .content-expand {
                margin-left: var(--sidebar-width) !important;
            }
        }

        /* Login form */
        #login-form {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Login Form (initially visible) -->
    <div id="login-container" class="container">
        <div id="login-form">
            <h2 class="text-center mb-4">Financial Dashboard Login</h2>
            <div class="mb-3">
                <label for="login-email" class="form-label">Email</label>
                <input type="email" class="form-control" id="login-email" placeholder="Enter your email">
            </div>
            <div class="mb-3">
                <label for="login-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="login-password" placeholder="Enter your password">
            </div>
            <button id="login-btn" class="btn btn-primary w-100">Login</button>
            <p class="text-center mt-3">
                Don't have an account? <a href="#" id="show-register">Register</a>
            </p>
        </div>

        <div id="register-form" style="display: none;">
            <h2 class="text-center mb-4">Create Account</h2>
            <div class="mb-3">
                <label for="register-name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="register-name" placeholder="Enter your name">
            </div>
            <div class="mb-3">
                <label for="register-email" class="form-label">Email</label>
                <input type="email" class="form-control" id="register-email" placeholder="Enter your email">
            </div>
            <div class="mb-3">
                <label for="register-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="register-password" placeholder="Create a password">
            </div>
            <button id="register-btn" class="btn btn-primary w-100">Register</button>
            <p class="text-center mt-3">
                Already have an account? <a href="#" id="show-login">Login</a>
            </p>
        </div>
    </div>

    <!-- Dashboard (initially hidden) -->
    <div id="dashboard" style="display: none;">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>Finance Manager</h3>
            </div>
            
            <ul class="list-unstyled">
                <li>
                    <a href="home.html" class="active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li>
                    <a href="coa.html">
                        <i class="fas fa-chart-pie"></i>
                        <span>COA</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="expenseTrackerBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Expense Tracker</span>
                    </a>
                </li>
                <li>
                    <a href="section.html">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Header -->
        <header id="header">
            <h1 class="page-title">Dashboard</h1>
            <div>
                <button class="btn btn-outline-primary btn-sm me-2" id="refresh-data">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-user-circle"></i> <span id="user-name">User</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content -->
        <div id="content">
            <div class="container-fluid">
                <!-- Financial Overview -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>Financial Overview</span>
                                <div>
                                    <button class="filter-btn active" data-filter="today">Today</button>
                                    <button class="filter-btn" data-filter="week">This Week</button>
                                    <button class="filter-btn" data-filter="month">This Month</button>
                                    <button class="filter-btn" data-filter="year">This Year</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="stat-card">
                                            <i class="fas fa-dollar-sign"></i>
                                            <div class="value text-success" id="total-income">$0.00</div>
                                            <div class="label">Total Income</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="stat-card">
                                            <i class="fas fa-credit-card"></i>
                                            <div class="value text-danger" id="total-expenses">$0.00</div>
                                            <div class="label">Total Expenses</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="stat-card">
                                            <i class="fas fa-chart-line"></i>
                                            <div class="value text-primary" id="net-profit">$0.00</div>
                                            <div class="label">Net Profit</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>Recent Transactions</h6>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Description</th>
                                                    <th>Category</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recent-transactions">
                                                <tr>
                                                    <td colspan="4" class="text-center">No transactions found</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calendar & Reminders -->
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>Calendar & Reminders</span>
                                <button class="btn btn-sm btn-outline-primary" id="add-reminder-btn">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="calendar">
                                    <div class="calendar-header">
                                        <button class="btn btn-sm btn-outline-primary" id="prev-month">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <h6 class="mb-0" id="current-month">June 2023</h6>
                                        <button class="btn btn-sm btn-outline-primary" id="next-month">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="calendar-days">
                                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                                    </div>
                                    
                                    <div class="calendar-dates" id="calendar-dates">
                                        <!-- Calendar dates will be populated by JavaScript -->
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>Today's Reminders</h6>
                                    <div class="reminders-list" id="reminders-list">
                                        <div class="text-center py-3 text-muted">Loading reminders...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Add Button -->
        <div class="quick-add-btn" id="quick-add-btn">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Expense Tracker Modal -->
        <div class="modal fade" id="expenseTrackerModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Expense Tracker</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center py-4">
                        <p>Choose your preferred view style:</p>
                        <div class="d-grid gap-3">
                            <a href="exp.html" class="btn btn-primary btn-lg">
                                <i class="fas fa-list me-2"></i> Classic View
                            </a>
                            <a href="expensemanager.html" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-grip-horizontal me-2"></i> Compact View
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Add Modal -->
        <div class="modal fade" id="quickAddModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Quick Add Transaction</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="quick-add-form">
                            <div class="mb-3">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="transaction-type" required>
                                    <option value="income">Income</option>
                                    <option value="expense">Expense</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Amount</label>
                                <input type="number" class="form-control" id="transaction-amount" placeholder="0.00" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-control" id="transaction-description" placeholder="Enter description" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="transaction-category" required>
                                    <option value="">Select category</option>
                                    <option value="salary">Salary</option>
                                    <option value="freelance">Freelance</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="transport">Transportation</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-control" id="transaction-date" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-transaction">Add Transaction</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Reminder Modal -->
        <div class="modal fade" id="addReminderModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Reminder</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="add-reminder-form">
                            <div class="mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" id="reminder-title" placeholder="Enter reminder title" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-control" id="reminder-date" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Time</label>
                                <input type="time" class="form-control" id="reminder-time">
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="reminder-repeat">
                                <label class="form-check-label" for="reminder-repeat">Repeat yearly (for birthdays/anniversaries)</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-reminder">Save Reminder</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
            authDomain: "budget-app-1365f.firebaseapp.com",
            projectId: "budget-app-1365f",
            storageBucket: "budget-app-1365f.firebasestorage.app",
            messagingSenderId: "1036194450411",
            appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
            measurementId: "G-YFFJL2H54X"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Initialize variables
        let currentUser = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentFilter = 'today';

        // DOM elements
        const loginContainer = document.getElementById('login-container');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const userName = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');
        const expenseTrackerBtn = document.getElementById('expenseTrackerBtn');
        const quickAddBtn = document.getElementById('quick-add-btn');
        const saveTransactionBtn = document.getElementById('save-transaction');
        const addReminderBtn = document.getElementById('add-reminder-btn');
        const saveReminderBtn = document.getElementById('save-reminder');
        const refreshDataBtn = document.getElementById('refresh-data');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const currentMonthElement = document.getElementById('current-month');
        const calendarDates = document.getElementById('calendar-dates');
        const remindersList = document.getElementById('reminders-list');
        const filterButtons = document.querySelectorAll('.filter-btn');

        // Initialize modals
        const expenseTrackerModal = new bootstrap.Modal(document.getElementById('expenseTrackerModal'));
        const quickAddModal = new bootstrap.Modal(document.getElementById('quickAddModal'));
        const addReminderModal = new bootstrap.Modal(document.getElementById('addReminderModal'));

        // Event listeners
        loginBtn.addEventListener('click', loginUser);
        registerBtn.addEventListener('click', registerUser);
        showRegister.addEventListener('click', () => {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        });
        showLogin.addEventListener('click', () => {
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
        });
        logoutBtn.addEventListener('click', logoutUser);
        expenseTrackerBtn.addEventListener('click', () => expenseTrackerModal.show());
        quickAddBtn.addEventListener('click', () => {
            document.getElementById('transaction-date').valueAsDate = new Date();
            quickAddModal.show();
        });
        saveTransactionBtn.addEventListener('click', saveTransaction);
        addReminderBtn.addEventListener('click', () => addReminderModal.show());
        saveReminderBtn.addEventListener('click', saveReminder);
        refreshDataBtn.addEventListener('click', loadUserData);
        prevMonthBtn.addEventListener('click', () => changeMonth(-1));
        nextMonthBtn.addEventListener('click', () => changeMonth(1));
        
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                filterButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                loadFinancialData();
            });
        });

        // Initialize calendar
        function initCalendar() {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                               "July", "August", "September", "October", "November", "December"];
            
            currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Get first day of month and number of days in month
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Clear previous dates
            calendarDates.innerHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.classList.add('calendar-date');
                calendarDates.appendChild(emptyCell);
            }
            
            // Add cells for each day of the month
            for (let i = 1; i <= daysInMonth; i++) {
                const dateCell = document.createElement('div');
                dateCell.classList.add('calendar-date');
                dateCell.textContent = i;
                
                // Mark today's date
                const today = new Date();
                if (i === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dateCell.classList.add('today');
                }
                
                // Check if this date has reminders
                checkDateForReminders(i, dateCell);
                
                calendarDates.appendChild(dateCell);
            }
        }

        // Check if a date has reminders
        function checkDateForReminders(day, dateCell) {
            if (!currentUser) return;
            
            const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            
            db.collection('users').doc(currentUser.uid).collection('reminders')
                .where('date', '==', dateStr)
                .get()
                .then(snapshot => {
                    if (!snapshot.empty) {
                        dateCell.classList.add('has-reminder');
                    }
                })
                .catch(error => {
                    console.error('Error checking reminders:', error);
                });
        }

        // Change month in calendar
        function changeMonth(direction) {
            currentMonth += direction;
            
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            initCalendar();
            loadReminders();
        }

        // Load user's reminders
        function loadReminders() {
            if (!currentUser) return;
            
            remindersList.innerHTML = '<div class="text-center py-3 text-muted">Loading reminders...</div>';
            
            const today = new Date().toISOString().split('T')[0];
            
            db.collection('users').doc(currentUser.uid).collection('reminders')
                .where('date', '==', today)
                .get()
                .then(snapshot => {
                    remindersList.innerHTML = '';
                    
                    if (snapshot.empty) {
                        remindersList.innerHTML = '<div class="text-center py-3 text-muted">No reminders for today</div>';
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const reminder = doc.data();
                        const reminderItem = document.createElement('div');
                        reminderItem.classList.add('reminder-item');
                        
                        let timeHtml = '';
                        if (reminder.time) {
                            timeHtml = `<div class="reminder-date">${reminder.time}</div>`;
                        }
                        
                        reminderItem.innerHTML = `
                            <div class="reminder-title">${reminder.title}</div>
                            ${timeHtml}
                            <div class="reminder-actions">
                                <button data-id="${doc.id}"><i class="fas fa-edit"></i></button>
                                <button data-id="${doc.id}"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                        
                        remindersList.appendChild(reminderItem);
                    });
                    
                    // Add event listeners to action buttons
                    document.querySelectorAll('.reminder-actions button').forEach(btn => {
                        const id = btn.dataset.id;
                        if (btn.querySelector('.fa-trash')) {
                            btn.addEventListener('click', () => deleteReminder(id));
                        } else {
                            btn.addEventListener('click', () => editReminder(id));
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading reminders:', error);
                    remindersList.innerHTML = '<div class="text-center py-3 text-muted">Error loading reminders</div>';
                });
        }

        // Save new reminder
        function saveReminder() {
            if (!currentUser) return;
            
            const title = document.getElementById('reminder-title').value;
            const date = document.getElementById('reminder-date').value;
            const time = document.getElementById('reminder-time').value;
            const repeatYearly = document.getElementById('reminder-repeat').checked;
            
            if (!title || !date) {
                Swal.fire('Error', 'Please fill in all required fields', 'error');
                return;
            }
            
            db.collection('users').doc(currentUser.uid).collection('reminders').add({
                title,
                date,
                time,
                repeatYearly,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                Swal.fire('Success', 'Reminder added successfully', 'success');
                addReminderModal.hide();
                document.getElementById('add-reminder-form').reset();
                loadReminders();
                initCalendar();
            })
            .catch(error => {
                console.error('Error adding reminder:', error);
                Swal.fire('Error', 'Failed to add reminder', 'error');
            });
        }

        // Delete reminder
        function deleteReminder(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    db.collection('users').doc(currentUser.uid).collection('reminders').doc(id).delete()
                        .then(() => {
                            Swal.fire('Deleted!', 'Your reminder has been deleted.', 'success');
                            loadReminders();
                            initCalendar();
                        })
                        .catch(error => {
                            console.error('Error deleting reminder:', error);
                            Swal.fire('Error', 'Failed to delete reminder', 'error');
                        });
                }
            });
        }

        // Edit reminder (placeholder)
        function editReminder(id) {
            Swal.fire('Info', 'Edit functionality will be implemented in the next version', 'info');
        }

        // Load financial data
        function loadFinancialData() {
            if (!currentUser) return;
            
            // Calculate date range based on filter
            let startDate, endDate;
            const today = new Date();
            
            switch(currentFilter) {
                case 'today':
                    startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                    break;
                case 'week':
                    const dayOfWeek = today.getDay();
                    startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - dayOfWeek);
                    endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + (6 - dayOfWeek) + 1);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 1);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear() + 1, 0, 1);
                    break;
            }
            
            // Fetch transactions for the date range
            db.collection('users').doc(currentUser.uid).collection('transactions')
                .where('date', '>=', startDate)
                .where('date', '<=', endDate)
                .get()
                .then(snapshot => {
                    let totalIncome = 0;
                    let totalExpenses = 0;
                    const recentTransactions = [];
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        if (transaction.type === 'income') {
                            totalIncome += parseFloat(transaction.amount);
                        } else {
                            totalExpenses += parseFloat(transaction.amount);
                        }
                        
                        recentTransactions.push(transaction);
                    });
                    
                    // Update UI
                    document.getElementById('total-income').textContent = `$${totalIncome.toFixed(2)}`;
                    document.getElementById('total-expenses').textContent = `$${totalExpenses.toFixed(2)}`;
                    document.getElementById('net-profit').textContent = `$${(totalIncome - totalExpenses).toFixed(2)}`;
                    
                    // Update recent transactions table
                    const transactionsBody = document.getElementById('recent-transactions');
                    transactionsBody.innerHTML = '';
                    
                    if (recentTransactions.length === 0) {
                        transactionsBody.innerHTML = '<tr><td colspan="4" class="text-center">No transactions found</td></tr>';
                        return;
                    }
                    
                    // Sort by date (newest first) and take top 5
                    recentTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                    const topTransactions = recentTransactions.slice(0, 5);
                    
                    topTransactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        const date = new Date(transaction.date.toDate()).toLocaleDateString();
                        
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>${transaction.description}</td>
                            <td>${transaction.category}</td>
                            <td class="${transaction.type === 'income' ? 'text-success' : 'text-danger'}">
                                ${transaction.type === 'income' ? '+' : '-'}$${parseFloat(transaction.amount).toFixed(2)}
                            </td>
                        `;
                        
                        transactionsBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading financial data:', error);
                });
        }

        // Save new transaction
        function saveTransaction() {
            if (!currentUser) return;
            
            const type = document.getElementById('transaction-type').value;
            const amount = document.getElementById('transaction-amount').value;
            const description = document.getElementById('transaction-description').value;
            const category = document.getElementById('transaction-category').value;
            const date = document.getElementById('transaction-date').value;
            
            if (!amount || !description || !category || !date) {
                Swal.fire('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            db.collection('users').doc(currentUser.uid).collection('transactions').add({
                type,
                amount: parseFloat(amount),
                description,
                category,
                date: new Date(date),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                Swal.fire('Success', 'Transaction added successfully', 'success');
                quickAddModal.hide();
                document.getElementById('quick-add-form').reset();
                loadFinancialData();
            })
            .catch(error => {
                console.error('Error adding transaction:', error);
                Swal.fire('Error', 'Failed to add transaction', 'error');
            });
        }

        // Load all user data
        function loadUserData() {
            loadFinancialData();
            loadReminders();
            initCalendar();
        }

        // Register new user
        function registerUser() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            if (!name || !email || !password) {
                Swal.fire('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Save user profile
                    return db.collection('users').doc(user.uid).set({
                        name,
                        email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    Swal.fire('Success', 'Account created successfully', 'success');
                    registerForm.style.display = 'none';
                    loginForm.style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error creating account:', error);
                    Swal.fire('Error', error.message, 'error');
                });
        }

        // Login user
        function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                Swal.fire('Error', 'Please enter email and password', 'error');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    loginContainer.style.display = 'none';
                    dashboard.style.display = 'block';
                    
                    // Load user data
                    loadUserData();
                    
                    // Get user name
                    db.collection('users').doc(currentUser.uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                userName.textContent = doc.data().name;
                            }
                        });
                })
                .catch((error) => {
                    console.error('Error signing in:', error);
                    Swal.fire('Error', error.message, 'error');
                });
        }

        // Logout user
        function logoutUser() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    dashboard.style.display = 'none';
                    loginContainer.style.display = 'block';
                    document.getElementById('login-email').value = '';
                    document.getElementById('login-password').value = '';
                })
                .catch((error) => {
                    console.error('Error signing out:', error);
                });
        }

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loginContainer.style.display = 'none';
                dashboard.style.display = 'block';
                
                // Load user data
                loadUserData();
                
                // Get user name
                db.collection('users').doc(currentUser.uid).get()
                    .then(doc => {
                        if (doc.exists) {
                            userName.textContent = doc.data().name;
                        }
                    });
            } else {
                currentUser = null;
                dashboard.style.display = 'none';
                loginContainer.style.display = 'block';
            }
        });

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', initCalendar);
    </script>
</body>
</html>
