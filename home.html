<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BudgetFlow - Modern Dashboard</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

  <!-- Bootstrap for Split Modal -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root {
      --primary: #4f46e5;
      --primary-light: #6366f1;
      --primary-dark: #4338ca;
      --secondary: #8b5cf6;
      --secondary-light: #a78bfa;
      --secondary-dark: #7c3aed;
      --success: #10b981;
      --success-light: #34d399;
      --success-dark: #059669;
      --danger: #ef4444;
      --danger-light: #f87171;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-light: #fbbf24;
      --warning-dark: #d97706;
      --info: #06b6d4;
      --info-light: #22d3ee;
      --info-dark: #0891b2;
      --dark: #1e293b;
      --dark-light: #334155;
      --dark-lighter: #475569;
      --light: #f8fafc;
      --light-dark: #f1f5f9;
      --text: #1e293b;
      --text-light: #64748b;
      --card-bg: #ffffff;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      --card-border: 1px solid #f1f5f9;
      
      /* 3D effect variables */
      --card-depth: 10px;
      --card-3d-shadow: 0 10px 25px rgba(0, 0, 0, 0.08), 0 5px 10px rgba(0, 0, 0, 0.05);
      
      /* Dark mode variables */
      --bg-dark: #0f172a;
      --card-bg-dark: #1e293b;
      --text-dark: #f1f5f9;
      --text-muted-dark: #94a3b8;
      --border-dark: #334155;
    }

    /* Dark mode */
    [data-theme="dark"] {
      --primary: #6366f1;
      --secondary: #8b5cf6;
      --success: #10b981;
      --danger: #f87171;
      --warning: #fbbf24;
      --info: #22d3ee;
      --dark: #1e293b;
      --light: #0f172a;
      --text: #f1f5f9;
      --card-bg: #1e293b;
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      --card-border: 1px solid #334155;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--light);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Dashboard */
    .dashboard {
      display: none;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--dark);
      color: #fff;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 20px;
      z-index: 999;
      transform: translateX(-260px);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
    }

    .sidebar.visible {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
    }

    .sidebar-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 20px;
      font-weight: 700;
    }

    .sidebar-title i {
      color: var(--primary-light);
      font-size: 24px;
    }

    .sidebar-nav {
      padding: 10px 0;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar ul li {
      padding: 12px 20px;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border-radius: 8px;
      margin: 4px 15px;
    }

    .sidebar ul li i {
      width: 20px;
      text-align: center;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.7);
      transition: color 0.2s;
    }

    .sidebar ul li span {
      font-weight: 500;
      font-size: 14px;
    }

    .sidebar ul li:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .sidebar ul li:hover i {
      color: white;
    }

    .sidebar ul li.active {
      background: var(--primary);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .sidebar ul li.active i {
      color: white;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      font-size: 14px;
    }

    .user-email {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      box-shadow: var(--card-shadow);
      z-index: 900;
      transition: left 0.3s, background-color 0.3s;
      border-bottom: var(--card-border);
    }

    header.sidebar-visible {
      left: 260px;
    }

    #menuToggle {
      font-size: 20px;
      cursor: pointer;
      color: var(--text);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    #menuToggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] #menuToggle:hover {
      background: var(--dark-light);
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    /* Date and time display */
    .datetime-display {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 14px;
    }

    .current-date {
      font-weight: 600;
    }

    .current-time {
      color: var(--text-light);
      font-size: 12px;
    }

    [data-theme="dark"] .current-time {
      color: var(--text-muted-dark);
    }

    /* Theme toggle */
    .theme-toggle {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 8px;
      border-radius: 10px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .theme-toggle:hover {
      background: var(--dark-light);
    }

    /* Profile */
    .profile {
      display: flex;
      align-items: center;
      position: relative;
      cursor: pointer;
    }

    .profile-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .dropdown {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      display: none;
      min-width: 180px;
      overflow: hidden;
      z-index: 1000;
      border: var(--card-border);
    }

    .dropdown a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      text-decoration: none;
      color: var(--text);
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .dropdown a:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .dropdown a:hover {
      background: var(--dark-light);
    }

    .profile.active .dropdown {
      display: block;
    }

    /* Notification Bell */
    .notification-bell {
      position: relative;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .notification-bell:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .notification-bell:hover {
      background: var(--dark-light);
    }

    .notification-bell i {
      font-size: 1.2rem;
      color: var(--text);
    }

    .notification-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Notification Panel */
    .notification-panel {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      display: none;
      width: 350px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 1000;
      border: var(--card-border);
    }

    .notification-panel.active {
      display: block;
    }

    .notification-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--light-dark);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    [data-theme="dark"] .notification-header {
      border-bottom: 1px solid var(--dark-light);
    }

    .notification-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .clear-notifications {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
    }

    .clear-notifications:hover {
      text-decoration: underline;
    }

    .notification-list {
      padding: 10px 0;
    }

    .notification-item {
      padding: 12px 20px;
      border-bottom: 1px solid var(--light-dark);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    [data-theme="dark"] .notification-item {
      border-bottom: 1px solid var(--dark-light);
    }

    .notification-item:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .notification-item:hover {
      background: var(--dark-light);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .notification-message {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    [data-theme="dark"] .notification-message {
      color: var(--text-muted-dark);
    }

    .notification-time {
      font-size: 11px;
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    [data-theme="dark"] .notification-time {
      color: var(--text-muted-dark);
    }

    .notification-icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .notification-icon.bill {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .notification-icon.reminder {
      background: rgba(6, 182, 212, 0.2);
      color: var(--info);
    }

    .notification-icon.birthday {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .notification-icon.meeting {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .no-notifications {
      padding: 30px 20px;
      text-align: center;
      color: var(--text-light);
      font-size: 14px;
    }

    [data-theme="dark"] .no-notifications {
      color: var(--text-muted-dark);
    }

    /* Main */
    .main {
      margin-left: 0;
      margin-top: 80px;
      padding: 25px;
      transition: margin-left 0.3s;
    }

    .main.sidebar-visible {
      margin-left: 260px;
    }

    /* Dashboard grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 25px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      perspective: 1000px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .card h3 {
      margin: 0 0 15px;
      font-size: 16px;
      color: var(--text-light);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h3 i {
      font-size: 18px;
    }

    [data-theme="dark"] .card h3 {
      color: var(--text-muted-dark);
    }

    .card .value {
      font-size: 32px;
      font-weight: 800;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card .balance-hidden {
      filter: blur(8px);
      user-select: none;
    }

    .balance-toggle {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-light);
      font-size: 16px;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .balance-toggle:hover {
      background: var(--light-dark);
    }

    [data-theme="dark"] .balance-toggle {
      color: var(--text-muted-dark);
    }

    [data-theme="dark"] .balance-toggle:hover {
      background: var(--dark-light);
    }

    .card.green {
      background: linear-gradient(135deg, var(--success), var(--success-dark));
      color: white;
    }

    .card.purple {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .card.dark {
      background: linear-gradient(135deg, var(--dark), var(--dark-light));
      color: white;
    }

    .card.orange {
      background: linear-gradient(135deg, var(--warning), var(--warning-dark));
      color: white;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-btn {
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      border: var(--card-border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .filter-btn:hover {
      background: var(--light-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .filter-btn:hover {
      background: var(--dark-light);
    }

    /* Calendar */
    #calendar {
      margin-top: 20px;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 16px;
      box-shadow: var(--card-3d-shadow);
      min-height: 450px;
      border: var(--card-border);
      transition: all 0.3s ease;
    }

    #calendar:hover {
      transform: translateY(-5px);
    }

    /* Additional dashboard sections */
    .dashboard-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }

    .dashboard-section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
    }

    .dashboard-section:hover {
      transform: translateY(-5px);
    }

    .dashboard-section h3 {
      margin: 0 0 20px;
      font-size: 18px;
      color: var(--text);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .dashboard-section h3 i {
      color: var(--primary);
      font-size: 20px;
    }

    .section-content {
      color: var(--text-light);
      line-height: 1.6;
    }

    [data-theme="dark"] .section-content {
      color: var(--text-muted-dark);
    }

    /* Quick stats */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .quick-stat {
      background: var(--light-dark);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      transition: all 0.2s;
    }

    [data-theme="dark"] .quick-stat {
      background: var(--dark-light);
    }

    .quick-stat:hover {
      transform: scale(1.05);
    }

    .quick-stat .value {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .quick-stat .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 500;
    }

    [data-theme="dark"] .quick-stat .label {
      color: var(--text-muted-dark);
    }

    /* Floating Action Buttons */
    .fab-container {
      position: fixed;
      right: 30px;
      bottom: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 800;
    }

    .fab {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .fab:hover {
      transform: scale(1.1);
      background: var(--primary-dark);
      box-shadow: 0 12px 30px rgba(79, 70, 229, 0.4);
    }

    .fab-secondary {
      background: var(--info);
      box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
    }

    .fab-secondary:hover {
      background: var(--info-dark);
      box-shadow: 0 12px 30px rgba(6, 182, 212, 0.4);
    }

    /* Popup/Modal */
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .popup.active {
      display: flex;
    }

    .popup-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      max-height: 90vh;
      overflow-y: auto;
      border: var(--card-border);
      transform-style: preserve-3d;
      perspective: 1000px;
      animation: modalAppear 0.3s ease-out;
    }

    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: translateY(30px) rotateX(-15deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotateX(0);
      }
    }

    .popup-content h2 {
      margin-bottom: 25px;
      color: var(--text);
      font-weight: 700;
      font-size: 24px;
    }

    .popup-content button {
      display: block;
      width: 100%;
      margin: 12px 0;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #fff;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .popup-content button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }

    .classic-btn {
      background: var(--primary);
    }

    .compact-btn {
      background: var(--secondary);
    }

    .report-btn {
      background: var(--info);
    }

    .trial-balance-btn {
      background: var(--warning);
    }

    .close-btn {
      background: var(--danger);
    }

    /* Form elements in modals */
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-family: inherit;
      background: var(--card-bg);
      color: var(--text);
      border: var(--card-border);
      transition: all 0.2s;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    /* Split Transaction Modal Styles */
    .split-container {
      max-width: 800px;
      width: 95%;
    }
    
    .split-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .split-summary {
      background: var(--light-dark);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: var(--card-border);
    }
    
    [data-theme="dark"] .split-summary {
      background: var(--dark-light);
    }
    
    .split-summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 15px;
    }
    
    .split-summary-item.total {
      font-weight: 700;
      border-top: 1px solid var(--light-dark);
      padding-top: 12px;
      margin-top: 12px;
      font-size: 16px;
    }
    
    .split-expense-item {
      background: var(--light-dark);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: var(--card-border);
      position: relative;
    }
    
    [data-theme="dark"] .split-expense-item {
      background: var(--dark-light);
    }
    
    .remove-expense {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 8px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .remove-expense:hover {
      background: var(--danger-dark);
      transform: scale(1.1);
    }
    
    .split-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .split-full-row {
      grid-column: 1 / -1;
    }
    
    .add-expense-btn {
      background: var(--success);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 12px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
      transition: all 0.2s;
      font-weight: 600;
      font-size: 15px;
    }
    
    .add-expense-btn:hover {
      background: var(--success-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
    }
    
    .split-status {
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      font-size: 15px;
    }
    
    .split-status.positive {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    .split-status.negative {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .split-status.neutral {
      background: rgba(6, 182, 212, 0.2);
      color: var(--info);
      border: 1px solid rgba(6, 182, 212, 0.3);
    }

    /* Loading spinner */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    
    .loading-overlay.active {
      display: flex;
    }
    
    .loading-content {
      background: var(--card-bg);
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }
    
    .loading-content p {
      margin-top: 20px;
      color: var(--text);
      font-weight: 600;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--card-bg);
      color: var(--text);
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      border: var(--card-border);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
    }
    
    .toast.active {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      border-left: 4px solid var(--success);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning);
    }

    /* Reminder Detail Modal */
    .reminder-detail-modal {
      max-width: 600px;
      text-align: left;
    }
    
    .reminder-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .reminder-detail-content {
      margin-bottom: 25px;
    }
    
    .reminder-detail-item {
      display: flex;
      margin-bottom: 15px;
      align-items: flex-start;
    }
    
    .reminder-detail-label {
      font-weight: 600;
      width: 120px;
      flex-shrink: 0;
    }
    
    .reminder-detail-value {
      flex: 1;
    }
    
    .reminder-type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: capitalize;
    }
    
    .reminder-type-badge.reminder {
      background: rgba(6, 182, 212, 0.2);
      color: var(--info);
    }
    
    .reminder-type-badge.bill {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }
    
    .reminder-type-badge.birthday {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .reminder-type-badge.meeting {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }
    
    .reminder-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }
    
    .reminder-actions button {
      flex: 1;
    }

    /* New Features Section */
    .new-features {
      margin-top: 25px;
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .feature-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-3d-shadow);
      border: var(--card-border);
      transition: all 0.3s ease;
      cursor: pointer;
      text-align: center;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    .feature-icon {
      font-size: 32px;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .feature-title {
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .feature-description {
      font-size: 14px;
      color: var(--text-light);
    }

    /* Bill Reminder Specific Styles */
    .recurrence-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .recurrence-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      border: 1px solid var(--light-dark);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    [data-theme="dark"] .recurrence-option {
      border: 1px solid var(--dark-light);
    }
    
    .recurrence-option:hover {
      background: var(--light-dark);
    }
    
    [data-theme="dark"] .recurrence-option:hover {
      background: var(--dark-light);
    }
    
    .recurrence-option.active {
      border-color: var(--primary);
      background: rgba(79, 70, 229, 0.1);
    }
    
    .recurrence-option input {
      margin: 0;
    }

    /* Bootstrap Modal Integration */
    .modal-content {
      background: var(--card-bg);
      color: var(--text);
      border: var(--card-border);
      border-radius: 16px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header {
      border-bottom: 1px solid var(--border-dark);
      background: var(--card-bg);
      border-radius: 16px 16px 0 0;
      padding: 20px 25px;
    }
    
    .modal-body {
      padding: 25px;
      background: var(--card-bg);
    }
    
    .modal-footer {
      border-top: 1px solid var(--border-dark);
      background: var(--card-bg);
      border-radius: 0 0 16px 16px;
      padding: 20px 25px;
    }
    
    .btn-close {
      filter: invert(0.5);
    }
    
    [data-theme="dark"] .btn-close {
      filter: invert(0.8);
    }

    /* Split transaction styles from your code */
    .split-transaction-item {
      border: 1px solid var(--border-dark);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      background: var(--light-dark);
      position: relative;
    }
    
    [data-theme="dark"] .split-transaction-item {
      background: var(--dark-light);
    }
    
    .split-transaction-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .split-transaction-header h6 {
      margin: 0;
      color: var(--text);
      font-weight: 600;
    }
    
    .remove-split {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 8px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .remove-split:hover {
      background: var(--danger-dark);
      transform: scale(1.1);
    }
    
    .split-amount-input, 
    .split-description-input, 
    .split-bank-input, 
    .split-account-input {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border-dark);
      border-radius: 8px;
      padding: 10px 12px;
      width: 100%;
      font-size: 14px;
    }
    
    .split-amount-input:focus, 
    .split-description-input:focus, 
    .split-bank-input:focus, 
    .split-account-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }
    
    .amount-remaining {
      color: var(--success);
      font-weight: 600;
    }
    
    .amount-exceeded {
      color: var(--danger);
      font-weight: 600;
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .sidebar {
        width: 240px;
        transform: translateX(-240px);
      }
      
      header.sidebar-visible {
        left: 240px;
      }
      
      .main.sidebar-visible {
        margin-left: 240px;
      }
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .sidebar.visible {
        transform: translateX(0);
        z-index: 1000;
      }

      header.sidebar-visible {
        left: 0;
      }

      .main.sidebar-visible {
        margin-left: 0;
      }
      
      .fab-container {
        right: 20px;
        bottom: 20px;
      }
      
      .fab {
        width: 55px;
        height: 55px;
        font-size: 20px;
      }
      
      .popup-content {
        max-width: 90%;
        padding: 25px;
      }
      
      .popup {
        padding: 15px;
      }

      .filters {
        flex-direction: column;
        align-items: flex-start;
      }

      .dashboard-sections {
        grid-template-columns: 1fr;
      }

      .datetime-display {
        display: none;
      }
      
      .split-row {
        grid-template-columns: 1fr;
      }
      
      .header-title {
        font-size: 18px;
      }
      
      .reminder-actions {
        flex-direction: column;
      }
      
      .feature-grid {
        grid-template-columns: 1fr;
      }
      
      .notification-panel {
        width: 300px;
        right: -50px;
      }
      
      .recurrence-options {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .grid {
        gap: 20px;
      }
      
      .card {
        padding: 20px;
      }
      
      .main {
        padding: 20px;
        margin-top: 70px;
      }
      
      .fab-container {
        right: 15px;
        bottom: 15px;
      }
      
      .fab {
        width: 50px;
        height: 50px;
        font-size: 18px;
      }

      header {
        padding: 0 20px;
        height: 65px;
      }

      .quick-stats {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        width: 280px;
        transform: translateX(-280px);
      }
      
      .notification-panel {
        width: 280px;
        right: -80px;
      }
    }
  </style>
</head>
<body>
  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <i class="fas fa-chart-pie"></i>
          <span>BudgetFlow</span>
        </div>
      </div>
      
      <div class="sidebar-nav">
        <ul>
          <li class="active" onclick="location.href='home.html'">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </li>
          <li onclick="openExpensePopup()">
            <i class="fas fa-wallet"></i>
            <span>Transactions Tracker</span>
          </li>
          <li onclick="location.href=Debt & Credit Card Tracker.html'">
            <i class="fas fa-book"></i>
            <span>Debt & Credit Card Tracker</span>
          </li>
          <li onclick="location.href='coa.html'">
            <i class="fas fa-book"></i>
            <span>Chart of Accounts</span>
          </li>
          <li onclick="location.href='calculate.html'">
            <i class="fas fa-calculator"></i>
            <span>Financial Calculator</span>
          </li>
<li onclick="location.href='Debt & Credit Card Tracker.html'">
            <i class="fas fa-calculator"></i>
            <span>Debt & Credit Card Tracker</span>
          </li>
          <li onclick="location.href='Assets Tracker.html'">
            <i class="fas fa-chart-line"></i>
            <span>Asset Tracker</span>
          </li>
          <li onclick="location.href='Section.html'">
            <i class="fas fa-file-alt"></i>
            <span>Financial Reports</span>
          </li>
          <li onclick="location.href='Genrate Invoice.html'">
            <i class="fas fa-file-invoice-dollar"></i>
            <span>Invoice Generator</span>
          </li>
          <li onclick="location.href='chart.html'">
            <i class="fas fa-chart-pie"></i>
            <span>Analytics & Charts</span>
          </li>
          <li onclick="location.href='Garage.html'">
            <i class="fas fa-car"></i>
            <span>Vehicle Management</span>
          </li>
          <li
onclick="location.href='inventory-dashboard.html'">
            <i class="fas fa-table"></i>
            <span>Inventory</span>
          </li>   
          <li onclick="location.href='Appsheet.html'">
            <i class="fas fa-table"></i>
            <span>AppSheet Integration</span>
          </li>   
          <li onclick="location.href='investment.html'">
            <i class="fas fa-chart-bar"></i>
            <span>Investment Portfolio</span>
          </li>
        </ul>
      </div>
      
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="userInitials">U</div>
          <div class="user-details">
            <div class="user-name" id="userName">User Name</div>
            <div class="user-email" id="userEmail">user@example.com</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header id="header">
      <i id="menuToggle" class="fa fa-bars"></i>
      <div class="header-title">Dashboard Overview</div>
      <div class="header-controls">
        <div class="datetime-display">
          <div class="current-date" id="currentDate">Monday, January 1, 2023</div>
          <div class="current-time" id="currentTime">12:00:00 PM</div>
        </div>
        
        <!-- Notification Bell -->
        <div class="notification-bell" id="notificationBell">
          <i class="fa fa-bell"></i>
          <div class="notification-badge" id="notificationBadge">0</div>
          <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="clear-notifications" id="clearNotifications">Clear All</button>
            </div>
            <div class="notification-list" id="notificationList">
              <!-- Notifications will be populated here -->
            </div>
          </div>
        </div>
        
        <button class="theme-toggle" id="themeToggle">
          <i class="fa fa-moon"></i>
        </button>
        <div class="profile" id="profileMenu">
          <div class="profile-circle" id="headerUserInitials">U</div>
          <div class="dropdown">
            <a href="#" onclick="openProfile()">
              <i class="fa fa-user"></i> 
              Profile
            </a>
            <a href="#" onclick="logout()">
              <i class="fa fa-sign-out-alt"></i> 
              Logout
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <div class="main" id="main">
      <!-- Filters -->
      <div class="filters">
        <button class="filter-btn active" data-filter="today">
          <i class="fas fa-calendar-day"></i>
          Today
        </button>
        <button class="filter-btn" data-filter="week">
          <i class="fas fa-calendar-week"></i>
          This Week
        </button>
        <button class="filter-btn" data-filter="month">
          <i class="fas fa-calendar-alt"></i>
          This Month
        </button>
        <button class="filter-btn" data-filter="year">
          <i class="fas fa-calendar"></i>
          This Year
        </button>
        <button class="filter-btn" data-filter="all">
          <i class="fas fa-infinity"></i>
          All Time
        </button>
      </div>

      <div class="grid">
        <div class="card dark">
          <h3><i class="fas fa-exchange-alt"></i> Total Transactions</h3>
          <div class="value" id="totalTransactions">0</div>
        </div>
        <div class="card green">
          <h3><i class="fas fa-piggy-bank"></i> Current Balance</h3>
          <div class="value">
            <span id="currentBalance" class="balance-hidden">$0.00</span>
            <button class="balance-toggle" id="balanceToggle">
              <i class="fa fa-eye-slash"></i>
            </button>
          </div>
        </div>
        <div class="card purple">
          <h3><i class="fas fa-arrow-down"></i> Total Income</h3>
          <div class="value" id="totalIncome">$0.00</div>
        </div>
        <div class="card orange">
          <h3><i class="fas fa-arrow-up"></i> Total Expenses</h3>
          <div class="value" id="totalExpenses">$0.00</div>
        </div>
      </div>

      <!-- Calendar -->
      <div class="card">
        <h3><i class="fas fa-calendar-check"></i> Reminders & Events</h3>
        <div id="calendar"></div>
      </div>

      <!-- Additional Dashboard Sections -->
      <div class="dashboard-sections">
        <div class="dashboard-section">
          <h3><i class="fas fa-chart-line"></i> Financial Overview</h3>
          <div class="section-content">
            <p>Track your income and expenses with detailed charts and analytics to better understand your financial health.</p>
            <div class="quick-stats">
              <div class="quick-stat">
                <div class="value">$2,540</div>
                <div class="label">Monthly Income</div>
              </div>
              <div class="quick-stat">
                <div class="value">$1,890</div>
                <div class="label">Monthly Expenses</div>
              </div>
              <div class="quick-stat">
                <div class="value">$650</div>
                <div class="label">Monthly Savings</div>
              </div>
              <div class="quick-stat">
                <div class="value">25.6%</div>
                <div class="label">Savings Rate</div>
              </div>
            </div>
          </div>
        </div>

        <div class="dashboard-section">
          <h3><i class="fas fa-bell"></i> Recent Activity</h3>
          <div class="section-content">
            <p>Your most recent transactions and activities at a glance.</p>
            <div class="quick-stats">
              <div class="quick-stat">
                <div class="value">12</div>
                <div class="label">This Week</div>
              </div>
              <div class="quick-stat">
                <div class="value">42</div>
                <div class="label">This Month</div>
              </div>
              <div class="quick-stat">
                <div class="value">5</div>
                <div class="label">Pending</div>
              </div>
              <div class="quick-stat">
                <div class="value">3</div>
                <div class="label">Upcoming</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- New Features Section -->
      <div class="dashboard-section new-features">
        <h3><i class="fas fa-rocket"></i> New Features</h3>
        <div class="section-content">
          <p>Explore these new features to enhance your financial management experience.</p>
          <div class="feature-grid">
            <div class="feature-card" onclick="openBudgetPlanner()">
              <div class="feature-icon">
                <i class="fas fa-chart-pie"></i>
              </div>
              <div class="feature-title">Budget Planner</div>
              <div class="feature-description">Plan and track your monthly budget with visual insights</div>
            </div>
            <div class="feature-card" onclick="openGoalTracker()">
              <div class="feature-icon">
                <i class="fas fa-bullseye"></i>
              </div>
              <div class="feature-title">Goal Tracker</div>
              <div class="feature-description">Set and monitor financial goals with progress tracking</div>
            </div>
            <div class="feature-card" onclick="openBillReminders()">
              <div class="feature-icon">
                <i class="fas fa-file-invoice-dollar"></i>
              </div>
              <div class="feature-title">Bill Reminders</div>
              <div class="feature-description">Never miss a payment with automated bill reminders</div>
            </div>
            <div class="feature-card" onclick="openFinancialInsights()">
              <div class="feature-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="feature-title">Financial Insights</div>
              <div class="feature-description">Get personalized insights to improve your finances</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
      <button class="fab fab-secondary" id="splitBtn">
        <i class="fa fa-share-alt"></i>
      </button>
      <button class="fab" id="addReminderBtn">
        <i class="fa fa-plus"></i>
      </button>
    </div>

    <!-- Transaction Type Popup -->
    <div class="popup" id="transactionTypePopup">
      <div class="popup-content">
        <h2>Select Transaction View</h2>
        <button class="classic-btn" onclick="location.href='transaction-classic.html'">
          <i class="fas fa-list"></i>
          Classic View
        </button>
        <button class="compact-btn" onclick="location.href='transaction-compact.html'">
          <i class="fas fa-th"></i>
          Compact View
        </button>
        <button class="close-btn" onclick="closeTransactionTypePopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Expense Tracker Popup -->
    <div class="popup" id="expensePopup">
      <div class="popup-content">
        <h2>Select Expense Tracker</h2>
        <button class="classic-btn" onclick="location.href='exp.html'">
          <i class="fas fa-list"></i>
          Classic View
        </button>
        <button class="compact-btn" onclick="location.href='expensemanager.html'">
          <i class="fas fa-th"></i>
          Compact View
        </button>
        <button class="close-btn" onclick="closeExpensePopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Income/Expense Report Popup -->
    <div class="popup" id="reportPopup">
      <div class="popup-content">
        <h2>Select Report Type</h2>
        <button class="trial-balance-btn" onclick="location.href='trialbalance.html'">
          <i class="fas fa-balance-scale"></i>
          Trial Balance
        </button>
        <button class="report-btn" onclick="location.href='Section.html'">
          <i class="fas fa-file-alt"></i>
          Financial Reports
        </button>
        <button class="close-btn" onclick="closeReportPopup()">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    <!-- Split Transaction Modal (Bootstrap) -->
    <div class="modal fade" id="splitIncomeModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Split Income into Multiple Expenses</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Income Amount to Split</label>
              <input id="splitIncomeAmount" type="number" step="0.01" class="form-control" placeholder="Enter total income amount" />
            </div>
            <div class="mb-3">
              <label class="form-label">Income Description</label>
              <input id="splitIncomeDescription" type="text" class="form-control" placeholder="Description for the income transaction" />
            </div>
            <div class="mb-3">
              <label class="form-label">Income Bank Account</label>
              <select id="splitIncomeBank" class="form-select">
                <option value="">Select Bank</option>
                <!-- Will be populated from COA -->
              </select>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6>Expense Transactions</h6>
              <button type="button" id="addSplitExpenseBtn" class="btn btn-sm btn-primary">
                <i class="fa fa-plus me-1"></i> Add Expense
              </button>
            </div>
            
            <div id="splitExpensesContainer">
              <!-- Split expense items will be added here -->
            </div>
            
            <div id="splitSummary" class="split-summary">
              <!-- Summary will be updated here -->
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" id="saveSplitTransactionsBtn" class="btn btn-primary">Save All Transactions</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Reminder Modal -->
    <div class="popup" id="reminderModal">
      <div class="popup-content">
        <h2>Add Reminder</h2>
        <div class="form-group">
          <label for="reminderType">Type</label>
          <select id="reminderType">
            <option value="reminder">Reminder</option>
            <option value="bill">Bill Payment</option>
            <option value="birthday">Birthday</option>
            <option value="meeting">Meeting</option>
          </select>
        </div>
        <div class="form-group">
          <label for="reminderTitle">Title</label>
          <input type="text" id="reminderTitle" placeholder="Enter title">
        </div>
        <div class="form-group">
          <label for="reminderDate">Date</label>
          <input type="date" id="reminderDate">
        </div>
        <div class="form-group">
          <label for="reminderTime">Time (optional)</label>
          <input type="time" id="reminderTime">
        </div>
        
        <!-- Bill-specific fields -->
        <div class="form-group" id="billAmountGroup" style="display: none;">
          <label for="billAmount">Bill Amount</label>
          <input type="number" id="billAmount" placeholder="0.00" step="0.01" min="0">
        </div>
        
        <div class="form-group" id="recurrenceGroup" style="display: none;">
          <label>Recurrence</label>
          <div class="recurrence-options">
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="none" checked> None
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="daily"> Daily
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="weekly"> Weekly
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="monthly"> Monthly
            </label>
            <label class="recurrence-option">
              <input type="radio" name="recurrence" value="yearly"> Yearly
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="reminderNotes">Notes (optional)</label>
          <textarea id="reminderNotes" rows="3" placeholder="Add notes"></textarea>
        </div>
        <button class="classic-btn" id="saveReminderBtn">
          <i class="fas fa-save"></i>
          Save Reminder
        </button>
        <button class="close-btn" onclick="closeReminderModal()">
          <i class="fas fa-times"></i>
          Cancel
        </button>
      </div>
    </div>

    <!-- Reminder Detail Modal -->
    <div class="popup" id="reminderDetailModal">
      <div class="popup-content reminder-detail-modal">
        <div class="reminder-detail-header">
          <h2>Reminder Details</h2>
        </div>
        <div class="reminder-detail-content">
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Type:</div>
            <div class="reminder-detail-value">
              <span class="reminder-type-badge" id="detailType">Reminder</span>
            </div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Title:</div>
            <div class="reminder-detail-value" id="detailTitle">Title</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Date:</div>
            <div class="reminder-detail-value" id="detailDate">Date</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Time:</div>
            <div class="reminder-detail-value" id="detailTime">Time</div>
          </div>
          <div class="reminder-detail-item" id="detailBillAmountItem" style="display: none;">
            <div class="reminder-detail-label">Amount:</div>
            <div class="reminder-detail-value" id="detailBillAmount">$0.00</div>
          </div>
          <div class="reminder-detail-item" id="detailRecurrenceItem" style="display: none;">
            <div class="reminder-detail-label">Recurrence:</div>
            <div class="reminder-detail-value" id="detailRecurrence">None</div>
          </div>
          <div class="reminder-detail-item">
            <div class="reminder-detail-label">Notes:</div>
            <div class="reminder-detail-value" id="detailNotes">Notes</div>
          </div>
        </div>
        <div class="reminder-actions">
          <button class="classic-btn" id="editReminderBtn">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="close-btn" id="deleteReminderBtn">
            <i class="fas fa-trash"></i> Delete
          </button>
          <button class="close-btn" onclick="closeReminderDetailModal()">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p id="loadingText">Processing...</p>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
      authDomain: "budget-app-1365f.firebaseapp.com",
      projectId: "budget-app-1365f",
      storageBucket: "budget-app-1365f.firebasestorage.app",
      messagingSenderId: "1036194450411",
      appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
      measurementId: "G-YFFJL2H54X"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // DOM Elements
    const dashboard = document.getElementById("dashboard");
    const sidebar = document.getElementById("sidebar");
    const menuToggle = document.getElementById("menuToggle");
    const header = document.getElementById("header");
    const main = document.getElementById("main");
    const profileMenu = document.getElementById("profileMenu");
    const userInitials = document.getElementById("userInitials");
    const headerUserInitials = document.getElementById("headerUserInitials");
    const userName = document.getElementById("userName");
    const userEmail = document.getElementById("userEmail");
    const addReminderBtn = document.getElementById("addReminderBtn");
    const splitBtn = document.getElementById("splitBtn");
    const expensePopup = document.getElementById("expensePopup");
    const reportPopup = document.getElementById("reportPopup");
    const transactionTypePopup = document.getElementById("transactionTypePopup");
    const reminderModal = document.getElementById("reminderModal");
    const reminderDetailModal = document.getElementById("reminderDetailModal");
    const saveReminderBtn = document.getElementById("saveReminderBtn");
    const editReminderBtn = document.getElementById("editReminderBtn");
    const deleteReminderBtn = document.getElementById("deleteReminderBtn");
    const themeToggle = document.getElementById("themeToggle");
    const balanceToggle = document.getElementById("balanceToggle");
    const currentBalanceEl = document.getElementById("currentBalance");
    const filterButtons = document.querySelectorAll('.filter-btn');
    const currentDateEl = document.getElementById("currentDate");
    const currentTimeEl = document.getElementById("currentTime");
    
    // Notification elements
    const notificationBell = document.getElementById("notificationBell");
    const notificationBadge = document.getElementById("notificationBadge");
    const notificationPanel = document.getElementById("notificationPanel");
    const notificationList = document.getElementById("notificationList");
    const clearNotifications = document.getElementById("clearNotifications");
    
    // Split modal elements (Bootstrap)
    const splitIncomeModalEl = document.getElementById('splitIncomeModal');
    const splitIncomeModal = new bootstrap.Modal(splitIncomeModalEl);
    const splitIncomeAmount = document.getElementById("splitIncomeAmount");
    const splitIncomeDescription = document.getElementById("splitIncomeDescription");
    const splitIncomeBank = document.getElementById("splitIncomeBank");
    const splitExpensesContainer = document.getElementById("splitExpensesContainer");
    const addSplitExpenseBtn = document.getElementById("addSplitExpenseBtn");
    const saveSplitTransactionsBtn = document.getElementById("saveSplitTransactionsBtn");
    const splitSummary = document.getElementById("splitSummary");
    
    // Reminder detail modal elements
    const detailType = document.getElementById("detailType");
    const detailTitle = document.getElementById("detailTitle");
    const detailDate = document.getElementById("detailDate");
    const detailTime = document.getElementById("detailTime");
    const detailNotes = document.getElementById("detailNotes");
    const detailBillAmount = document.getElementById("detailBillAmount");
    const detailBillAmountItem = document.getElementById("detailBillAmountItem");
    const detailRecurrence = document.getElementById("detailRecurrence");
    const detailRecurrenceItem = document.getElementById("detailRecurrenceItem");
    
    // Bill reminder specific elements
    const reminderType = document.getElementById("reminderType");
    const billAmountGroup = document.getElementById("billAmountGroup");
    const recurrenceGroup = document.getElementById("recurrenceGroup");
    const billAmount = document.getElementById("billAmount");
    
    // New elements
    const loadingOverlay = document.getElementById("loadingOverlay");
    const loadingText = document.getElementById("loadingText");
    const toast = document.getElementById("toast");
    
    // Stats elements
    const totalTransactionsEl = document.getElementById("totalTransactions");
    const totalIncomeEl = document.getElementById("totalIncome");
    const totalExpensesEl = document.getElementById("totalExpenses");

    // Store the currently selected reminder
    let currentReminderId = null;
    let balanceVisible = false;
    let currentFilter = 'today';
    let allTransactions = [];
    let filteredTransactions = [];
    let accountHeaders = [];
    let bankNames = [];
    let notifications = [];

    // COA data
    let coaAccounts = [];
    let coaBanks = [];

    // Update date and time
    function updateDateTime() {
      const now = new Date();
      
      // Format date
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      currentDateEl.textContent = now.toLocaleDateString('en-US', options);
      
      // Format time
      currentTimeEl.textContent = now.toLocaleTimeString('en-US');
    }

    // Update date and time immediately and then every second
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // Calendar initialization
    let calendar;
    let selectedDate = null;
    
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: [],
        height: 'auto',
        dateClick: function(info) {
          // When a date is clicked, open reminder modal with that date
          selectedDate = info.dateStr;
          openReminderModalWithDate(selectedDate);
        },
        eventClick: function(info) {
          // When a reminder is clicked, show the detail modal
          showReminderDetails(info.event);
        },
        eventDidMount: function(info) {
          // Add tooltip to events
          info.el.title = info.event.title;
        }
      });
      calendar.render();
    });

    // Open reminder modal with selected date
    function openReminderModalWithDate(date) {
      document.getElementById("reminderDate").value = date;
      document.getElementById("reminderType").value = "reminder";
      document.getElementById("reminderTitle").value = "";
      document.getElementById("reminderTime").value = "";
      document.getElementById("reminderNotes").value = "";
      document.getElementById("billAmount").value = "";
      document.querySelector('input[name="recurrence"][value="none"]').checked = true;
      toggleBillFields("reminder");
      
      // Reset save button to default
      saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Save Reminder';
      saveReminderBtn.onclick = saveReminder;
      
      reminderModal.classList.add("active");
    }

    // Show toast notification
    function showToast(message, type = '') {
      toast.textContent = message;
      toast.className = 'toast';
      if (type) toast.classList.add(type);
      toast.classList.add('active');
      
      // Remove active class after animation completes
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    // Show loading overlay
    function showLoading(text = 'Processing...') {
      loadingText.textContent = text;
      loadingOverlay.classList.add('active');
    }

    // Hide loading overlay
    function hideLoading() {
      loadingOverlay.classList.remove('active');
    }

    // Set button loading state
    function setButtonLoading(button, isLoading) {
      if (isLoading) {
        button.classList.add('loading');
        button.disabled = true;
      } else {
        button.classList.remove('loading');
        button.disabled = false;
      }
    }

    // Toggle theme
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      themeToggle.innerHTML = newTheme === 'light' ? '<i class="fa fa-moon"></i>' : '<i class="fa fa-sun"></i>';
      localStorage.setItem('theme', newTheme);
    }

    // Toggle balance visibility
    function toggleBalanceVisibility() {
      balanceVisible = !balanceVisible;
      
      if (balanceVisible) {
        currentBalanceEl.classList.remove('balance-hidden');
        balanceToggle.innerHTML = '<i class="fa fa-eye"></i>';
      } else {
        currentBalanceEl.classList.add('balance-hidden');
        balanceToggle.innerHTML = '<i class="fa fa-eye-slash"></i>';
      }
      
      localStorage.setItem('balanceVisible', balanceVisible);
    }

    // Open transaction type popup
    function openTransactionTypePopup() {
      transactionTypePopup.classList.add('active');
    }

    // Close transaction type popup
    function closeTransactionTypePopup() {
      transactionTypePopup.classList.remove('active');
    }

    // ========== SPLIT TRANSACTION FEATURE ==========

    // Split Income Functions
    function openSplitIncomeModal() {
      // Reset the modal
      splitIncomeAmount.value = "";
      splitIncomeDescription.value = "";
      splitIncomeBank.value = "";
      splitExpensesContainer.innerHTML = "";
      splitSummary.innerHTML = "";
      
      // Populate bank dropdown
      populateBankDropdown();
      
      // Add one initial expense
      addSplitExpense();
      
      splitIncomeModal.show();
    }

    function addSplitExpense() {
      const expenseId = 'expense-' + Date.now();
      const expenseHtml = `
        <div class="split-transaction-item" id="${expenseId}">
          <div class="split-transaction-header">
            <h6>Expense</h6>
            <button type="button" class="remove-split" onclick="removeSplitExpense('${expenseId}')">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <div class="row g-2">
            <div class="col-md-4">
              <label class="form-label">Amount</label>
              <input type="number" step="0.01" class="form-control split-amount-input" placeholder="0.00" oninput="updateSplitSummary()">
            </div>
            <div class="col-md-4">
              <label class="form-label">Description</label>
              <input type="text" class="form-control split-description-input" placeholder="Expense description">
            </div>
            <div class="col-md-4">
              <label class="form-label">Bank Account</label>
              <select class="form-select split-bank-input">
                <option value="">Select Bank</option>
                ${coaBanks.map(bank => `<option value="${bank}">${bank}</option>`).join('')}
              </select>
            </div>
          </div>
          <div class="row g-2 mt-2">
            <div class="col-md-12">
              <label class="form-label">Account Header</label>
              <select class="form-select split-account-input">
                <option value="">Select Account Header</option>
                ${coaAccounts.map(account => `<option value="${account}">${account}</option>`).join('')}
              </select>
            </div>
          </div>
        </div>
      `;
      
      splitExpensesContainer.insertAdjacentHTML('beforeend', expenseHtml);
      updateSplitSummary();
    }

    function removeSplitExpense(id) {
      const element = document.getElementById(id);
      if (element) {
        element.remove();
        updateSplitSummary();
      }
    }

    function updateSplitSummary() {
      const incomeAmount = parseFloat(splitIncomeAmount.value) || 0;
      const expenseElements = splitExpensesContainer.querySelectorAll('.split-transaction-item');
      
      let totalExpenses = 0;
      expenseElements.forEach(element => {
        const amountInput = element.querySelector('.split-amount-input');
        const amount = parseFloat(amountInput.value) || 0;
        totalExpenses += amount;
      });
      
      const remaining = incomeAmount - totalExpenses;
      
      let summaryHtml = '';
      if (incomeAmount > 0) {
        summaryHtml = `
          <div class="d-flex justify-content-between">
            <span>Total Income:</span>
            <span>$${incomeAmount.toFixed(2)}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Total Expenses:</span>
            <span>$${totalExpenses.toFixed(2)}</span>
          </div>
          <div class="d-flex justify-content-between ${remaining >= 0 ? 'amount-remaining' : 'amount-exceeded'}">
            <span>Remaining:</span>
            <span>$${remaining.toFixed(2)}</span>
          </div>
        `;
        
        if (remaining < 0) {
          summaryHtml += `<div class="text-danger small mt-1">Warning: Expenses exceed income by $${Math.abs(remaining).toFixed(2)}</div>`;
        } else if (remaining > 0) {
          summaryHtml += `<div class="text-warning small mt-1">Note: $${remaining.toFixed(2)} of income not allocated</div>`;
        } else {
          summaryHtml += `<div class="text-success small mt-1">Perfect! All income allocated to expenses</div>`;
        }
      }
      
      splitSummary.innerHTML = summaryHtml;
    }

    async function saveSplitTransactions() {
      const incomeAmount = parseFloat(splitIncomeAmount.value) || 0;
      const incomeDescription = splitIncomeDescription.value.trim();
      const incomeBank = splitIncomeBank.value;
      
      if (!incomeAmount || incomeAmount <= 0) {
        showToast("Please enter a valid income amount", "error");
        return;
      }
      
      if (!incomeDescription) {
        showToast("Please enter an income description", "error");
        return;
      }
      
      if (!incomeBank) {
        showToast("Please select an income bank account", "error");
        return;
      }
      
      const expenseElements = splitExpensesContainer.querySelectorAll('.split-transaction-item');
      if (expenseElements.length === 0) {
        showToast("Please add at least one expense", "error");
        return;
      }
      
      let totalExpenses = 0;
      const expenses = [];
      
      // Validate all expenses
      for (const element of expenseElements) {
        const amountInput = element.querySelector('.split-amount-input');
        const descriptionInput = element.querySelector('.split-description-input');
        const bankInput = element.querySelector('.split-bank-input');
        const accountInput = element.querySelector('.split-account-input');
        
        const amount = parseFloat(amountInput.value) || 0;
        const description = descriptionInput.value.trim();
        const bank = bankInput.value;
        const account = accountInput.value;
        
        if (amount <= 0) {
          showToast("All expenses must have a positive amount", "error");
          return;
        }
        
        if (!description) {
          showToast("All expenses must have a description", "error");
          return;
        }
        
        if (!bank) {
          showToast("All expenses must have a bank account selected", "error");
          return;
        }
        
        if (!account) {
          showToast("All expenses must have an account header selected", "error");
          return;
        }
        
        totalExpenses += amount;
        expenses.push({ amount, description, bank, account });
      }
      
      const remaining = incomeAmount - totalExpenses;
      if (remaining < 0) {
        const confirm = window.confirm(
          `Your expenses ($${totalExpenses.toFixed(2)}) exceed your income ($${incomeAmount.toFixed(2)}) by $${Math.abs(remaining).toFixed(2)}. Do you want to continue?`
        );
        
        if (!confirm) {
          return;
        }
      }
      
      try {
        setButtonLoading(saveSplitTransactionsBtn, true);
        showLoading('Saving split transactions...');
        
        const user = auth.currentUser;
        const today = new Date().toISOString().split('T')[0];
        
        // Save income transaction
        const incomeVoucher = await getNextVoucherNumber(user.uid, "Receipt");
        const incomeData = {
          DATE: today,
          SINO: incomeVoucher,
          ACCOUNT_HEADER: "Income",
          BANK_NAME: incomeBank,
          MODE: incomeBank,
          VOUCHER_TYPE: "Receipt",
          TYPE: "Income",
          INCOME: incomeAmount,
          EXPENSE: 0,
          BALANCE: 0,
          DESCRIPTION: incomeDescription,
          NOTES: "Split income transaction",
          CURRENCY: "USD",
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          userId: user.uid
        };
        
        await db.collection("users").doc(user.uid).collection("transactions").add(incomeData);
        
        // Save all expense transactions
        for (const expense of expenses) {
          const expenseVoucher = await getNextVoucherNumber(user.uid, "Payment");
          const expenseData = {
            DATE: today,
            SINO: expenseVoucher,
            ACCOUNT_HEADER: expense.account,
            BANK_NAME: expense.bank,
            MODE: expense.bank,
            VOUCHER_TYPE: "Payment",
            TYPE: "Expense",
            INCOME: 0,
            EXPENSE: expense.amount,
            BALANCE: 0,
            DESCRIPTION: expense.description,
            NOTES: "Split from income",
            CURRENCY: "USD",
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            userId: user.uid
          };
          
          await db.collection("users").doc(user.uid).collection("transactions").add(expenseData);
        }
        
        splitIncomeModal.hide();
        showToast(`Successfully created ${1 + expenses.length} transactions!`, "success");
        loadFinancialData(user.uid); // Refresh financial data
      } catch (error) {
        console.error("Error saving split transactions: ", error);
        showToast("Error saving split transactions. Please try again.", "error");
      } finally {
        setButtonLoading(saveSplitTransactionsBtn, false);
        hideLoading();
      }
    }

    // Load COA data from the chartOfAccounts collection
    async function loadCOAData() {
      try {
        const user = auth.currentUser;
        if (!user) return;
        
        // Get account headers from chartOfAccounts collection
        const accountsQuery = db.collection("users").doc(user.uid).collection("chartOfAccounts");
        const accountsSnapshot = await accountsQuery.get();
        
        coaAccounts = [];
        coaBanks = [];
        
        accountsSnapshot.forEach(doc => {
          const data = doc.data();
          if (data.name) {
            coaAccounts.push(data.name);
          }
          
          // Check if this is a bank account
          if (data.category === "Bank" || data.category === "Cash" || 
              data.type === "Asset" && data.name.toLowerCase().includes("bank")) {
            coaBanks.push(data.name);
          }
        });
        
        // If no accounts found, set default accounts
        if (coaAccounts.length === 0) {
          coaAccounts = ["Rent", "AXIS", "Amount Tally", "Meals & Entertainment", "BOM", "Fuel", "Shopping", "Miscellaneous"];
        }
        
        if (coaBanks.length === 0) {
          coaBanks = ["AXIS", "BOM", "Cash"];
        }
        
        // Populate the dropdowns
        populateBankDropdown();
        
      } catch (error) {
        console.warn('Error loading COA data:', error);
        // Use default accounts if COA is not available
        coaAccounts = ["Rent", "AXIS", "Amount Tally", "Meals & Entertainment", "BOM", "Fuel", "Shopping", "Miscellaneous"];
        coaBanks = ["AXIS", "BOM", "Cash"];
        populateBankDropdown();
      }
    }
    
    function populateBankDropdown() {
      // Clear existing options (except the first one)
      splitIncomeBank.innerHTML = '<option value="">Select Bank</option>';
      
      // Add bank names
      coaBanks.forEach(bank => {
        const option = document.createElement('option');
        option.value = bank;
        option.textContent = bank;
        splitIncomeBank.appendChild(option);
      });
    }

    // Function to generate sequential voucher numbers
    async function getNextVoucherNumber(userId, type) {
      try {
        const transactionsQuery = db.collection("users").doc(userId).collection("transactions")
          .orderBy("SINO", "desc").limit(1);
        
        const snapshot = await transactionsQuery.get();
        
        if (snapshot.empty) {
          return type === "Receipt" ? "RP-001" : "PMT-001";
        }
        
        let lastVoucher = "";
        snapshot.forEach(doc => {
          lastVoucher = doc.data().SINO || "";
        });
        
        if (!lastVoucher) return type === "Receipt" ? "RP-001" : "PMT-001";
        
        // Extract number and increment
        const matches = lastVoucher.match(/\d+$/);
        if (matches) {
          const num = parseInt(matches[0]) + 1;
          return type === "Receipt" ? `RP-${num.toString().padStart(3, '0')}` : `PMT-${num.toString().padStart(3, '0')}`;
        }
        
        return type === "Receipt" ? "RP-001" : "PMT-001";
      } catch (error) {
        console.error("Error getting voucher number:", error);
        return type === "Receipt" ? "RP-001" : "PMT-001";
      }
    }

    // ========== END OF SPLIT TRANSACTION FEATURE ==========

    // Check if user is logged in
    auth.onAuthStateChanged((user) => {
      if (user) {
        // User is signed in
        dashboard.style.display = "block";
        const displayName = user.displayName || "User Name";
        const email = user.email || "user@example.com";
        
        userInitials.textContent = displayName.charAt(0).toUpperCase();
        headerUserInitials.textContent = displayName.charAt(0).toUpperCase();
        userName.textContent = displayName;
        userEmail.textContent = email;
        
        // Load saved preferences
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
          themeToggle.innerHTML = savedTheme === 'light' ? '<i class="fa fa-moon"></i>' : '<i class="fa fa-sun"></i>';
        }
        
        const savedBalanceVisibility = localStorage.getItem('balanceVisible');
        if (savedBalanceVisibility === 'true') {
          balanceVisible = true;
          currentBalanceEl.classList.remove('balance-hidden');
          balanceToggle.innerHTML = '<i class="fa fa-eye"></i>';
        }
        
        loadFinancialData(user.uid);
        loadCalendarEvents(user.uid);
        loadAccountHeaders(user.uid);
        loadCOAData(); // Load COA data for split feature
        loadNotifications(user.uid);
      } else {
        // User is signed out - redirect to login
        window.location.href = "index.html";
      }
    });

    // Load financial data from transactions
    async function loadFinancialData(userId) {
      try {
        showLoading('Loading financial data...');
        
        // Query transactions for this user
        const transactionsQuery = db.collection("users").doc(userId).collection("transactions");
        const snapshot = await transactionsQuery.get();
        
        allTransactions = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          allTransactions.push({ id: doc.id, ...data });
        });
        
        // Apply current filter to update stats
        applyFilter(currentFilter);
        
        hideLoading();
      } catch (error) {
        console.error("Error loading financial data:", error);
        hideLoading();
        showToast('Error loading financial data', 'error');
      }
    }

    // Apply date filter to transactions
    function applyFilter(filterType) {
      currentFilter = filterType;
      
      // Update active button state
      filterButtons.forEach(btn => {
        if (btn.dataset.filter === filterType) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Filter transactions based on the selected filter
      const now = new Date();
      filteredTransactions = allTransactions.filter(transaction => {
        const transactionDate = new Date(transaction.DATE);
        
        switch(filterType) {
          case 'today':
            return isSameDay(transactionDate, now);
          case 'week':
            return isSameWeek(transactionDate, now);
          case 'month':
            return isSameMonth(transactionDate, now);
          case 'year':
            return isSameYear(transactionDate, now);
          case 'all':
          default:
            return true;
        }
      });
      
      // Calculate stats based on filtered transactions
      calculateStats(filteredTransactions);
      
      showToast(`Showing ${filteredTransactions.length} transactions for ${filterType}`, 'success');
    }

    // Helper functions for date filtering
    function isSameDay(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
             date1.getMonth() === date2.getMonth() &&
             date1.getDate() === date2.getDate();
    }

    function isSameWeek(date1, date2) {
      const startOfWeek = new Date(date2);
      startOfWeek.setDate(date2.getDate() - date2.getDay());
      startOfWeek.setHours(0, 0, 0, 0);
      
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);
      endOfWeek.setHours(23, 59, 59, 999);
      
      return date1 >= startOfWeek && date1 <= endOfWeek;
    }

    function isSameMonth(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
             date1.getMonth() === date2.getMonth();
    }

    function isSameYear(date1, date2) {
      return date1.getFullYear() === date2.getFullYear();
    }

    // Calculate statistics from filtered transactions
    function calculateStats(transactions) {
      let totalIncome = 0;
      let totalExpenses = 0;
      let totalTransactions = transactions.length;
      let latestBalance = 0;
      
      transactions.forEach(transaction => {
        totalIncome += parseFloat(transaction.INCOME || 0);
        totalExpenses += parseFloat(transaction.EXPENSE || 0);
        
        // Get the latest balance (assuming transactions are ordered by date)
        if (latestBalance === 0 && transaction.BALANCE) {
          latestBalance = parseFloat(transaction.BALANCE);
        }
      });
      
      const currentBalance = latestBalance || (totalIncome - totalExpenses);
      
      // Update the dashboard with filtered data
      totalTransactionsEl.textContent = totalTransactions;
      currentBalanceEl.textContent = `$${currentBalance.toFixed(2)}`;
      totalIncomeEl.textContent = `$${totalIncome.toFixed(2)}`;
      totalExpensesEl.textContent = `$${totalExpenses.toFixed(2)}`;
    }

    // Load account headers from Chart of Accounts
    async function loadAccountHeaders(userId) {
      try {
        showLoading('Loading account headers...');
        
        const coaSnapshot = await db.collection("users").doc(userId).collection("chartOfAccounts").get();
        
        // Clear and repopulate the accountHeaders array
        accountHeaders = [];
        
        // Add options from COA
        coaSnapshot.forEach(doc => {
          const data = doc.data();
          if (data.name) {
            accountHeaders.push(data.name);
          }
        });
        
        hideLoading();
      } catch (error) {
        console.error("Error loading account headers:", error);
        hideLoading();
        showToast('Error loading account headers', 'error');
      }
    }

    // Load calendar events
    async function loadCalendarEvents(userId) {
      try {
        showLoading('Loading calendar events...');
        
        const snapshot = await db.collection("users").doc(userId).collection("reminders").get();
        
        const events = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          const eventData = {
            id: doc.id,
            title: data.title,
            start: data.date + (data.time ? "T" + data.time : ""),
            allDay: !data.time,
            extendedProps: {
              reminderId: doc.id,
              type: data.type,
              notes: data.notes || "",
              billAmount: data.billAmount || 0,
              recurrence: data.recurrence || "none"
            }
          };
          
          // Add color based on type
          if (data.type === "bill") {
            eventData.color = "#FF6B6B";
            eventData.title = " " + data.title;
            
            // For recurring bills, create events based on recurrence
            if (data.recurrence && data.recurrence !== "none") {
              createRecurringEvents(eventData, data.recurrence, events);
            } else {
              events.push(eventData);
            }
          } else if (data.type === "birthday") {
            eventData.color = "#FFD700";
            eventData.title = " " + data.title;
            
            // For birthdays, create recurring events for lifetime
            const year = new Date().getFullYear();
            const maxYear = year + 50; // Show for next 50 years
            for (let y = year; y <= maxYear; y++) {
              const birthdayEvent = {...eventData};
              birthdayEvent.id = `${doc.id}-${y}`; // Unique ID for each year
              birthdayEvent.start = y + "-" + data.date.substring(5);
              events.push(birthdayEvent);
            }
          } else if (data.type === "meeting") {
            eventData.color = "#4ECDC4";
            events.push(eventData);
          } else {
            eventData.color = "#45B7D1";
            events.push(eventData);
          }
        });
        
        // Clear existing events and add new ones
        calendar.removeAllEvents();
        if (events.length > 0) {
          calendar.addEventSource(events);
        }
        calendar.refetchEvents();
        
        hideLoading();
      } catch (error) {
        console.error("Error loading reminders: ", error);
        hideLoading();
        showToast('Error loading calendar events', 'error');
      }
    }

    // Create recurring events for bills
    function createRecurringEvents(eventData, recurrence, events) {
      const startDate = new Date(eventData.start);
      const today = new Date();
      const maxDate = new Date();
      maxDate.setFullYear(today.getFullYear() + 2); // Show for next 2 years
      
      let currentDate = new Date(startDate);
      let eventCount = 0;
      const maxEvents = 50; // Limit to prevent too many events
      
      while (currentDate <= maxDate && eventCount < maxEvents) {
        const recurringEvent = {...eventData};
        recurringEvent.id = `${eventData.id}-${eventCount}`;
        recurringEvent.start = currentDate.toISOString().split('T')[0];
        events.push(recurringEvent);
        
        // Increment date based on recurrence
        if (recurrence === "daily") {
          currentDate.setDate(currentDate.getDate() + 1);
        } else if (recurrence === "weekly") {
          currentDate.setDate(currentDate.getDate() + 7);
        } else if (recurrence === "monthly") {
          currentDate.setMonth(currentDate.getMonth() + 1);
        } else if (recurrence === "yearly") {
          currentDate.setFullYear(currentDate.getFullYear() + 1);
        }
        
        eventCount++;
      }
    }

    // Show reminder details in modal
    async function showReminderDetails(event) {
      try {
        showLoading('Loading reminder details...');
        
        const reminderId = event.extendedProps.reminderId;
        currentReminderId = reminderId;
        
        // Get reminder data from Firestore
        const user = auth.currentUser;
        const reminderDoc = await db.collection("users").doc(user.uid).collection("reminders").doc(reminderId).get();
        
        if (reminderDoc.exists) {
          const data = reminderDoc.data();
          
          // Update modal content
          detailType.textContent = data.type;
          detailType.className = `reminder-type-badge ${data.type}`;
          detailTitle.textContent = data.title;
          detailDate.textContent = formatDate(data.date);
          detailTime.textContent = data.time || "Not specified";
          detailNotes.textContent = data.notes || "No notes";
          
          // Show bill-specific fields if it's a bill
          if (data.type === "bill") {
            detailBillAmount.textContent = `$${parseFloat(data.billAmount || 0).toFixed(2)}`;
            detailBillAmountItem.style.display = "flex";
            detailRecurrence.textContent = data.recurrence || "None";
            detailRecurrenceItem.style.display = "flex";
          } else {
            detailBillAmountItem.style.display = "none";
            detailRecurrenceItem.style.display = "none";
          }
          
          // Show the modal
          reminderDetailModal.classList.add('active');
        } else {
          showToast("Reminder not found", "error");
        }
        
        hideLoading();
      } catch (error) {
        console.error("Error loading reminder details: ", error);
        hideLoading();
        showToast("Error loading reminder details", "error");
      }
    }

    // Format date for display
    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('en-US', options);
    }

    // Close reminder detail modal
    function closeReminderDetailModal() {
      reminderDetailModal.classList.remove('active');
      currentReminderId = null;
    }

    // Edit reminder
    async function editReminder() {
      if (!currentReminderId) return;
      
      try {
        showLoading('Loading reminder for editing...');
        
        const user = auth.currentUser;
        const reminderDoc = await db.collection("users").doc(user.uid).collection("reminders").doc(currentReminderId).get();
        
        if (reminderDoc.exists) {
          const data = reminderDoc.data();
          
          // Populate the reminder modal with existing data
          document.getElementById("reminderType").value = data.type;
          document.getElementById("reminderTitle").value = data.title;
          document.getElementById("reminderDate").value = data.date;
          document.getElementById("reminderTime").value = data.time || "";
          document.getElementById("reminderNotes").value = data.notes || "";
          
          // Populate bill-specific fields
          if (data.type === "bill") {
            document.getElementById("billAmount").value = data.billAmount || "";
            document.querySelector(`input[name="recurrence"][value="${data.recurrence || 'none'}"]`).checked = true;
          }
          
          // Show/hide bill fields based on type
          toggleBillFields(data.type);
          
          // Close detail modal and open edit modal
          closeReminderDetailModal();
          reminderModal.classList.add('active');
          
          // Change save button to update
          saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Update Reminder';
          saveReminderBtn.onclick = updateReminder;
        }
        
        hideLoading();
      } catch (error) {
        console.error("Error loading reminder for editing: ", error);
        hideLoading();
        showToast("Error loading reminder for editing", "error");
      }
    }

    // Update reminder
    async function updateReminder() {
      const type = document.getElementById("reminderType").value;
      const title = document.getElementById("reminderTitle").value;
      const date = document.getElementById("reminderDate").value;
      const time = document.getElementById("reminderTime").value;
      const notes = document.getElementById("reminderNotes").value;
      const user = auth.currentUser;

      if (!title || !date) {
        showToast("Please fill in all required fields", "error");
        return;
      }

      try {
        setButtonLoading(saveReminderBtn, true);
        
        const updateData = {
          type,
          title,
          date,
          time,
          notes,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Add bill-specific data if it's a bill
        if (type === "bill") {
          updateData.billAmount = parseFloat(document.getElementById("billAmount").value) || 0;
          updateData.recurrence = document.querySelector('input[name="recurrence"]:checked').value;
        }
        
        await db.collection("users").doc(user.uid).collection("reminders").doc(currentReminderId).update(updateData);
        
        closeReminderModal();
        showToast("Reminder updated successfully!", "success");
        loadCalendarEvents(user.uid); // Refresh calendar
        loadNotifications(user.uid); // Refresh notifications
        
        // Reset save button to default
        saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Save Reminder';
        saveReminderBtn.onclick = saveReminder;
      } catch (error) {
        console.error("Error updating reminder: ", error);
        showToast("Error updating reminder. Please try again.", "error");
      } finally {
        setButtonLoading(saveReminderBtn, false);
      }
    }

    // Delete reminder
    async function deleteReminder() {
      if (!currentReminderId) return;
      
      const confirmDelete = confirm("Are you sure you want to delete this reminder?");
      if (!confirmDelete) return;
      
      try {
        setButtonLoading(deleteReminderBtn, true);
        
        const user = auth.currentUser;
        await db.collection("users").doc(user.uid).collection("reminders").doc(currentReminderId).delete();
        
        closeReminderDetailModal();
        showToast("Reminder deleted successfully!", "success");
        loadCalendarEvents(user.uid); // Refresh calendar
        loadNotifications(user.uid); // Refresh notifications
      } catch (error) {
        console.error("Error deleting reminder: ", error);
        showToast("Error deleting reminder. Please try again.", "error");
      } finally {
        setButtonLoading(deleteReminderBtn, false);
      }
    }

    // Save reminder
    async function saveReminder() {
      const type = document.getElementById("reminderType").value;
      const title = document.getElementById("reminderTitle").value;
      const date = document.getElementById("reminderDate").value;
      const time = document.getElementById("reminderTime").value;
      const notes = document.getElementById("reminderNotes").value;
      const user = auth.currentUser;

      if (!title || !date) {
        showToast("Please fill in all required fields", "error");
        return;
      }

      try {
        setButtonLoading(saveReminderBtn, true);
        
        const reminderData = {
          type,
          title,
          date,
          time,
          notes,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Add bill-specific data if it's a bill
        if (type === "bill") {
          reminderData.billAmount = parseFloat(document.getElementById("billAmount").value) || 0;
          reminderData.recurrence = document.querySelector('input[name="recurrence"]:checked').value;
        }
        
        await db.collection("users").doc(user.uid).collection("reminders").add(reminderData);
        
        closeReminderModal();
        showToast("Reminder added successfully!", "success");
        loadCalendarEvents(user.uid); // Refresh calendar
        loadNotifications(user.uid); // Refresh notifications
      } catch (error) {
        console.error("Error adding reminder: ", error);
        showToast("Error adding reminder. Please try again.", "error");
      } finally {
        setButtonLoading(saveReminderBtn, false);
      }
    }

    // Toggle bill-specific fields based on reminder type
    function toggleBillFields(type) {
      if (type === "bill") {
        billAmountGroup.style.display = "block";
        recurrenceGroup.style.display = "block";
      } else {
        billAmountGroup.style.display = "none";
        recurrenceGroup.style.display = "none";
      }
    }

    // Load notifications
    async function loadNotifications(userId) {
      try {
        const snapshot = await db.collection("users").doc(userId).collection("reminders").get();
        
        notifications = [];
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        snapshot.forEach(doc => {
          const data = doc.data();
          const reminderDate = new Date(data.date);
          reminderDate.setHours(0, 0, 0, 0);
          
          // Calculate days until reminder
          const timeDiff = reminderDate.getTime() - today.getTime();
          const daysUntil = Math.ceil(timeDiff / (1000 * 3600 * 24));
          
          // Only show notifications for upcoming reminders (within 7 days)
          if (daysUntil >= 0 && daysUntil <= 7) {
            let message = "";
            let daysText = "";
            
            if (daysUntil === 0) {
              daysText = "Today";
            } else if (daysUntil === 1) {
              daysText = "Tomorrow";
            } else {
              daysText = `In ${daysUntil} days`;
            }
            
            if (data.type === "bill") {
              message = `Bill payment of $${parseFloat(data.billAmount || 0).toFixed(2)} due ${daysText}`;
            } else {
              message = `${data.type.charAt(0).toUpperCase() + data.type.slice(1)} ${daysText}`;
            }
            
            notifications.push({
              id: doc.id,
              title: data.title,
              message: message,
              type: data.type,
              date: data.date,
              daysUntil: daysUntil
            });
          }
        });
        
        // Sort notifications by date (soonest first)
        notifications.sort((a, b) => {
          return new Date(a.date) - new Date(b.date);
        });
        
        updateNotificationUI();
      } catch (error) {
        console.error("Error loading notifications:", error);
      }
    }

    // Update notification UI
    function updateNotificationUI() {
      // Update badge count
      notificationBadge.textContent = notifications.length;
      
      // Update notification list
      notificationList.innerHTML = "";
      
      if (notifications.length === 0) {
        notificationList.innerHTML = '<div class="no-notifications">No upcoming reminders</div>';
        return;
      }
      
      notifications.forEach(notification => {
        const notificationItem = document.createElement('div');
        notificationItem.className = 'notification-item';
        notificationItem.onclick = () => {
          // When notification is clicked, find and show the corresponding calendar event
          const event = calendar.getEvents().find(e => e.id === notification.id || e.id.startsWith(notification.id));
          if (event) {
            showReminderDetails(event);
            closeNotificationPanel();
          }
        };
        
        let iconClass = "";
        if (notification.type === "bill") {
          iconClass = "bill";
        } else if (notification.type === "birthday") {
          iconClass = "birthday";
        } else if (notification.type === "meeting") {
          iconClass = "meeting";
        } else {
          iconClass = "reminder";
        }
        
        notificationItem.innerHTML = `
          <div class="notification-title">
            <div class="notification-icon ${iconClass}">
              <i class="fa ${notification.type === 'bill' ? 'fa-file-invoice-dollar' : 
                              notification.type === 'birthday' ? 'fa-birthday-cake' : 
                              notification.type === 'meeting' ? 'fa-users' : 'fa-bell'}"></i>
            </div>
            ${notification.title}
          </div>
          <div class="notification-message">${notification.message}</div>
          <div class="notification-time">
            <i class="fa fa-calendar"></i>
            ${formatDate(notification.date)}
          </div>
        `;
        
        notificationList.appendChild(notificationItem);
      });
    }

    // Clear all notifications
    function clearAllNotifications() {
      notifications = [];
      updateNotificationUI();
      showToast("Notifications cleared", "success");
    }

    // Toggle notification panel
    function toggleNotificationPanel() {
      notificationPanel.classList.toggle('active');
    }

    // Close notification panel
    function closeNotificationPanel() {
      notificationPanel.classList.remove('active');
    }

    // New Feature Functions
    function openBudgetPlanner() {
      showToast("Budget Planner feature coming soon!", "info");
    }

    function openGoalTracker() {
      showToast("Goal Tracker feature coming soon!", "info");
    }

    function openBillReminders() {
      showToast("Bill Reminders feature coming soon!", "info");
    }

    function openFinancialInsights() {
      showToast("Financial Insights feature coming soon!", "info");
    }

    function logout() {
      auth.signOut().then(() => {
        console.log("User signed out");
        window.location.href = "index.html";
      }).catch((error) => {
        showToast("Logout error: " + error.message, 'error');
      });
    }

    function openProfile() {
      window.location.href = "profile.html";
    }

    // Sidebar toggle
    menuToggle.addEventListener("click", () => {
      sidebar.classList.toggle("visible");
      header.classList.toggle("sidebar-visible");
      main.classList.toggle("sidebar-visible");
    });

    // Profile dropdown
    profileMenu.addEventListener("click", (e) => {
      e.stopPropagation();
      profileMenu.classList.toggle("active");
    });

    // Close dropdown when clicking elsewhere
    document.addEventListener("click", () => {
      profileMenu.classList.remove("active");
    });

    // Theme toggle
    themeToggle.addEventListener("click", toggleTheme);

    // Balance visibility toggle
    balanceToggle.addEventListener("click", toggleBalanceVisibility);

    // Filter buttons
    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        applyFilter(btn.dataset.filter);
      });
    });

    // Transaction button click handler
    totalTransactionsEl.addEventListener('click', () => {
      openTransactionTypePopup();
    });

    // Income/Expense click handlers
    totalIncomeEl.addEventListener('click', () => {
      reportPopup.classList.add('active');
    });

    totalExpensesEl.addEventListener('click', () => {
      reportPopup.classList.add('active');
    });

    // Split button
    splitBtn.addEventListener("click", openSplitIncomeModal);

    // Add expense button
    addSplitExpenseBtn.addEventListener("click", addSplitExpense);

    // Save split button
    saveSplitTransactionsBtn.addEventListener("click", saveSplitTransactions);

    // Expense Popup
    function openExpensePopup() {
      expensePopup.classList.add("active");
    }
    
    function closeExpensePopup() {
      expensePopup.classList.remove("active");
    }

    // Report Popup
    function closeReportPopup() {
      reportPopup.classList.remove("active");
    }

    // Reminder Modal
    addReminderBtn.addEventListener("click", () => {
      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("reminderDate").value = today;
      document.getElementById("reminderType").value = "reminder";
      document.getElementById("reminderTitle").value = "";
      document.getElementById("reminderTime").value = "";
      document.getElementById("reminderNotes").value = "";
      document.getElementById("billAmount").value = "";
      document.querySelector('input[name="recurrence"][value="none"]').checked = true;
      toggleBillFields("reminder");
      
      // Reset save button to default
      saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Save Reminder';
      saveReminderBtn.onclick = saveReminder;
      
      reminderModal.classList.add("active");
    });
    
    function closeReminderModal() {
      reminderModal.classList.remove("active");
      // Reset save button to default
      saveReminderBtn.innerHTML = '<i class="fas fa-save"></i> Save Reminder';
      saveReminderBtn.onclick = saveReminder;
    }

    // Edit reminder button
    editReminderBtn.addEventListener("click", editReminder);

    // Delete reminder button
    deleteReminderBtn.addEventListener("click", deleteReminder);

    // Notification bell click
    notificationBell.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleNotificationPanel();
    });

    // Clear notifications button
    clearNotifications.addEventListener("click", clearAllNotifications);

    // Close notification panel when clicking elsewhere
    document.addEventListener("click", closeNotificationPanel);

    // Toggle bill fields when reminder type changes
    reminderType.addEventListener("change", function() {
      toggleBillFields(this.value);
    });

    // Add some default account headers if none loaded
    if (accountHeaders.length === 0) {
      accountHeaders = [
        "Rent", "Utilities", "Groceries", "Transportation", 
        "Entertainment", "Healthcare", "Education", "Shopping"
      ];
    }

    // Initialize the dashboard with some sample data for demonstration
    function initializeSampleData() {
      // Set current date in reminder modal
      document.getElementById("reminderDate").value = new Date().toISOString().split('T')[0];
      
      // Add some sample events to calendar for demo if no events exist
      const user = auth.currentUser;
      if (user) {
        db.collection("users").doc(user.uid).collection("reminders").get()
          .then(snapshot => {
            if (snapshot.empty) {
              const today = new Date();
              const nextWeek = new Date(today);
              nextWeek.setDate(today.getDate() + 7);
              
              const sampleEvents = [
                {
                  title: "Team Meeting",
                  start: today.toISOString().split('T')[0],
                  color: "#4ECDC4"
                },
                {
                  title: "Project Deadline",
                  start: nextWeek.toISOString().split('T')[0],
                  color: "#FF6B6B"
                }
              ];
              
              calendar.addEventSource(sampleEvents);
            }
          });
      }
    }

    // Initialize sample data when page loads
    window.addEventListener('load', initializeSampleData);

    // Make functions available globally for HTML onclick handlers
    window.openExpensePopup = openExpensePopup;
    window.closeExpensePopup = closeExpensePopup;
    window.closeReportPopup = closeReportPopup;
    window.closeTransactionTypePopup = closeTransactionTypePopup;
    window.closeReminderModal = closeReminderModal;
    window.closeReminderDetailModal = closeReminderDetailModal;
    window.removeSplitExpense = removeSplitExpense;
    window.updateSplitSummary = updateSplitSummary;
    window.openBudgetPlanner = openBudgetPlanner;
    window.openGoalTracker = openGoalTracker;
    window.openBillReminders = openBillReminders;
    window.openFinancialInsights = openFinancialInsights;
    window.openSplitIncomeModal = openSplitIncomeModal;
  </script>
</body>
</html>