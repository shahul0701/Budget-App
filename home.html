<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BudgetFlow - Dashboard</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet"/>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <!-- Sidebar -->
  <div id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-800 text-white transform -translate-x-full transition-transform duration-300 z-50">
    <div class="p-4 text-xl font-bold border-b border-gray-700">BudgetFlow</div>
    <ul class="p-4 space-y-4">
      <li><a href="home.html" class="flex items-center gap-2 hover:text-yellow-400"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="coa.html" class="flex items-center gap-2 hover:text-yellow-400"><i class="fas fa-book"></i> COA</a></li>
      <li><a href="Section.html" class="flex items-center gap-2 hover:text-yellow-400"><i class="fas fa-file-alt"></i> Reports</a></li>
      <li><a href="chart.html" class="flex items-center gap-2 hover:text-yellow-400"><i class="fas fa-chart-line"></i> Charts</a></li>
    </ul>
  </div>

  <!-- Topbar -->
  <div class="flex items-center justify-between bg-white shadow px-4 py-3 sticky top-0 z-40">
    <button id="menuToggle" class="text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
    <div class="flex items-center gap-4">
      <div id="liveClock" class="text-gray-700 font-semibold"></div>
      <div class="relative">
        <button id="profileBtn" class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center font-bold text-white"></button>
        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-40 bg-white border rounded shadow">
          <a href="#" id="logoutBtn" class="block px-4 py-2 hover:bg-gray-100"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex flex-col lg:flex-row p-6 gap-6">
    <!-- Left Summary -->
    <div class="lg:w-1/3 space-y-6">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Summary</h2>
        <p id="totalIncome" class="text-green-600 font-semibold">Income: â‚¹0</p>
        <p id="totalExpenses" class="text-red-600 font-semibold">Expenses: â‚¹0</p>
        <select id="timeFilter" class="mt-4 w-full border rounded p-2">
          <option>Today</option>
          <option>This Week</option>
          <option>This Month</option>
          <option>This Year</option>
        </select>
      </div>
      <div id="chartContainer" class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Spending Chart</h2>
        <canvas id="spendingChart"></canvas>
      </div>
    </div>

    <!-- Right Calendar -->
    <div class="lg:w-2/3 bg-white p-6 rounded-lg shadow relative">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Reminders & Events</h2>
        <button id="addReminderBtn" class="bg-yellow-500 text-white px-4 py-2 rounded"><i class="fas fa-plus"></i></button>
      </div>
      <div id="calendar"></div>
    </div>
  </div>

  <!-- Add Reminder Modal -->
  <div id="reminderModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-96 p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Add Reminder</h2>
      <select id="reminderType" class="w-full border rounded p-2 mb-3">
        <option value="reminder">Reminder</option>
        <option value="birthday">Birthday</option>
        <option value="meeting">Meeting</option>
      </select>
      <input type="text" id="reminderTitle" placeholder="Title" class="w-full border rounded p-2 mb-3"/>
      <input type="date" id="reminderDate" class="w-full border rounded p-2 mb-3"/>
      <input type="time" id="reminderTime" class="w-full border rounded p-2 mb-3"/>
      <textarea id="reminderNotes" placeholder="Notes" class="w-full border rounded p-2 mb-3"></textarea>
      <div class="flex justify-end gap-3">
        <button id="cancelReminder" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
        <button id="saveReminder" class="px-4 py-2 bg-yellow-500 text-white rounded">Save</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
      authDomain: "budget-app-1365f.firebaseapp.com",
      projectId: "budget-app-1365f",
      storageBucket: "budget-app-1365f.appspot.com",
      messagingSenderId: "1036194450411",
      appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
      measurementId: "G-YFFJL2H54X"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const userId = localStorage.getItem("username") || "guest";

    // Sidebar toggle
    document.getElementById("menuToggle").addEventListener("click", () => {
      document.getElementById("sidebar").classList.toggle("-translate-x-full");
    });

    // Profile initials
    const profileBtn = document.getElementById("profileBtn");
    profileBtn.textContent = userId.charAt(0).toUpperCase();
    profileBtn.addEventListener("click", () => {
      document.getElementById("profileMenu").classList.toggle("hidden");
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "index.html";
    });

    // Live clock
    setInterval(() => {
      document.getElementById("liveClock").textContent = new Date().toLocaleString();
    }, 1000);

    // FullCalendar init
    let calendar;
    document.addEventListener("DOMContentLoaded", function() {
      const calendarEl = document.getElementById("calendar");
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        events: [],
        eventClick: function(info) {
          alert(info.event.title + "\\n" + info.event.extendedProps.notes);
        }
      });
      calendar.render();
      loadReminders();
    });

    // Load reminders from Firestore
    async function loadReminders() {
      const q = query(collection(db, "reminders"), where("userId", "==", userId));
      onSnapshot(q, (snapshot) => {
        const events = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.type === "birthday") {
            // repeat yearly
            let year = new Date().getFullYear();
            events.push({ title: data.title + " ðŸŽ‚", start: year + "-" + data.date.slice(5), notes: data.notes });
          } else {
            events.push({ title: data.title, start: data.date, notes: data.notes });
          }
        });
        calendar.removeAllEvents();
        calendar.addEventSource(events);
      });
    }

    // Open modal
    document.getElementById("addReminderBtn").addEventListener("click", () => {
      document.getElementById("reminderModal").classList.remove("hidden");
    });

    document.getElementById("cancelReminder").addEventListener("click", () => {
      document.getElementById("reminderModal").classList.add("hidden");
    });

    // Save reminder
    document.getElementById("saveReminder").addEventListener("click", async () => {
      const type = document.getElementById("reminderType").value;
      const title = document.getElementById("reminderTitle").value;
      const date = document.getElementById("reminderDate").value;
      const time = document.getElementById("reminderTime").value;
      const notes = document.getElementById("reminderNotes").value;

      if (!title || !date) {
        alert("Please enter title and date");
        return;
      }

      await addDoc(collection(db, "reminders"), {
        userId, type, title, date, time, notes
      });

      document.getElementById("reminderModal").classList.add("hidden");
    });

  </script>

  <!-- FullCalendar Script -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
