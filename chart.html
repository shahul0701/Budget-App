<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .header-left a {
            text-decoration: none;
            color: var(--primary);
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #userInitials {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        #logoutBtn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        #logoutBtn:hover {
            background: #c0392b;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
        }
        
        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .time-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-filter select, .time-filter button {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .time-filter button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
        }
        
        .view-toggle button {
            padding: 8px 14px;
            border-radius: 4px;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
        }
        
        .view-toggle button.active {
            background: #2980b9;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-content {
            flex: 1;
            position: relative;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .summary-card.income {
            border-top: 4px solid var(--secondary);
        }
        
        .summary-card.expenses {
            border-top: 4px solid var(--danger);
        }
        
        .summary-card.profit {
            border-top: 4px solid var(--primary);
        }
        
        .summary-card.balance {
            border-top: 4px solid var(--warning);
        }
        
        .card-title {
            font-size: 16px;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .card-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .income .card-value {
            color: var(--secondary);
        }
        
        .expenses .card-value {
            color: var(--danger);
        }
        
        .profit .card-value {
            color: var(--primary);
        }
        
        .balance .card-value {
            color: var(--warning);
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .export-buttons button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .export-buttons button:hover {
            background: #2980b9;
        }
        
        .loading-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
        }
        
        @media (max-width: 1100px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-controls {
                flex-direction: column;
            }
            
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left"><a href="home.html"><i class="fa fa-home"></i> Home</a></div>
        <div class="header-right">
            <div id="userInitials">U</div>
            <div id="username">User</div>
            <button id="logoutBtn">Logout</button>
        </div>
    </header>

    <div class="container">
        <h1><i class="fas fa-chart-line"></i> Financial Analytics Dashboard</h1>
        
        <div class="dashboard-controls">
            <div class="time-filter">
                <span>Time Period:</span>
                <select id="timeRange">
                    <option value="7">Last 7 Days</option>
                    <option value="30" selected>Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                    <option value="180">Last 6 Months</option>
                    <option value="365">Last Year</option>
                    <option value="all">All Time</option>
                </select>
                <button id="applyFilter">Apply</button>
            </div>
            
            <div class="view-toggle">
                <button id="overviewView" class="active">Overview</button>
                <button id="detailedView">Detailed View</button>
            </div>
        </div>
        
        <div class="summary-cards">
            <div class="summary-card income">
                <div class="card-title">Total Income</div>
                <div class="card-value" id="totalIncome">₹0.00</div>
            </div>
            <div class="summary-card expenses">
                <div class="card-title">Total Expenses</div>
                <div class="card-value" id="totalExpenses">₹0.00</div>
            </div>
            <div class="summary-card profit">
                <div class="card-title">Net Profit</div>
                <div class="card-value" id="netProfit">₹0.00</div>
            </div>
            <div class="summary-card balance">
                <div class="card-title">Account Balance</div>
                <div class="card-value" id="accountBalance">₹0.00</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <!-- Income vs Expenses Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Income vs Expenses</span>
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="chart-content">
                    <canvas id="incomeExpensesChart"></canvas>
                </div>
            </div>
            
            <!-- Monthly Trends Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Monthly Trends</span>
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="chart-content">
                    <canvas id="monthlyTrendsChart"></canvas>
                </div>
            </div>
            
            <!-- Expense Categories Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Expense Categories</span>
                    <i class="fas fa-pie-chart"></i>
                </div>
                <div class="chart-content">
                    <canvas id="expenseCategoriesChart"></canvas>
                </div>
            </div>
            
            <!-- Income Sources Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Income Sources</span>
                    <i class="fas fa-chart-pie"></i>
                </div>
                <div class="chart-content">
                    <canvas id="incomeSourcesChart"></canvas>
                </div>
            </div>
            
            <!-- Cash Flow Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Cash Flow</span>
                    <i class="fas fa-water"></i>
                </div>
                <div class="chart-content">
                    <canvas id="cashFlowChart"></canvas>
                </div>
            </div>
            
            <!-- Account Balances Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Account Balances</span>
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="chart-content">
                    <canvas id="accountBalancesChart"></canvas>
                </div>
            </div>
            
            <!-- Weekly Analysis Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Weekly Analysis</span>
                    <i class="fas fa-calendar-week"></i>
                </div>
                <div class="chart-content">
                    <canvas id="weeklyAnalysisChart"></canvas>
                </div>
            </div>
            
            <!-- Year-over-Year Comparison -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Year-over-Year Comparison</span>
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="chart-content">
                    <canvas id="yoyComparisonChart"></canvas>
                </div>
            </div>
            
            <!-- Top Expenses Chart -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Top Expenses</span>
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="chart-content">
                    <canvas id="topExpensesChart"></canvas>
                </div>
            </div>
            
            <!-- Budget vs Actual -->
            <div class="chart-container">
                <div class="chart-title">
                    <span>Budget vs Actual</span>
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div class="chart-content">
                    <canvas id="budgetVsActualChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="export-buttons">
            <button id="exportDashboardPDF"><i class="fa fa-file-pdf"></i> Export Dashboard as PDF</button>
            <button id="exportChartsData"><i class="fa fa-file-csv"></i> Export Charts Data</button>
        </div>
    </div>

    <div id="loadingModal" class="loading-modal">
        <div class="loading-content">
            <i class="fa fa-spinner fa-spin" style="font-size:40px;margin-bottom:15px;"></i>
            <p>Loading Financial Data...</p>
        </div>
    </div>

    <script>
        // Firebase imports (would be added in a real implementation)
        // For this demo, we'll simulate loading data from your existing structure
        
        // DOM Elements
        const usernameElem = document.getElementById("username");
        const initialsElem = document.getElementById("userInitials");
        const logoutBtn = document.getElementById("logoutBtn");
        const loadingModal = document.getElementById("loadingModal");
        const applyFilterBtn = document.getElementById("applyFilter");
        const timeRangeSelect = document.getElementById("timeRange");
        
        // Summary elements
        const totalIncomeElem = document.getElementById("totalIncome");
        const totalExpensesElem = document.getElementById("totalExpenses");
        const netProfitElem = document.getElementById("netProfit");
        const accountBalanceElem = document.getElementById("accountBalance");
        
        // Chart references
        let incomeExpensesChart, monthlyTrendsChart, expenseCategoriesChart, incomeSourcesChart;
        let cashFlowChart, accountBalancesChart, weeklyAnalysisChart, yoyComparisonChart;
        let topExpensesChart, budgetVsActualChart;
        
        // Data storage
        let transactions = [];
        let accounts = [];
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate loading user data
            const user = {
                displayName: "Demo User",
                email: "user@example.com"
            };
            
            if(user){
                const name = user.displayName || user.email || "User";
                usernameElem.textContent = name;
                initialsElem.textContent = name.charAt(0).toUpperCase();
                loadFinancialData();
            }
            
            // Set up event listeners
            logoutBtn.addEventListener('click', () => {
                alert('Logging out...');
                // In a real implementation, this would call Firebase auth signOut
            });
            
            applyFilterBtn.addEventListener('click', applyFilters);
        });
        
        // Load financial data
        function loadFinancialData() {
            loadingModal.style.display = "flex";
            
            // In a real implementation, this would load from Firebase
            // For this demo, we'll simulate loading after a short delay
            setTimeout(() => {
                // Simulate loading transactions from your existing structure
                // In a real implementation, this would come from Firestore
                transactions = [
                    { id: 1, DATE: '2023-01-15', ACCOUNT_HEADER: 'Salary', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 50000, EXPENSE: 0, DESCRIPTION: 'Monthly Salary', BALANCE: 50000 },
                    { id: 2, DATE: '2023-01-16', ACCOUNT_HEADER: 'Rent', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 0, EXPENSE: 15000, DESCRIPTION: 'House Rent', BALANCE: 35000 },
                    { id: 3, DATE: '2023-01-17', ACCOUNT_HEADER: 'Food', MODE: 'Cash', BANK_NAME: '', 
                      INCOME: 0, EXPENSE: 3000, DESCRIPTION: 'Groceries', BALANCE: 32000 },
                    { id: 4, DATE: '2023-01-18', ACCOUNT_HEADER: 'Transport', MODE: 'Card', BANK_NAME: 'SBI Credit', 
                      INCOME: 0, EXPENSE: 2000, DESCRIPTION: 'Fuel', BALANCE: 30000 },
                    { id: 5, DATE: '2023-01-19', ACCOUNT_HEADER: 'Freelance', MODE: 'Bank', BANK_NAME: 'ICICI', 
                      INCOME: 10000, EXPENSE: 0, DESCRIPTION: 'Project Work', BALANCE: 40000 },
                    { id: 6, DATE: '2023-01-20', ACCOUNT_HEADER: 'Entertainment', MODE: 'Card', BANK_NAME: 'SBI Credit', 
                      INCOME: 0, EXPENSE: 2500, DESCRIPTION: 'Movie Tickets', BALANCE: 37500 },
                    { id: 7, DATE: '2023-02-05', ACCOUNT_HEADER: 'Dividends', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 5000, EXPENSE: 0, DESCRIPTION: 'Stock Dividends', BALANCE: 42500 },
                    { id: 8, DATE: '2023-02-10', ACCOUNT_HEADER: 'Utilities', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 0, EXPENSE: 3500, DESCRIPTION: 'Electricity Bill', BALANCE: 39000 },
                    { id: 9, DATE: '2023-02-15', ACCOUNT_HEADER: 'Salary', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 50000, EXPENSE: 0, DESCRIPTION: 'Monthly Salary', BALANCE: 89000 },
                    { id: 10, DATE: '2023-02-16', ACCOUNT_HEADER: 'Rent', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 0, EXPENSE: 15000, DESCRIPTION: 'House Rent', BALANCE: 74000 },
                    { id: 11, DATE: '2023-02-20', ACCOUNT_HEADER: 'Healthcare', MODE: 'Card', BANK_NAME: 'SBI Credit', 
                      INCOME: 0, EXPENSE: 4000, DESCRIPTION: 'Medical Checkup', BALANCE: 70000 },
                    { id: 12, DATE: '2023-03-05', ACCOUNT_HEADER: 'Interest', MODE: 'Bank', BANK_NAME: 'ICICI', 
                      INCOME: 2000, EXPENSE: 0, DESCRIPTION: 'Savings Interest', BALANCE: 72000 },
                    { id: 13, DATE: '2023-03-15', ACCOUNT_HEADER: 'Salary', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 50000, EXPENSE: 0, DESCRIPTION: 'Monthly Salary', BALANCE: 122000 },
                    { id: 14, DATE: '2023-03-16', ACCOUNT_HEADER: 'Rent', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 0, EXPENSE: 15000, DESCRIPTION: 'House Rent', BALANCE: 107000 },
                    { id: 15, DATE: '2023-03-20', ACCOUNT_HEADER: 'Shopping', MODE: 'Card', BANK_NAME: 'SBI Credit', 
                      INCOME: 0, EXPENSE: 8000, DESCRIPTION: 'Clothing', BALANCE: 99000 },
                    { id: 16, DATE: '2023-03-25', ACCOUNT_HEADER: 'Food', MODE: 'Cash', BANK_NAME: '', 
                      INCOME: 0, EXPENSE: 4000, DESCRIPTION: 'Restaurant', BALANCE: 95000 },
                    { id: 17, DATE: '2023-04-02', ACCOUNT_HEADER: 'Bonus', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 20000, EXPENSE: 0, DESCRIPTION: 'Performance Bonus', BALANCE: 115000 },
                    { id: 18, DATE: '2023-04-15', ACCOUNT_HEADER: 'Salary', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 50000, EXPENSE: 0, DESCRIPTION: 'Monthly Salary', BALANCE: 165000 },
                    { id: 19, DATE: '2023-04-16', ACCOUNT_HEADER: 'Rent', MODE: 'Bank', BANK_NAME: 'HDFC', 
                      INCOME: 0, EXPENSE: 15000, DESCRIPTION: 'House Rent', BALANCE: 150000 },
                    { id: 20, DATE: '2023-04-22', ACCOUNT_HEADER: 'Travel', MODE: 'Card', BANK_NAME: 'SBI Credit', 
                      INCOME: 0, EXPENSE: 12000, DESCRIPTION: 'Weekend Trip', BALANCE: 138000 }
                ];
                
                // Calculate summary values
                updateSummaryValues();
                
                // Initialize all charts
                initAllCharts();
                
                loadingModal.style.display = "none";
            }, 1500);
        }
        
        // Update summary values
        function updateSummaryValues() {
            const totalIncome = transactions.reduce((sum, tx) => sum + (parseFloat(tx.INCOME) || 0), 0);
            const totalExpenses = transactions.reduce((sum, tx) => sum + (parseFloat(tx.EXPENSE) || 0), 0);
            const netProfit = totalIncome - totalExpenses;
            
            // Find the latest balance
            const latestBalance = transactions.length > 0 ? 
                parseFloat(transactions[transactions.length - 1].BALANCE) || 0 : 0;
            
            totalIncomeElem.textContent = `₹${totalIncome.toLocaleString('en-IN')}`;
            totalExpensesElem.textContent = `₹${totalExpenses.toLocaleString('en-IN')}`;
            netProfitElem.textContent = `₹${netProfit.toLocaleString('en-IN')}`;
            accountBalanceElem.textContent = `₹${latestBalance.toLocaleString('en-IN')}`;
        }
        
        // Apply filters based on time range
        function applyFilters() {
            loadingModal.style.display = "flex";
            
            // In a real implementation, this would filter the transactions
            // For this demo, we'll just reload the charts with the current data
            setTimeout(() => {
                initAllCharts();
                loadingModal.style.display = "none";
            }, 500);
        }
        
        // Initialize all charts
        function initAllCharts() {
            initIncomeExpensesChart();
            initMonthlyTrendsChart();
            initExpenseCategoriesChart();
            initIncomeSourcesChart();
            initCashFlowChart();
            initAccountBalancesChart();
            initWeeklyAnalysisChart();
            initYoyComparisonChart();
            initTopExpensesChart();
            initBudgetVsActualChart();
        }
        
        // 1. Income vs Expenses Chart
        function initIncomeExpensesChart() {
            const ctx = document.getElementById('incomeExpensesChart').getContext('2d');
            
            // Group by month
            const monthlyData = {};
            transactions.forEach(tx => {
                const month = tx.DATE.substring(0, 7); // YYYY-MM
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expenses: 0 };
                }
                monthlyData[month].income += parseFloat(tx.INCOME) || 0;
                monthlyData[month].expenses += parseFloat(tx.EXPENSE) || 0;
            });
            
            const months = Object.keys(monthlyData).sort();
            const incomeData = months.map(month => monthlyData[month].income);
            const expensesData = months.map(month => monthlyData[month].expenses);
            
            if (incomeExpensesChart) {
                incomeExpensesChart.destroy();
            }
            
            incomeExpensesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Income',
                            data: incomeData,
                            backgroundColor: '#2ecc71'
                        },
                        {
                            label: 'Expenses',
                            data: expensesData,
                            backgroundColor: '#e74c3c'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 2. Monthly Trends Chart
        function initMonthlyTrendsChart() {
            const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');
            
            // Group by month
            const monthlyData = {};
            transactions.forEach(tx => {
                const month = tx.DATE.substring(0, 7); // YYYY-MM
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expenses: 0 };
                }
                monthlyData[month].income += parseFloat(tx.INCOME) || 0;
                monthlyData[month].expenses += parseFloat(tx.EXPENSE) || 0;
            });
            
            const months = Object.keys(monthlyData).sort();
            const incomeData = months.map(month => monthlyData[month].income);
            const expensesData = months.map(month => monthlyData[month].expenses);
            
            if (monthlyTrendsChart) {
                monthlyTrendsChart.destroy();
            }
            
            monthlyTrendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Income Trend',
                            data: incomeData,
                            borderColor: '#2ecc71',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: 'Expense Trend',
                            data: expensesData,
                            borderColor: '#e74c3c',
                            tension: 0.1,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 3. Expense Categories Chart
        function initExpenseCategoriesChart() {
            const ctx = document.getElementById('expenseCategoriesChart').getContext('2d');
            
            // Group by category
            const categories = {};
            transactions.forEach(tx => {
                if (tx.EXPENSE > 0) {
                    const category = tx.ACCOUNT_HEADER;
                    categories[category] = (categories[category] || 0) + parseFloat(tx.EXPENSE);
                }
            });
            
            const categoryLabels = Object.keys(categories);
            const categoryData = Object.values(categories);
            
            if (expenseCategoriesChart) {
                expenseCategoriesChart.destroy();
            }
            
            expenseCategoriesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryData,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                            '#9b59b6', '#1abc9c', '#d35400', '#34495e',
                            '#16a085', '#27ae60', '#2980b9', '#8e44ad'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // 4. Income Sources Chart
        function initIncomeSourcesChart() {
            const ctx = document.getElementById('incomeSourcesChart').getContext('2d');
            
            // Group by source
            const sources = {};
            transactions.forEach(tx => {
                if (tx.INCOME > 0) {
                    const source = tx.ACCOUNT_HEADER;
                    sources[source] = (sources[source] || 0) + parseFloat(tx.INCOME);
                }
            });
            
            const sourceLabels = Object.keys(sources);
            const sourceData = Object.values(sources);
            
            if (incomeSourcesChart) {
                incomeSourcesChart.destroy();
            }
            
            incomeSourcesChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: sourceLabels,
                    datasets: [{
                        data: sourceData,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                            '#9b59b6', '#1abc9c', '#d35400', '#34495e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // 5. Cash Flow Chart
        function initCashFlowChart() {
            const ctx = document.getElementById('cashFlowChart').getContext('2d');
            
            // Group by month and calculate net cash flow
            const monthlyData = {};
            transactions.forEach(tx => {
                const month = tx.DATE.substring(0, 7); // YYYY-MM
                if (!monthlyData[month]) {
                    monthlyData[month] = 0;
                }
                monthlyData[month] += (parseFloat(tx.INCOME) || 0) - (parseFloat(tx.EXPENSE) || 0);
            });
            
            const months = Object.keys(monthlyData).sort();
            const cashFlowData = months.map(month => monthlyData[month]);
            
            if (cashFlowChart) {
                cashFlowChart.destroy();
            }
            
            cashFlowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Cash Flow',
                        data: cashFlowData,
                        borderColor: '#3498db',
                        tension: 0.1,
                        fill: true,
                        backgroundColor: 'rgba(52, 152, 219, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 6. Account Balances Chart
        function initAccountBalancesChart() {
            const ctx = document.getElementById('accountBalancesChart').getContext('2d');
            
            // Get latest balance for each account
            const accountBalances = {
                'HDFC': 120000,
                'ICICI': 25000,
                'SBI Credit': -15000,
                'Cash': 5000
            };
            
            const accountLabels = Object.keys(accountBalances);
            const balanceData = Object.values(accountBalances);
            
            // Create colors based on positive/negative values
            const backgroundColors = balanceData.map(value => 
                value >= 0 ? '#2ecc71' : '#e74c3c'
            );
            
            if (accountBalancesChart) {
                accountBalancesChart.destroy();
            }
            
            accountBalancesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: accountLabels,
                    datasets: [{
                        label: 'Balance',
                        data: balanceData,
                        backgroundColor: backgroundColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 7. Weekly Analysis Chart
        function initWeeklyAnalysisChart() {
            const ctx = document.getElementById('weeklyAnalysisChart').getContext('2d');
            
            // Simulate weekly data
            const weeks = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const spendingData = [12000, 8000, 15000, 10000];
            
            if (weeklyAnalysisChart) {
                weeklyAnalysisChart.destroy();
            }
            
            weeklyAnalysisChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weeks,
                    datasets: [{
                        label: 'Weekly Spending',
                        data: spendingData,
                        backgroundColor: '#9b59b6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 8. Year-over-Year Comparison
        function initYoyComparisonChart() {
            const ctx = document.getElementById('yoyComparisonChart').getContext('2d');
            
            // Simulate YoY data
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const currentYearData = [135000, 145000, 150000, 165000];
            const previousYearData = [120000, 130000, 125000, 140000];
            
            if (yoyComparisonChart) {
                yoyComparisonChart.destroy();
            }
            
            yoyComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: quarters,
                    datasets: [
                        {
                            label: '2022',
                            data: previousYearData,
                            backgroundColor: '#3498db'
                        },
                        {
                            label: '2023',
                            data: currentYearData,
                            backgroundColor: '#2ecc71'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 9. Top Expenses Chart
        function initTopExpensesChart() {
            const ctx = document.getElementById('topExpensesChart').getContext('2d');
            
            // Get top expenses
            const expenseMap = {};
            transactions.forEach(tx => {
                if (tx.EXPENSE > 0) {
                    const desc = tx.DESCRIPTION || tx.ACCOUNT_HEADER;
                    expenseMap[desc] = (expenseMap[desc] || 0) + parseFloat(tx.EXPENSE);
                }
            });
            
            // Convert to array and sort
            const expenseArray = Object.entries(expenseMap)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const expenseLabels = expenseArray.map(item => item[0]);
            const expenseData = expenseArray.map(item => item[1]);
            
            if (topExpensesChart) {
                topExpensesChart.destroy();
            }
            
            topExpensesChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: expenseLabels,
                    datasets: [{
                        label: 'Amount',
                        data: expenseData,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6'
                        ]
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
        
        // 10. Budget vs Actual Chart
        function initBudgetVsActualChart() {
            const ctx = document.getElementById('budgetVsActualChart').getContext('2d');
            
            // Simulate budget vs actual data
            const categories = ['Rent', 'Food', 'Transport', 'Entertainment', 'Utilities'];
            const budgetData = [15000, 5000, 3000, 2000, 4000];
            const actualData = [15000, 7000, 2000, 2500, 3500];
            
            if (budgetVsActualChart) {
                budgetVsActualChart.destroy();
            }
            
            budgetVsActualChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [
                        {
                            label: 'Budget',
                            data: budgetData,
                            backgroundColor: '#3498db'
                        },
                        {
                            label: 'Actual',
                            data: actualData,
                            backgroundColor: '#2ecc71'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>