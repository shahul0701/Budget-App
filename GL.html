<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General Ledger</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #eef2f5;
            --bg-secondary: #fff;
            --text-primary: #333;
            --text-secondary: #777;
            --accent-primary: #007bff;
            --accent-secondary: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --border-color: #ccc;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --card-bg: #fff;
            --table-header-bg: #007bff;
            --table-header-color: #fff;
            --table-row-even: #f3f8fc;
            --table-row-hover: #ddeffb;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --accent-primary: #4a90e2;
            --accent-secondary: #3a70b2;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ffcc00;
            --border-color: #444;
            --shadow: 0 2px 4px rgba(0,0,0,0.3);
            --card-bg: #2d2d2d;
            --table-header-bg: #3a3a3a;
            --table-header-color: #f0f0f0;
            --table-row-even: #363636;
            --table-row-hover: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--bg-secondary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .header h1 {
            color: var(--accent-primary);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            width: 60px;
            height: 30px;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5px;
        }

        .theme-toggle i {
            font-size: 14px;
            z-index: 2;
        }

        .theme-toggle .fa-sun {
            color: #f39c12;
        }

        .theme-toggle .fa-moon {
            color: #f1c40f;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background: var(--accent-primary);
            border-radius: 50%;
            transition: transform 0.3s;
        }

        [data-theme="dark"] .theme-toggle::before {
            transform: translateX(30px);
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h2 {
            color: var(--text-primary);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .account-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .account-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent-primary);
            transition: transform 0.3s;
        }

        .account-card:hover {
            transform: translateY(-2px);
        }

        .account-card.income {
            border-left-color: var(--success);
        }

        .account-card.expense {
            border-left-color: var(--danger);
        }

        .account-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .account-balance {
            font-size: 20px;
            font-weight: 700;
            margin: 5px 0;
        }

        .account-type {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-transform: uppercase;
        }

        .positive-balance {
            color: var(--success);
        }

        .negative-balance {
            color: var(--danger);
        }

        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 10px;
            box-shadow: inset 0 -1px 5px rgba(0,0,0,0.1);
        }

        .ledger-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .ledger-table th, .ledger-table td {
            border: 1px solid var(--border-color);
            padding: 10px 12px;
            text-align: left;
        }

        .ledger-table th {
            background: var(--table-header-bg);
            color: var(--table-header-color);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .ledger-table tbody tr:nth-child(even) {
            background: var(--table-row-even);
        }

        .ledger-table tbody tr:hover {
            background: var(--table-row-hover);
        }

        .debit-amount {
            color: var(--success);
            font-weight: 600;
        }

        .credit-amount {
            color: var(--danger);
            font-weight: 600;
        }

        .ledger-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 6px;
            font-weight: 600;
            border: 1px solid var(--border-color);
        }

        .ledger-total-debit {
            color: var(--success);
        }

        .ledger-total-credit {
            color: var(--danger);
        }

        .ledger-net-balance {
            color: var(--accent-primary);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--accent-primary);
        }

        .loading i {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .filters {
                grid-template-columns: 1fr;
            }
            
            .account-summary {
                grid-template-columns: 1fr;
            }
            
            .ledger-summary {
                flex-direction: column;
                gap: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-book"></i> General Ledger</h1>
            <div class="header-controls">
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </div>
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-filter"></i> Filters</h2>
            </div>
            <div class="filters">
                <div class="filter-group">
                    <label for="dateFilter">Date Range</label>
                    <select id="dateFilter">
                        <option value="all">All Time</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="startDate">From Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="filter-group">
                    <label for="endDate">To Date</label>
                    <input type="date" id="endDate">
                </div>
                <div class="filter-group">
                    <label for="accountFilter">Account</label>
                    <select id="accountFilter">
                        <option value="all">All Accounts</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="typeFilter">Account Type</label>
                    <select id="typeFilter">
                        <option value="all">All Types</option>
                        <option value="Asset">Assets</option>
                        <option value="Liability">Liabilities</option>
                        <option value="Equity">Equity</option>
                        <option value="Income">Income</option>
                        <option value="Expense">Expenses</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-primary" id="applyFiltersBtn">
                <i class="fas fa-check"></i> Apply Filters
            </button>
        </div>

        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-chart-pie"></i> Account Summary</h2>
            </div>
            <div class="account-summary" id="accountSummary">
                <!-- Account summary cards will be populated here -->
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-table"></i> Ledger Entries</h2>
            </div>
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading ledger data...</p>
            </div>
            <div class="table-responsive">
                <table class="ledger-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Voucher No.</th>
                            <th>Account</th>
                            <th>Description</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="ledgerTableBody">
                        <!-- Ledger entries will be populated here -->
                    </tbody>
                </table>
            </div>
            <div class="ledger-summary">
                <div class="ledger-total-debit">Total Debit: $0.00</div>
                <div class="ledger-total-credit">Total Credit: $0.00</div>
                <div class="ledger-net-balance">Net Balance: $0.00</div>
            </div>
        </div>
    </div>

    <script>
        // Sample data structure - In a real app, this would come from your database
        const sampleAccounts = [
            { id: 1, name: "Cash", type: "Asset", category: "Current Assets" },
            { id: 2, name: "Bank Account", type: "Asset", category: "Current Assets" },
            { id: 3, name: "Accounts Receivable", type: "Asset", category: "Current Assets" },
            { id: 4, name: "Equipment", type: "Asset", category: "Fixed Assets" },
            { id: 5, name: "Accounts Payable", type: "Liability", category: "Current Liabilities" },
            { id: 6, name: "Loan Payable", type: "Liability", category: "Long-term Liabilities" },
            { id: 7, name: "Owner's Equity", type: "Equity", category: "Equity" },
            { id: 8, name: "Sales Revenue", type: "Income", category: "Revenue" },
            { id: 9, name: "Service Revenue", type: "Income", category: "Revenue" },
            { id: 10, name: "Rent Expense", type: "Expense", category: "Operating Expenses" },
            { id: 11, name: "Salary Expense", type: "Expense", category: "Operating Expenses" },
            { id: 12, name: "Utilities Expense", type: "Expense", category: "Operating Expenses" }
        ];

        const sampleTransactions = [
            { id: 1, date: "2024-01-15", voucherNo: "INV-001", account: "Cash", description: "Initial investment", debit: 10000, credit: 0 },
            { id: 2, date: "2024-01-16", voucherNo: "INV-002", account: "Equipment", description: "Purchase of computer", debit: 2000, credit: 0 },
            { id: 3, date: "2024-01-16", voucherNo: "INV-002", account: "Cash", description: "Purchase of computer", debit: 0, credit: 2000 },
            { id: 4, date: "2024-01-20", voucherNo: "INV-003", account: "Sales Revenue", description: "Product sales", debit: 0, credit: 5000 },
            { id: 5, date: "2024-01-20", voucherNo: "INV-003", account: "Accounts Receivable", description: "Product sales", debit: 5000, credit: 0 },
            { id: 6, date: "2024-01-25", voucherNo: "INV-004", account: "Rent Expense", description: "Office rent", debit: 1200, credit: 0 },
            { id: 7, date: "2024-01-25", voucherNo: "INV-004", account: "Cash", description: "Office rent", debit: 0, credit: 1200 },
            { id: 8, date: "2024-01-28", voucherNo: "INV-005", account: "Salary Expense", description: "Employee salary", debit: 3000, credit: 0 },
            { id: 9, date: "2024-01-28", voucherNo: "INV-005", account: "Cash", description: "Employee salary", debit: 0, credit: 3000 },
            { id: 10, date: "2024-01-30", voucherNo: "INV-006", account: "Cash", description: "Collection from customer", debit: 3000, credit: 0 },
            { id: 11, date: "2024-01-30", voucherNo: "INV-006", account: "Accounts Receivable", description: "Collection from customer", debit: 0, credit: 3000 }
        ];

        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const exportBtn = document.getElementById('exportBtn');
        const dateFilter = document.getElementById('dateFilter');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const accountFilter = document.getElementById('accountFilter');
        const typeFilter = document.getElementById('typeFilter');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const accountSummary = document.getElementById('accountSummary');
        const ledgerTableBody = document.getElementById('ledgerTableBody');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            populateAccountFilter();
            loadGeneralLedger();
        });

        // Theme functionality
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggleIcon(savedTheme);
        }

        function updateThemeToggleIcon(theme) {
            const sunIcon = themeToggle.querySelector('.fa-sun');
            const moonIcon = themeToggle.querySelector('.fa-moon');
            
            if (theme === 'dark') {
                sunIcon.style.opacity = '0.5';
                moonIcon.style.opacity = '1';
            } else {
                sunIcon.style.opacity = '1';
                moonIcon.style.opacity = '0.5';
            }
        }

        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeToggleIcon(newTheme);
        });

        // Populate account filter dropdown
        function populateAccountFilter() {
            accountFilter.innerHTML = '<option value="all">All Accounts</option>';
            sampleAccounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.name;
                option.textContent = account.name;
                accountFilter.appendChild(option);
            });
        }

        // Load general ledger data
        function loadGeneralLedger() {
            showLoading();
            
            // Simulate API call delay
            setTimeout(() => {
                const filteredTransactions = filterTransactions();
                updateAccountSummary(filteredTransactions);
                updateLedgerTable(filteredTransactions);
                hideLoading();
            }, 1000);
        }

        // Filter transactions based on selected filters
        function filterTransactions() {
            let filtered = [...sampleTransactions];
            
            // Date filter
            const dateFilterValue = dateFilter.value;
            if (dateFilterValue !== 'all') {
                const now = new Date();
                let startDate, endDate;
                
                switch(dateFilterValue) {
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        break;
                    case 'quarter':
                        const quarter = Math.floor(now.getMonth() / 3);
                        startDate = new Date(now.getFullYear(), quarter * 3, 1);
                        endDate = new Date(now.getFullYear(), (quarter + 1) * 3, 0);
                        break;
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear(), 11, 31);
                        break;
                    case 'custom':
                        if (startDateInput.value && endDateInput.value) {
                            startDate = new Date(startDateInput.value);
                            endDate = new Date(endDateInput.value);
                        }
                        break;
                }
                
                if (startDate && endDate) {
                    filtered = filtered.filter(transaction => {
                        const transactionDate = new Date(transaction.date);
                        return transactionDate >= startDate && transactionDate <= endDate;
                    });
                }
            }
            
            // Account filter
            const accountFilterValue = accountFilter.value;
            if (accountFilterValue !== 'all') {
                filtered = filtered.filter(transaction => transaction.account === accountFilterValue);
            }
            
            // Type filter
            const typeFilterValue = typeFilter.value;
            if (typeFilterValue !== 'all') {
                filtered = filtered.filter(transaction => {
                    const account = sampleAccounts.find(acc => acc.name === transaction.account);
                    return account && account.type === typeFilterValue;
                });
            }
            
            return filtered;
        }

        // Update account summary cards
        function updateAccountSummary(transactions) {
            accountSummary.innerHTML = '';
            
            // Calculate account balances
            const accountBalances = {};
            sampleAccounts.forEach(account => {
                accountBalances[account.name] = 0;
            });
            
            transactions.forEach(transaction => {
                accountBalances[transaction.account] += transaction.debit - transaction.credit;
            });
            
            // Create account cards
            sampleAccounts.forEach(account => {
                const balance = accountBalances[account.name];
                if (balance === 0 && accountFilter.value !== 'all') return;
                
                const card = document.createElement('div');
                card.className = `account-card ${account.type.toLowerCase()}`;
                
                const balanceClass = balance >= 0 ? 'positive-balance' : 'negative-balance';
                const balanceDisplay = formatCurrency(Math.abs(balance));
                
                card.innerHTML = `
                    <div class="account-name">
                        <span>${account.name}</span>
                        <i class="fas ${getAccountIcon(account.type)}"></i>
                    </div>
                    <div class="account-balance ${balanceClass}">
                        ${balance >= 0 ? '+' : '-'}${balanceDisplay}
                    </div>
                    <div class="account-type">${account.type} â€¢ ${account.category}</div>
                `;
                
                accountSummary.appendChild(card);
            });
        }

        // Update ledger table
        function updateLedgerTable(transactions) {
            ledgerTableBody.innerHTML = '';
            
            if (transactions.length === 0) {
                ledgerTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 10px;"></i>
                            <p>No transactions found for the selected filters</p>
                        </td>
                    </tr>
                `;
                updateSummaryTotals(0, 0);
                return;
            }
            
            // Sort transactions by date
            transactions.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let totalDebit = 0;
            let totalCredit = 0;
            
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const debitDisplay = transaction.debit > 0 ? 
                    `<span class="debit-amount">${formatCurrency(transaction.debit)}</span>` : '';
                
                const creditDisplay = transaction.credit > 0 ? 
                    `<span class="credit-amount">${formatCurrency(transaction.credit)}</span>` : '';
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.voucherNo}</td>
                    <td>${transaction.account}</td>
                    <td>${transaction.description}</td>
                    <td>${debitDisplay}</td>
                    <td>${creditDisplay}</td>
                    <td>${formatCurrency(Math.abs(transaction.debit - transaction.credit))}</td>
                `;
                
                ledgerTableBody.appendChild(row);
                
                totalDebit += transaction.debit;
                totalCredit += transaction.credit;
            });
            
            updateSummaryTotals(totalDebit, totalCredit);
        }

        // Update summary totals
        function updateSummaryTotals(totalDebit, totalCredit) {
            const totalDebitElement = document.querySelector('.ledger-total-debit');
            const totalCreditElement = document.querySelector('.ledger-total-credit');
            const netBalanceElement = document.querySelector('.ledger-net-balance');
            
            totalDebitElement.textContent = `Total Debit: ${formatCurrency(totalDebit)}`;
            totalCreditElement.textContent = `Total Credit: ${formatCurrency(totalCredit)}`;
            netBalanceElement.textContent = `Net Balance: ${formatCurrency(totalDebit - totalCredit)}`;
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function getAccountIcon(accountType) {
            switch(accountType) {
                case 'Asset': return 'fa-wallet';
                case 'Liability': return 'fa-credit-card';
                case 'Equity': return 'fa-chart-line';
                case 'Income': return 'fa-money-bill-wave';
                case 'Expense': return 'fa-receipt';
                default: return 'fa-file-invoice-dollar';
            }
        }

        function showLoading() {
            loadingIndicator.style.display = 'block';
        }

        function hideLoading() {
            loadingIndicator.style.display = 'none';
        }

        // Event listeners
        applyFiltersBtn.addEventListener('click', loadGeneralLedger);

        exportBtn.addEventListener('click', function() {
            // Simple CSV export implementation
            const filteredTransactions = filterTransactions();
            let csvContent = "Date,Voucher No,Account,Description,Debit,Credit\n";
            
            filteredTransactions.forEach(transaction => {
                csvContent += `"${transaction.date}","${transaction.voucherNo}","${transaction.account}","${transaction.description}",${transaction.debit},${transaction.credit}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'general_ledger.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            Swal.fire({
                title: 'Export Successful',
                text: 'General ledger data has been exported to CSV',
                icon: 'success',
                confirmButtonText: 'OK'
            });
        });

        // Initialize date inputs with current month
        const now = new Date();
        const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
        const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        
        startDateInput.value = firstDay.toISOString().split('T')[0];
        endDateInput.value = lastDay.toISOString().split('T')[0];
    </script>
</body>
</html>