<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Code Dashboard App Builder - Premium Edition</title>
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.22.9/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .draggable { 
            cursor: move; 
            transition: all 0.3s ease; 
            user-select: none;
        }
        .draggable:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .dropzone { 
            min-height: 300px; 
            border: 2px dashed #d1d5db; 
            padding: 20px; 
            background: #f9fafb; 
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .dropzone.drag-over {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        .form-field { 
            margin-bottom: 15px; 
            padding: 15px; 
            background: #ffffff; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            border-left: 4px solid #3b82f6;
            position: relative;
        }
        .form-field:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .tab { 
            cursor: pointer; 
            padding: 14px 24px; 
            background: #f3f4f6; 
            margin-right: 5px; 
            border-radius: 8px 8px 0 0; 
            font-weight: 600;
            transition: all 0.2s ease;
            color: #6b7280;
        }
        .tab.active { 
            background: #ffffff; 
            border: 1px solid #e5e7eb; 
            border-bottom: none; 
            color: #3b82f6; 
            box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
        }
        .tab:hover:not(.active) {
            background: #e5e7eb;
            color: #4b5563;
        }
        .bg-gradient-blue { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        .field-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .form-field:hover .field-actions {
            opacity: 1;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-success:hover {
            background: #059669;
        }
        .btn-premium {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .btn-premium:hover {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            transform: translateY(-1px);
        }
        .btn i {
            margin-right: 6px;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }
        .sidebar {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
        }
        @media (max-width: 640px) {
            .tab { padding: 10px 16px; font-size: 14px; }
            .form-field { padding: 12px; }
            .dropzone { min-height: 250px; padding: 15px; }
        }
        .grid-stack {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        .grid-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: move;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .grid-item i {
            color: #6b7280;
        }
        .folder {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .folder:hover {
            background: #e0f2fe;
            transform: translateY(-2px);
        }
        .folder.active {
            background: #bae6fd;
            border-color: #7dd3fc;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        /* Premium Styles */
        .premium-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .dashboard-widget {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
        }
        .widget-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0.3;
            transition: opacity 0.2s;
        }
        .dashboard-widget:hover .widget-actions {
            opacity: 1;
        }
        .ai-suggestion {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .ai-suggestion:hover {
            background: #e0f2fe;
            transform: translateX(5px);
        }
        .automation-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #10b981;
        }
        .template-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        .template-thumb {
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        .template-content {
            padding: 15px;
        }
        .export-option {
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .export-option:hover {
            background: #f9fafb;
            border-color: #3b82f6;
        }
        .collaborator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        .version-history-item {
            padding: 12px;
            border-left: 3px solid #e5e7eb;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .version-history-item:hover {
            border-left-color: #3b82f6;
            background: #f9fafb;
        }
        .dark-mode {
            background: #1f2937;
            color: #f3f4f6;
        }
        .dark-mode .card {
            background: #374151;
            color: #f3f4f6;
        }
        .dark-mode .sidebar {
            background: #374151;
        }
        .dark-mode .form-field {
            background: #4b5563;
        }
        .dark-mode .grid-item {
            background: #4b5563;
            color: #f3f4f6;
        }
        .dark-mode .folder {
            background: #4b5563;
            border-color: #6b7280;
            color: #f3f4f6;
        }
        .dark-mode .folder.active {
            background: #3b82f6;
        }
        .dark-mode .tab {
            background: #4b5563;
            color: #d1d5db;
        }
        .dark-mode .tab.active {
            background: #1f2937;
            color: #3b82f6;
        }
        .dark-mode .dropzone {
            background: #374151;
            border-color: #4b5563;
        }
        .dark-mode .modal-content {
            background: #374151;
            color: #f3f4f6;
        }
        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background: #4b5563;
            color: #f3f4f6;
            border-color: #6b7280;
        }
        .dark-mode .ai-suggestion {
            background: #4b5563;
            border-left-color: #3b82f6;
        }
        .dark-mode .automation-card {
            background: #4b5563;
            border-left-color: #10b981;
        }
        
        /* Field header editing */
        .field-header-editable {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .field-header-input {
            border: 1px dashed #3b82f6;
            background: #f0f9ff;
            padding: 4px 8px;
            border-radius: 4px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
            authDomain: "budget-app-1365f.firebaseapp.com",
            projectId: "budget-app-1365f",
            storageBucket: "budget-app-1365f.firebasestorage.app",
            messagingSenderId: "1036194450411",
            appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
            measurementId: "G-YFFJL2H54X"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            const app = firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        firebase.auth().signInAnonymously()
            .then(() => console.log("Signed in anonymously"))
            .catch(error => console.error("Anonymous auth error:", error));

        function App() {
            const [tables, setTables] = useState(['default']);
            const [currentTable, setCurrentTable] = useState('default');
            const [tableFields, setTableFields] = useState({ default: [] });
            const [computedFields, setComputedFields] = useState({ default: [] });
            const [records, setRecords] = useState([]);
            const [newRecord, setNewRecord] = useState({});
            const [dragField, setDragField] = useState(null);
            const [activeTab, setActiveTab] = useState('builder');
            const [chartType, setChartType] = useState('bar');
            const [chartFieldX, setChartFieldX] = useState('');
            const [chartFieldY, setChartFieldY] = useState('');
            const [isDraggingOver, setIsDraggingOver] = useState(false);
            const [editingFieldIndex, setEditingFieldIndex] = useState(null);
            const [folders, setFolders] = useState(['All Forms']);
            const [currentFolder, setCurrentFolder] = useState('All Forms');
            const [showFolderModal, setShowFolderModal] = useState(false);
            const [editingFormulaIndex, setEditingFormulaIndex] = useState(null);
            const [formulaEditName, setFormulaEditName] = useState('');
            const [formulaEditFormula, setFormulaEditFormula] = useState('');
            
            // Field editing state
            const [editingFieldId, setEditingFieldId] = useState(null);
            const [fieldEditValue, setFieldEditValue] = useState('');
            
            // Premium features state
            const [dashboardWidgets, setDashboardWidgets] = useState([]);
            const [activeDashboard, setActiveDashboard] = useState('default');
            const [dashboards, setDashboards] = useState(['default']);
            const [automationRules, setAutomationRules] = useState([]);
            const [showAutomationModal, setShowAutomationModal] = useState(false);
            const [newAutomation, setNewAutomation] = useState({ trigger: '', condition: '', action: '' });
            const [editingAutomation, setEditingAutomation] = useState(null);
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const [collaborators, setCollaborators] = useState([]);
            const [showCollaboratorModal, setShowCollaboratorModal] = useState(false);
            const [newCollaborator, setNewCollaborator] = useState('');
            const [versionHistory, setVersionHistory] = useState([]);
            const [templates, setTemplates] = useState([]);
            const [showTemplateModal, setShowTemplateModal] = useState(false);
            const [exportFormat, setExportFormat] = useState('csv');
            const [showExportModal, setShowExportModal] = useState(false);
            const [apiEndpoint, setApiEndpoint] = useState('');
            const [showApiModal, setShowApiModal] = useState(false);
            const [notifications, setNotifications] = useState([]);
            
            const chartInstance = useRef(null);
            const canvasRef = useRef(null);
            const unsubscribe = useRef(null);

            // Fetch table configurations and records
            useEffect(() => {
                // Fetch table list
                db.collection('tables').onSnapshot(snapshot => {
                    const tableNames = snapshot.docs.map(doc => doc.id);
                    setTables(tableNames.length > 0 ? tableNames : ['default']);
                    const configs = {};
                    const computedConfigs = {};
                    snapshot.docs.forEach(doc => {
                        configs[doc.id] = doc.data().fields || [];
                        computedConfigs[doc.id] = doc.data().computedFields || [];
                    });
                    setTableFields(configs);
                    setComputedFields(computedConfigs);
                });

                // Fetch folders
                db.collection('folders').onSnapshot(snapshot => {
                    const folderNames = snapshot.docs.map(doc => doc.id);
                    setFolders(['All Forms', ...folderNames]);
                });
                
                // Premium: Fetch dashboards
                db.collection('dashboards').onSnapshot(snapshot => {
                    const dashboardNames = snapshot.docs.map(doc => doc.id);
                    setDashboards(dashboardNames.length > 0 ? dashboardNames : ['default']);
                });
                
                // Premium: Fetch dashboard widgets
                db.collection('dashboards').doc(activeDashboard).collection('widgets').onSnapshot(snapshot => {
                    const widgets = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setDashboardWidgets(widgets);
                });
                
                // Premium: Fetch automation rules
                db.collection('automations').onSnapshot(snapshot => {
                    const rules = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setAutomationRules(rules);
                });
                
                // Premium: Fetch templates
                db.collection('templates').onSnapshot(snapshot => {
                    const templateData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (snapshot.empty) {
                        // Add default templates if none exist
                        const defaultTemplates = [
                            {
                                name: 'Invoice',
                                description: 'Basic invoice template',
                                fields: [
                                    { type: 'text', label: 'Customer Name', id: Date.now().toString() + '1' },
                                    { type: 'number', label: 'Amount', id: Date.now().toString() + '2' },
                                    { type: 'date', label: 'Date', id: Date.now().toString() + '3' }
                                ]
                            },
                            {
                                name: 'Todo List',
                                description: 'Simple task management',
                                fields: [
                                    { type: 'text', label: 'Task', id: Date.now().toString() + '4' },
                                    { type: 'checkbox', label: 'Completed', id: Date.now().toString() + '5' },
                                    { type: 'date', label: 'Due Date', id: Date.now().toString() + '6' }
                                ]
                            }
                        ];
                        setTemplates(defaultTemplates);
                        // Optionally save to DB
                        defaultTemplates.forEach(temp => db.collection('templates').add(temp));
                    } else {
                        setTemplates(templateData);
                    }
                });
                
                // Premium: Generate AI suggestions
                generateAiSuggestions();
                
                // Premium: Load version history
                loadVersionHistory();
                
                // Premium: Load collaborators
                loadCollaborators();
            }, [activeDashboard]);

            // Fetch records for current table
            useEffect(() => {
                if (unsubscribe.current) unsubscribe.current();
                
                let query = db.collection('tables').doc(currentTable).collection('records');
                
                // If a specific folder is selected, filter by folder
                if (currentFolder !== 'All Forms') {
                    query = query.where('folder', '==', currentFolder);
                }
                
                unsubscribe.current = query.onSnapshot(snapshot => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setRecords(data);
                    
                    // Premium: Check for automation triggers
                    checkAutomations(data);
                });
                return () => unsubscribe.current && unsubscribe.current();
            }, [currentTable, currentFolder]);

            // Premium: Toggle dark mode
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
            }, [darkMode]);

            // Handle drag start
            const handleDragStart = (e, fieldType) => {
                setDragField(fieldType);
                e.dataTransfer.setData("text/plain", fieldType);
            };

            // Handle drag over
            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDraggingOver(true);
            };

            // Handle drag leave
            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDraggingOver(false);
            };

            // Handle drop
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDraggingOver(false);
                if (dragField) {
                    const newField = { 
                        type: dragField, 
                        label: `${dragField.charAt(0).toUpperCase() + dragField.slice(1)} Field`,
                        id: Date.now().toString() // Unique ID for each field
                    };
                    const newFields = [...(tableFields[currentTable] || []), newField];
                    setTableFields({ ...tableFields, [currentTable]: newFields });
                    // Save to Firebase
                    db.collection('tables').doc(currentTable).set({ 
                        fields: newFields, 
                        computedFields: computedFields[currentTable] || [] 
                    }, { merge: true });
                    
                    // Premium: Save to version history
                    saveToVersionHistory(`Added ${dragField} field to ${currentTable}`);
                }
                setDragField(null);
            };

            // Delete a field
            const deleteField = (index) => {
                const newFields = [...(tableFields[currentTable] || [])];
                const deletedField = newFields[index];
                newFields.splice(index, 1);
                setTableFields({ ...tableFields, [currentTable]: newFields });
                db.collection('tables').doc(currentTable).set({ 
                    fields: newFields, 
                    computedFields: computedFields[currentTable] || [] 
                }, { merge: true });
                
                // Premium: Save to version history
                saveToVersionHistory(`Removed ${deletedField.type} field from ${currentTable}`);
            };

            // Handle form input change
            const handleInputChange = (e, key) => {
                const value = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
                setNewRecord({ ...newRecord, [key]: value });
            };

            // Update field label
            const updateFieldLabel = (index, newLabel) => {
                const newFields = [...(tableFields[currentTable] || [])];
                const oldLabel = newFields[index].label;
                newFields[index].label = newLabel;
                setTableFields({ ...tableFields, [currentTable]: newFields });
                db.collection('tables').doc(currentTable).set({ 
                    fields: newFields, 
                    computedFields: computedFields[currentTable] || [] 
                }, { merge: true });
                
                // Premium: Save to version history
                saveToVersionHistory(`Renamed field from ${oldLabel} to ${newLabel} in ${currentTable}`);
            };

            // Update field type
            const updateFieldType = (index, newType) => {
                const newFields = [...(tableFields[currentTable] || [])];
                const fieldName = newFields[index].label;
                newFields[index].type = newType;
                setTableFields({ ...tableFields, [currentTable]: newFields });
                db.collection('tables').doc(currentTable).set({ 
                    fields: newFields, 
                    computedFields: computedFields[currentTable] || [] 
                }, { merge: true });
                
                // Premium: Save to version history
                saveToVersionHistory(`Changed ${fieldName} field type to ${newType} in ${currentTable}`);
            };

            // Save record to Firebase
            const saveRecord = () => {
                if (Object.keys(newRecord).length > 0) {
                    let data = { ...newRecord };
                    
                    // Add folder information if not "All Forms"
                    if (currentFolder !== 'All Forms') {
                        data.folder = currentFolder;
                    }
                    
                    // Calculate computed fields
                    (computedFields[currentTable] || []).forEach(cf => {
                        try {
                            // Replace field references with actual values
                            let formula = cf.formula;
                            const fieldRegex = /\[(.*?)\]/g;
                            let match;
                            
                            while ((match = fieldRegex.exec(formula)) !== null) {
                                const fieldName = match[1];
                                const fieldValue = newRecord[fieldName];
                                
                                if (fieldValue !== undefined) {
                                    // Handle different data types appropriately
                                    if (typeof fieldValue === 'string') {
                                        formula = formula.replace(`[${fieldName}]`, `"${fieldValue}"`);
                                    } else {
                                        formula = formula.replace(`[${fieldName}]`, fieldValue);
                                    }
                                } else {
                                    formula = formula.replace(`[${fieldName}]`, '0');
                                }
                            }
                            
                            // Use Function constructor instead of eval for safer execution
                            data[cf.name] = new Function('return ' + formula)();
                        } catch (err) {
                            console.error("Error computing field:", err);
                            data[cf.name] = 'Error';
                        }
                    });
                    
                    // Premium: Add timestamp
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    data.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                    
                    db.collection('tables').doc(currentTable).collection('records').add(data)
                        .then(() => {
                            setNewRecord({});
                            // Reset form properly
                            const form = document.getElementById("record-form");
                            if (form) form.reset();
                            
                            // Premium: Show notification
                            addNotification('success', 'Record saved successfully!');
                            
                            // Premium: Save to version history
                            saveToVersionHistory(`Added new record to ${currentTable}`);
                        })
                        .catch(error => {
                            console.error("Error saving record:", error);
                            addNotification('error', 'Failed to save record.');
                        });
                } else {
                    addNotification('warning', 'Please fill in at least one field before saving.');
                }
            };

            // Add computed field
            const addComputedField = () => {
                const name = document.getElementById('comp-name').value;
                const formula = document.getElementById('comp-formula').value;
                if (name && formula) {
                    const newComputed = [...(computedFields[currentTable] || []), { name, formula }];
                    setComputedFields({ ...computedFields, [currentTable]: newComputed });
                    db.collection('tables').doc(currentTable).set({ 
                        fields: tableFields[currentTable] || [], 
                        computedFields: newComputed 
                    }, { merge: true });
                    
                    // Premium: Save to version history
                    saveToVersionHistory(`Added computed field ${name} to ${currentTable}`);
                    
                    // Update existing records
                    db.collection('tables').doc(currentTable).collection('records').get().then(snapshot => {
                        snapshot.docs.forEach(doc => {
                            const record = doc.data();
                            let expr = formula;
                            expr = expr.replace(/\[(.*?)\]/g, (match, f) => record[f] !== undefined ? (typeof record[f] === 'string' ? `"${record[f]}"` : record[f]) : '0');
                            try {
                                db.collection('tables').doc(currentTable).collection('records').doc(doc.id).update({ 
                                    [name]: new Function('return ' + expr)(),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            } catch (err) {
                                db.collection('tables').doc(currentTable).collection('records').doc(doc.id).update({ 
                                    [name]: 'Error',
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }
                        });
                    });
                    document.getElementById('comp-name').value = '';
                    document.getElementById('comp-formula').value = '';
                }
            };

            // Edit computed field
            const editComputedField = (index) => {
                const cf = computedFields[currentTable][index];
                setFormulaEditName(cf.name);
                setFormulaEditFormula(cf.formula);
                setEditingFormulaIndex(index);
            };

            // Save edited computed field
            const saveEditedComputedField = () => {
                if (formulaEditName && formulaEditFormula) {
                    const newComputed = [...(computedFields[currentTable] || [])];
                    const oldName = newComputed[editingFormulaIndex].name;
                    newComputed[editingFormulaIndex] = { 
                        name: formulaEditName, 
                        formula: formulaEditFormula 
                    };
                    setComputedFields({ ...computedFields, [currentTable]: newComputed });
                    db.collection('tables').doc(currentTable).set({ 
                        fields: tableFields[currentTable] || [], 
                        computedFields: newComputed 
                    }, { merge: true });
                    
                    // Premium: Save to version history
                    saveToVersionHistory(`Updated computed field ${oldName} in ${currentTable}`);
                    
                    // Update existing records
                    db.collection('tables').doc(currentTable).collection('records').get().then(snapshot => {
                        snapshot.docs.forEach(doc => {
                            const record = doc.data();
                            let expr = formulaEditFormula;
                            expr = expr.replace(/\[(.*?)\]/g, (match, f) => record[f] !== undefined ? (typeof record[f] === 'string' ? `"${record[f]}"` : record[f]) : '0');
                            try {
                                db.collection('tables').doc(currentTable).collection('records').doc(doc.id).update({ 
                                    [formulaEditName]: new Function('return ' + expr)(),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            } catch (err) {
                                db.collection('tables').doc(currentTable).collection('records').doc(doc.id).update({ 
                                    [formulaEditName]: 'Error',
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }
                        });
                    });
                    
                    setEditingFormulaIndex(null);
                    setFormulaEditName('');
                    setFormulaEditFormula('');
                }
            };

            // Delete computed field
            const deleteComputedField = (index) => {
                const newComputed = [...(computedFields[currentTable] || [])];
                const deletedField = newComputed[index];
                newComputed.splice(index, 1);
                setComputedFields({ ...computedFields, [currentTable]: newComputed });
                db.collection('tables').doc(currentTable).set({ 
                    fields: tableFields[currentTable] || [], 
                    computedFields: newComputed 
                }, { merge: true });
                
                // Premium: Save to version history
                saveToVersionHistory(`Removed computed field ${deletedField.name} from ${currentTable}`);
            };

            // Add new table
            const addNewTable = () => {
                const name = document.getElementById('newTable').value.trim();
                if (name && !tables.includes(name)) {
                    setTables([...tables, name]);
                    setTableFields({ ...tableFields, [name]: [] });
                    setComputedFields({ ...computedFields, [name]: [] });
                    setCurrentTable(name);
                    db.collection('tables').doc(name).set({ fields: [], computedFields: [] });
                    document.getElementById('newTable').value = '';
                    
                    // Premium: Save to version history
                    saveToVersionHistory(`Created new table: ${name}`);
                    
                    // Premium: Show notification
                    addNotification('success', `Table "${name}" created successfully!`);
                }
            };

            // Delete table
            const deleteTable = (tableName) => {
                if (tables.length <= 1) {
                    alert("You cannot delete the only table.");
                    return;
                }
                
                if (window.confirm(`Are you sure you want to delete the table "${tableName}"? This will also delete all its data.`)) {
                    // Delete from Firebase
                    db.collection('tables').doc(tableName).delete()
                        .then(() => {
                            // Update local state
                            const newTables = tables.filter(t => t !== tableName);
                            setTables(newTables);
                            setCurrentTable(newTables[0]);
                            
                            // Premium: Save to version history
                            saveToVersionHistory(`Deleted table: ${tableName}`);
                            
                            // Premium: Show notification
                            addNotification('success', `Table "${tableName}" deleted successfully!`);
                            
                            // Delete all records in the table
                            db.collection('tables').doc(tableName).collection('records').get()
                                .then(snapshot => {
                                    const batch = db.batch();
                                    snapshot.docs.forEach(doc => {
                                        batch.delete(doc.ref);
                                    });
                                    return batch.commit();
                                });
                        })
                        .catch(error => {
                            console.error("Error deleting table:", error);
                            addNotification('error', 'Failed to delete table.');
                        });
                }
            };

            // Add new folder
            const addNewFolder = () => {
                const name = document.getElementById('newFolder').value.trim();
                if (name && !folders.includes(name)) {
                    db.collection('folders').doc(name).set({})
                        .then(() => {
                            setFolders([...folders, name]);
                            document.getElementById('newFolder').value = '';
                            setShowFolderModal(false);
                            
                            // Premium: Save to version history
                            saveToVersionHistory(`Created new folder: ${name}`);
                            
                            // Premium: Show notification
                            addNotification('success', `Folder "${name}" created successfully!`);
                        })
                        .catch(error => {
                            console.error("Error adding folder:", error);
                            addNotification('error', 'Failed to create folder.');
                        });
                }
            };

            // Render chart
            useEffect(() => {
                if (chartInstance.current) chartInstance.current.destroy();
                if (canvasRef.current && chartFieldX && chartFieldY && records.length > 0) {
                    const labels = records.map(r => r[chartFieldX] || 'Unknown');
                    const data = records.map(r => parseFloat(r[chartFieldY]) || 0);
                    
                    const ctx = canvasRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: chartType,
                        data: {
                            labels,
                            datasets: [{
                                label: chartFieldY,
                                data,
                                backgroundColor: chartType === 'pie' || chartType === 'doughnut' ? [
                                    'rgba(239, 68, 68, 0.7)',
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(139, 92, 246, 0.7)',
                                    'rgba(236, 72, 153, 0.7)'
                                ] : 'rgba(59,130,246,0.4)',
                                borderColor: 'rgba(59,130,246,1)',
                                borderWidth: 1
                            }]
                        },
                        options: { 
                            scales: { y: { beginAtZero: true } }, 
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: `${chartFieldY} by ${chartFieldX}`
                                }
                            }
                        }
                    });
                }
            }, [chartType, chartFieldX, chartFieldY, records]);

            // Render input based on field type
            const renderInput = (field, index) => {
                const key = field.label;
                if (field.type === 'checkbox') {
                    return <input type="checkbox" checked={newRecord[key] || false} onChange={(e) => handleInputChange(e, key)} className="h-5 w-5" />;
                } else if (field.type === 'select') {
                    return (
                        <select className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)}>
                            <option value="">Select...</option>
                            <option value="Option A">Option A</option>
                            <option value="Option B">Option B</option>
                            <option value="Option C">Option C</option>
                        </select>
                    );
                } else if (field.type === 'yesno') {
                    return (
                        <select className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)}>
                            <option value="">Select...</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    );
                } else if (field.type === 'textarea') {
                    return <textarea className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)} rows="4" />;
                } else if (field.type === 'date') {
                    return <input type="date" className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)} />;
                } else if (field.type === 'time') {
                    return <input type="time" className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)} />;
                } else if (field.type === 'color') {
                    return <input type="color" className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 h-10" value={newRecord[key] || '#3b82f6'} onChange={(e) => handleInputChange(e, key)} />;
                } else if (field.type === 'range') {
                    return <input type="range" className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || 50} onChange={(e) => handleInputChange(e, key)} min="0" max="100" />;
                } else {
                    return <input type={field.type} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" value={newRecord[key] || ''} onChange={(e) => handleInputChange(e, key)} placeholder={`Enter ${field.label}`} />;
                }
            };

            const allFields = [...(tableFields[currentTable] || []).map(f => f.label), ...(computedFields[currentTable] || []).map(cf => cf.name)];

            // Field type options
            const fieldTypes = [
                { value: 'text', label: 'Text', icon: 'font' },
                { value: 'number', label: 'Number', icon: 'hashtag' },
                { value: 'email', label: 'Email', icon: 'envelope' },
                { value: 'tel', label: 'Phone', icon: 'phone' },
                { value: 'date', label: 'Date', icon: 'calendar' },
                {value: 'time', label: 'Time', icon: 'clock' },
                { value: 'checkbox', label: 'Checkbox', icon: 'square-check' },
                { value: 'select', label: 'Dropdown', icon: 'caret-down' },
                { value: 'textarea', label: 'Text Area', icon: 'align-left' },
                { value: 'yesno', label: 'Yes/No', icon: 'circle-question' },
                { value: 'color', label: 'Color', icon: 'palette' },
                { value: 'range', label: 'Range', icon: 'sliders' }
            ];

            // Premium: Add new dashboard
            const addNewDashboard = () => {
                const name = prompt('Enter new dashboard name:');
                if (name && !dashboards.includes(name)) {
                    db.collection('dashboards').doc(name).set({})
                        .then(() => {
                            setDashboards([...dashboards, name]);
                            setActiveDashboard(name);
                            addNotification('success', `Dashboard "${name}" created!`);
                            saveToVersionHistory(`Created new dashboard: ${name}`);
                        })
                        .catch(error => {
                            console.error("Error creating dashboard:", error);
                            addNotification('error', 'Failed to create dashboard.');
                        });
                }
            };

            // Premium: Add dashboard widget
            const addDashboardWidget = (type) => {
                const newWidget = {
                    type,
                    title: `${type.charAt(0).toUpperCase() + type.slice(1)} Widget`,
                    config: {},
                    position: dashboardWidgets.length
                };
                
                db.collection('dashboards').doc(activeDashboard).collection('widgets').add(newWidget)
                    .then(() => {
                        addNotification('success', 'Widget added to dashboard!');
                        saveToVersionHistory(`Added ${type} widget to dashboard`);
                    })
                    .catch(error => {
                        console.error("Error adding widget:", error);
                        addNotification('error', 'Failed to add widget.');
                    });
            };

            // Premium: Delete dashboard widget
            const deleteDashboardWidget = (id) => {
                if (window.confirm('Are you sure you want to delete this widget?')) {
                    db.collection('dashboards').doc(activeDashboard).collection('widgets').doc(id).delete()
                        .then(() => {
                            addNotification('success', 'Widget deleted!');
                            saveToVersionHistory('Deleted widget from dashboard');
                        })
                        .catch(error => {
                            console.error("Error deleting widget:", error);
                            addNotification('error', 'Failed to delete widget.');
                        });
                }
            };

            // Premium: Add automation rule
            const addAutomationRule = () => {
                if (newAutomation.trigger && newAutomation.condition && newAutomation.action) {
                    db.collection('automations').add({
                        ...newAutomation,
                        table: currentTable,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                    .then(() => {
                        setNewAutomation({ trigger: '', condition: '', action: '' });
                        setShowAutomationModal(false);
                        addNotification('success', 'Automation rule added!');
                        saveToVersionHistory(`Added automation rule for ${currentTable}`);
                    })
                    .catch(error => {
                        console.error("Error adding automation:", error);
                        addNotification('error', 'Failed to add automation rule.');
                    });
                }
            };

            // Premium: Save edited automation
            const saveEditedAutomation = () => {
                if (editingAutomation.trigger && editingAutomation.condition && editingAutomation.action) {
                    db.collection('automations').doc(editingAutomation.id).update({
                        trigger: editingAutomation.trigger,
                        condition: editingAutomation.condition,
                        action: editingAutomation.action,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                    .then(() => {
                        setEditingAutomation(null);
                        addNotification('success', 'Automation rule updated!');
                        saveToVersionHistory(`Updated automation rule for ${currentTable}`);
                    })
                    .catch(error => {
                        console.error("Error updating automation:", error);
                        addNotification('error', 'Failed to update automation rule.');
                    });
                }
            };

            // Premium: Delete automation rule
            const deleteAutomationRule = (id) => {
                if (window.confirm('Are you sure you want to delete this automation rule?')) {
                    db.collection('automations').doc(id).delete()
                        .then(() => {
                            addNotification('success', 'Automation rule deleted!');
                            saveToVersionHistory('Deleted automation rule');
                        })
                        .catch(error => {
                            console.error("Error deleting automation:", error);
                            addNotification('error', 'Failed to delete automation rule.');
                        });
                }
            };

            // Premium: Check for automation triggers
            const checkAutomations = (records) => {
                automationRules.forEach(rule => {
                    if (rule.table === currentTable) {
                        // Simple example: Check if any record matches condition
                        const matchingRecords = records.filter(record => {
                            // This is a simplified condition check
                            // In a real app, you'd parse the condition properly
                            try {
                                const func = new Function('record', `return ${rule.condition.replace(/\[(.*?)\]/g, (match, f) => `record["${f}"]`)};`);
                                return func(record);
                            } catch (err) {
                                console.error("Error evaluating automation condition:", err);
                                return false;
                            }
                        });
                        
                        if (matchingRecords.length > 0) {
                            // Trigger the action (mocked for demo - in real, integrate with email/Slack/etc.)
                            console.log(`Automation triggered: ${rule.action} for ${matchingRecords.length} records`);
                            addNotification('info', `Automation "${rule.action}" triggered for ${matchingRecords.length} records!`);
                        }
                    }
                });
            };

            // Premium: Generate AI suggestions
            const generateAiSuggestions = () => {
                // Mock AI suggestions based on current data
                const suggestions = [
                    { text: "Add a chart to visualize your data", action: () => setActiveTab('charts') },
                    { text: "Create a computed field for totals", action: () => setActiveTab('formulas') },
                    { text: "Organize records into folders", action: () => setShowFolderModal(true) }
                ];
                
                setAiSuggestions(suggestions);
            };

            // Premium: Save to version history
            const saveToVersionHistory = (action) => {
                const version = {
                    action,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    user: 'You'
                };
                
                db.collection('versionHistory').add(version)
                    .catch(error => console.error("Error saving version history:", error));
            };

            // Premium: Load version history
            const loadVersionHistory = () => {
                db.collection('versionHistory')
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .onSnapshot(snapshot => {
                        const history = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setVersionHistory(history);
                    });
            };

            // Premium: Load collaborators
            const loadCollaborators = () => {
                db.collection('collaborators').onSnapshot(snapshot => {
                    const collabs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setCollaborators(collabs);
                });
            };

            // Premium: Add collaborator
            const addCollaborator = () => {
                if (newCollaborator) {
                    db.collection('collaborators').add({
                        email: newCollaborator,
                        role: 'editor',
                        addedAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                    .then(() => {
                        setNewCollaborator('');
                        setShowCollaboratorModal(false);
                        addNotification('success', 'Collaborator added!');
                    })
                    .catch(error => {
                        console.error("Error adding collaborator:", error);
                        addNotification('error', 'Failed to add collaborator.');
                    });
                }
            };

            // Premium: Delete collaborator
            const deleteCollaborator = (id) => {
                if (window.confirm('Are you sure you want to remove this collaborator?')) {
                    db.collection('collaborators').doc(id).delete()
                        .then(() => {
                            addNotification('success', 'Collaborator removed!');
                        })
                        .catch(error => {
                            console.error("Error deleting collaborator:", error);
                            addNotification('error', 'Failed to remove collaborator.');
                        });
                }
            };

            // Premium: Apply template
            const applyTemplate = (template) => {
                // Apply template fields to current table
                const newFields = [...(tableFields[currentTable] || []), ...template.fields];
                setTableFields({ ...tableFields, [currentTable]: newFields });
                
                db.collection('tables').doc(currentTable).set({ 
                    fields: newFields, 
                    computedFields: computedFields[currentTable] || [] 
                }, { merge: true });
                
                setShowTemplateModal(false);
                addNotification('success', `Template "${template.name}" applied!`);
                saveToVersionHistory(`Applied template "${template.name}" to ${currentTable}`);
            };

            // Premium: Export data
            const exportData = () => {
                let dataStr = '';
                let fileExtension = '';
                let mimeType = '';
                
                if (exportFormat === 'csv') {
                    // Convert to CSV
                    const headers = allFields.join(',');
                    const rows = records.map(record => 
                        allFields.map(field => `"${(record[field] || '').toString().replace(/"/g, '""')}"`).join(',')
                    );
                    dataStr = [headers, ...rows].join('\n');
                    fileExtension = 'csv';
                    mimeType = 'text/csv';
                } else if (exportFormat === 'json') {
                    // Convert to JSON
                    dataStr = JSON.stringify(records, null, 2);
                    fileExtension = 'json';
                    mimeType = 'application/json';
                }
                
                const blob = new Blob([dataStr], { type: mimeType });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentTable}-export.${fileExtension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setShowExportModal(false);
                addNotification('success', `Data exported as ${exportFormat.toUpperCase()}!`);
            };

            // Premium: Generate API endpoint
            const generateApiEndpoint = () => {
                const endpoint = `https://yourapi.com/data/${currentTable}`; // Mock - replace with real API if available
                setApiEndpoint(endpoint);
                setShowApiModal(true);
                
                // In a real app, you'd actually set up the API endpoint
                addNotification('info', 'API endpoint generated (mock)');
            };

            // Premium: Add notification
            const addNotification = (type, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    message,
                    timestamp: new Date()
                };
                
                setNotifications(prev => [notification, ...prev.slice(0, 4)]); // Keep last 5 notifications
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== notification.id));
                }, 5000);
            };

            // Start editing a field header
            const startEditingField = (fieldId, currentLabel) => {
                setEditingFieldId(fieldId);
                setFieldEditValue(currentLabel);
            };

            // Save the edited field header
            const saveFieldEdit = (index) => {
                if (fieldEditValue.trim()) {
                    updateFieldLabel(index, fieldEditValue.trim());
                }
                setEditingFieldId(null);
                setFieldEditValue('');
            };

            // Cancel editing
            const cancelFieldEdit = () => {
                setEditingFieldId(null);
                setFieldEditValue('');
            };

            // Handle editing automation changes
            const handleAutomationChange = (field, value) => {
                setEditingAutomation(prev => ({ ...prev, [field]: value }));
            };

            return (
                <div className="container mx-auto p-4 sm:p-6 bg-gray-50 min-h-screen">
                    {/* Notifications */}
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.map(notification => (
                            <div key={notification.id} className={`p-4 rounded-lg shadow-lg border-l-4 ${
                                notification.type === 'success' ? 'bg-green-100 border-green-500 text-green-700' :
                                notification.type === 'error' ? 'bg-red-100 border-red-500 text-red-700' :
                                notification.type === 'warning' ? 'bg-yellow-100 border-yellow-500 text-yellow-700' :
                                'bg-blue-100 border-blue-500 text-blue-700'
                            }`}>
                                <div className="flex justify-between items-center">
                                    <span>{notification.message}</span>
                                    <button onClick={() => setNotifications(prev => prev.filter(n => n.id !== notification.id))} className="ml-4">
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    <div className="flex justify-between items-center mb-4">
                        <h1 className="text-3xl font-bold text-white bg-gradient-blue p-6 rounded-xl shadow-lg flex items-center">
                            <i className="fas fa-chart-dashboard mr-3"></i>
                            No-Code Dashboard App Builder <span className="premium-badge">PREMIUM</span>
                        </h1>
                        
                        <div className="flex items-center space-x-2">
                            <button className="btn btn-premium" onClick={() => setDarkMode(!darkMode)}>
                                <i className={`fas ${darkMode ? 'fa-sun' : 'fa-moon'}`}></i> {darkMode ? 'Light Mode' : 'Dark Mode'}
                            </button>
                        </div>
                    </div>
                    
                    <div className="flex flex-wrap mb-4 border-b-2 border-gray-200">
                        <div className={`tab ${activeTab === 'builder' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('builder')}>
                            <i className="fas fa-wrench mr-2"></i>Form Builder
                        </div>
                        <div className={`tab ${activeTab === 'data' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('data')}>
                            <i className="fas fa-table mr-2"></i>Data Table
                        </div>
                        <div className={`tab ${activeTab === 'formulas' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('formulas')}>
                            <i className="fas fa-calculator mr-2"></i>Formulas
                        </div>
                        <div className={`tab ${activeTab === 'charts' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('charts')}>
                            <i className="fas fa-chart-bar mr-2"></i>Charts
                        </div>
                        <div className={`tab ${activeTab === 'dashboard' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('dashboard')}>
                            <i className="fas fa-gauge-high mr-2"></i>Dashboard <span className="premium-badge">NEW</span>
                        </div>
                        <div className={`tab ${activeTab === 'automations' ? 'active' : ''} sm:text-lg`} onClick={() => setActiveTab('automations')}>
                            <i className="fas fa-robot mr-2"></i>Automations <span className="premium-badge">NEW</span>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                        {activeTab === 'builder' && (
                            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-1 sidebar">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                        <i className="fas fa-table-cells-large mr-2"></i>Table Management
                                    </h3>
                                    <div className="mb-4 flex flex-col gap-2">
                                        <select value={currentTable} onChange={(e) => setCurrentTable(e.target.value)} className="p-2 border rounded focus:ring-2 focus:ring-blue-500">
                                            {tables.map(t => <option key={t} value={t}>{t}</option>)}
                                        </select>
                                        <div className="flex gap-2">
                                            <input id="newTable" placeholder="New Table Name" className="p-2 border rounded flex-grow focus:ring-2 focus:ring-blue-500" />
                                            <button className="btn btn-success" onClick={addNewTable} title="Add Table">
                                                <i className="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        {tables.length > 1 && (
                                            <button className="btn btn-danger" onClick={() => deleteTable(currentTable)}>
                                                <i className="fas fa-trash mr-1"></i>Delete Current Table
                                            </button>
                                        )}
                                    </div>
                                    
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                        <i className="fas fa-folder mr-2"></i>Folders
                                    </h3>
                                    <div className="mb-4 space-y-2">
                                        {folders.map(folder => (
                                            <div 
                                                key={folder} 
                                                className={`folder ${currentFolder === folder ? 'active' : ''}`}
                                                onClick={() => setCurrentFolder(folder)}
                                            >
                                                <i className="fas fa-folder mr-2"></i> {folder}
                                            </div>
                                        ))}
                                        <button 
                                            className="btn btn-primary w-full mt-2"
                                            onClick={() => setShowFolderModal(true)}
                                        >
                                            <i className="fas fa-plus mr-1"></i>New Folder
                                        </button>
                                    </div>
                                    
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                        <i className="fas fa-shapes mr-2"></i>Available Fields
                                    </h3>
                                    <div className="grid-stack">
                                        {fieldTypes.map(fieldType => (
                                            <div key={fieldType.value} className="grid-item draggable" draggable onDragStart={(e) => handleDragStart(e, fieldType.value)}>
                                                <i className={`fas fa-${fieldType.icon}`}></i>
                                                {fieldType.label}
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {/* Premium: AI Suggestions */}
                                    <h3 className="text-lg font-semibold text-gray-700 mt-6 mb-4 flex items-center">
                                        <i className="fas fa-robot mr-2"></i>AI Suggestions <span className="premium-badge">AI</span>
                                    </h3>
                                    <div className="space-y-2">
                                        {aiSuggestions.map((suggestion, index) => (
                                            <div key={index} className="ai-suggestion" onClick={suggestion.action}>
                                                <i className="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                                {suggestion.text}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="lg:col-span-3">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-semibold text-gray-800 flex items-center">
                                            <i className="fas fa-pen-to-square mr-2"></i>Form Builder for {currentTable}
                                            {currentFolder !== 'All Forms' && <span className="ml-2 text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded">Folder: {currentFolder}</span>}
                                        </h2>
                                        
                                        <div className="flex space-x-2">
                                            <button className="btn btn-premium" onClick={() => setShowTemplateModal(true)}>
                                                <i className="fas fa-file-import mr-1"></i>Apply Template
                                            </button>
                                            <button className="btn btn-premium" onClick={generateApiEndpoint}>
                                                <i className="fas fa-bolt mr-1"></i>API Endpoint
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div 
                                        className={`dropzone ${isDraggingOver ? 'drag-over' : ''}`}
                                        onDragOver={handleDragOver}
                                        onDragLeave={handleDragLeave}
                                        onDrop={handleDrop}
                                    >
                                        {(!tableFields[currentTable] || tableFields[currentTable].length === 0) && (
                                            <div className="text-center text-gray-500 py-10">
                                                <i className="fas fa-cloud-arrow-up text-4xl mb-3"></i>
                                                <p>Drag and drop fields here to build your form</p>
                                            </div>
                                        )}
                                        
                                        <form id="record-form">
                                            {(tableFields[currentTable] || []).map((field, index) => (
                                                <div key={field.id || index} className="form-field">
                                                    <div className="field-actions flex space-x-2">
                                                        <button 
                                                            className="text-blue-500 hover:text-blue-700"
                                                            onClick={() => setEditingFieldIndex(editingFieldIndex === index ? null : index)}
                                                            title="Edit Field"
                                                        >
                                                            <i className="fas fa-edit"></i>
                                                        </button>
                                                        <button 
                                                            className="text-red-500 hover:text-red-700"
                                                            onClick={() => deleteField(index)}
                                                            title="Delete Field"
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                    
                                                    {editingFieldIndex === index ? (
                                                        <div className="mb-3 p-3 bg-gray-100 rounded-lg">
                                                            <div className="flex items-center mb-2">
                                                                <label className="block text-sm font-medium text-gray-700 mr-2">Label:</label>
                                                                <input 
                                                                    type="text" 
                                                                    value={field.label} 
                                                                    onChange={(e) => updateFieldLabel(index, e.target.value)}
                                                                    className="p-1 border rounded flex-grow"
                                                                />
                                                            </div>
                                                            <div className="flex items-center">
                                                                <label className="block text-sm font-medium text-gray-700 mr-2">Type:</label>
                                                                <select 
                                                                    value={field.type} 
                                                                    onChange={(e) => updateFieldType(index, e.target.value)}
                                                                    className="p-1 border rounded"
                                                                >
                                                                    {fieldTypes.map(ft => (
                                                                        <option key={ft.value} value={ft.value}>{ft.label}</option>
                                                                    ))}
                                                                </select>
                                                            </div>
                                                            <button 
                                                                className="mt-2 text-sm text-blue-500"
                                                                onClick={() => setEditingFieldIndex(null)}
                                                            >
                                                                Done
                                                            </button>
                                                        </div>
                                                    ) : (
                                                        <div className="field-header-editable">
                                                            {editingFieldId === field.id ? (
                                                                <>
                                                                    <input
                                                                        type="text"
                                                                        value={fieldEditValue}
                                                                        onChange={(e) => setFieldEditValue(e.target.value)}
                                                                        className="field-header-input"
                                                                        autoFocus
                                                                    />
                                                                    <button 
                                                                        className="text-green-500 hover:text-green-700"
                                                                        onClick={() => saveFieldEdit(index)}
                                                                        title="Save"
                                                                    >
                                                                        <i className="fas fa-check"></i>
                                                                    </button>
                                                                    <button 
                                                                        className="text-red-500 hover:text-red-700"
                                                                        onClick={cancelFieldEdit}
                                                                        title="Cancel"
                                                                    >
                                                                        <i className="fas fa-times"></i>
                                                                    </button>
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <label 
                                                                        className="block text-sm font-medium text-gray-700 mb-1 cursor-pointer"
                                                                        onDoubleClick={() => startEditingField(field.id, field.label)}
                                                                    >
                                                                        {field.label}
                                                                    </label>
                                                                    <button 
                                                                        className="text-blue-500 hover:text-blue-700 ml-2"
                                                                        onClick={() => startEditingField(field.id, field.label)}
                                                                        title="Edit Field Header"
                                                                    >
                                                                        <i className="fas fa-edit text-xs"></i>
                                                                    </button>
                                                                </>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    {renderInput(field, index)}
                                                </div>
                                            ))}
                                        </form>
                                        
                                        {(tableFields[currentTable] || []).length > 0 && (
                                            <button className="btn btn-primary mt-4" onClick={saveRecord}>
                                                <i className="fas fa-save mr-1"></i>Save Record
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'data' && (
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">
                                        <i className="fas fa-table mr-2"></i>Data for {currentTable}
                                        {currentFolder !== 'All Forms' && <span className="ml-2 text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded">Folder: {currentFolder}</span>}
                                    </h2>
                                    <div className="flex space-x-2">
                                        <button className="btn btn-premium" onClick={() => setShowExportModal(true)}>
                                            <i className="fas fa-download mr-1"></i>Export Data
                                        </button>
                                    </div>
                                </div>
                                
                                {allFields.length > 0 ? (
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full bg-white border border-gray-200">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    {allFields.map((field, idx) => (
                                                        <th key={idx} className="py-2 px-4 border-b border-gray-200 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            {field}
                                                        </th>
                                                    ))}
                                                    <th className="py-2 px-4 border-b border-gray-200 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        Actions
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {records.map((record, idx) => (
                                                    <tr key={record.id || idx} className="hover:bg-gray-50">
                                                        {allFields.map((field, fIdx) => (
                                                            <td key={fIdx} className="py-2 px-4 border-b border-gray-200">
                                                                {record[field] !== undefined ? String(record[field]) : ''}
                                                            </td>
                                                        ))}
                                                        <td className="py-2 px-4 border-b border-gray-200">
                                                            <button 
                                                                className="text-red-500 hover:text-red-700"
                                                                onClick={() => {
                                                                    if (window.confirm('Are you sure you want to delete this record?')) {
                                                                        db.collection('tables').doc(currentTable).collection('records')
                                                                            .doc(record.id).delete()
                                                                            .then(() => {
                                                                                addNotification('success', 'Record deleted successfully!');
                                                                                saveToVersionHistory(`Deleted record from ${currentTable}`);
                                                                            })
                                                                            .catch(error => {
                                                                                console.error("Error deleting record:", error);
                                                                                addNotification('error', 'Failed to delete record.');
                                                                            });
                                                                    }
                                                                }}
                                                                title="Delete Record"
                                                            >
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                ) : (
                                    <div className="text-center py-10 text-gray-500">
                                        <i className="fas fa-table text-4xl mb-3"></i>
                                        <p>No data available. Add some fields to your form and save records.</p>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {activeTab === 'formulas' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">
                                        <i className="fas fa-calculator mr-2"></i>Computed Fields for {currentTable}
                                    </h2>
                                    
                                    <div className="mb-6 card">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Add New Computed Field</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Field Name</label>
                                                <input 
                                                    id="comp-name" 
                                                    type="text" 
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                                    placeholder="e.g., Total" 
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Formula</label>
                                                <input 
                                                    id="comp-formula" 
                                                    type="text" 
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                                    placeholder="e.g., [Price] * [Quantity]" 
                                                />
                                            </div>
                                        </div>
                                        <div className="mb-3">
                                            <p className="text-sm text-gray-600">
                                                Use field names in square brackets, e.g., [Price] * [Quantity]
                                            </p>
                                        </div>
                                        <button className="btn btn-primary" onClick={addComputedField}>
                                            <i className="fas fa-plus mr-1"></i>Add Computed Field
                                        </button>
                                    </div>
                                    
                                    <div className="card">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Existing Computed Fields</h3>
                                        {computedFields[currentTable] && computedFields[currentTable].length > 0 ? (
                                            <div className="space-y-4">
                                                {computedFields[currentTable].map((cf, index) => (
                                                    <div key={index} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                                        {editingFormulaIndex === index ? (
                                                            <div>
                                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                                                    <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">Field Name</label>
                                                                        <input 
                                                                            type="text" 
                                                                            value={formulaEditName} 
                                                                            onChange={(e) => setFormulaEditName(e.target.value)}
                                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                                                        />
                                                                    </div>
                                                                    <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">Formula</label>
                                                                        <input 
                                                                            type="text" 
                                                                            value={formulaEditFormula} 
                                                                            onChange={(e) => setFormulaEditFormula(e.target.value)}
                                                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                                                        />
                                                                    </div>
                                                                </div>
                                                                <div className="flex space-x-2">
                                                                    <button className="btn btn-success" onClick={saveEditedComputedField}>
                                                                        <i className="fas fa-save mr-1"></i>Save
                                                                    </button>
                                                                    <button className="btn btn-danger" onClick={() => setEditingFormulaIndex(null)}>
                                                                        <i className="fas fa-times mr-1"></i>Cancel
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <div>
                                                                <div className="flex justify-between items-start mb-2">
                                                                    <div>
                                                                        <h4 className="font-medium text-gray-800">{cf.name}</h4>
                                                                        <p className="text-sm text-gray-600">{cf.formula}</p>
                                                                    </div>
                                                                    <div className="flex space-x-2">
                                                                        <button 
                                                                            className="text-blue-500 hover:text-blue-700"
                                                                            onClick={() => editComputedField(index)}
                                                                            title="Edit Field"
                                                                        >
                                                                            <i className="fas fa-edit"></i>
                                                                        </button>
                                                                        <button 
                                                                            className="text-red-500 hover:text-red-700"
                                                                            onClick={() => deleteComputedField(index)}
                                                                            title="Delete Field"
                                                                        >
                                                                            <i className="fas fa-trash"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-6 text-gray-500">
                                                <i className="fas fa-calculator text-3xl mb-3"></i>
                                                <p>No computed fields yet. Add one to get started.</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="lg:col-span-1">
                                    <div className="card">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">
                                            <i className="fas fa-lightbulb mr-2"></i>Formula Tips
                                        </h3>
                                        <ul className="space-y-2 text-sm text-gray-600">
                                            <li> Use field names in square brackets: [Field Name]</li>
                                            <li> Basic math operations: +, -, *, /</li>
                                            <li> Example: [Price] * [Quantity]</li>
                                            <li> Example: ([Subtotal] * [Tax Rate]) / 100</li>
                                            <li> Example: [Revenue] - [Expenses]</li>
                                        </ul>
                                    </div>
                                    
                                    <div className="card mt-6">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">
                                            <i className="fas fa-history mr-2"></i>Version History
                                        </h3>
                                        <div className="space-y-2 max-h-60 overflow-y-auto">
                                            {versionHistory.length > 0 ? (
                                                versionHistory.map((version, idx) => (
                                                    <div key={idx} className="version-history-item">
                                                        <div className="text-sm font-medium">{version.action}</div>
                                                        <div className="text-xs text-gray-500">
                                                            {version.user}  {version.timestamp?.toDate ? version.timestamp.toDate().toLocaleString() : 'Recent'}
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <p className="text-sm text-gray-500">No history yet</p>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'charts' && (
                            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-1">
                                    <div className="card">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Chart Settings</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Chart Type</label>
                                                <select 
                                                    value={chartType} 
                                                    onChange={(e) => setChartType(e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="bar">Bar Chart</option>
                                                    <option value="line">Line Chart</option>
                                                    <option value="pie">Pie Chart</option>
                                                    <option value="doughnut">Doughnut Chart</option>
                                                    <option value="radar">Radar Chart</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">X-Axis Field</label>
                                                <select 
                                                    value={chartFieldX} 
                                                    onChange={(e) => setChartFieldX(e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="">Select Field</option>
                                                    {allFields.map((field, idx) => (
                                                        <option key={idx} value={field}>{field}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Y-Axis Field</label>
                                                <select 
                                                    value={chartFieldY} 
                                                    onChange={(e) => setChartFieldY(e.target.value)}
                                                    className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="">Select Field</option>
                                                    {allFields.map((field, idx) => (
                                                        <option key={idx} value={field}>{field}</option>
                                                    ))}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="card mt-6">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Export Chart</h3>
                                        <button 
                                            className="btn btn-premium w-full"
                                            onClick={() => {
                                                if (canvasRef.current) {
                                                    html2canvas(canvasRef.current).then(canvas => {
                                                        const imgData = canvas.toDataURL('image/png');
                                                        const pdf = new jspdf.jsPDF();
                                                        const imgProps = pdf.getImageProperties(imgData);
                                                        const pdfWidth = pdf.internal.pageSize.getWidth();
                                                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                                                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                                                        pdf.save(`${currentTable}-chart.pdf`);
                                                    });
                                                }
                                            }}
                                        >
                                            <i className="fas fa-download mr-1"></i>Export as PDF
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="lg:col-span-3">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">
                                        <i className="fas fa-chart-bar mr-2"></i>Data Visualization for {currentTable}
                                    </h2>
                                    
                                    {chartFieldX && chartFieldY ? (
                                        <div className="card">
                                            <div className="chart-container" style={{position: 'relative', height: '400px'}}>
                                                <canvas ref={canvasRef}></canvas>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="card text-center py-10 text-gray-500">
                                            <i className="fas fa-chart-bar text-4xl mb-3"></i>
                                            <p>Select X and Y axis fields to generate a chart</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'dashboard' && (
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">
                                        <i className="fas fa-gauge-high mr-2"></i>Dashboard <span className="premium-badge">PREMIUM</span>
                                    </h2>
                                    <div className="flex space-x-2">
                                        <select 
                                            value={activeDashboard} 
                                            onChange={(e) => setActiveDashboard(e.target.value)}
                                            className="p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                        >
                                            {dashboards.map(d => <option key={d} value={d}>{d}</option>)}
                                        </select>
                                        <button className="btn btn-premium" onClick={addNewDashboard}>
                                            <i className="fas fa-plus mr-1"></i>New Dashboard
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                    <div className="card cursor-pointer hover:bg-gray-50 text-center py-6" onClick={() => addDashboardWidget('summary')}>
                                        <i className="fas fa-chart-pie text-3xl text-blue-500 mb-2"></i>
                                        <h3 className="font-medium">Summary Widget</h3>
                                        <p className="text-sm text-gray-500">Add key metrics</p>
                                    </div>
                                    <div className="card cursor-pointer hover:bg-gray-50 text-center py-6" onClick={() => addDashboardWidget('chart')}>
                                        <i className="fas fa-chart-line text-3xl text-green-500 mb-2"></i>
                                        <h3 className="font-medium">Chart Widget</h3>
                                        <p className="text-sm text-gray-500">Visualize your data</p>
                                    </div>
                                    <div className="card cursor-pointer hover:bg-gray-50 text-center py-6" onClick={() => addDashboardWidget('table')}>
                                        <i className="fas fa-table text-3xl text-purple-500 mb-2"></i>
                                        <h3 className="font-medium">Table Widget</h3>
                                        <p className="text-sm text-gray-500">Show data in table format</p>
                                    </div>
                                </div>
                                
                                <h3 className="text-lg font-semibold text-gray-700 mb-4">Your Dashboard Widgets</h3>
                                
                                {dashboardWidgets.length > 0 ? (
                                    <div className="dashboard-grid">
                                        {dashboardWidgets.map(widget => (
                                            <div key={widget.id} className="dashboard-widget">
                                                <div className="widget-actions flex space-x-2">
                                                    <button className="text-red-500 hover:text-red-700" onClick={() => deleteDashboardWidget(widget.id)}>
                                                        <i className="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <h4 className="font-medium mb-2">{widget.title}</h4>
                                                <div className="bg-gray-100 rounded-lg p-4 text-center">
                                                    <i className="fas fa-cog text-2xl text-gray-400 mb-2"></i>
                                                    <p className="text-sm text-gray-500">Configure your {widget.type} widget</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="card text-center py-10 text-gray-500">
                                        <i className="fas fa-gauge-high text-4xl mb-3"></i>
                                        <p>Your dashboard is empty. Add widgets to get started.</p>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {activeTab === 'automations' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-semibold text-gray-800">
                                            <i className="fas fa-robot mr-2"></i>Automation Rules <span className="premium-badge">PREMIUM</span>
                                        </h2>
                                        <button className="btn btn-premium" onClick={() => setShowAutomationModal(true)}>
                                            <i className="fas fa-plus mr-1"></i>New Automation
                                        </button>
                                    </div>
                                    
                                    {automationRules.length > 0 ? (
                                        <div className="space-y-4">
                                            {automationRules.map((rule) => (
                                                <div key={rule.id} className="automation-card">
                                                    {editingAutomation && editingAutomation.id === rule.id ? (
                                                        <div>
                                                            <div className="space-y-4">
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Trigger</label>
                                                                    <select 
                                                                        value={editingAutomation.trigger} 
                                                                        onChange={(e) => handleAutomationChange('trigger', e.target.value)}
                                                                        className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                                                    >
                                                                        <option value="">Select Trigger</option>
                                                                        <option value="New Record">New Record Created</option>
                                                                        <option value="Record Updated">Record Updated</option>
                                                                        <option value="Field Changed">Field Value Changed</option>
                                                                    </select>
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Condition</label>
                                                                    <input 
                                                                        type="text" 
                                                                        value={editingAutomation.condition} 
                                                                        onChange={(e) => handleAutomationChange('condition', e.target.value)}
                                                                        placeholder="e.g., Status == 'Completed'"
                                                                        className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Action</label>
                                                                    <select 
                                                                        value={editingAutomation.action} 
                                                                        onChange={(e) => handleAutomationChange('action', e.target.value)}
                                                                        className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                                                    >
                                                                        <option value="">Select Action</option>
                                                                        <option value="Send Email">Send Email</option>
                                                                        <option value="Send Notification">Send Notification</option>
                                                                        <option value="Update Record">Update Record</option>
                                                                        <option value="Create Task">Create Task</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div className="flex space-x-2 mt-4">
                                                                <button className="btn btn-success" onClick={saveEditedAutomation}>
                                                                    <i className="fas fa-save mr-1"></i>Save
                                                                </button>
                                                                <button className="btn btn-danger" onClick={() => setEditingAutomation(null)}>
                                                                    <i className="fas fa-times mr-1"></i>Cancel
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <h4 className="font-medium">{rule.trigger}  {rule.action}</h4>
                                                                <p className="text-sm text-gray-600">When: {rule.condition}</p>
                                                                <p className="text-xs text-gray-500">Table: {rule.table}</p>
                                                            </div>
                                                            <div className="flex space-x-2">
                                                                <button className="text-blue-500 hover:text-blue-700" onClick={() => setEditingAutomation(rule)}>
                                                                    <i className="fas fa-edit"></i>
                                                                </button>
                                                                <button className="text-red-500 hover:text-red-700" onClick={() => deleteAutomationRule(rule.id)}>
                                                                    <i className="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="card text-center py-10 text-gray-500">
                                            <i className="fas fa-robot text-4xl mb-3"></i>
                                            <p>No automation rules yet. Create one to get started.</p>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="lg:col-span-1">
                                    <div className="card">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Collaborators</h3>
                                        <div className="space-y-3 mb-4">
                                            {collaborators.map((collab) => (
                                                <div key={collab.id} className="flex items-center justify-between">
                                                    <div className="flex items-center">
                                                        <div className="collaborator-avatar">
                                                            {collab.email.charAt(0).toUpperCase()}
                                                        </div>
                                                        <div>
                                                            <div className="font-medium">{collab.email}</div>
                                                            <div className="text-xs text-gray-500">{collab.role}</div>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        className="text-red-500 hover:text-red-700"
                                                        onClick={() => deleteCollaborator(collab.id)}
                                                    >
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                        <button 
                                            className="btn btn-primary w-full"
                                            onClick={() => setShowCollaboratorModal(true)}
                                        >
                                            <i className="fas fa-plus mr-1"></i>Add Collaborator
                                        </button>
                                    </div>
                                    
                                    <div className="card mt-6">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Automation Ideas</h3>
                                        <ul className="space-y-2 text-sm text-gray-600">
                                            <li> Send email when a new record is added</li>
                                            <li> Create Slack notification when field value changes</li>
                                            <li> Update related record when condition is met</li>
                                            <li> Generate PDF report on schedule</li>
                                            <li> Send SMS alert for important changes</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Folder Modal */}
                    {showFolderModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Create New Folder</h3>
                                <input 
                                    id="newFolder" 
                                    type="text" 
                                    placeholder="Folder Name" 
                                    className="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-blue-500" 
                                />
                                <div className="flex justify-end space-x-2">
                                    <button className="btn btn-danger" onClick={() => setShowFolderModal(false)}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={addNewFolder}>
                                        Create Folder
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Automation Modal */}
                    {showAutomationModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Create New Automation</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Trigger</label>
                                        <select 
                                            value={newAutomation.trigger} 
                                            onChange={(e) => setNewAutomation({...newAutomation, trigger: e.target.value})}
                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                        >
                                            <option value="">Select Trigger</option>
                                            <option value="New Record">New Record Created</option>
                                            <option value="Record Updated">Record Updated</option>
                                            <option value="Field Changed">Field Value Changed</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Condition</label>
                                        <input 
                                            type="text" 
                                            value={newAutomation.condition} 
                                            onChange={(e) => setNewAutomation({...newAutomation, condition: e.target.value})}
                                            placeholder="e.g., Status == 'Completed'"
                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500" 
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Action</label>
                                        <select 
                                            value={newAutomation.action} 
                                            onChange={(e) => setNewAutomation({...newAutomation, action: e.target.value})}
                                            className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"
                                        >
                                            <option value="">Select Action</option>
                                            <option value="Send Email">Send Email</option>
                                            <option value="Send Notification">Send Notification</option>
                                            <option value="Update Record">Update Record</option>
                                            <option value="Create Task">Create Task</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-2 mt-6">
                                    <button className="btn btn-danger" onClick={() => setShowAutomationModal(false)}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={addAutomationRule}>
                                        Create Automation
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Collaborator Modal */}
                    {showCollaboratorModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Add Collaborator</h3>
                                <input 
                                    type="email" 
                                    value={newCollaborator} 
                                    onChange={(e) => setNewCollaborator(e.target.value)}
                                    placeholder="Email address" 
                                    className="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-blue-500" 
                                />
                                <div className="flex justify-end space-x-2">
                                    <button className="btn btn-danger" onClick={() => setShowCollaboratorModal(false)}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={addCollaborator}>
                                        Add Collaborator
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Template Modal */}
                    {showTemplateModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Apply Template</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
                                    {templates.length > 0 ? (
                                        templates.map(template => (
                                            <div key={template.id || template.name} className="template-card" onClick={() => applyTemplate(template)}>
                                                <div className="template-thumb">
                                                    <i className="fas fa-layer-group"></i>
                                                </div>
                                                <div className="template-content">
                                                    <h4 className="font-medium">{template.name}</h4>
                                                    <p className="text-sm text-gray-600">{template.description}</p>
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="col-span-2 text-center py-6 text-gray-500">
                                            <i className="fas fa-file-alt text-3xl mb-3"></i>
                                            <p>No templates available yet.</p>
                                        </div>
                                    )}
                                </div>
                                <div className="flex justify-end mt-6">
                                    <button className="btn btn-danger" onClick={() => setShowTemplateModal(false)}>
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Export Modal */}
                    {showExportModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Export Data</h3>
                                <div className="space-y-3">
                                    <div 
                                        className={`export-option ${exportFormat === 'csv' ? 'border-blue-500 bg-blue-50' : ''}`}
                                        onClick={() => setExportFormat('csv')}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-file-csv text-2xl text-green-500 mr-3"></i>
                                            <div>
                                                <h4 className="font-medium">CSV Format</h4>
                                                <p className="text-sm text-gray-600">Comma-separated values, ideal for spreadsheets</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div 
                                        className={`export-option ${exportFormat === 'json' ? 'border-blue-500 bg-blue-50' : ''}`}
                                        onClick={() => setExportFormat('json')}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-file-code text-2xl text-yellow-500 mr-3"></i>
                                            <div>
                                                <h4 className="font-medium">JSON Format</h4>
                                                <p className="text-sm text-gray-600">JavaScript Object Notation, ideal for developers</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-2 mt-6">
                                    <button className="btn btn-danger" onClick={() => setShowExportModal(false)}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={exportData}>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* API Modal */}
                    {showApiModal && (
                        <div className="modal active">
                            <div className="modal-content">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">API Endpoint</h3>
                                <p className="text-sm text-gray-600 mb-4">
                                    Use this endpoint to access your {currentTable} data via API:
                                </p>
                                <div className="bg-gray-100 p-3 rounded-lg mb-4">
                                    <code className="break-all">{apiEndpoint}</code>
                                </div>
                                <div className="flex justify-end">
                                    <button className="btn btn-primary" onClick={() => setShowApiModal(false)}>
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
