<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chart of Accounts</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1000px;
      margin: 40px auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      margin-bottom: 15px;
    }

    .form-group label {
      width: 200px;
      font-weight: bold;
      margin-top: 6px;
    }

    .form-group select,
    .form-group input {
      flex: 1;
      padding: 8px;
      font-size: 1rem;
    }

    button {
      background-color: #28a745;
      color: #fff;
      padding: 10px 20px;
      border: none;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background-color: #218838;
    }

    table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: left;
    }

    th {
      background-color: #f1f1f1;
    }

    .Income { color: green; }
    .Expense, .COGS, .OtherExpense { color: red; }
    .Asset, .Liability, .Equity, .OtherIncome { color: #333; }
  </style>
</head>
<body>

<div class="container">
  <h2>Chart of Accounts</h2>

  <!-- Add Account Form -->
  <form id="accountForm">
    <div class="form-group">
      <label for="accountType">Account Type</label>
      <select id="accountType" required>
        <option value="">Select Type</option>
        <option value="Asset">Asset</option>
        <option value="Liability">Liability</option>
        <option value="Equity">Equity</option>
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
        <option value="COGS">Cost of Goods Sold</option>
        <option value="OtherIncome">Other Income</option>
        <option value="OtherExpense">Other Expense</option>
      </select>
    </div>

    <div class="form-group">
      <label for="category">Category</label>
      <select id="category" required>
        <option value="">Select Category</option>
      </select>
    </div>

    <div class="form-group">
      <label></label>
      <button type="button" id="addCategoryBtn">+ Add New Category</button>
    </div>

    <div class="form-group">
      <label for="accountName">Account Name</label>
      <input type="text" id="accountName" placeholder="e.g. Bank Account" required />
    </div>

    <div class="form-group">
      <label></label>
      <button type="submit">Add Account</button>
    </div>
  </form>

  <!-- Account Table -->
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Category</th>
        <th>Account Name</th>
      </tr>
    </thead>
    <tbody id="accountsTable"></tbody>
  </table>
</div>

<!-- Firebase SDKs -->
<script type="module">
  // Import Firebase SDK modules from CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-lite.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
    authDomain: "budget-app-1365f.firebaseapp.com",
    projectId: "budget-app-1365f",
    storageBucket: "budget-app-1365f.appspot.com",
    messagingSenderId: "1036194450411",
    appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
    measurementId: "G-YFFJL2H54X"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Category options per type
  const categories = {
    Asset: ['Cash', 'Bank', 'Accounts Receivable', 'Inventory', 'Fixed Assets'],
    Liability: ['Accounts Payable', 'Credit Card', 'Loan Payable'],
    Equity: ['Ownerâ€™s Equity', 'Retained Earnings', 'Common Stock'],
    Income: ['Sales Revenue', 'Service Income'],
    Expense: ['Rent', 'Utilities', 'Payroll', 'Supplies', 'Insurance'],
    COGS: ['Raw Materials', 'Freight In', 'Packaging'],
    OtherIncome: ['Investment Gains', 'Interest Received'],
    OtherExpense: ['Penalties', 'Asset Disposal Loss']
  };

  // DOM Elements
  const accountTypeSelect = document.getElementById('accountType');
  const categorySelect = document.getElementById('category');
  const addCategoryBtn = document.getElementById('addCategoryBtn');
  const accountForm = document.getElementById('accountForm');
  const accountsTable = document.getElementById('accountsTable');

  // Load categories based on account type
  accountTypeSelect.addEventListener('change', () => {
    const type = accountTypeSelect.value;
    updateCategoryOptions(type);
  });

  function updateCategoryOptions(type) {
    categorySelect.innerHTML = '<option value="">Select Category</option>';
    if (categories[type]) {
      categories[type].forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        categorySelect.appendChild(opt);
      });
    }
  }

  // Add new category to selected type
  addCategoryBtn.addEventListener('click', () => {
    const type = accountTypeSelect.value;
    if (!type) {
      alert("Please select Account Type first.");
      return;
    }
    const newCat = prompt(`Enter new category for "${type}"`);
    if (newCat && !categories[type].includes(newCat)) {
      categories[type].push(newCat);
      updateCategoryOptions(type);
      categorySelect.value = newCat;
    }
  });

  // Submit account and save to Firebase
  accountForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const type = accountTypeSelect.value;
    const category = categorySelect.value;
    const name = document.getElementById('accountName').value.trim();

    if (!type || !category || !name) {
      alert("All fields are required.");
      return;
    }

    try {
      // Save to Firestore
      await addDoc(collection(db, "chartOfAccounts"), {
        type,
        category,
        name,
        createdAt: new Date().toISOString()
      });

      // Add to UI
      const row = document.createElement('tr');
      row.innerHTML = `<td class="${type}">${type}</td><td>${category}</td><td>${name}</td>`;
      accountsTable.appendChild(row);

      accountForm.reset();
      categorySelect.innerHTML = '<option value="">Select Category</option>';
    } catch (error) {
      alert("Error saving to Firebase: " + error.message);
    }
  });

  // Load saved accounts from Firebase
  async function loadAccounts() {
    try {
      const snapshot = await getDocs(collection(db, "chartOfAccounts"));
      snapshot.forEach(doc => {
        const { type, category, name } = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `<td class="${type}">${type}</td><td>${category}</td><td>${name}</td>`;
        accountsTable.appendChild(row);
      });
    } catch (error) {
      console.error("Failed to load accounts:", error);
    }
  }

  // Initial load
  loadAccounts();
</script>

</body>
</html>
