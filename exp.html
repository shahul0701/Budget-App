<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Transaction Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --purple: #7209b7;
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --border-color: #dee2e6;
        }

        .dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --header-bg: #1e1e1e;
            --border-color: #2d2d2d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--header-bg);
            border-radius: 12px;
            padding: 15px 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .app-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 25px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s;
            border: 1px solid var(--border-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
        }

        .income-color {
            color: #28a745;
        }

        .expense-color {
            color: #dc3545;
        }

        .transfer-color {
            color: #7209b7;
        }

        .balance-hidden {
            filter: blur(5px);
            user-select: none;
        }

        .balance-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 16px;
        }

        .bank-balances-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .bank-balance-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--primary);
            transition: transform 0.3s;
            border: 1px solid var(--border-color);
        }

        .bank-balance-card:hover {
            transform: translateY(-3px);
        }

        .total-balance-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .bank-name {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bank-balance {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }

        .positive-balance {
            color: #28a745;
        }

        .negative-balance {
            color: #dc3545;
        }

        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        table {
            margin: 0;
            color: var(--text-color);
        }

        thead th {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px;
        }

        tbody tr {
            transition: background 0.2s;
            background: var(--card-bg);
        }

        tbody tr:hover {
            background: var(--bg-color);
        }

        .btn-action {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            margin: 2px;
        }

        .btn-view {
            background: var(--info);
            color: white;
        }

        .btn-edit {
            background: var(--warning);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }

        .floating-btn:hover {
            transform: scale(1.1);
        }

        .modal-content {
            border-radius: 12px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 15px 20px;
        }

        .modal-body {
            padding: 25px;
        }

        .transfer-section {
            background: var(--bg-color);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--purple);
        }

        .transfer-header {
            font-weight: 600;
            color: var(--purple);
            margin-bottom: 10px;
        }

        .pagination {
            margin: 20px 0;
            justify-content: center;
        }

        .page-item.active .page-link {
            background: var(--primary);
            border-color: var(--primary);
        }

        .page-link {
            color: var(--primary);
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        .page-link:hover {
            background: var(--bg-color);
            color: var(--primary);
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-left: 15px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .slider:after {
            content: '‚òÄÔ∏è';
            position: absolute;
            right: 10px;
            top: 5px;
            font-size: 12px;
        }

        input:checked + .slider:after {
            content: 'üåô';
            left: 10px;
            right: auto;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .transfer-badge {
            background-color: var(--purple);
        }

        @media (max-width: 768px) {
            .stats-grid,
            .bank-balances-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-row {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-money-bill-wave me-2"></i>Transaction Manager</h1>
            <div class="d-flex align-items-center">
                <div id="userInitials" class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px; font-weight: 700;">U</div>
                <div id="username" class="me-3 fw-bold">User</div>
                <label class="theme-switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
                <button id="logoutBtn" class="btn btn-sm btn-outline-danger ms-2">Logout</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label text-muted">Total Income</div>
                <div id="statIncome" class="stat-value income-color">$12,450.00</div>
                <div class="small text-muted"><i class="fa fa-arrow-up text-success"></i> 12.5% from last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label text-muted">Total Expenses</div>
                <div id="statExpense" class="stat-value expense-color">$8,275.50</div>
                <div class="small text-muted"><i class="fa fa-arrow-up text-danger"></i> 5.2% from last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label text-muted">Current Balance</div>
                <div id="statBalance" class="stat-value balance-hidden">$4,174.50</div>
                <div class="small text-muted">
                    <button id="balanceToggle" class="balance-toggle" title="Toggle balance visibility">
                        <i class="fa fa-eye-slash"></i> Hide Balance
                    </button>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label text-muted">Transactions</div>
                <div id="statCount" class="stat-value">42</div>
                <div class="small text-muted">This month</div>
            </div>
        </div>

        <!-- Bank Balances -->
        <div class="app-card">
            <div class="card-header">
                <h3 class="m-0"><i class="fas fa-university me-2"></i>Bank Balances</h3>
                <button class="btn btn-sm btn-light" id="refreshBalancesBtn"><i class="fas fa-sync-alt me-1"></i> Refresh</button>
            </div>
            <div class="card-body">
                <div class="bank-balances-grid" id="bankBalancesContainer">
                    <!-- Bank balances will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Filters and Transactions -->
        <div class="app-card">
            <div class="card-header">
                <h3 class="m-0"><i class="fas fa-exchange-alt me-2"></i>Transactions</h3>
                <div>
                    <button id="csvUploadBtn" class="btn btn-sm btn-light me-2"><i class="fas fa-file-import me-1"></i> Import CSV</button>
                    <button id="newTxBtn" class="btn btn-sm btn-light"><i class="fas fa-plus me-1"></i> New Transaction</button>
                </div>
            </div>
            <div class="card-body">
                <!-- Filters -->
                <div class="filters-row">
                    <div class="filter-group">
                        <label class="form-label">Date Filter</label>
                        <select id="dateFilter" class="form-select">
                            <option value="all">All Dates</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month" selected>This Month</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Type</label>
                        <select id="typeFilter" class="form-select">
                            <option value="all">All Types</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                            <option value="transfer">Transfer</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Bank</label>
                        <select id="bankFilter" class="form-select">
                            <option value="all">All Banks</option>
                            <option value="chase">Chase Bank</option>
                            <option value="bofa">Bank of America</option>
                            <option value="wells">Wells Fargo</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="form-label">Search</label>
                        <input id="searchDesc" class="form-control" placeholder="Search description...">
                    </div>
                    <div class="filter-group d-flex align-items-end">
                        <button id="applyFiltersBtn" class="btn btn-primary w-100"><i class="fas fa-search me-1"></i> Apply Filters</button>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Account Header</th>
                                <th>Type</th>
                                <th>Bank</th>
                                <th class="text-end">Income</th>
                                <th class="text-end">Expense</th>
                                <th class="text-end">Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTableBody">
                            <!-- Transactions will be populated dynamically -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <nav aria-label="Transaction pagination">
                    <ul class="pagination" id="paginationContainer">
                        <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- Floating Action Button -->
        <div class="floating-btn" id="floatingAdd">
            <i class="fas fa-plus"></i>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div class="modal fade" id="transactionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"><i class="fas fa-money-bill-wave me-2"></i>Add Transaction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="transactionForm">
                        <input type="hidden" id="txId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-control" id="formDATE" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Voucher # (SINO)</label>
                                <input type="text" class="form-control" id="formSINO">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Account Header</label>
                                <select class="form-select" id="formACCOUNTHEADER">
                                    <option value="">Select Account Header</option>
                                    <option value="Income">Income</option>
                                    <option value="Expense">Expense</option>
                                    <option value="Housing">Housing</option>
                                    <option value="Food">Food & Dining</option>
                                    <option value="Utilities">Utilities</option>
                                    <option value="Transportation">Transportation</option>
                                    <option value="Entertainment">Entertainment</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="formTYPE">
                                    <option value="Income">Income</option>
                                    <option value="Expense">Expense</option>
                                    <option value="Transfer">Transfer</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Bank Name</label>
                                <select class="form-select" id="formBANKNAME">
                                    <option value="">Select Bank</option>
                                    <option value="Chase Bank">Chase Bank</option>
                                    <option value="Bank of America">Bank of America</option>
                                    <option value="Wells Fargo">Wells Fargo</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Voucher Type</label>
                                <select class="form-select" id="formVOUCHERTYPE">
                                    <option value="Payment">Payment</option>
                                    <option value="Receipt">Receipt</option>
                                    <option value="Journal">Journal</option>
                                    <option value="Transfer">Transfer</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Income</label>
                                <input type="number" step="0.01" class="form-control" id="formINCOME">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Expense</label>
                                <input type="number" step="0.01" class="form-control" id="formEXPENSE">
                            </div>
                        </div>
                        
                        <!-- Transfer Section (shown only when Voucher Type is Transfer) -->
                        <div class="transfer-section" id="transferSection" style="display: none;">
                            <div class="transfer-header"><i class="fas fa-exchange-alt me-2"></i>Transfer Details</div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">From Bank</label>
                                    <select class="form-select" id="formFROMBANK">
                                        <option value="">Select Source Bank</option>
                                        <option value="Chase Bank">Chase Bank</option>
                                        <option value="Bank of America">Bank of America</option>
                                        <option value="Wells Fargo">Wells Fargo</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">To Bank</label>
                                    <select class="form-select" id="formTOBANK">
                                        <option value="">Select Destination Bank</option>
                                        <option value="Chase Bank">Chase Bank</option>
                                        <option value="Bank of America">Bank of America</option>
                                        <option value="Wells Fargo">Wells Fargo</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-control" id="formNOTES">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Balance</label>
                                <input type="number" step="0.01" class="form-control" id="formBALANCE" readonly>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label class="form-label">Attachment</label>
                                <input type="file" class="form-control" id="formATTACHFILE" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,image/*">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveTransactionBtn">
                        <span id="saveBtnText">Save Transaction</span>
                        <span id="saveBtnSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Data storage
        const transactions = [
            {
                id: 1,
                date: '2023-10-15',
                description: 'Salary Deposit',
                accountHeader: 'Income',
                type: 'Income',
                bank: 'Chase Bank',
                income: 5000.00,
                expense: 0.00,
                balance: 8420.75,
                voucherType: 'Receipt'
            },
            {
                id: 2,
                date: '2023-10-18',
                description: 'Rent Payment',
                accountHeader: 'Housing',
                type: 'Expense',
                bank: 'Chase Bank',
                income: 0.00,
                expense: 1200.00,
                balance: 7220.75,
                voucherType: 'Payment'
            },
            {
                id: 3,
                date: '2023-10-20',
                description: 'Grocery Shopping',
                accountHeader: 'Food & Dining',
                type: 'Expense',
                bank: 'Bank of America',
                income: 0.00,
                expense: 156.30,
                balance: 3000.00,
                voucherType: 'Payment'
            },
            {
                id: 4,
                date: '2023-10-22',
                description: 'Freelance Work',
                accountHeader: 'Income',
                type: 'Income',
                bank: 'Wells Fargo',
                income: 1250.00,
                expense: 0.00,
                balance: 1024.50,
                voucherType: 'Receipt'
            },
            {
                id: 5,
                date: '2023-10-25',
                description: 'Utility Bills',
                accountHeader: 'Utilities',
                type: 'Expense',
                bank: 'Chase Bank',
                income: 0.00,
                expense: 275.50,
                balance: 6945.25,
                voucherType: 'Payment'
            },
            {
                id: 6,
                date: '2023-10-28',
                description: 'Transfer to Savings',
                accountHeader: 'Transfer',
                type: 'Transfer',
                bank: 'Transfer',
                income: 500.00,
                expense: 500.00,
                balance: 6445.25,
                voucherType: 'Transfer',
                fromBank: 'Chase Bank',
                toBank: 'Bank of America'
            }
        ];

        const bankBalances = {
            "Chase Bank": 6420.75,
            "Bank of America": 3656.30,
            "Wells Fargo": 1024.50
        };

        $(document).ready(function() {
            // Initialize modal
            const transactionModal = new bootstrap.Modal(document.getElementById('transactionModal'));
            
            // Check for saved theme preference or respect OS preference
            if (localStorage.getItem('theme') === 'dark' || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('theme'))) {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').checked = true;
            }
            
            // Initialize data
            updateBankBalancesUI();
            updateTransactionsUI();
            updateStatsUI();
            
            // Theme toggle functionality
            $('#themeToggle').change(function() {
                if ($(this).is(':checked')) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });
            
            // Show loading overlay function
            function showLoading() {
                $('#loadingOverlay').fadeIn();
            }
            
            // Hide loading overlay function
            function hideLoading() {
                $('#loadingOverlay').fadeOut();
            }
            
            // Show save button loading state
            function showSaveLoading() {
                $('#saveBtnText').text('Saving...');
                $('#saveBtnSpinner').show();
                $('#saveTransactionBtn').prop('disabled', true);
            }
            
            // Hide save button loading state
            function hideSaveLoading() {
                $('#saveBtnText').text('Save Transaction');
                $('#saveBtnSpinner').hide();
                $('#saveTransactionBtn').prop('disabled', false);
            }
            
            // Simulate loading delay
            function simulateLoading(callback, delay = 1500) {
                showLoading();
                setTimeout(() => {
                    callback();
                    hideLoading();
                }, delay);
            }
            
            // Update bank balances UI
            function updateBankBalancesUI() {
                const container = $('#bankBalancesContainer');
                container.empty();
                
                let totalBalance = 0;
                let totalTransactions = 0;
                
                for (const [bank, balance] of Object.entries(bankBalances)) {
                    const transactionCount = transactions.filter(t => t.bank === bank).length;
                    totalBalance += balance;
                    totalTransactions += transactionCount;
                    
                    container.append(`
                        <div class="bank-balance-card">
                            <div class="bank-name">
                                <span>${bank}</span>
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="bank-balance ${balance >= 0 ? 'positive-balance' : 'negative-balance'}">${balance >= 0 ? '$' : '-$'}${Math.abs(balance).toFixed(2)}</div>
                            <div class="bank-transaction-count">${transactionCount} transactions</div>
                        </div>
                    `);
                }
                
                container.append(`
                    <div class="bank-balance-card total-balance-card">
                        <div class="bank-name">
                            <span>Total Balance</span>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="bank-balance">$${totalBalance.toFixed(2)}</div>
                        <div class="bank-transaction-count">${totalTransactions} total transactions</div>
                    </div>
                `);
            }
            
            // Update transactions UI
            function updateTransactionsUI() {
                const tbody = $('#transactionsTableBody');
                tbody.empty();
                
                transactions.forEach(tx => {
                    const badgeClass = tx.type === 'Income' ? 'bg-success' : 
                                      tx.type === 'Expense' ? 'bg-danger' : 'transfer-badge';
                    
                    tbody.append(`
                        <tr>
                            <td>${tx.date}</td>
                            <td>${tx.description}</td>
                            <td>${tx.accountHeader}</td>
                            <td><span class="badge ${badgeClass}">${tx.type}</span></td>
                            <td>${tx.bank}</td>
                            <td class="text-end ${tx.income > 0 ? 'text-success' : ''}">${tx.income > 0 ? '$' + tx.income.toFixed(2) : '$0.00'}</td>
                            <td class="text-end ${tx.expense > 0 ? 'text-danger' : ''}">${tx.expense > 0 ? '$' + tx.expense.toFixed(2) : '$0.00'}</td>
                            <td class="text-end">$${tx.balance.toFixed(2)}</td>
                            <td>
                                <button class="btn btn-sm btn-action btn-view"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-sm btn-action btn-edit" data-id="${tx.id}"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-action btn-delete" data-id="${tx.id}"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `);
                });
            }
            
            // Update stats UI
            function updateStatsUI() {
                const totalIncome = transactions
                    .filter(tx => tx.type === 'Income')
                    .reduce((sum, tx) => sum + tx.income, 0);
                
                const totalExpense = transactions
                    .filter(tx => tx.type === 'Expense' || tx.type === 'Transfer')
                    .reduce((sum, tx) => sum + tx.expense, 0);
                
                const totalBalance = Object.values(bankBalances).reduce((sum, balance) => sum + balance, 0);
                
                $('#statIncome').text('$' + totalIncome.toFixed(2));
                $('#statExpense').text('$' + totalExpense.toFixed(2));
                $('#statBalance').text('$' + totalBalance.toFixed(2));
                $('#statCount').text(transactions.length);
            }
            
            // Open modal on button clicks
            $('#newTxBtn, #floatingAdd').click(function() {
                // Reset form
                $('#transactionForm')[0].reset();
                // Set today's date as default
                $('#formDATE').val(new Date().toISOString().split('T')[0]);
                // Hide transfer section by default
                $('#transferSection').hide();
                // Reset modal title
                $('#modalTitle').html('<i class="fas fa-money-bill-wave me-2"></i>Add Transaction');
                // Show modal
                transactionModal.show();
            });
            
            // Toggle balance visibility
            $('#balanceToggle').click(function() {
                const balance = $('#statBalance');
                const isHidden = balance.hasClass('balance-hidden');
                
                if (isHidden) {
                    balance.removeClass('balance-hidden');
                    $(this).html('<i class="fa fa-eye-slash"></i> Hide Balance');
                } else {
                    balance.addClass('balance-hidden');
                    $(this).html('<i class="fa fa-eye"></i> Show Balance');
                }
            });
            
            // Show/hide transfer section based on voucher type
            $('#formVOUCHERTYPE').change(function() {
                if ($(this).val() === 'Transfer') {
                    $('#transferSection').show();
                    // Auto-set the type to Transfer
                    $('#formTYPE').val('Transfer');
                    // Auto-set the bank name to "Transfer" for clarity
                    $('#formBANKNAME').val('').prop('disabled', true);
                } else {
                    $('#transferSection').hide();
                    $('#formBANKNAME').prop('disabled', false);
                    // Reset type if not transfer
                    if ($('#formTYPE').val() === 'Transfer') {
                        $('#formTYPE').val('Income');
                    }
                }
            });
            
            // Also show transfer section when type is set to Transfer
            $('#formTYPE').change(function() {
                if ($(this).val() === 'Transfer') {
                    $('#transferSection').show();
                    $('#formVOUCHERTYPE').val('Transfer');
                    $('#formBANKNAME').val('').prop('disabled', true);
                } else {
                    $('#transferSection').hide();
                    $('#formBANKNAME').prop('disabled', false);
                    if ($('#formVOUCHERTYPE').val() === 'Transfer') {
                        $('#formVOUCHERTYPE').val('Payment');
                    }
                }
            });
            
            // Calculate balance when income or expense changes
            $('#formINCOME, #formEXPENSE').on('input', function() {
                const income = parseFloat($('#formINCOME').val()) || 0;
                const expense = parseFloat($('#formEXPENSE').val()) || 0;
                
                // For transfers, ensure income equals expense
                if ($('#formVOUCHERTYPE').val() === 'Transfer' || $('#formTYPE').val() === 'Transfer') {
                    if (income > 0 && expense === 0) {
                        $('#formEXPENSE').val(income);
                    } else if (expense > 0 && income === 0) {
                        $('#formINCOME').val(expense);
                    } else if (income !== expense) {
                        // If both are set but not equal, make them equal
                        const maxVal = Math.max(income, expense);
                        $('#formINCOME').val(maxVal);
                        $('#formEXPENSE').val(maxVal);
                    }
                }
                
                // Calculate and update balance
                const currentBalance = parseFloat($('#formBALANCE').val()) || 0;
                const newBalance = currentBalance + income - expense;
                $('#formBALANCE').val(newBalance.toFixed(2));
            });
            
            // Save transaction
            $('#saveTransactionBtn').click(function() {
                // Basic validation
                if (!$('#formDATE').val()) {
                    Swal.fire('Error', 'Please select a date', 'error');
                    return;
                }
                
                if (!$('#formACCOUNTHEADER').val()) {
                    Swal.fire('Error', 'Please select an account header', 'error');
                    return;
                }
                
                const income = parseFloat($('#formINCOME').val()) || 0;
                const expense = parseFloat($('#formEXPENSE').val()) || 0;
                
                if (income === 0 && expense === 0) {
                    Swal.fire('Error', 'Please enter either income or expense amount', 'error');
                    return;
                }
                
                // For transfers, validate from and to banks
                if ($('#formVOUCHERTYPE').val() === 'Transfer' || $('#formTYPE').val() === 'Transfer') {
                    if (!$('#formFROMBANK').val() || !$('#formTOBANK').val()) {
                        Swal.fire('Error', 'Please select both source and destination banks for transfer', 'error');
                        return;
                    }
                    
                    if ($('#formFROMBANK').val() === $('#formTOBANK').val()) {
                        Swal.fire('Error', 'Source and destination banks cannot be the same for transfers', 'error');
                        return;
                    }
                    
                    if (income !== expense) {
                        Swal.fire('Error', 'For transfers, income and expense amounts must be equal', 'error');
                        return;
                    }
                }
                
                // Show loading state on save button
                showSaveLoading();
                
                // Simulate API call
                setTimeout(() => {
                    // Create transaction object
                    const newTransaction = {
                        id: transactions.length + 1,
                        date: $('#formDATE').val(),
                        description: $('#formNOTES').val() || 'No description',
                        accountHeader: $('#formACCOUNTHEADER').val(),
                        type: $('#formTYPE').val(),
                        bank: $('#formBANKNAME').val() || 'Transfer',
                        income: income,
                        expense: expense,
                        balance: parseFloat($('#formBALANCE').val()),
                        voucherType: $('#formVOUCHERTYPE').val()
                    };
                    
                    // For transfers, add from/to bank info
                    if (newTransaction.type === 'Transfer') {
                        newTransaction.fromBank = $('#formFROMBANK').val();
                        newTransaction.toBank = $('#formTOBANK').val();
                        
                        // Update bank balances for transfer
                        bankBalances[newTransaction.fromBank] -= expense;
                        bankBalances[newTransaction.toBank] += income;
                    } else {
                        // Update bank balance for regular transaction
                        if (newTransaction.type === 'Income') {
                            bankBalances[newTransaction.bank] += income;
                        } else {
                            bankBalances[newTransaction.bank] -= expense;
                        }
                    }
                    
                    // Add to transactions array
                    transactions.push(newTransaction);
                    
                    // Update UI
                    updateBankBalancesUI();
                    updateTransactionsUI();
                    updateStatsUI();
                    
                    // Hide save loading state
                    hideSaveLoading();
                    
                    // Show success message
                    Swal.fire('Success', 'Transaction saved successfully!', 'success').then(() => {
                        // Close modal
                        transactionModal.hide();
                    });
                }, 1500);
            });
            
            // Edit transaction buttons
            $(document).on('click', '.btn-edit', function() {
                const txId = $(this).data('id');
                const transaction = transactions.find(t => t.id === txId);
                
                if (transaction) {
                    // Show loading
                    simulateLoading(function() {
                        // Populate the form with existing data
                        $('#transactionForm')[0].reset();
                        $('#txId').val(transaction.id);
                        $('#formDATE').val(transaction.date);
                        $('#formACCOUNTHEADER').val(transaction.accountHeader);
                        $('#formTYPE').val(transaction.type);
                        $('#formBANKNAME').val(transaction.bank);
                        $('#formVOUCHERTYPE').val(transaction.voucherType);
                        $('#formINCOME').val(transaction.income);
                        $('#formEXPENSE').val(transaction.expense);
                        $('#formNOTES').val(transaction.description);
                        $('#formBALANCE').val(transaction.balance);
                        
                        // For transfers, populate from/to banks
                        if (transaction.type === 'Transfer') {
                            $('#transferSection').show();
                            $('#formFROMBANK').val(transaction.fromBank);
                            $('#formTOBANK').val(transaction.toBank);
                            $('#formBANKNAME').prop('disabled', true);
                        } else {
                            $('#transferSection').hide();
                            $('#formBANKNAME').prop('disabled', false);
                        }
                        
                        // Update modal title
                        $('#modalTitle').html('<i class="fas fa-edit me-2"></i>Edit Transaction');
                        
                        // Show modal
                        transactionModal.show();
                    }, 1000);
                }
            });
            
            // Delete transaction buttons
            $(document).on('click', '.btn-delete', function() {
                const txId = $(this).data('id');
                
                Swal.fire({
                    title: 'Delete Transaction?',
                    text: 'Are you sure you want to delete this transaction?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        simulateLoading(function() {
                            // Find transaction index
                            const index = transactions.findIndex(t => t.id === txId);
                            
                            if (index !== -1) {
                                const transaction = transactions[index];
                                
                                // Reverse the transaction effect on bank balance
                                if (transaction.type === 'Income') {
                                    bankBalances[transaction.bank] -= transaction.income;
                                } else if (transaction.type === 'Expense') {
                                    bankBalances[transaction.bank] += transaction.expense;
                                } else if (transaction.type === 'Transfer') {
                                    bankBalances[transaction.fromBank] += transaction.expense;
                                    bankBalances[transaction.toBank] -= transaction.income;
                                }
                                
                                // Remove transaction
                                transactions.splice(index, 1);
                                
                                // Update UI
                                updateBankBalancesUI();
                                updateTransactionsUI();
                                updateStatsUI();
                                
                                Swal.fire('Deleted!', 'The transaction has been deleted.', 'success');
                            }
                        }, 1000);
                    }
                });
            });
            
            // Refresh balances button
            $('#refreshBalancesBtn').click(function() {
                const btn = $(this);
                const originalText = btn.html();
                
                // Show loading on button
                btn.html('<i class="fas fa-spinner fa-spin me-1"></i> Refreshing...');
                btn.prop('disabled', true);
                
                // Simulate refresh
                setTimeout(() => {
                    // Update UI
                    updateBankBalancesUI();
                    
                    // Restore button
                    btn.html(originalText);
                    btn.prop('disabled', false);
                    
                    Swal.fire('Refreshed!', 'Bank balances have been updated.', 'success');
                }, 1500);
            });
            
            // Logout button
            $('#logoutBtn').click(function() {
                Swal.fire({
                    title: 'Logout?',
                    text: 'Are you sure you want to logout?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, logout!',
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        simulateLoading(function() {
                            // In a real app, this would redirect to logout
                            Swal.fire('Logged Out', 'You have been successfully logged out.', 'success');
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>