<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>All-in-One Calculator & Live Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  :root{--accent:#0ea5a4;--good:#10b981;--danger:#ef4444;--muted:#6b7280}
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  body{background:linear-gradient(180deg,#0f1724,#0b1220);min-height:100vh;padding:18px;display:flex;justify-content:center;align-items:flex-start}
  .app{width:100%;max-width:1200px;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 20px 60px rgba(2,6,23,.6)}
  header{background:linear-gradient(90deg,var(--accent),#3b82f6);color:#fff;padding:16px 18px;display:flex;justify-content:space-between;align-items:center}
  header h1{font-size:1.05rem;display:flex;gap:10px;align-items:center}
  .layout{display:grid;grid-template-columns:1fr 340px;gap:0;min-height:680px}
  @media(max-width:980px){ .layout{grid-template-columns:1fr} .sidebar{order:2} .main{order:1} }
  .main{padding:18px;background:#fff}
  .sidebar{background:#f8fafc;padding:18px;border-left:1px solid #e6eef6}
  .modes{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
  .tab{padding:8px 12px;border-radius:8px;background:#f1f5f9;border:1px solid #e6eef6;cursor:pointer;font-weight:700;color:#0f1724}
  .tab.active{background:var(--accent);color:#fff;border-color:transparent}
  .panel{display:none}
  .panel.active{display:block;animation:fadeIn .25s ease}
  .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .input, input, select, textarea, button{font-family:inherit}
  .input{padding:10px;border-radius:8px;border:1px solid #e6eef6;background:#fff}
  button.btn{padding:10px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
  button.btn.ghost{background:#eef2ff;color:#0f1724;border:1px solid #e6eef6}
  .display{width:100%;padding:12px;border-radius:8px;border:1px solid #e6eef6;background:#f8fafc;text-align:right;font-size:1.25rem}
  .result-box{margin-top:12px;padding:12px;border-left:4px solid var(--accent);background:#f0f9ff;border-radius:8px}
  .section{margin-bottom:14px}
  .small{font-size:0.92rem;color:var(--muted)}
  .history{max-height:220px;overflow:auto;padding:8px;background:#fff;border-radius:8px;border:1px solid #eef5fb}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eef5fb;text-align:left;font-size:0.92rem}
  .live-card{background:#fff;padding:12px;border-radius:10px;border:1px solid #eef5fb;margin-bottom:10px}
  .live-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .muted{color:var(--muted)}
  .tiny{font-size:0.85rem}
  .actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .delete{color:var(--danger);cursor:pointer}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  footer{padding:10px 18px;background:#f8fafc;border-top:1px solid #eef5fb;font-size:0.9rem;color:var(--muted)}
</style>
</head>
<body>

<div class="app" role="application" aria-label="All-in-One Calculator">
  <header>
    <h1><i class="fas fa-calculator"></i> All-in-One Calculator — Live</h1>
    <div class="small">Currency (live) · Gold · Crypto · Mileage · Loan · Tax · Date · Measure</div>
  </header>

  <div class="layout">
    <!-- MAIN -->
    <main class="main" aria-live="polite">
      <div class="modes" role="tablist">
        <div class="tab active" data-tab="standard">Standard</div>
        <div class="tab" data-tab="scientific">Scientific</div>
        <div class="tab" data-tab="currency">Currency</div>
        <div class="tab" data-tab="mileage">Mileage</div>
        <div class="tab" data-tab="loan">Loan</div>
        <div class="tab" data-tab="tax">Tax</div>
        <div class="tab" data-tab="date">Date</div>
        <div class="tab" data-tab="measure">Measure</div>
      </div>

      <!-- Standard -->
      <section id="standard" class="panel active section">
        <div class="small">Basic arithmetic</div>
        <input id="std-display" class="display" readonly value="0" aria-label="Standard display">
        <div style="margin-top:10px" class="grid-4">
          <button class="btn ghost" onclick="stdClear()">C</button>
          <button class="btn ghost" onclick="stdBack()">⌫</button>
          <button class="btn ghost" onclick="stdAppend('%')">%</button>
          <button class="btn ghost" onclick="stdAppend('/')">/</button>

          <button class="btn" onclick="stdAppend('7')">7</button>
          <button class="btn" onclick="stdAppend('8')">8</button>
          <button class="btn" onclick="stdAppend('9')">9</button>
          <button class="btn ghost" onclick="stdAppend('*')">×</button>

          <button class="btn" onclick="stdAppend('4')">4</button>
          <button class="btn" onclick="stdAppend('5')">5</button>
          <button class="btn" onclick="stdAppend('6')">6</button>
          <button class="btn ghost" onclick="stdAppend('-')">-</button>

          <button class="btn" onclick="stdAppend('1')">1</button>
          <button class="btn" onclick="stdAppend('2')">2</button>
          <button class="btn" onclick="stdAppend('3')">3</button>
          <button class="btn ghost" onclick="stdAppend('+')">+</button>

          <button class="btn" onclick="stdAppend('0')" style="grid-column:span 2">0</button>
          <button class="btn" onclick="stdAppend('.')">.</button>
          <button class="btn" onclick="stdCalculate()">=</button>
        </div>
      </section>

      <!-- Scientific -->
      <section id="scientific" class="panel section" aria-hidden="true">
        <div class="small">Scientific (trig in degrees)</div>
        <input id="sci-display" class="display" readonly value="0">
        <div style="margin-top:10px;display:grid;grid-template-columns:repeat(5,1fr);gap:8px">
          <button class="btn ghost" onclick="sciClear()">C</button>
          <button class="btn ghost" onclick="sciBack()">⌫</button>
          <button class="btn ghost" onclick="sciAppend('(')">(</button>
          <button class="btn ghost" onclick="sciAppend(')')">)</button>
          <button class="btn ghost" onclick="sciAppend('**')">^</button>

          <button class="btn" onclick="sciFunc('sin')">sin</button>
          <button class="btn" onclick="sciFunc('cos')">cos</button>
          <button class="btn" onclick="sciFunc('tan')">tan</button>
          <button class="btn" onclick="sciFunc('sqrt')">√</button>
          <button class="btn" onclick="sciAppend('Math.PI')">π</button>

          <button class="btn" onclick="sciFunc('log')">log</button>
          <button class="btn" onclick="sciFunc('ln')">ln</button>
          <button class="btn" onclick="sciAppend('Math.E')">e</button>
          <button class="btn" onclick="sciFact()">x!</button>
          <button class="btn" onclick="sciAppend('%')">%</button>

          <button class="btn" onclick="sciAppend('7')">7</button>
          <button class="btn" onclick="sciAppend('8')">8</button>
          <button class="btn" onclick="sciAppend('9')">9</button>
          <button class="btn ghost" onclick="sciAppend('/')">/</button>
          <button class="btn ghost" onclick="sciAppend('*')">×</button>

          <button class="btn" onclick="sciAppend('4')">4</button>
          <button class="btn" onclick="sciAppend('5')">5</button>
          <button class="btn" onclick="sciAppend('6')">6</button>
          <button class="btn ghost" onclick="sciAppend('-')">-</button>
          <button class="btn ghost" onclick="sciAppend('+')">+</button>

          <button class="btn" onclick="sciAppend('1')">1</button>
          <button class="btn" onclick="sciAppend('2')">2</button>
          <button class="btn" onclick="sciAppend('3')">3</button>
          <button class="btn" onclick="sciCalculate()" style="grid-column:span 2">=</button>

          <button class="btn" onclick="sciAppend('0')" style="grid-column:span 2">0</button>
          <button class="btn" onclick="sciAppend('.')">.</button>
        </div>
      </section>

      <!-- Currency -->
      <section id="currency" class="panel section" aria-hidden="true">
        <div class="small">Live currency conversion (exchangerate.host)</div>
        <div style="display:grid;grid-template-columns:1fr 180px;gap:8px;margin-top:8px">
          <input id="cur-amount" class="input" type="number" value="1" min="0" step="any">
          <div style="display:flex;gap:8px">
            <button class="btn" onclick="convertCurrency()">Convert</button>
            <button class="btn ghost" onclick="swapCurrency()">Swap</button>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <select id="from-currency" class="input"></select>
          <select id="to-currency" class="input"></select>
        </div>

        <div class="result-box" id="cur-result">Result will appear here</div>
        <div class="small" style="margin-top:6px">If conversion fails, there will be a helpful error message (CORS or network)</div>
      </section>

      <!-- Mileage -->
      <section id="mileage" class="panel section" aria-hidden="true">
        <div class="small">Mileage tracker (saved in browser)</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="vehicle" class="input" placeholder="Vehicle name">
          <input id="odo" class="input" placeholder="Odometer (km)" type="number" step="any">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <input id="fuel" class="input" placeholder="Fuel (L)" type="number" step="any">
          <input id="cost" class="input" placeholder="Fuel cost (₹)" type="number" step="any">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="mdate" class="input" type="date" style="flex:1">
          <button class="btn" onclick="addMileage()">Add</button>
          <button class="btn ghost" onclick="clearMileageForm()">Clear</button>
        </div>

        <div class="result-box" id="mileage-summary">No records yet</div>

        <h3 style="margin-top:12px">History</h3>
        <div style="overflow:auto;max-height:220px">
          <table id="mileage-table"><thead><tr><th>Date</th><th>Vehicle</th><th>Odo</th><th>Fuel</th><th>Cost</th><th>Mileage</th><th></th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <!-- Loan -->
      <section id="loan" class="panel section" aria-hidden="true">
        <div class="small">Loan / EMI</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="loan-p" class="input" placeholder="Principal (₹)" type="number" value="100000">
          <input id="loan-r" class="input" placeholder="Annual rate (%)" type="number" value="7.5">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="loan-n" class="input" placeholder="Years" type="number" value="5">
          <button class="btn" onclick="calcLoan()">Calculate</button>
          <button class="btn ghost" onclick="clearLoan()">Clear</button>
        </div>
        <div class="result-box" id="loan-result">EMI result</div>
      </section>

      <!-- Tax -->
      <section id="tax" class="panel section" aria-hidden="true">
        <div class="small">Tax helper (flat & demo slab)</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="tax-income" class="input" placeholder="Taxable income" type="number" value="500000">
          <input id="tax-rate" class="input" placeholder="Flat tax rate (%)" type="number" value="10">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="calcTax()">Flat tax</button>
          <button class="btn ghost" onclick="calcTaxSlab()">Slab demo</button>
        </div>
        <div class="result-box" id="tax-result">Tax result</div>
      </section>

      <!-- Date -->
      <section id="date" class="panel section" aria-hidden="true">
        <div class="small">Age, days between and add/subtract days</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="dob" type="date" class="input"><div style="display:flex;gap:8px"><button class="btn" onclick="calcAge()">Age</button><button class="btn ghost" onclick="clearAge()">Clear</button></div>
        </div>
        <div class="result-box" id="age-result">Age result</div>

        <hr style="margin:12px 0">

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="start-date" type="date" class="input"><input id="end-date" type="date" class="input">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="daysBetween()">Days between</button>
          <button class="btn ghost" onclick="clearDates()">Clear</button>
        </div>
        <div class="result-box" id="date-diff-result">Days difference</div>

        <hr style="margin:12px 0">

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="base-date" type="date" class="input"><input id="days-add" type="number" class="input" value="0">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="addDays()">Add/Subtract</button><button class="btn ghost" onclick="clearAddDays()">Clear</button>
        </div>
        <div class="result-box" id="add-days-result">Add/Sub result</div>
      </section>

      <!-- Measure -->
      <section id="measure" class="panel section" aria-hidden="true">
        <div class="small">Length, Weight, Temperature conversions</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <select id="measure-type" class="input" onchange="populateUnits()"><option value="length">Length</option><option value="weight">Weight</option><option value="temperature">Temperature</option></select>
          <input id="measure-value" class="input" type="number" value="1" step="any">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <select id="measure-from" class="input"></select>
          <select id="measure-to" class="input"></select>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="convertMeasure()">Convert</button>
          <button class="btn ghost" onclick="resetMeasure()">Clear</button>
        </div>
        <div class="result-box" id="measure-result">Conversion</div>
      </section>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div class="small">Recent calculations</div>
        <div style="display:flex;gap:8px">
          <button class="btn ghost" onclick="copyHistory()">Copy</button>
          <button class="btn ghost" onclick="downloadHistory()">Export CSV</button>
          <button class="btn" onclick="resetAll()">Reset</button>
        </div>
      </div>
      <div style="margin-top:8px" class="history" id="history"></div>
    </main>

    <!-- SIDEBAR / LIVE PANEL -->
    <aside class="sidebar" aria-label="Live market data">
      <div class="live-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Live Snapshot</strong>
          <div class="tiny muted" id="live-updated">--</div>
        </div>

        <div style="margin-top:8px" class="live-grid">
          <div><div class="small muted">USD → INR</div><div id="usd-inr" style="font-weight:800">--</div></div>
          <div><div class="small muted">EUR → USD</div><div id="eur-usd" style="font-weight:800">--</div></div>

          <div><div class="small muted">Gold (XAU/oz)</div><div id="gold" style="font-weight:800">--</div></div>
          <div><div class="small muted">Silver (XAG/oz)</div><div id="silver" style="font-weight:800">--</div></div>

          <div><div class="small muted">Bitcoin (USD)</div><div id="btc" style="font-weight:800">--</div></div>
          <div><div class="small muted">Ethereum (USD)</div><div id="eth" style="font-weight:800">--</div></div>
        </div>

        <div class="actions" style="margin-top:10px">
          <button class="btn" onclick="refreshLive()">Refresh</button>
          <button class="btn ghost" onclick="toggleAuto()">Auto: <span id="auto-status">ON</span></button>
        </div>

        <div class="tiny muted" style="margin-top:8px">Data sources: exchangerate.host, CoinGecko, GoldPrice (public endpoints).</div>
      </div>

      <div class="live-card">
        <strong>Quick Converter</strong>
        <div style="margin-top:8px">
          <input id="quick-amt" class="input" value="1" type="number" step="any">
          <select id="quick-from" class="input" style="margin-top:6px"></select>
          <select id="quick-to" class="input" style="margin-top:6px"></select>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" onclick="quickConvert()">Convert</button>
            <button class="btn ghost" onclick="fillQuick()">Use main</button>
          </div>
          <div class="result-box" id="quick-result">Quick result</div>
        </div>
      </div>

      <div class="live-card">
        <strong>Mileage Export</strong>
        <div class="small muted" style="margin-top:8px">Export or clear local mileage</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="exportMileageCSV()">Export CSV</button>
          <button class="btn ghost" onclick="clearMileageStorage()">Clear</button>
        </div>
      </div>
    </aside>
  </div>

  <footer>Open dev console to see detailed errors if any API fails. If CORS errors appear, run a local web server (e.g. <code>python -m http.server 8000</code>) and open the page at <code>http://localhost:8000/</code>.</footer>
</div>

<script type="module">
/* ---------------- Firebase ---------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
  authDomain: "budget-app-1365f.firebaseapp.com",
  projectId: "budget-app-1365f",
  storageBucket: "budget-app-1365f.appspot.com",
  messagingSenderId: "1036194450411",
  appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
  measurementId: "G-YFFJL2H54X"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ---------------- API constants ---------------- */
const API = {
  SYMBOLS: "https://api.exchangerate.host/symbols",
  CONVERT: "https://api.exchangerate.host/convert",
  LATEST: "https://api.exchangerate.host/latest"
};

/* ---------------- Helpers ---------------- */
async function fetchJson(url, opts = {}, timeout = 12000) {
  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), timeout);
  try {
    const res = await fetch(url, { ...opts, signal: controller.signal });
    clearTimeout(id);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    return await res.json();
  } catch (err) {
    clearTimeout(id);
    throw err;
  }
}

/* ---------------- Tabs switching ---------------- */
document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(t.dataset.tab).classList.add('active');
  });
});

/* ---------------- Mileage with Firebase ---------------- */
async function addMileage() {
  const vehicle = document.getElementById("vehicle").value;
  const odo = parseFloat(document.getElementById("odo").value);
  const fuel = parseFloat(document.getElementById("fuel").value);
  const cost = parseFloat(document.getElementById("cost").value);
  const date = document.getElementById("mdate").value;

  if (!vehicle || isNaN(odo) || isNaN(fuel)) {
    alert("Enter valid details");
    return;
  }
  const mileage = odo / fuel;
  await addDoc(collection(db, "mileage"), {
    vehicle, odo, fuel, cost, mileage, date, createdAt: new Date()
  });
  alert("Saved in Firebase!");
  loadMileage();
}

async function loadMileage() {
  const tbody = document.querySelector("#mileage-table tbody");
  tbody.innerHTML = "";
  const snapshot = await getDocs(collection(db, "mileage"));
  snapshot.forEach(docSnap => {
    const d = docSnap.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.date || ""}</td>
      <td>${d.vehicle}</td>
      <td>${d.odo}</td>
      <td>${d.fuel}</td>
      <td>${d.cost || "-"}</td>
      <td>${d.mileage.toFixed(2)}</td>
      <td><span class="delete" onclick="deleteMileage('${docSnap.id}')">✖</span></td>`;
    tbody.appendChild(tr);
  });
}

async function deleteMileage(id) {
  await deleteDoc(doc(db, "mileage", id));
  loadMileage();
}

window.addMileage = addMileage;
window.deleteMileage = deleteMileage;

/* ---------------- Currency ---------------- */
async function loadSymbols() {
  try {
    const j = await fetchJson(API.SYMBOLS);
    if (j && j.symbols) {
      const codes = Object.keys(j.symbols).sort();
      document.getElementById("from-currency").innerHTML =
        codes.map(c => `<option value="${c}">${c}</option>`).join("");
      document.getElementById("to-currency").innerHTML =
        document.getElementById("from-currency").innerHTML;
      document.getElementById("from-currency").value = "USD";
      document.getElementById("to-currency").value = "INR";
    }
  } catch (e) {
    console.error("Failed to load symbols", e);
  }
}

async function convertCurrency() {
  const amount = parseFloat(document.getElementById("cur-amount").value);
  const from = document.getElementById("from-currency").value;
  const to = document.getElementById("to-currency").value;
  const out = document.getElementById("cur-result");
  try {
    const j = await fetchJson(`${API.CONVERT}?from=${from}&to=${to}&amount=${amount}`);
    out.innerHTML = `${amount} ${from} = <b>${j.result.toFixed(2)} ${to}</b>`;
  } catch (e) {
    out.textContent = "Conversion failed: " + e.message;
  }
}
window.convertCurrency = convertCurrency;

/* ---------------- Init ---------------- */
loadSymbols();
loadMileage();
</script>
</body>
</html>
