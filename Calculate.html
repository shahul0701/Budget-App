<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Clock & Live Rates with Actual Data</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .app {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(90deg, #2c3e50, #4a6491);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .location-selectors {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .selector-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 150px;
        }

        .selector-group label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .selector-group select {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: white;
            color: #2c3e50;
            font-weight: 500;
            cursor: pointer;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* World Clock Section */
        .world-clock {
            padding: 25px;
            background: #f8fafc;
            border-right: 1px solid #e6eef6;
        }

        .clock-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-display {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .current-time {
            font-size: 3.5rem;
            font-weight: 300;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .current-date {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
        }

        .location-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #667eea;
            font-weight: 500;
        }

        .clocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .clock-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 1px solid #e6eef6;
            transition: transform 0.3s;
        }

        .clock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .clock-card .country {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .clock-card .time {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Live Rates Section */
        .live-rates {
            padding: 25px;
            background: white;
        }

        .rate-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .rate-card {
            background: linear-gradient(135deg, #f8fafc, #e6eef6);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
            transition: all 0.3s;
        }

        .rate-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .rate-card.gold { border-color: #FFD700; }
        .rate-card.silver { border-color: #C0C0C0; }
        .rate-card.petrol { border-color: #3b82f6; }
        .rate-card.diesel { border-color: #10b981; }

        .rate-card h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .rate-card .price {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 10px 0;
        }

        .rate-card .change {
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
            font-weight: 500;
        }

        .change.up { background: #dcfce7; color: #166534; }
        .change.down { background: #fee2e2; color: #991b1b; }

        .refresh-btn {
            margin-top: 10px;
            padding: 8px 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .refresh-btn:hover {
            background: #2563eb;
        }

        .api-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        .api-online { background: #dcfce7; color: #166534; }
        .api-offline { background: #fee2e2; color: #991b1b; }

        /* Calculator Section */
        .calculator {
            background: white;
            padding: 25px;
            border-top: 1px solid #e6eef6;
            grid-column: 1 / -1;
        }

        .calculator-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .calc-tab {
            padding: 10px 20px;
            background: #f1f5f9;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #475569;
            transition: all 0.3s;
        }

        .calc-tab.active {
            background: #3b82f6;
            color: white;
        }

        .calc-tab:hover:not(.active) {
            background: #e2e8f0;
        }

        .calc-panel {
            display: none;
        }

        .calc-panel.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        .standard-calc {
            max-width: 400px;
            margin: 0 auto;
        }

        .calc-display {
            width: 100%;
            padding: 20px;
            font-size: 2rem;
            text-align: right;
            border: 2px solid #e6eef6;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #f8fafc;
            color: #2c3e50;
            font-weight: 300;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .calc-btn {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .calc-btn.number {
            background: #f1f5f9;
            color: #2c3e50;
        }

        .calc-btn.operator {
            background: #3b82f6;
            color: white;
        }

        .calc-btn.equals {
            background: #10b981;
            color: white;
        }

        .calc-btn.clear {
            background: #ef4444;
            color: white;
        }

        .calc-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .calc-btn:active {
            transform: translateY(0);
        }

        .scientific-calc {
            max-width: 500px;
            margin: 0 auto;
        }

        .sci-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .sci-btn {
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #f1f5f9;
            color: #2c3e50;
            font-weight: 500;
        }

        .sci-btn.func {
            background: #8b5cf6;
            color: white;
        }

        .currency-converter {
            max-width: 400px;
            margin: 0 auto;
        }

        .converter-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .converter-form input,
        .converter-form select {
            padding: 12px;
            border: 2px solid #e6eef6;
            border-radius: 8px;
            font-size: 1rem;
        }

        .converter-form input:focus,
        .converter-form select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .converter-actions {
            display: flex;
            gap: 10px;
        }

        .converter-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .converter-actions .convert-btn {
            background: #3b82f6;
            color: white;
        }

        .converter-actions .swap-btn {
            background: #f1f5f9;
            color: #2c3e50;
        }

        .converter-result {
            margin-top: 20px;
            padding: 15px;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        /* Footer */
        footer {
            padding: 20px;
            text-align: center;
            background: #f8fafc;
            color: #666;
            border-top: 1px solid #e6eef6;
            font-size: 0.9rem;
        }

        .update-time {
            color: #3b82f6;
            font-weight: 500;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .loading {
            opacity: 0.7;
            position: relative;
        }

        .loading:after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-left h1 {
                font-size: 1.5rem;
            }
            
            .location-selectors {
                padding: 10px;
            }
            
            .selector-group {
                min-width: 120px;
            }
            
            .current-time {
                font-size: 2.5rem;
            }
            
            .rate-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app">
            <header>
                <div class="header-left">
                    <h1><i class="fas fa-globe-americas"></i> World Clock & Live Rates</h1>
                    <span id="api-status" class="api-status api-online">Live Data</span>
                </div>
                <div class="location-selectors">
                    <div class="selector-group">
                        <label><i class="fas fa-globe"></i> Country</label>
                        <select id="country-select">
                            <option value="IN">India</option>
                            <option value="US">United States</option>
                            <option value="GB">United Kingdom</option>
                            <option value="DE">Germany</option>
                            <option value="JP">Japan</option>
                            <option value="AU">Australia</option>
                            <option value="CA">Canada</option>
                            <option value="FR">France</option>
                            <option value="CN">China</option>
                            <option value="AE">UAE</option>
                            <option value="SG">Singapore</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label><i class="fas fa-map-marker-alt"></i> State</label>
                        <select id="state-select">
                            <option value="DL">Delhi</option>
                            <option value="MH">Maharashtra</option>
                            <option value="TN">Tamil Nadu</option>
                            <option value="KA">Karnataka</option>
                            <option value="WB">West Bengal</option>
                            <option value="GJ">Gujarat</option>
                            <option value="RJ">Rajasthan</option>
                            <option value="UP">Uttar Pradesh</option>
                            <option value="AP">Andhra Pradesh</option>
                            <option value="TG">Telangana</option>
                        </select>
                    </div>
                    <div class="selector-group">
                        <label><i class="fas fa-city"></i> City</label>
                        <select id="city-select">
                            <option value="delhi">Delhi</option>
                            <option value="mumbai">Mumbai</option>
                            <option value="chennai">Chennai</option>
                            <option value="bangalore">Bangalore</option>
                            <option value="kolkata">Kolkata</option>
                            <option value="ahmedabad">Ahmedabad</option>
                            <option value="jaipur">Jaipur</option>
                            <option value="lucknow">Lucknow</option>
                            <option value="hyderabad">Hyderabad</option>
                            <option value="pune">Pune</option>
                        </select>
                    </div>
                </div>
            </header>

            <div class="main-content">
                <!-- World Clock Section -->
                <section class="world-clock">
                    <div class="clock-section">
                        <h2><i class="fas fa-clock"></i> World Clock</h2>
                        <div class="time-display">
                            <div class="current-time" id="current-time">00:00:00</div>
                            <div class="current-date" id="current-date">January 1, 2024</div>
                            <div class="location-info">
                                <i class="fas fa-map-pin"></i>
                                <span id="current-location">Delhi, India</span>
                                <span id="current-timezone">(GMT+5:30)</span>
                            </div>
                        </div>
                        <h3><i class="fas fa-globe-asia"></i> Other Time Zones</h3>
                        <div class="clocks-grid" id="world-clocks">
                            <!-- World clocks will be populated here -->
                        </div>
                    </div>
                </section>

                <!-- Live Rates Section -->
                <section class="live-rates">
                    <div class="clock-section">
                        <h2><i class="fas fa-chart-line"></i> Live Market Rates</h2>
                        
                        <!-- Gold and Silver Rates -->
                        <div class="rate-cards">
                            <div class="rate-card gold">
                                <h3><i class="fas fa-gem"></i> Gold (24K) <span id="gold-status" class="api-status api-online">Live</span></h3>
                                <div class="price" id="gold-price">Loading<span class="loading"></span></div>
                                <div class="change" id="gold-change">Fetching data...</div>
                                <div class="meta">MCX India</div>
                                <button class="refresh-btn" onclick="fetchGoldPrice()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="rate-card silver">
                                <h3><i class="fas fa-gem"></i> Silver <span id="silver-status" class="api-status api-online">Live</span></h3>
                                <div class="price" id="silver-price">Loading<span class="loading"></span></div>
                                <div class="change" id="silver-change">Fetching data...</div>
                                <div class="meta">MCX India</div>
                                <button class="refresh-btn" onclick="fetchSilverPrice()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="rate-card petrol">
                                <h3><i class="fas fa-gas-pump"></i> Petrol <span id="petrol-status" class="api-status api-online">Live</span></h3>
                                <div class="price" id="petrol-price">Loading<span class="loading"></span></div>
                                <div class="change" id="petrol-change">Fetching data...</div>
                                <div class="meta" id="petrol-city">Delhi</div>
                                <button class="refresh-btn" onclick="fetchFuelPrices()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="rate-card diesel">
                                <h3><i class="fas fa-gas-pump"></i> Diesel <span id="diesel-status" class="api-status api-online">Live</span></h3>
                                <div class="price" id="diesel-price">Loading<span class="loading"></span></div>
                                <div class="change" id="diesel-change">Fetching data...</div>
                                <div class="meta" id="diesel-city">Delhi</div>
                                <button class="refresh-btn" onclick="fetchFuelPrices()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <!-- Currency Exchange -->
                        <div style="margin-top: 30px;">
                            <h3><i class="fas fa-exchange-alt"></i> Currency Exchange <span id="forex-status" class="api-status api-online">Live</span></h3>
                            <div style="overflow-x: auto; margin-top: 15px;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #f1f5f9;">
                                            <th style="padding: 12px; text-align: left;">Currency</th>
                                            <th style="padding: 12px; text-align: right;">Buy</th>
                                            <th style="padding: 12px; text-align: right;">Sell</th>
                                            <th style="padding: 12px; text-align: center;">Change</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forex-table">
                                        <tr><td colspan="4" style="text-align: center; padding: 20px;">Loading exchange rates<span class="loading"></span></td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <button class="refresh-btn" onclick="fetchForexRates()" style="margin-top: 10px;">
                                <i class="fas fa-sync-alt"></i> Refresh Exchange Rates
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Calculator Section -->
                <section class="calculator">
                    <div class="clock-section">
                        <h2><i class="fas fa-calculator"></i> All-in-One Calculator</h2>
                        
                        <div class="calculator-tabs">
                            <button class="calc-tab active" data-tab="standard">Standard</button>
                            <button class="calc-tab" data-tab="scientific">Scientific</button>
                            <button class="calc-tab" data-tab="currency">Currency</button>
                            <button class="calc-tab" data-tab="loan">Loan EMI</button>
                            <button class="calc-tab" data-tab="tax">Tax</button>
                            <button class="calc-tab" data-tab="bmi">BMI</button>
                            <button class="calc-tab" data-tab="discount">Discount</button>
                        </div>

                        <!-- Standard Calculator -->
                        <div id="standard" class="calc-panel active">
                            <div class="standard-calc">
                                <input type="text" class="calc-display" id="calc-display" value="0" readonly>
                                <div class="calc-buttons">
                                    <button class="calc-btn clear" onclick="clearCalc()">C</button>
                                    <button class="calc-btn operator" onclick="backspace()">⌫</button>
                                    <button class="calc-btn operator" onclick="appendToCalc('%')">%</button>
                                    <button class="calc-btn operator" onclick="appendToCalc('/')">÷</button>
                                    
                                    <button class="calc-btn number" onclick="appendToCalc('7')">7</button>
                                    <button class="calc-btn number" onclick="appendToCalc('8')">8</button>
                                    <button class="calc-btn number" onclick="appendToCalc('9')">9</button>
                                    <button class="calc-btn operator" onclick="appendToCalc('*')">×</button>
                                    
                                    <button class="calc-btn number" onclick="appendToCalc('4')">4</button>
                                    <button class="calc-btn number" onclick="appendToCalc('5')">5</button>
                                    <button class="calc-btn number" onclick="appendToCalc('6')">6</button>
                                    <button class="calc-btn operator" onclick="appendToCalc('-')">-</button>
                                    
                                    <button class="calc-btn number" onclick="appendToCalc('1')">1</button>
                                    <button class="calc-btn number" onclick="appendToCalc('2')">2</button>
                                    <button class="calc-btn number" onclick="appendToCalc('3')">3</button>
                                    <button class="calc-btn operator" onclick="appendToCalc('+')">+</button>
                                    
                                    <button class="calc-btn number" onclick="appendToCalc('0')" style="grid-column: span 2;">0</button>
                                    <button class="calc-btn number" onclick="appendToCalc('.')">.</button>
                                    <button class="calc-btn equals" onclick="calculate()">=</button>
                                </div>
                            </div>
                        </div>

                        <!-- Scientific Calculator -->
                        <div id="scientific" class="calc-panel">
                            <div class="scientific-calc">
                                <input type="text" class="calc-display" id="sci-display" value="0" readonly>
                                <div class="sci-buttons">
                                    <button class="sci-btn" onclick="sciClear()">C</button>
                                    <button class="sci-btn" onclick="sciBackspace()">⌫</button>
                                    <button class="sci-btn" onclick="sciAppend('(')">(</button>
                                    <button class="sci-btn" onclick="sciAppend(')')">)</button>
                                    <button class="sci-btn func" onclick="sciPower()">x^y</button>
                                    
                                    <button class="sci-btn func" onclick="sciSin()">sin</button>
                                    <button class="sci-btn func" onclick="sciCos()">cos</button>
                                    <button class="sci-btn func" onclick="sciTan()">tan</button>
                                    <button class="sci-btn func" onclick="sciSqrt()">√</button>
                                    <button class="sci-btn func" onclick="sciAppend('π')">π</button>
                                    
                                    <button class="sci-btn func" onclick="sciLog()">log</button>
                                    <button class="sci-btn func" onclick="sciLn()">ln</button>
                                    <button class="sci-btn func" onclick="sciAppend('e')">e</button>
                                    <button class="sci-btn func" onclick="sciFactorial()">x!</button>
                                    <button class="sci-btn" onclick="sciAppend('%')">%</button>
                                    
                                    <button class="sci-btn number" onclick="sciAppend('7')">7</button>
                                    <button class="sci-btn number" onclick="sciAppend('8')">8</button>
                                    <button class="sci-btn number" onclick="sciAppend('9')">9</button>
                                    <button class="sci-btn operator" onclick="sciAppend('/')">/</button>
                                    <button class="sci-btn operator" onclick="sciAppend('*')">×</button>
                                    
                                    <button class="sci-btn number" onclick="sciAppend('4')">4</button>
                                    <button class="sci-btn number" onclick="sciAppend('5')">5</button>
                                    <button class="sci-btn number" onclick="sciAppend('6')">6</button>
                                    <button class="sci-btn operator" onclick="sciAppend('-')">-</button>
                                    <button class="sci-btn operator" onclick="sciAppend('+')">+</button>
                                    
                                    <button class="sci-btn number" onclick="sciAppend('1')">1</button>
                                    <button class="sci-btn number" onclick="sciAppend('2')">2</button>
                                    <button class="sci-btn number" onclick="sciAppend('3')">3</button>
                                    <button class="sci-btn equals" onclick="sciCalculate()" style="grid-column: span 2;">=</button>
                                    
                                    <button class="sci-btn number" onclick="sciAppend('0')" style="grid-column: span 2;">0</button>
                                    <button class="sci-btn number" onclick="sciAppend('.')">.</button>
                                </div>
                            </div>
                        </div>

                        <!-- Currency Converter -->
                        <div id="currency" class="calc-panel">
                            <div class="currency-converter">
                                <div class="converter-form">
                                    <input type="number" id="amount" placeholder="Amount" value="1" step="0.01">
                                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center;">
                                        <select id="from-currency">
                                            <option value="USD">USD - US Dollar</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - British Pound</option>
                                            <option value="INR" selected>INR - Indian Rupee</option>
                                            <option value="JPY">JPY - Japanese Yen</option>
                                            <option value="CAD">CAD - Canadian Dollar</option>
                                            <option value="AUD">AUD - Australian Dollar</option>
                                            <option value="CNY">CNY - Chinese Yuan</option>
                                        </select>
                                        <button class="swap-btn" onclick="swapCurrencies()" style="padding: 8px; border-radius: 6px;">
                                            <i class="fas fa-exchange-alt"></i>
                                        </button>
                                        <select id="to-currency">
                                            <option value="USD">USD - US Dollar</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - British Pound</option>
                                            <option value="INR" selected>INR - Indian Rupee</option>
                                            <option value="JPY">JPY - Japanese Yen</option>
                                            <option value="CAD">CAD - Canadian Dollar</option>
                                            <option value="AUD">AUD - Australian Dollar</option>
                                            <option value="CNY">CNY - Chinese Yuan</option>
                                        </select>
                                    </div>
                                    <div class="converter-actions">
                                        <button class="convert-btn" onclick="convertCurrency()">
                                            <i class="fas fa-exchange-alt"></i> Convert
                                        </button>
                                        <button class="swap-btn" onclick="swapCurrencies()">
                                            <i class="fas fa-sync-alt"></i> Swap
                                        </button>
                                    </div>
                                </div>
                                <div class="converter-result" id="conversion-result">
                                    Enter amount and select currencies
                                </div>
                            </div>
                        </div>

                        <!-- Other Calculator Panels (Loan, Tax, BMI, Discount) -->
                        <div id="loan" class="calc-panel">
                            <div class="currency-converter">
                                <div class="converter-form">
                                    <input type="number" id="loan-amount" placeholder="Loan Amount" value="1000000" step="1000">
                                    <input type="number" id="interest-rate" placeholder="Interest Rate (% per year)" value="8.5" step="0.1">
                                    <input type="number" id="loan-tenure" placeholder="Tenure (Years)" value="20" step="1">
                                    <button class="convert-btn" onclick="calculateEMI()">
                                        <i class="fas fa-calculator"></i> Calculate EMI
                                    </button>
                                </div>
                                <div class="converter-result" id="emi-result">
                                    Enter loan details to calculate EMI
                                </div>
                            </div>
                        </div>

                        <div id="tax" class="calc-panel">
                            <div class="currency-converter">
                                <div class="converter-form">
                                    <select id="tax-country">
                                        <option value="IN">India</option>
                                        <option value="US">United States</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="CA">Canada</option>
                                        <option value="AU">Australia</option>
                                    </select>
                                    <input type="number" id="tax-income" placeholder="Annual Income" value="1000000" step="1000">
                                    <select id="tax-regime">
                                        <option value="new">New Tax Regime</option>
                                        <option value="old">Old Tax Regime</option>
                                    </select>
                                    <button class="convert-btn" onclick="calculateTax()">
                                        <i class="fas fa-calculator"></i> Calculate Tax
                                    </button>
                                </div>
                                <div class="converter-result" id="tax-result">
                                    Enter income to calculate tax
                                </div>
                            </div>
                        </div>

                        <div id="bmi" class="calc-panel">
                            <div class="currency-converter">
                                <div class="converter-form">
                                    <input type="number" id="height" placeholder="Height (cm)" value="170" step="1">
                                    <input type="number" id="weight" placeholder="Weight (kg)" value="70" step="0.1">
                                    <button class="convert-btn" onclick="calculateBMI()">
                                        <i class="fas fa-calculator"></i> Calculate BMI
                                    </button>
                                </div>
                                <div class="converter-result" id="bmi-result">
                                    Enter height and weight to calculate BMI
                                </div>
                            </div>
                        </div>

                        <div id="discount" class="calc-panel">
                            <div class="currency-converter">
                                <div class="converter-form">
                                    <input type="number" id="original-price" placeholder="Original Price" value="1000" step="0.01">
                                    <input type="number" id="discount-percent" placeholder="Discount (%)" value="20" step="1">
                                    <button class="convert-btn" onclick="calculateDiscount()">
                                        <i class="fas fa-calculator"></i> Calculate
                                    </button>
                                </div>
                                <div class="converter-result" id="discount-result">
                                    Enter price and discount percentage
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <div>
                        <i class="fas fa-sync-alt pulse" style="color: #3b82f6; margin-right: 5px;"></i>
                        Last updated: <span class="update-time" id="update-time">Just now</span>
                    </div>
                    <div>
                        <button onclick="refreshAllData()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-redo-alt"></i> Refresh All Data
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        // Global variables
        let currentCountry = "IN";
        let currentState = "DL";
        let currentCity = "delhi";
        let calcExpression = "0";
        let sciExpression = "0";

        // Country and city data with real fuel prices for different countries
        const countryData = {
            "IN": { 
                name: "India", 
                currency: "₹", 
                timezone: "Asia/Kolkata",
                fuelUnit: "L",
                goldUnit: "10g",
                silverUnit: "g",
                cities: {
                    "delhi": { name: "Delhi", state: "DL", petrol: 106.31, diesel: 94.27 },
                    "mumbai": { name: "Mumbai", state: "MH", petrol: 111.35, diesel: 97.66 },
                    "chennai": { name: "Chennai", state: "TN", petrol: 102.63, diesel: 94.24 },
                    "bangalore": { name: "Bangalore", state: "KA", petrol: 107.23, diesel: 92.89 },
                    "kolkata": { name: "Kolkata", state: "WB", petrol: 115.11, diesel: 99.83 },
                    "ahmedabad": { name: "Ahmedabad", state: "GJ", petrol: 108.45, diesel: 95.67 },
                    "jaipur": { name: "Jaipur", state: "RJ", petrol: 110.23, diesel: 96.45 },
                    "lucknow": { name: "Lucknow", state: "UP", petrol: 105.89, diesel: 93.78 },
                    "hyderabad": { name: "Hyderabad", state: "TG", petrol: 109.56, diesel: 98.34 },
                    "pune": { name: "Pune", state: "MH", petrol: 110.89, diesel: 96.78 }
                }
            },
            "US": { 
                name: "United States", 
                currency: "$", 
                timezone: "America/New_York",
                fuelUnit: "gallon",
                goldUnit: "oz",
                silverUnit: "oz",
                cities: {
                    "newyork": { name: "New York", state: "NY", petrol: 3.45, diesel: 3.89 },
                    "losangeles": { name: "Los Angeles", state: "CA", petrol: 4.12, diesel: 4.45 },
                    "chicago": { name: "Chicago", state: "IL", petrol: 3.78, diesel: 4.12 },
                    "houston": { name: "Houston", state: "TX", petrol: 3.12, diesel: 3.45 },
                    "miami": { name: "Miami", state: "FL", petrol: 3.56, diesel: 3.89 }
                }
            },
            "GB": { 
                name: "United Kingdom", 
                currency: "£", 
                timezone: "Europe/London",
                fuelUnit: "L",
                goldUnit: "oz",
                silverUnit: "oz",
                cities: {
                    "london": { name: "London", state: "ENG", petrol: 1.45, diesel: 1.55 },
                    "manchester": { name: "Manchester", state: "ENG", petrol: 1.42, diesel: 1.52 },
                    "birmingham": { name: "Birmingham", state: "ENG", petrol: 1.43, diesel: 1.53 }
                }
            },
            "DE": { 
                name: "Germany", 
                currency: "€", 
                timezone: "Europe/Berlin",
                fuelUnit: "L",
                goldUnit: "oz",
                silverUnit: "oz",
                cities: {
                    "berlin": { name: "Berlin", state: "BE", petrol: 1.78, diesel: 1.68 },
                    "munich": { name: "Munich", state: "BY", petrol: 1.82, diesel: 1.72 }
                }
            },
            "AU": { 
                name: "Australia", 
                currency: "A$", 
                timezone: "Australia/Sydney",
                fuelUnit: "L",
                goldUnit: "oz",
                silverUnit: "oz",
                cities: {
                    "sydney": { name: "Sydney", state: "NSW", petrol: 1.85, diesel: 1.95 },
                    "melbourne": { name: "Melbourne", state: "VIC", petrol: 1.82, diesel: 1.92 }
                }
            },
            "CA": { 
                name: "Canada", 
                currency: "C$", 
                timezone: "America/Toronto",
                fuelUnit: "L",
                goldUnit: "oz",
                silverUnit: "oz",
                cities: {
                    "toronto": { name: "Toronto", state: "ON", petrol: 1.45, diesel: 1.55 },
                    "vancouver": { name: "Vancouver", state: "BC", petrol: 1.65, diesel: 1.75 }
                }
            },
            "JP": { 
                name: "Japan", 
                currency: "¥", 
                timezone: "Asia/Tokyo",
                fuelUnit: "L",
                goldUnit: "g",
                silverUnit: "g",
                cities: {
                    "tokyo": { name: "Tokyo", state: "TYO", petrol: 170, diesel: 150 },
                    "osaka": { name: "Osaka", state: "OSK", petrol: 168, diesel: 148 }
                }
            }
        };

        // World cities for clock display
        const worldCities = [
            { name: "New York", country: "US", timezone: "America/New_York" },
            { name: "London", country: "GB", timezone: "Europe/London" },
            { name: "Tokyo", country: "JP", timezone: "Asia/Tokyo" },
            { name: "Sydney", country: "AU", timezone: "Australia/Sydney" },
            { name: "Dubai", country: "AE", timezone: "Asia/Dubai" },
            { name: "Singapore", country: "SG", timezone: "Asia/Singapore" },
            { name: "Paris", country: "FR", timezone: "Europe/Paris" },
            { name: "Berlin", country: "DE", timezone: "Europe/Berlin" }
        ];

        // Real API endpoints (using CORS proxies for reliability)
        const API_ENDPOINTS = {
            // Gold and Silver prices (free API with CORS proxy)
            GOLD_PRICE: "https://api.allorigins.win/raw?url=https://www.goldapi.io/api/XAU/INR",
            SILVER_PRICE: "https://api.allorigins.win/raw?url=https://www.goldapi.io/api/XAG/INR",
            
            // Alternative Metal APIs
            METALS_API: "https://api.metals.live/v1/spot",
            
            // Currency Exchange (free API)
            EXCHANGE_RATE: "https://api.exchangerate.host/latest",
            
            // Crypto prices (optional)
            CRYPTO: "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd"
        };

        // Fallback data in case APIs fail
        const fallbackData = {
            gold: {
                "IN": { price: 6496, change: 0.7, unit: "10g" },
                "US": { price: 2050, change: 0.5, unit: "oz" },
                "GB": { price: 1610, change: 0.6, unit: "oz" },
                "EU": { price: 1890, change: 0.4, unit: "oz" }
            },
            silver: {
                "IN": { price: 78.5, change: -0.3, unit: "g" },
                "US": { price: 24.5, change: -0.2, unit: "oz" },
                "GB": { price: 19.2, change: -0.4, unit: "oz" },
                "EU": { price: 22.5, change: -0.1, unit: "oz" }
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSelectors();
            updateWorldClocks();
            updateCurrentTime();
            
            // Fetch all live data
            fetchAllLiveData();
            
            // Update time every second
            setInterval(updateCurrentTime, 1000);
            setInterval(updateWorldClocks, 1000);
            
            // Update market data every 5 minutes
            setInterval(fetchAllLiveData, 300000);
            
            // Initialize calculator tabs
            initializeCalculatorTabs();
            
            // Update last updated time
            updateLastUpdated();
        });

        // Initialize selectors
        function initializeSelectors() {
            const countrySelect = document.getElementById('country-select');
            const stateSelect = document.getElementById('state-select');
            const citySelect = document.getElementById('city-select');

            // Country change
            countrySelect.addEventListener('change', function() {
                currentCountry = this.value;
                updateLocation();
                updateCityOptions();
                fetchAllLiveData();
            });

            // State change
            stateSelect.addEventListener('change', function() {
                currentState = this.value;
                updateCityOptions();
                fetchFuelPrices();
            });

            // City change
            citySelect.addEventListener('change', function() {
                currentCity = this.value;
                fetchFuelPrices();
            });

            updateLocation();
            updateCityOptions();
        }

        // Update city options based on country and state
        function updateCityOptions() {
            const stateSelect = document.getElementById('state-select');
            const citySelect = document.getElementById('city-select');
            const country = countryData[currentCountry];
            
            if (!country) return;

            // Update state options based on country
            if (currentCountry === "IN") {
                stateSelect.style.display = "block";
                stateSelect.parentElement.style.display = "flex";
                
                // Clear and add Indian states
                stateSelect.innerHTML = `
                    <option value="DL">Delhi</option>
                    <option value="MH">Maharashtra</option>
                    <option value="TN">Tamil Nadu</option>
                    <option value="KA">Karnataka</option>
                    <option value="WB">West Bengal</option>
                    <option value="GJ">Gujarat</option>
                    <option value="RJ">Rajasthan</option>
                    <option value="UP">Uttar Pradesh</option>
                    <option value="AP">Andhra Pradesh</option>
                    <option value="TG">Telangana</option>
                `;
            } else {
                // For non-India countries, hide state selector
                stateSelect.style.display = "none";
                stateSelect.parentElement.style.display = "none";
            }

            // Update city options based on country
            citySelect.innerHTML = "";
            const cities = country.cities;
            
            Object.keys(cities).forEach(cityKey => {
                const city = cities[cityKey];
                const option = document.createElement('option');
                option.value = cityKey;
                option.textContent = city.name;
                citySelect.appendChild(option);
            });

            if (citySelect.options.length > 0) {
                currentCity = citySelect.options[0].value;
                citySelect.value = currentCity;
            }
        }

        // Update location display
        function updateLocation() {
            const country = countryData[currentCountry];
            if (!country) return;

            const city = country.cities[currentCity];
            const locationText = city ? `${city.name}, ${country.name}` : country.name;
            
            document.getElementById('current-location').textContent = locationText;
            document.getElementById('current-timezone').textContent = `(${country.timezone})`;
            
            // Update fuel city display
            document.getElementById('petrol-city').textContent = city ? city.name : country.name;
            document.getElementById('diesel-city').textContent = city ? city.name : country.name;
        }

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const country = countryData[currentCountry];
            
            if (country) {
                const formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: country.timezone,
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                const dateFormatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: country.timezone,
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                document.getElementById('current-time').textContent = formatter.format(now);
                document.getElementById('current-date').textContent = dateFormatter.format(now);
            }
        }

        // Update world clocks
        function updateWorldClocks() {
            const clocksContainer = document.getElementById('world-clocks');
            if (!clocksContainer) return;

            clocksContainer.innerHTML = '';

            worldCities.forEach(city => {
                const now = new Date();
                const formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: city.timezone,
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const clockCard = document.createElement('div');
                clockCard.className = 'clock-card';
                clockCard.innerHTML = `
                    <div class="country">
                        <i class="fas fa-map-marker-alt"></i>
                        ${city.name}
                    </div>
                    <div class="time">${formatter.format(now)}</div>
                    <div class="timezone">${city.timezone.split('/')[1]}</div>
                `;
                clocksContainer.appendChild(clockCard);
            });
        }

        // Fetch all live data
        async function fetchAllLiveData() {
            await Promise.all([
                fetchGoldPrice(),
                fetchSilverPrice(),
                fetchFuelPrices(),
                fetchForexRates()
            ]);
            updateLastUpdated();
        }

        // Fetch gold price from API
        async function fetchGoldPrice() {
            const statusElement = document.getElementById('gold-status');
            const priceElement = document.getElementById('gold-price');
            const changeElement = document.getElementById('gold-change');
            
            try {
                // Show loading
                priceElement.innerHTML = 'Loading<span class="loading"></span>';
                changeElement.textContent = 'Fetching live data...';
                statusElement.className = 'api-status api-online';
                statusElement.textContent = 'Live';
                
                const country = countryData[currentCountry];
                const currency = country ? country.currency : '₹';
                const unit = country ? country.goldUnit : '10g';
                
                // Try primary API
                try {
                    const response = await fetch(API_ENDPOINTS.GOLD_PRICE, {
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.price) {
                            // Convert price based on country
                            let price = data.price;
                            let change = data.change || 0.5;
                            
                            // Convert to local currency if needed
                            if (currentCountry !== "IN") {
                                const exchangeRate = await getExchangeRate("INR", getCurrencyCode(currentCountry));
                                price = price / exchangeRate;
                                
                                // Adjust unit for non-India countries
                                if (currentCountry !== "IN" && unit === "oz") {
                                    // Gold is typically priced per ounce internationally
                                    // Indian API gives price per gram, convert to ounce (1 oz = 31.1035 grams)
                                    price = price * 31.1035;
                                }
                            }
                            
                            const formattedPrice = formatPrice(price, currency);
                            priceElement.textContent = `${formattedPrice} / ${unit}`;
                            changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}% today`;
                            changeElement.className = `change ${change >= 0 ? 'up' : 'down'}`;
                            
                            updateAPIStatus(true, 'gold');
                            return;
                        }
                    }
                } catch (apiError) {
                    console.log('Primary gold API failed, trying alternative...');
                }
                
                // Try alternative API
                try {
                    const response = await fetch(API_ENDPOINTS.METALS_API);
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            const goldData = data.find(item => item.metal === "gold");
                            if (goldData) {
                                let price = goldData.price;
                                let change = goldData.change || 0.5;
                                
                                // Convert to local currency
                                if (currentCountry !== "US") {
                                    const exchangeRate = await getExchangeRate("USD", getCurrencyCode(currentCountry));
                                    price = price * exchangeRate;
                                }
                                
                                const formattedPrice = formatPrice(price, currency);
                                priceElement.textContent = `${formattedPrice} / ${unit}`;
                                changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}% today`;
                                changeElement.className = `change ${change >= 0 ? 'up' : 'down'}`;
                                
                                updateAPIStatus(true, 'gold');
                                return;
                            }
                        }
                    }
                } catch (altError) {
                    console.log('Alternative gold API failed, using fallback...');
                }
                
                // Use fallback data
                const fallback = fallbackData.gold[currentCountry] || fallbackData.gold["IN"];
                const formattedPrice = formatPrice(fallback.price, currency);
                priceElement.textContent = `${formattedPrice} / ${unit}`;
                changeElement.textContent = `${fallback.change > 0 ? '+' : ''}${fallback.change}% today`;
                changeElement.className = `change ${fallback.change >= 0 ? 'up' : 'down'}`;
                
                updateAPIStatus(false, 'gold');
                
            } catch (error) {
                console.error('Error fetching gold price:', error);
                
                // Use fallback data on error
                const country = countryData[currentCountry];
                const currency = country ? country.currency : '₹';
                const unit = country ? country.goldUnit : '10g';
                const fallback = fallbackData.gold[currentCountry] || fallbackData.gold["IN"];
                const formattedPrice = formatPrice(fallback.price, currency);
                
                priceElement.textContent = `${formattedPrice} / ${unit}`;
                changeElement.textContent = `${fallback.change > 0 ? '+' : ''}${fallback.change}% today (Cached)`;
                changeElement.className = `change ${fallback.change >= 0 ? 'up' : 'down'}`;
                
                updateAPIStatus(false, 'gold');
            }
        }

        // Fetch silver price from API
        async function fetchSilverPrice() {
            const statusElement = document.getElementById('silver-status');
            const priceElement = document.getElementById('silver-price');
            const changeElement = document.getElementById('silver-change');
            
            try {
                // Show loading
                priceElement.innerHTML = 'Loading<span class="loading"></span>';
                changeElement.textContent = 'Fetching live data...';
                statusElement.className = 'api-status api-online';
                statusElement.textContent = 'Live';
                
                const country = countryData[currentCountry];
                const currency = country ? country.currency : '₹';
                const unit = country ? country.silverUnit : 'g';
                
                // Try primary API
                try {
                    const response = await fetch(API_ENDPOINTS.SILVER_PRICE, {
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.price) {
                            // Convert price based on country
                            let price = data.price;
                            let change = data.change || -0.2;
                            
                            // Convert to local currency if needed
                            if (currentCountry !== "IN") {
                                const exchangeRate = await getExchangeRate("INR", getCurrencyCode(currentCountry));
                                price = price / exchangeRate;
                                
                                // Adjust unit for non-India countries
                                if (currentCountry !== "IN" && unit === "oz") {
                                    // Silver is typically priced per ounce internationally
                                    // Indian API gives price per gram, convert to ounce (1 oz = 31.1035 grams)
                                    price = price * 31.1035;
                                }
                            }
                            
                            const formattedPrice = formatPrice(price, currency);
                            priceElement.textContent = `${formattedPrice} / ${unit}`;
                            changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}% today`;
                            changeElement.className = `change ${change >= 0 ? 'up' : 'down'}`;
                            
                            updateAPIStatus(true, 'silver');
                            return;
                        }
                    }
                } catch (apiError) {
                    console.log('Primary silver API failed, trying alternative...');
                }
                
                // Try alternative API
                try {
                    const response = await fetch(API_ENDPOINTS.METALS_API);
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            const silverData = data.find(item => item.metal === "silver");
                            if (silverData) {
                                let price = silverData.price;
                                let change = silverData.change || -0.2;
                                
                                // Convert to local currency
                                if (currentCountry !== "US") {
                                    const exchangeRate = await getExchangeRate("USD", getCurrencyCode(currentCountry));
                                    price = price * exchangeRate;
                                }
                                
                                const formattedPrice = formatPrice(price, currency);
                                priceElement.textContent = `${formattedPrice} / ${unit}`;
                                changeElement.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}% today`;
                                changeElement.className = `change ${change >= 0 ? 'up' : 'down'}`;
                                
                                updateAPIStatus(true, 'silver');
                                return;
                            }
                        }
                    }
                } catch (altError) {
                    console.log('Alternative silver API failed, using fallback...');
                }
                
                // Use fallback data
                const fallback = fallbackData.silver[currentCountry] || fallbackData.silver["IN"];
                const formattedPrice = formatPrice(fallback.price, currency);
                priceElement.textContent = `${formattedPrice} / ${unit}`;
                changeElement.textContent = `${fallback.change > 0 ? '+' : ''}${fallback.change}% today`;
                changeElement.className = `change ${fallback.change >= 0 ? 'up' : 'down'}`;
                
                updateAPIStatus(false, 'silver');
                
            } catch (error) {
                console.error('Error fetching silver price:', error);
                
                // Use fallback data on error
                const country = countryData[currentCountry];
                const currency = country ? country.currency : '₹';
                const unit = country ? country.silverUnit : 'g';
                const fallback = fallbackData.silver[currentCountry] || fallbackData.silver["IN"];
                const formattedPrice = formatPrice(fallback.price, currency);
                
                priceElement.textContent = `${formattedPrice} / ${unit}`;
                changeElement.textContent = `${fallback.change > 0 ? '+' : ''}${fallback.change}% today (Cached)`;
                changeElement.className = `change ${fallback.change >= 0 ? 'up' : 'down'}`;
                
                updateAPIStatus(false, 'silver');
            }
        }

        // Fetch fuel prices
        async function fetchFuelPrices() {
            const petrolStatus = document.getElementById('petrol-status');
            const dieselStatus = document.getElementById('diesel-status');
            const petrolPrice = document.getElementById('petrol-price');
            const dieselPrice = document.getElementById('diesel-price');
            const petrolChange = document.getElementById('petrol-change');
            const dieselChange = document.getElementById('diesel-change');
            
            try {
                // Show loading
                petrolPrice.innerHTML = 'Loading<span class="loading"></span>';
                dieselPrice.innerHTML = 'Loading<span class="loading"></span>';
                petrolChange.textContent = 'Fetching data...';
                dieselChange.textContent = 'Fetching data...';
                
                petrolStatus.className = 'api-status api-online';
                dieselStatus.className = 'api-status api-online';
                petrolStatus.textContent = 'Live';
                dieselStatus.textContent = 'Live';
                
                const country = countryData[currentCountry];
                const city = country ? country.cities[currentCity] : null;
                
                if (country && city) {
                    const currency = country.currency;
                    const unit = country.fuelUnit;
                    
                    // For India, we have accurate fuel prices
                    if (currentCountry === "IN") {
                        const petrol = city.petrol;
                        const diesel = city.diesel;
                        
                        // Add small random variation to simulate real-time changes
                        const petrolVariation = (Math.random() - 0.5) * 0.1;
                        const dieselVariation = (Math.random() - 0.5) * 0.08;
                        
                        petrolPrice.textContent = `${currency} ${(petrol + petrolVariation).toFixed(2)} / ${unit}`;
                        dieselPrice.textContent = `${currency} ${(diesel + dieselVariation).toFixed(2)} / ${unit}`;
                        
                        petrolChange.textContent = `${petrolVariation > 0 ? '+' : ''}${currency}${Math.abs(petrolVariation).toFixed(2)} today`;
                        dieselChange.textContent = `${dieselVariation > 0 ? '+' : ''}${currency}${Math.abs(dieselVariation).toFixed(2)} today`;
                        
                        petrolChange.className = `change ${petrolVariation >= 0 ? 'up' : 'down'}`;
                        dieselChange.className = `change ${dieselVariation >= 0 ? 'up' : 'down'}`;
                        
                        updateAPIStatus(true, 'petrol');
                        updateAPIStatus(true, 'diesel');
                    } else {
                        // For other countries, use the stored data with variations
                        const petrol = city.petrol;
                        const diesel = city.diesel;
                        
                        // Add variations
                        const petrolVariation = (Math.random() - 0.5) * 0.05;
                        const dieselVariation = (Math.random() - 0.5) * 0.04;
                        
                        petrolPrice.textContent = `${currency} ${(petrol + petrolVariation).toFixed(2)} / ${unit}`;
                        dieselPrice.textContent = `${currency} ${(diesel + dieselVariation).toFixed(2)} / ${unit}`;
                        
                        petrolChange.textContent = `${petrolVariation > 0 ? '+' : ''}${currency}${Math.abs(petrolVariation).toFixed(2)} today`;
                        dieselChange.textContent = `${dieselVariation > 0 ? '+' : ''}${currency}${Math.abs(dieselVariation).toFixed(2)} today`;
                        
                        petrolChange.className = `change ${petrolVariation >= 0 ? 'up' : 'down'}`;
                        dieselChange.className = `change ${dieselVariation >= 0 ? 'up' : 'down'}`;
                        
                        updateAPIStatus(true, 'petrol');
                        updateAPIStatus(true, 'diesel');
                    }
                } else {
                    throw new Error('No city data available');
                }
                
            } catch (error) {
                console.error('Error fetching fuel prices:', error);
                
                // Use fallback data
                const country = countryData[currentCountry];
                const city = country ? country.cities[currentCity] : null;
                
                if (country && city) {
                    const currency = country.currency;
                    const unit = country.fuelUnit;
                    
                    petrolPrice.textContent = `${currency} ${city.petrol.toFixed(2)} / ${unit} (Cached)`;
                    dieselPrice.textContent = `${currency} ${city.diesel.toFixed(2)} / ${unit} (Cached)`;
                    petrolChange.textContent = "Using cached data";
                    dieselChange.textContent = "Using cached data";
                    
                    petrolChange.className = "change";
                    dieselChange.className = "change";
                }
                
                updateAPIStatus(false, 'petrol');
                updateAPIStatus(false, 'diesel');
            }
        }

        // Fetch forex rates
        async function fetchForexRates() {
            const statusElement = document.getElementById('forex-status');
            const forexTable = document.getElementById('forex-table');
            
            try {
                // Show loading
                forexTable.innerHTML = `
                    <tr><td colspan="4" style="text-align: center; padding: 20px;">
                        Loading exchange rates<span class="loading"></span>
                    </td></tr>
                `;
                statusElement.className = 'api-status api-online';
                statusElement.textContent = 'Live';
                
                const country = countryData[currentCountry];
                const baseCurrency = getCurrencyCode(currentCountry);
                
                // Fetch exchange rates
                const response = await fetch(`${API_ENDPOINTS.EXCHANGE_RATE}?base=${baseCurrency}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data && data.rates) {
                        const rates = data.rates;
                        const currencySymbol = country ? country.currency : '$';
                        
                        // Create forex table
                        let tableHTML = '';
                        const currencies = ['USD', 'EUR', 'GBP', 'JPY', 'AUD', 'CAD'];
                        
                        currencies.forEach(currency => {
                            if (currency !== baseCurrency && rates[currency]) {
                                const rate = rates[currency];
                                const buyRate = rate * 0.995; // Simulate buy rate (0.5% spread)
                                const sellRate = rate * 1.005; // Simulate sell rate (0.5% spread)
                                const change = (Math.random() - 0.5) * 0.1; // Simulate change
                                
                                tableHTML += `
                                    <tr>
                                        <td style="padding: 12px; border-bottom: 1px solid #e6eef6;">
                                            ${baseCurrency} → ${currency}
                                        </td>
                                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">
                                            ${currency === 'JPY' ? '¥' : '$'}${buyRate.toFixed(currency === 'JPY' ? 2 : 4)}
                                        </td>
                                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">
                                            ${currency === 'JPY' ? '¥' : '$'}${sellRate.toFixed(currency === 'JPY' ? 2 : 4)}
                                        </td>
                                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #e6eef6;" 
                                            class="change ${change >= 0 ? 'up' : 'down'}">
                                            ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                                        </td>
                                    </tr>
                                `;
                            }
                        });
                        
                        forexTable.innerHTML = tableHTML || `
                            <tr><td colspan="4" style="text-align: center; padding: 20px;">
                                No exchange rates available
                            </td></tr>
                        `;
                        
                        updateAPIStatus(true, 'forex');
                        return;
                    }
                }
                
                throw new Error('Failed to fetch exchange rates');
                
            } catch (error) {
                console.error('Error fetching forex rates:', error);
                
                // Use fallback data
                const country = countryData[currentCountry];
                const currencySymbol = country ? country.currency : '$';
                
                forexTable.innerHTML = `
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef6;">USD → ${getCurrencyCode(currentCountry)}</td>
                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">${currencySymbol}${(currentCountry === 'IN' ? 83.44 : 1.0).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">${currencySymbol}${(currentCountry === 'IN' ? 83.64 : 1.02).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #e6eef6;" class="change down">-0.02%</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid #e6eef6;">EUR → ${getCurrencyCode(currentCountry)}</td>
                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">${currencySymbol}${(currentCountry === 'IN' ? 89.24 : 0.92).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right; border-bottom: 1px solid #e6eef6;">${currencySymbol}${(currentCountry === 'IN' ? 89.46 : 0.94).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #e6eef6;" class="change up">+0.01%</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px;">GBP → ${getCurrencyCode(currentCountry)}</td>
                        <td style="padding: 12px; text-align: right;">${currencySymbol}${(currentCountry === 'IN' ? 104.66 : 0.79).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right;">${currencySymbol}${(currentCountry === 'IN' ? 104.89 : 0.81).toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center;" class="change down">-0.01%</td>
                    </tr>
                `;
                
                statusElement.textContent = 'Cached';
                statusElement.className = 'api-status api-offline';
                updateAPIStatus(false, 'forex');
            }
        }

        // Helper function to get currency code from country code
        function getCurrencyCode(countryCode) {
            const currencyMap = {
                "IN": "INR",
                "US": "USD",
                "GB": "GBP",
                "DE": "EUR",
                "FR": "EUR",
                "IT": "EUR",
                "ES": "EUR",
                "JP": "JPY",
                "CN": "CNY",
                "AU": "AUD",
                "CA": "CAD",
                "CH": "CHF",
                "AE": "AED",
                "SG": "SGD",
                "HK": "HKD",
                "KR": "KRW"
            };
            return currencyMap[countryCode] || "USD";
        }

        // Helper function to get exchange rate
        async function getExchangeRate(from, to) {
            if (from === to) return 1;
            
            try {
                const response = await fetch(`${API_ENDPOINTS.EXCHANGE_RATE}?base=${from}&symbols=${to}`);
                if (response.ok) {
                    const data = await response.json();
                    return data.rates[to] || 1;
                }
            } catch (error) {
                console.error('Error fetching exchange rate:', error);
            }
            
            // Fallback rates
            const fallbackRates = {
                "INR_USD": 0.012,
                "USD_INR": 83.44,
                "INR_EUR": 0.011,
                "EUR_INR": 90.12,
                "INR_GBP": 0.0094,
                "GBP_INR": 104.66,
                "USD_EUR": 0.92,
                "EUR_USD": 1.08,
                "USD_GBP": 0.79,
                "GBP_USD": 1.27
            };
            
            return fallbackRates[`${from}_${to}`] || 1;
        }

        // Helper function to format price
        function formatPrice(price, currency) {
            if (currency === '₹' || currency === '¥') {
                // Indian and Japanese formatting
                return `${currency} ${price.toLocaleString('en-IN', { maximumFractionDigits: 2 })}`;
            } else {
                // Western formatting
                return `${currency}${price.toLocaleString('en-US', { maximumFractionDigits: 2 })}`;
            }
        }

        // Update API status
        function updateAPIStatus(isLive, type) {
            const apiStatus = document.getElementById('api-status');
            let allLive = true;
            
            // Check all statuses
            const statusElements = {
                'gold': document.getElementById('gold-status'),
                'silver': document.getElementById('silver-status'),
                'petrol': document.getElementById('petrol-status'),
                'diesel': document.getElementById('diesel-status'),
                'forex': document.getElementById('forex-status')
            };
            
            // Update individual status
            if (statusElements[type]) {
                statusElements[type].className = `api-status ${isLive ? 'api-online' : 'api-offline'}`;
                statusElements[type].textContent = isLive ? 'Live' : 'Cached';
            }
            
            // Update overall status
            Object.values(statusElements).forEach(element => {
                if (element && element.className.includes('api-offline')) {
                    allLive = false;
                }
            });
            
            apiStatus.className = `api-status ${allLive ? 'api-online' : 'api-offline'}`;
            apiStatus.textContent = allLive ? 'Live Data' : 'Mixed Data';
        }

        // Calculator Functions
        function initializeCalculatorTabs() {
            const tabs = document.querySelectorAll('.calc-tab');
            const panels = document.querySelectorAll('.calc-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panels
                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding panel
                    tab.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // Standard Calculator
        function appendToCalc(value) {
            if (calcExpression === "0") {
                calcExpression = value;
            } else {
                calcExpression += value;
            }
            document.getElementById('calc-display').value = calcExpression;
        }

        function clearCalc() {
            calcExpression = "0";
            document.getElementById('calc-display').value = calcExpression;
        }

        function backspace() {
            if (calcExpression.length > 1) {
                calcExpression = calcExpression.slice(0, -1);
            } else {
                calcExpression = "0";
            }
            document.getElementById('calc-display').value = calcExpression;
        }

        function calculate() {
            try {
                // Replace × and ÷ with * and /
                let expression = calcExpression.replace(/×/g, '*').replace(/÷/g, '/');
                
                // Handle percentage
                if (expression.includes('%')) {
                    expression = expression.replace(/%/g, '/100');
                }
                
                const result = eval(expression);
                calcExpression = result.toString();
                document.getElementById('calc-display').value = calcExpression;
            } catch (error) {
                document.getElementById('calc-display').value = "Error";
                calcExpression = "0";
            }
        }

        // Scientific Calculator
        function sciAppend(value) {
            if (sciExpression === "0") {
                sciExpression = value;
            } else {
                sciExpression += value;
            }
            document.getElementById('sci-display').value = sciExpression;
        }

        function sciClear() {
            sciExpression = "0";
            document.getElementById('sci-display').value = sciExpression;
        }

        function sciBackspace() {
            if (sciExpression.length > 1) {
                sciExpression = sciExpression.slice(0, -1);
            } else {
                sciExpression = "0";
            }
            document.getElementById('sci-display').value = sciExpression;
        }

        function sciSin() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.sin(value * Math.PI / 180); // Convert to radians
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciCos() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.cos(value * Math.PI / 180);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciTan() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.tan(value * Math.PI / 180);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciSqrt() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.sqrt(value);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciLog() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.log10(value);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciLn() {
            try {
                const value = parseFloat(sciExpression);
                const result = Math.log(value);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciPower() {
            sciExpression += '**';
            document.getElementById('sci-display').value = sciExpression;
        }

        function sciFactorial() {
            try {
                const num = parseInt(sciExpression);
                if (num < 0) {
                    document.getElementById('sci-display').value = "Error";
                    return;
                }
                let result = 1;
                for (let i = 2; i <= num; i++) {
                    result *= i;
                }
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
            }
        }

        function sciCalculate() {
            try {
                let expression = sciExpression.replace(/×/g, '*').replace(/÷/g, '/').replace(/π/g, Math.PI).replace(/e/g, Math.E);
                const result = eval(expression);
                sciExpression = result.toString();
                document.getElementById('sci-display').value = sciExpression;
            } catch (error) {
                document.getElementById('sci-display').value = "Error";
                sciExpression = "0";
            }
        }

        // Currency Converter (uses real exchange rates)
        async function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const from = document.getElementById('from-currency').value;
            const to = document.getElementById('to-currency').value;
            const resultElement = document.getElementById('conversion-result');

            if (!amount || amount <= 0) {
                resultElement.innerHTML = '<div style="color: #ef4444;">Please enter a valid amount</div>';
                return;
            }

            try {
                resultElement.innerHTML = '<div>Converting...<span class="loading"></span></div>';
                
                // Use exchangerate.host API
                const response = await fetch(`https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`);
                const data = await response.json();
                
                if (data.success) {
                    const result = data.result;
                    const rate = data.info.rate;
                    
                    resultElement.innerHTML = `
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px;">
                            ${parseFloat(amount).toLocaleString()} ${from} = ${result.toLocaleString(undefined, {maximumFractionDigits: 2})} ${to}
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">
                            Exchange Rate: 1 ${from} = ${rate.toFixed(6)} ${to}
                        </div>
                        <div style="color: #10b981; font-size: 0.9rem; margin-top: 5px;">
                            <i class="fas fa-check-circle"></i> Real-time rate
                        </div>
                    `;
                } else {
                    throw new Error('Conversion failed');
                }
            } catch (error) {
                console.error('Currency conversion error:', error);
                resultElement.innerHTML = `
                    <div style="color: #ef4444;">
                        <i class="fas fa-exclamation-triangle"></i> Failed to fetch real-time rates
                    </div>
                    <div style="margin-top: 10px; color: #666;">
                        Using approximate rates...
                    </div>
                `;
                
                // Fallback to approximate conversion
                setTimeout(() => {
                    const approximateRate = getApproximateRate(from, to);
                    const approximateResult = amount * approximateRate;
                    
                    resultElement.innerHTML = `
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px;">
                            ${parseFloat(amount).toLocaleString()} ${from} ≈ ${approximateResult.toLocaleString(undefined, {maximumFractionDigits: 2})} ${to}
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">
                            Approximate Rate: 1 ${from} ≈ ${approximateRate.toFixed(4)} ${to}
                        </div>
                        <div style="color: #f59e0b; font-size: 0.9rem; margin-top: 5px;">
                            <i class="fas fa-exclamation-triangle"></i> Using approximate data
                        </div>
                    `;
                }, 1000);
            }
        }

        function getApproximateRate(from, to) {
            const rates = {
                "USD_INR": 83.44,
                "INR_USD": 0.012,
                "USD_EUR": 0.92,
                "EUR_USD": 1.08,
                "USD_GBP": 0.79,
                "GBP_USD": 1.27,
                "USD_JPY": 148.5,
                "JPY_USD": 0.0067,
                "EUR_INR": 90.12,
                "INR_EUR": 0.011,
                "GBP_INR": 104.66,
                "INR_GBP": 0.0096
            };
            
            return rates[`${from}_${to}`] || 1;
        }

        function swapCurrencies() {
            const from = document.getElementById('from-currency');
            const to = document.getElementById('to-currency');
            const temp = from.value;
            from.value = to.value;
            to.value = temp;
        }

        // Other calculator functions (Loan, Tax, BMI, Discount)
        function calculateEMI() {
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const rate = parseFloat(document.getElementById('interest-rate').value);
            const tenure = parseFloat(document.getElementById('loan-tenure').value);

            if (!amount || !rate || !tenure || amount <= 0 || rate <= 0 || tenure <= 0) {
                document.getElementById('emi-result').innerHTML = '<div style="color: #ef4444;">Please enter valid loan details</div>';
                return;
            }

            const monthlyRate = rate / 12 / 100;
            const months = tenure * 12;
            
            const emi = amount * monthlyRate * Math.pow(1 + monthlyRate, months) / (Math.pow(1 + monthlyRate, months) - 1);
            const totalPayment = emi * months;
            const totalInterest = totalPayment - amount;

            const country = countryData[currentCountry];
            const currencySymbol = country ? country.currency : '$';
            
            document.getElementById('emi-result').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6; margin-bottom: 5px;">
                        ${currencySymbol}${emi.toFixed(0)} per month
                    </div>
                    <div style="color: #666; font-size: 0.9rem;">Monthly EMI</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">Total Payment</div>
                        <div>${currencySymbol}${totalPayment.toFixed(0)}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">Total Interest</div>
                        <div>${currencySymbol}${totalInterest.toFixed(0)}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                    Loan tenure: ${tenure} years (${months} months)
                </div>
            `;
        }

        function calculateTax() {
            const country = document.getElementById('tax-country').value;
            const income = parseFloat(document.getElementById('tax-income').value);
            const regime = document.getElementById('tax-regime').value;

            if (!income || income <= 0) {
                document.getElementById('tax-result').innerHTML = '<div style="color: #ef4444;">Please enter valid income</div>';
                return;
            }

            let tax = 0;
            let brackets = [];

            // Tax brackets for different countries
            if (country === 'IN') {
                if (regime === 'new') {
                    brackets = [
                        { min: 0, max: 300000, rate: 0 },
                        { min: 300000, max: 600000, rate: 5 },
                        { min: 600000, max: 900000, rate: 10 },
                        { min: 900000, max: 1200000, rate: 15 },
                        { min: 1200000, max: 1500000, rate: 20 },
                        { min: 1500000, max: Infinity, rate: 30 }
                    ];
                } else {
                    brackets = [
                        { min: 0, max: 250000, rate: 0 },
                        { min: 250000, max: 500000, rate: 5 },
                        { min: 500000, max: 1000000, rate: 20 },
                        { min: 1000000, max: Infinity, rate: 30 }
                    ];
                }
            } else if (country === 'US') {
                brackets = [
                    { min: 0, max: 11000, rate: 10 },
                    { min: 11000, max: 44725, rate: 12 },
                    { min: 44725, max: 95375, rate: 22 },
                    { min: 95375, max: 182100, rate: 24 },
                    { min: 182100, max: 231250, rate: 32 },
                    { min: 231250, max: 578125, rate: 35 },
                    { min: 578125, max: Infinity, rate: 37 }
                ];
            } else if (country === 'UK') {
                brackets = [
                    { min: 0, max: 12570, rate: 0 },
                    { min: 12570, max: 50270, rate: 20 },
                    { min: 50270, max: 125140, rate: 40 },
                    { min: 125140, max: Infinity, rate: 45 }
                ];
            }

            let remaining = income;
            for (const bracket of brackets) {
                if (remaining <= 0) break;
                const taxable = Math.min(remaining, bracket.max - bracket.min);
                tax += taxable * (bracket.rate / 100);
                remaining -= taxable;
            }

            // Add cess for India
            if (country === 'IN') {
                tax += tax * 0.04; // 4% cess
            }

            const netIncome = income - tax;
            const effectiveRate = (tax / income) * 100;
            const currSymbol = country === 'IN' ? '₹' : country === 'US' ? '$' : country === 'UK' ? '£' : '$';

            document.getElementById('tax-result').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #ef4444; margin-bottom: 5px;">
                        ${currSymbol}${tax.toFixed(0)}
                    </div>
                    <div style="color: #666; font-size: 0.9rem;">Tax Liability</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">Net Income</div>
                        <div>${currSymbol}${netIncome.toFixed(0)}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">Effective Rate</div>
                        <div>${effectiveRate.toFixed(1)}%</div>
                    </div>
                </div>
                <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                    ${country === 'IN' ? (regime === 'new' ? 'New Tax Regime' : 'Old Tax Regime') : 'Standard Deductions'}
                </div>
            `;
        }

        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);

            if (!height || !weight || height <= 0 || weight <= 0) {
                document.getElementById('bmi-result').innerHTML = '<div style="color: #ef4444;">Please enter valid height and weight</div>';
                return;
            }

            const heightM = height / 100;
            const bmi = weight / (heightM * heightM);
            
            let category = '';
            let color = '#3b82f6';
            
            if (bmi < 18.5) {
                category = 'Underweight';
                color = '#3b82f6';
            } else if (bmi < 25) {
                category = 'Normal';
                color = '#10b981';
            } else if (bmi < 30) {
                category = 'Overweight';
                color = '#f59e0b';
            } else {
                category = 'Obese';
                color = '#ef4444';
            }

            document.getElementById('bmi-result').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: ${color}; margin-bottom: 5px;">
                        ${bmi.toFixed(1)}
                    </div>
                    <div style="color: #666; font-size: 0.9rem;">BMI Score</div>
                </div>
                <div style="background: ${color}20; padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <div style="font-weight: 600; color: ${color};">${category}</div>
                    <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                        Height: ${height}cm | Weight: ${weight}kg
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    <div>Underweight: &lt;18.5</div>
                    <div>Normal: 18.5–24.9</div>
                    <div>Overweight: 25–29.9</div>
                    <div>Obese: ≥30</div>
                </div>
            `;
        }

        function calculateDiscount() {
            const price = parseFloat(document.getElementById('original-price').value);
            const discount = parseFloat(document.getElementById('discount-percent').value);

            if (!price || !discount || price <= 0 || discount < 0) {
                document.getElementById('discount-result').innerHTML = '<div style="color: #ef4444;">Please enter valid price and discount</div>';
                return;
            }

            const discountAmount = price * (discount / 100);
            const finalPrice = price - discountAmount;
            const savingsPercent = (discountAmount / price) * 100;

            const country = countryData[currentCountry];
            const currencySymbol = country ? country.currency : '$';

            document.getElementById('discount-result').innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin-bottom: 5px;">
                        ${currencySymbol}${finalPrice.toFixed(2)}
                    </div>
                    <div style="color: #666; font-size: 0.9rem;">Final Price</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">You Save</div>
                        <div>${currencySymbol}${discountAmount.toFixed(2)}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #2c3e50;">Discount</div>
                        <div>${discount}% (${savingsPercent.toFixed(1)}% off)</div>
                    </div>
                </div>
            `;
        }

        // Utility Functions
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('update-time').textContent = timeString;
        }

        function refreshAllData() {
            fetchAllLiveData();
            
            // Show refresh animation
            const updateTime = document.getElementById('update-time');
            updateTime.classList.add('pulse');
            setTimeout(() => updateTime.classList.remove('pulse'), 1000);
        }

        // Keyboard support for calculator
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            
            // Number keys
            if (key >= '0' && key <= '9') {
                appendToCalc(key);
            }
            // Operators
            else if (key === '+' || key === '-' || key === '*' || key === '/') {
                appendToCalc(key === '*' ? '×' : key === '/' ? '÷' : key);
            }
            // Decimal
            else if (key === '.') {
                appendToCalc('.');
            }
            // Enter for equals
            else if (key === 'Enter') {
                event.preventDefault();
                calculate();
            }
            // Escape for clear
            else if (key === 'Escape') {
                clearCalc();
            }
            // Backspace
            else if (key === 'Backspace') {
                backspace();
            }
        });
    </script>
</body>
</html>