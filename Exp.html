<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #eef2f5; margin:0; padding:0; }
    .header { background:#fff; padding:12px 20px; display:flex; justify-content:space-between;
      align-items:center; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .header-left a { text-decoration:none; color:#007bff; font-weight:bold; font-size:18px; }
    .header-right { display:flex; align-items:center; gap:12px; }
    #userInitials { background:#007bff; color:#fff; border-radius:50%; width:32px; height:32px;
      display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:18px; }
    #username { font-weight:bold; font-size:16px; }
    button#logoutBtn { background:#dc3545; color:#fff; border:none; border-radius:4px;
      padding:6px 12px; cursor:pointer; }
    button#logoutBtn:hover { background:#a71d2a; }

    .container { max-width:1200px; margin:30px auto; background:#fff; padding:20px 30px 60px;
      border-radius:8px; box-shadow:0 0 12px rgba(0,0,0,0.1); position: relative; }

    h2 { text-align:center; margin-bottom:20px; color:#333; }

    .filter-section { margin-bottom:20px; background:#f9f9f9; padding:15px 20px;
      border-radius:8px; box-shadow:0 0 6px rgba(0,0,0,0.1); }
    .filters-row { display:flex; flex-wrap:wrap; gap:15px; align-items:center; }
    .filters-row label { font-size:14px; display:flex; flex-direction:column; min-width:140px; }
    .filters-row select, .filters-row input { margin-top:5px; padding:5px 8px; font-size:14px;
      border-radius:4px; border:1px solid #ccc; }
    #applyFiltersBtn { background:#007bff; padding:8px 16px; color:#fff; border:none;
      border-radius:5px; cursor:pointer; margin-top:10px; }
    #applyFiltersBtn:hover { background:#0056b3; }

    table { width:100%; border-collapse:collapse; font-size:14px; margin-bottom:20px; }
    th, td { border:1px solid #ccc; padding:8px 10px; text-align:left; }
    th { background:#007bff; color:#fff; }
    tbody tr:nth-child(even) { background:#f3f8fc; }
    tbody tr:hover { background:#ddeffb; }

    .attachment-cell a { color:#007bff; text-decoration:none; }
    .attachment-cell a:hover { text-decoration:underline; }

    .pagination { text-align:center; margin-top:10px; }
    .pagination button { margin:0 3px; padding:6px 10px; border:none;
      background:#007bff; color:#fff; border-radius:4px; cursor:pointer; }
    .pagination button.disabled { background:#aaa; cursor:not-allowed; }
    .pagination button.active { background:#0056b3; }

    #addTransactionBtn {
      position: fixed; bottom:30px; right:30px; background:#28a745; color:white;
      border:none; border-radius:50%; width:60px; height:60px; font-size:32px;
      cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.3); display:flex;
      align-items:center; justify-content:center; z-index:1000;
    }
    #addTransactionBtn:hover { background:#218838; }

    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1001; }
    .modal-content { background:white; padding:20px; border-radius:8px; width:90%;
      max-width:450px; display:flex; flex-direction:column; gap:10px; position:relative; }
    .modal-content label { font-size:14px; display:flex; flex-direction:column; }
    .modal-content input { padding:6px; border:1px solid #ccc; border-radius:4px; }
    .modal-content button { background:#007bff; color:white; padding:8px;
      border:none; border-radius:4px; font-size:16px; cursor:pointer; }
    .modal-content button:hover { background:#0056b3; }
    .close { position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; }

    /* Loading Modal */
    #loadingModal {
      display: none;
      position: fixed;
      top:0; left:0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
      z-index: 1100;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      flex-direction: column;
    }
    #loadingModal i.fa-spinner {
      font-size: 48px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-left"><a href="home.html"><i class="fa fa-home"></i> Home</a></div>
    <div class="header-right">
      <div id="userInitials">U</div>
      <div id="username">User</div>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="container">
    <h2><i class="fa fa-money-bill-wave"></i> Expense Tracker</h2>
    <input type="file" id="csvInput" accept=".csv" />

    <div class="filter-section">
      <div class="filters-row">
        <label>Date Filter:
          <select id="dateFilter">
            <option value="all">All</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="year">This Year</option>
            <option value="custom">Custom Range</option>
          </select>
        </label>
        <label id="customDateRange" style="display:none; flex-wrap: nowrap; align-items: center;">
          From:
          <input type="date" id="startDate" style="margin-left:5px; margin-right:10px;" />
          To:
          <input type="date" id="endDate" style="margin-left:5px;" />
        </label>
        <label>Income/Expense:
          <select id="incomeExpenseFilter">
            <option value="all">All</option>
            <option value="income">Income Only</option>
            <option value="expense">Expense Only</option>
          </select>
        </label>
        <label>Description contains:
          <input type="text" id="descFilter" placeholder="Searchâ€¦" />
        </label>
        <label>Mode:
          <select id="modeFilter"><option value="all">All</option></select>
        </label>
        <label>Bank:
          <select id="bankFilter"><option value="all">All</option></select>
        </label>
        <button id="applyFiltersBtn">Apply Filters</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>SINO</th><th>DATE</th><th>TIME</th><th>ACCOUNT HEADER</th><th>MODE</th>
          <th>BANK NAME</th><th>INCOME</th><th>EXPENSE</th><th>DESCRIPTION</th>
          <th>BALANCE</th><th>ATTACHMENT</th><th>ACTION</th>
        </tr>
      </thead>
      <tbody id="transactionsTableBody">
        <tr><td colspan="12" style="text-align:center; color:#777;">No transactions loaded.</td></tr>
      </tbody>
    </table>

    <div class="pagination" id="pagination"></div>
  </div>

  <button id="addTransactionBtn" title="Add Transaction"><i class="fa fa-plus"></i></button>

  <div id="transactionModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3 id="modalTitle">Add Transaction</h3>
      <form id="transactionForm">
        <input type="hidden" id="txId" />
        <label>SINO: <input type="text" id="formSINO" required /></label>
        <label>DATE: <input type="date" id="formDATE" required /></label>
        <label>TIME: <input type="time" id="formTIME" required /></label>
        <label>ACCOUNT HEADER: <input type="text" id="formAccountHeader" required /></label>
        <label>MODE: <input type="text" id="formMode" required /></label>
        <label>BANK NAME: <input type="text" id="formBankName" required /></label>
        <label>INCOME: <input type="number" id="formIncome" min="0" step="0.01" value="0" /></label>
        <label>EXPENSE: <input type="number" id="formExpense" min="0" step="0.01" value="0" /></label>
        <label>DESCRIPTION: <input type="text" id="formDescription" required /></label>
        <label>BALANCE: <input type="number" id="formBalance" readonly /></label>
        <label>ATTACHMENT URL: <input type="url" id="formAttachment" placeholder="https://example.com" /></label>
        <button type="submit">Save Transaction</button>
      </form>
    </div>
  </div>

  <div id="loadingModal">
    <i class="fas fa-spinner fa-spin"></i>
    <div>Loading, please wait...</div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config - replace with your config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const currentUserEmail = "user@example.com"; // Example, replace with actual auth email
    const transactionsCollection = db.collection('transactions');

    // Elements
    const csvInput = document.getElementById('csvInput');
    const tbody = document.getElementById('transactionsTableBody');
    const paginationDiv = document.getElementById('pagination');

    const dateFilterSelect = document.getElementById('dateFilter');
    const customDateRangeLabel = document.getElementById('customDateRange');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    const incomeExpenseFilter = document.getElementById('incomeExpenseFilter');
    const descFilterInput = document.getElementById('descFilter');
    const modeFilterSelect = document.getElementById('modeFilter');
    const bankFilterSelect = document.getElementById('bankFilter');
    const applyFiltersBtn = document.getElementById('applyFiltersBtn');

    const addTransactionBtn = document.getElementById('addTransactionBtn');
    const transactionModal = document.getElementById('transactionModal');
    const modalCloseBtn = transactionModal.querySelector('.close');
    const transactionForm = document.getElementById('transactionForm');
    const modalTitle = document.getElementById('modalTitle');

    const userInitialsDiv = document.getElementById('userInitials');
    const usernameDiv = document.getElementById('username');
    const logoutBtn = document.getElementById('logoutBtn');

    const loadingModal = document.getElementById('loadingModal');

    let allTransactions = [];
    let filteredTransactions = [];
    let currentPage = 1;
    const pageSize = 10;

    // Helper: parse CSV robustly
    function parseCSV(text) {
      // Simple CSV parse assuming no quoted commas
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(',').map(h => h.trim());
      const rows = lines.slice(1).map(line => {
        // Handle commas inside quotes
        const values = [];
        let current = '';
        let inQuotes = false;
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"' && (i === 0 || line[i-1] !== '\\')) inQuotes = !inQuotes;
          else if (char === ',' && !inQuotes) {
            values.push(current.trim().replace(/^"|"$/g, ''));
            current = '';
          } else current += char;
        }
        values.push(current.trim().replace(/^"|"$/g, ''));
        const obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || '');
        return obj;
      });
      return rows;
    }

    function getInitials(name) {
      if (!name) return 'U';
      const parts = name.trim().split(' ');
      if (parts.length === 1) return parts[0][0].toUpperCase();
      return (parts[0][0] + parts[1][0]).toUpperCase();
    }

    // Update header user info
    function updateUserHeader() {
      const email = currentUserEmail;
      const initials = getInitials(email.split('@')[0]);
      userInitialsDiv.textContent = initials;
      usernameDiv.textContent = email;
    }

    // Calculate balance for transaction list
    function calculateBalances(transactions) {
      let balance = 0;
      transactions.forEach(tx => {
        const income = parseFloat(tx.INCOME) || 0;
        const expense = parseFloat(tx.EXPENSE) || 0;
        balance += income - expense;
        tx.BALANCE = balance.toFixed(2);
      });
    }

    // Populate Mode and Bank filters options
    function populateModeBankFilters() {
      const modes = new Set();
      const banks = new Set();
      allTransactions.forEach(tx => {
        if (tx.MODE) modes.add(tx.MODE);
        if (tx['BANK NAME']) banks.add(tx['BANK NAME']);
      });

      modeFilterSelect.innerHTML = '<option value="all">All</option>' + 
        [...modes].sort().map(m => `<option value="${m}">${m}</option>`).join('');
      bankFilterSelect.innerHTML = '<option value="all">All</option>' + 
        [...banks].sort().map(b => `<option value="${b}">${b}</option>`).join('');
    }

    // Show loading
    function showLoading() {
      loadingModal.style.display = 'flex';
    }
    // Hide loading
    function hideLoading() {
      loadingModal.style.display = 'none';
    }

    // Load CSV and store in Firestore
    csvInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      if (!file.name.toLowerCase().endsWith('.csv')) {
        alert('Please upload a CSV file.');
        return;
      }
      showLoading();
      const reader = new FileReader();
      reader.onload = async function(event) {
        try {
          const text = event.target.result;
          const rows = parseCSV(text);
          if (rows.length === 0) {
            alert('CSV file is empty or invalid.');
            hideLoading();
            return;
          }
          // Clear old user transactions
          await clearUserTransactions();
          // Add all rows to Firestore for current user
          const batch = db.batch();
          rows.forEach(row => {
            // Add userEmail field
            row.userEmail = currentUserEmail;
            // Generate ID based on SINO or random if missing
            const docId = row.SINO ? `${currentUserEmail}_${row.SINO}` : db.collection('transactions').doc().id;
            const docRef = transactionsCollection.doc(docId);
            batch.set(docRef, row);
          });
          await batch.commit();
          alert('CSV uploaded and transactions saved!');
          csvInput.value = ''; // reset input
          await loadTransactionsFromFirestore();
        } catch(err) {
          console.error(err);
          alert('Error processing CSV: ' + err.message);
        } finally {
          hideLoading();
        }
      };
      reader.readAsText(file);
    });

    // Clear user's transactions from Firestore
    async function clearUserTransactions() {
      const snapshot = await transactionsCollection.where('userEmail', '==', currentUserEmail).get();
      const batch = db.batch();
      snapshot.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    }

    // Load transactions from Firestore for current user
    async function loadTransactionsFromFirestore() {
      showLoading();
      try {
        const snapshot = await transactionsCollection.where('userEmail', '==', currentUserEmail).get();
        allTransactions = [];
        snapshot.forEach(doc => {
          allTransactions.push(doc.data());
        });
        calculateBalances(allTransactions);
        populateModeBankFilters();
        applyFilters();
      } catch(err) {
        console.error(err);
        alert('Failed to load transactions from database.');
      } finally {
        hideLoading();
      }
    }

    // Filter transactions according to filters and render
    function applyFilters() {
      const dateFilterVal = dateFilterSelect.value;
      const incomeExpenseVal = incomeExpenseFilter.value;
      const descVal = descFilterInput.value.trim().toLowerCase();
      const modeVal = modeFilterSelect.value;
      const bankVal = bankFilterSelect.value;

      // Filter by date
      const today = new Date();
      let startDate = null, endDate = null;
      switch(dateFilterVal) {
        case 'week':
          const firstDayOfWeek = new Date(today);
          firstDayOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
          startDate = new Date(firstDayOfWeek.setHours(0,0,0,0));
          endDate = new Date(today);
          break;
        case 'month':
          startDate = new Date(today.getFullYear(), today.getMonth(), 1);
          endDate = today;
          break;
        case 'year':
          startDate = new Date(today.getFullYear(), 0, 1);
          endDate = today;
          break;
        case 'custom':
          if (startDateInput.value) startDate = new Date(startDateInput.value);
          if (endDateInput.value) endDate = new Date(endDateInput.value);
          if (startDate && endDate) {
            // Ensure startDate <= endDate
            if (startDate > endDate) {
              alert('Start date cannot be after end date.');
              return;
            }
          }
          break;
      }

      filteredTransactions = allTransactions.filter(tx => {
        const txDate = tx.DATE ? new Date(tx.DATE) : null;
        if (txDate && startDate && txDate < startDate) return false;
        if (txDate && endDate) {
          const d = new Date(txDate.getFullYear(), txDate.getMonth(), txDate.getDate(), 23,59,59);
          if (d > endDate) return false;
        }
        if (incomeExpenseVal === 'income' && !(parseFloat(tx.INCOME) > 0)) return false;
        if (incomeExpenseVal === 'expense' && !(parseFloat(tx.EXPENSE) > 0)) return false;
        if (descVal && !(tx.DESCRIPTION && tx.DESCRIPTION.toLowerCase().includes(descVal))) return false;
        if (modeVal !== 'all' && tx.MODE !== modeVal) return false;
        if (bankVal !== 'all' && tx['BANK NAME'] !== bankVal) return false;
        return true;
      });

      currentPage = 1;
      renderTable();
      renderPagination();
    }

    // Render transactions table
    function renderTable() {
      tbody.innerHTML = '';
      if (filteredTransactions.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" style="text-align:center; color:#777;">No transactions found.</td></tr>';
        return;
      }

      // Calculate page slice
      const startIdx = (currentPage - 1) * pageSize;
      const endIdx = Math.min(startIdx + pageSize, filteredTransactions.length);
      const pageTransactions = filteredTransactions.slice(startIdx, endIdx);

      pageTransactions.forEach((tx, idx) => {
        const row = document.createElement('tr');

        // Fields:
        // SINO, DATE, TIME, ACCOUNT HEADER, MODE, BANK NAME, INCOME, EXPENSE, DESCRIPTION, BALANCE, ATTACHMENT, ACTION
        row.innerHTML = `
          <td>${tx.SINO || ''}</td>
          <td>${tx.DATE || ''}</td>
          <td>${tx.TIME || ''}</td>
          <td>${tx['ACCOUNT HEADER'] || ''}</td>
          <td>${tx.MODE || ''}</td>
          <td>${tx['BANK NAME'] || ''}</td>
          <td>${tx.INCOME || ''}</td>
          <td>${tx.EXPENSE || ''}</td>
          <td>${tx.DESCRIPTION || ''}</td>
          <td>${tx.BALANCE || ''}</td>
          <td class="attachment-cell">${tx.ATTACHMENT ? `<a href="${tx.ATTACHMENT}" target="_blank" rel="noopener noreferrer"><i class="fa fa-paperclip"></i></a>` : ''}</td>
          <td>
            <button class="editBtn" data-sino="${tx.SINO || ''}">Edit</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Attach edit event handlers
      tbody.querySelectorAll('.editBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          const sino = btn.getAttribute('data-sino');
          openEditModal(sino);
        });
      });
    }

    // Render pagination controls
    function renderPagination() {
      paginationDiv.innerHTML = '';
      const totalPages = Math.ceil(filteredTransactions.length / pageSize);
      if (totalPages <= 1) return;

      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'Prev';
      prevBtn.disabled = currentPage === 1;
      prevBtn.classList.toggle('disabled', currentPage === 1);
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
          renderPagination();
        }
      });
      paginationDiv.appendChild(prevBtn);

      // Show few pages
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
          const pageBtn = document.createElement('button');
          pageBtn.textContent = i;
          pageBtn.classList.toggle('active', i === currentPage);
          pageBtn.addEventListener('click', () => {
            currentPage = i;
            renderTable();
            renderPagination();
          });
          paginationDiv.appendChild(pageBtn);
        } else if (i === currentPage - 3 || i === currentPage + 3) {
          const dots = document.createElement('span');
          dots.textContent = '...';
          dots.style.margin = '0 5px';
          paginationDiv.appendChild(dots);
        }
      }

      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'Next';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.classList.toggle('disabled', currentPage === totalPages);
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable();
          renderPagination();
        }
      });
      paginationDiv.appendChild(nextBtn);
    }

    // Modal open for new or edit
    function openEditModal(sino) {
      modalTitle.textContent = sino ? 'Edit Transaction' : 'Add Transaction';
      transactionForm.reset();
      document.getElementById('formBalance').value = '';
      document.getElementById('txId').value = '';

      if (sino) {
        const tx = allTransactions.find(t => t.SINO === sino);
        if (!tx) {
          alert('Transaction not found.');
          return;
        }
        document.getElementById('txId').value = sino;
        document.getElementById('formSINO').value = tx.SINO || '';
        document.getElementById('formDATE').value = tx.DATE || '';
        document.getElementById('formTIME').value = tx.TIME || '';
        document.getElementById('formAccountHeader').value = tx['ACCOUNT HEADER'] || '';
        document.getElementById('formMode').value = tx.MODE || '';
        document.getElementById('formBankName').value = tx['BANK NAME'] || '';
        document.getElementById('formIncome').value = tx.INCOME || '0';
        document.getElementById('formExpense').value = tx.EXPENSE || '0';
        document.getElementById('formDescription').value = tx.DESCRIPTION || '';
        document.getElementById('formBalance').value = tx.BALANCE || '0';
        document.getElementById('formAttachment').value = tx.ATTACHMENT || '';
      }
      transactionModal.style.display = 'flex';
    }

    // Close modal
    modalCloseBtn.addEventListener('click', () => {
      transactionModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target === transactionModal) {
        transactionModal.style.display = 'none';
      }
    });

    // Save transaction form submit
    transactionForm.addEventListener('submit', async e => {
      e.preventDefault();
      const sino = document.getElementById('formSINO').value.trim();
      if (!sino) {
        alert('SINO is required.');
        return;
      }
      const newTx = {
        SINO: sino,
        DATE: document.getElementById('formDATE').value,
        TIME: document.getElementById('formTIME').value,
        'ACCOUNT HEADER': document.getElementById('formAccountHeader').value.trim(),
        MODE: document.getElementById('formMode').value.trim(),
        'BANK NAME': document.getElementById('formBankName').value.trim(),
        INCOME: parseFloat(document.getElementById('formIncome').value) || 0,
        EXPENSE: parseFloat(document.getElementById('formExpense').value) || 0,
        DESCRIPTION: document.getElementById('formDescription').value.trim(),
        ATTACHMENT: document.getElementById('formAttachment').value.trim(),
        userEmail: currentUserEmail
      };

      try {
        showLoading();
        // Update or add
        const docRef = transactionsCollection.doc(`${currentUserEmail}_${sino}`);
        await docRef.set(newTx);

        // Update local data and recalc balances
        const idx = allTransactions.findIndex(t => t.SINO === sino);
        if (idx >= 0) allTransactions[idx] = newTx;
        else allTransactions.push(newTx);
        calculateBalances(allTransactions);
        applyFilters();

        transactionModal.style.display = 'none';
      } catch(err) {
        alert('Failed to save transaction: ' + err.message);
      } finally {
        hideLoading();
      }
    });

    // Recalculate balance on income/expense change
    function recalcBalance() {
      const income = parseFloat(document.getElementById('formIncome').value) || 0;
      const expense = parseFloat(document.getElementById('formExpense').value) || 0;
      // For simplicity, show income - expense here (not cumulative)
      document.getElementById('formBalance').value = (income - expense).toFixed(2);
    }

    document.getElementById('formIncome').addEventListener('input', recalcBalance);
    document.getElementById('formExpense').addEventListener('input', recalcBalance);

    // Filters UI logic
    dateFilterSelect.addEventListener('change', () => {
      customDateRangeLabel.style.display = dateFilterSelect.value === 'custom' ? 'inline-block' : 'none';
    });

    applyFiltersBtn.addEventListener('click', () => {
      applyFilters();
    });

    // Add Transaction button
    addTransactionBtn.addEventListener('click', () => {
      openEditModal(null);
    });

    // Logout button
    logoutBtn.addEventListener('click', () => {
      // For example purposes just reload, replace with actual auth logout
      location.reload();
    });

    // Init
    updateUserHeader();
    loadTransactionsFromFirestore();

  </script>
</body>
</html>
