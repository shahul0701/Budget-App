<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #user-info { margin-bottom: 20px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
  .pagination { margin-top: 10px; text-align: center; }
  .pagination button { margin: 0 5px; padding: 5px 10px; }
</style>
</head>
<body>

<div id="user-info">
  User: <span id="user-name">Loading...</span> | 
  Date: <span id="date"></span> | 
  Time: <span id="time"></span>
</div>

<table id="data-table">
  <thead>
    <tr>
      <th>SINO</th>
      <th>DATE</th>
      <th>TIME</th>
      <th>ACCOUNT HEADER</th>
      <th>MODE</th>
      <th>BANK NAME</th>
      <th>INCOME</th>
      <th>EXPENSES</th>
      <th>DESCRIPTION</th>
      <th>BALANCE</th>
      <th>ATTACHMENT</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination" id="pagination-controls"></div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  // Firebase config from you
  const firebaseConfig = {
    apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
    authDomain: "budget-app-1365f.firebaseapp.com",
    projectId: "budget-app-1365f",
    storageBucket: "budget-app-1365f.appspot.com",
    messagingSenderId: "1036194450411",
    appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
    measurementId: "G-YFFJL2H54X"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Dummy session user (replace with your real session retrieval)
  // For demo: Save user in sessionStorage: sessionStorage.setItem('user', 'JohnDoe');
  const userName = sessionStorage.getItem('user') || 'Guest User';

  document.getElementById('user-name').textContent = userName;

  // Live Date & Time
  function updateDateTime() {
    const now = new Date();
    document.getElementById('date').textContent = now.toLocaleDateString();
    document.getElementById('time').textContent = now.toLocaleTimeString();
  }
  updateDateTime();
  setInterval(updateDateTime, 1000);

  // Table and Pagination Setup
  const tbody = document.querySelector('#data-table tbody');
  const paginationControls = document.getElementById('pagination-controls');
  const rowsPerPage = 5;  // Adjust as needed
  let currentPage = 1;
  let records = [];

  // Load data from Firestore collection called 'transactions' (change if your collection name differs)
  async function loadData() {
    try {
      const q = query(collection(db, "transactions"), orderBy("date", "desc"));
      const querySnapshot = await getDocs(q);
      records = querySnapshot.docs.map((doc, i) => {
        const data = doc.data();
        return {
          id: doc.id,
          SINO: i + 1,
          DATE: data.date || '',
          TIME: data.time || '',
          ACCOUNT_HEADER: data.accountHeader || '',
          MODE: data.mode || '',
          BANK_NAME: data.bankName || '',
          INCOME: data.income || 0,
          EXPENSES: data.expenses || 0,
          DESCRIPTION: data.description || '',
          BALANCE: data.balance || 0,
          ATTACHMENT: data.attachment || ''
        };
      });
      renderTable();
      renderPagination();
    } catch (error) {
      console.error("Error loading data: ", error);
      tbody.innerHTML = `<tr><td colspan="11">Error loading data</td></tr>`;
    }
  }

  function renderTable() {
    tbody.innerHTML = "";
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;
    const pageRecords = records.slice(start, end);

    if (pageRecords.length === 0) {
      tbody.innerHTML = '<tr><td colspan="11">No records found</td></tr>';
      return;
    }

    for (const rec of pageRecords) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${rec.SINO}</td>
        <td>${rec.DATE}</td>
        <td>${rec.TIME}</td>
        <td>${rec.ACCOUNT_HEADER}</td>
        <td>${rec.MODE}</td>
        <td>${rec.BANK_NAME}</td>
        <td>${rec.INCOME}</td>
        <td>${rec.EXPENSES}</td>
        <td>${rec.DESCRIPTION}</td>
        <td>${rec.BALANCE}</td>
        <td>${rec.ATTACHMENT ? `<a href="${rec.ATTACHMENT}" target="_blank">View</a>` : ''}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  function renderPagination() {
    paginationControls.innerHTML = '';

    const totalPages = Math.ceil(records.length / rowsPerPage);
    if (totalPages <= 1) return; // No pagination needed

    // Previous button
    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'Prev';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
        renderPagination();
      }
    };
    paginationControls.appendChild(prevBtn);

    // Page numbers (simple display)
    for (let i = 1; i <= totalPages; i++) {
      const pageBtn = document.createElement('button');
      pageBtn.textContent = i;
      if (i === currentPage) pageBtn.disabled = true;
      pageBtn.onclick = () => {
        currentPage = i;
        renderTable();
        renderPagination();
      };
      paginationControls.appendChild(pageBtn);
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderTable();
        renderPagination();
      }
    };
    paginationControls.appendChild(nextBtn);
  }

  loadData();
</script>
</body>
</html>
