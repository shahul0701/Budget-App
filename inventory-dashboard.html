<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¯ Inventory Pro - Complete Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --success: #00b09b;
            --warning: #f46b45;
            --danger: #ff416c;
            --info: #3498db;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --purple: #9b59b6;
            --teal: #1abc9c;
            --orange: #e67e22;
            --pink: #e84393;
            --sidebar-width: 280px;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            --gradient-warning: linear-gradient(135deg, #f46b45 0%, #eea849 100%);
            --gradient-danger: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --gradient-info: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            color: var(--dark);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Background Animation */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0.1;
        }
        
        /* Toast Container */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9998;
        }
        
        .toast {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            min-width: 300px;
            transform: translateX(400px);
            animation: slideIn 0.3s forwards;
        }
        
        @keyframes slideIn {
            to { transform: translateX(0); }
        }
        
        .toast.success {
            border-left: 5px solid var(--success);
        }
        
        .toast.error {
            border-left: 5px solid var(--danger);
        }
        
        .toast.info {
            border-left: 5px solid var(--info);
        }
        
        .toast.warning {
            border-left: 5px solid var(--warning);
        }
        
        .toast i {
            font-size: 24px;
        }
        
        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--danger); }
        .toast.info i { color: var(--info); }
        .toast.warning i { color: var(--warning); }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #999;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            box-shadow: 5px 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .sidebar-header h3 {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .sidebar-header p {
            color: #666;
            font-size: 12px;
        }
        
        .sidebar-menu {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px;
            color: var(--dark);
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
            position: relative;
        }
        
        .menu-item:hover {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: var(--primary);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 5px 15px rgba(78, 84, 200, 0.3);
        }
        
        .menu-item i {
            width: 30px;
            font-size: 18px;
        }
        
        .menu-badge {
            background: var(--danger);
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: auto;
        }
        
        .menu-item.active .menu-badge {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .user-info h5 {
            margin: 0;
            font-size: 16px;
        }
        
        .user-info small {
            color: #666;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 25px;
        }
        
        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pageSubtitle {
            color: #666;
            font-size: 16px;
        }
        
        .top-actions {
            display: flex;
            gap: 15px;
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .action-btn i {
            font-size: 16px;
        }
        
        .action-btn.success {
            background: var(--gradient-success);
            color: white;
        }
        
        .action-btn.warning {
            background: var(--gradient-warning);
            color: white;
        }
        
        .action-btn.danger {
            background: var(--gradient-danger);
            color: white;
        }
        
        .action-btn.info {
            background: var(--gradient-info);
            color: white;
        }
        
        .action-btn.pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 84, 200, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(78, 84, 200, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 84, 200, 0); }
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .stat-card.success {
            border-left-color: var(--success);
        }
        
        .stat-card.warning {
            border-left-color: var(--warning);
        }
        
        .stat-card.danger {
            border-left-color: var(--danger);
        }
        
        .stat-card.info {
            border-left-color: var(--info);
        }
        
        .stat-card.purple {
            border-left-color: var(--purple);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .stat-card.success .stat-icon {
            background: var(--gradient-success);
        }
        
        .stat-card.warning .stat-icon {
            background: var(--gradient-warning);
        }
        
        .stat-card.danger .stat-icon {
            background: var(--gradient-danger);
        }
        
        .stat-card.info .stat-icon {
            background: var(--gradient-info);
        }
        
        .stat-card.purple .stat-icon {
            background: linear-gradient(135deg, var(--purple) 0%, #3498db 100%);
        }
        
        .stat-value {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--dark);
            line-height: 1;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: var(--success);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-warning);
            border-radius: 4px;
        }
        
        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .date-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tables */
        .table-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 250px;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #eee;
        }
        
        .table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-in-stock {
            background: rgba(0, 176, 155, 0.1);
            color: var(--success);
        }
        
        .status-low-stock {
            background: rgba(244, 107, 69, 0.1);
            color: var(--warning);
        }
        
        .status-out-of-stock {
            background: rgba(255, 65, 108, 0.1);
            color: var(--danger);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state i {
            font-size: 72px;
            margin-bottom: 25px;
            opacity: 0.3;
            color: var(--primary);
        }
        
        .empty-state h4 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 700;
        }
        
        .empty-state p {
            font-size: 16px;
            color: #666;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            padding: 20px;
            gap: 5px;
        }
        
        .page-item {
            padding: 10px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-item:hover {
            background: #f8f9fa;
        }
        
        .page-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Filter Controls */
        .filter-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        /* Balance Section Styles */
        .balance-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }
        
        .balance-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .balance-title i {
            background: var(--gradient-primary);
            color: white;
            padding: 12px;
            border-radius: 12px;
        }
        
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #dee2e6;
            transition: all 0.3s;
        }
        
        .balance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .balance-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #666;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .balance-card-value {
            font-size: 42px;
            font-weight: 800;
            color: var(--dark);
            line-height: 1;
            margin-bottom: 15px;
        }
        
        .balance-card-positive {
            color: var(--success);
        }
        
        .balance-card-negative {
            color: var(--danger);
        }
        
        .balance-card-neutral {
            color: var(--info);
        }
        
        .balance-card-change {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .balance-card-change.positive {
            color: var(--success);
        }
        
        .balance-card-change.negative {
            color: var(--danger);
        }
        
        .balance-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .balance-history-table {
            margin-top: 30px;
        }
        
        .transaction-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .transaction-income {
            background: rgba(0, 176, 155, 0.1);
            color: var(--success);
        }
        
        .transaction-expense {
            background: rgba(255, 65, 108, 0.1);
            color: var(--danger);
        }
        
        .transaction-transfer {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info);
        }
        
        /* Notes Section Styles */
        .notes-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }
        
        .notes-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notes-title i {
            background: var(--gradient-primary);
            color: white;
            padding: 12px;
            border-radius: 12px;
        }
        
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .note-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #dee2e6;
            transition: all 0.3s;
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .note-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .note-card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .note-card-category {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .note-card-content {
            flex: 1;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
            white-space: pre-line;
        }
        
        .note-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .note-card-date {
            font-size: 12px;
            color: #999;
        }
        
        .note-card-actions {
            display: flex;
            gap: 8px;
        }
        
        .empty-notes {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }
        
        .empty-notes i {
            font-size: 72px;
            margin-bottom: 25px;
            opacity: 0.3;
            color: var(--primary);
        }
        
        .empty-notes h4 {
            font-size: 28px;
            margin-bottom: 15px;
            color: var(--dark);
            font-weight: 700;
        }
        
        .empty-notes p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #666;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--success);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .tab {
            padding: 12px 25px;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Sale Cart */
        .sale-cart {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-price {
            color: #666;
            font-size: 14px;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-item-total {
            font-weight: bold;
            color: var(--primary);
        }
        
        .remove-from-cart {
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .color-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .color-option.selected {
            border-color: var(--primary);
        }
        
        /* Invoice Styles */
        .invoice-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }
        
        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .invoice-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #eee;
        }
        
        .invoice-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .invoice-totals {
            margin-left: auto;
            width: 300px;
        }
        
        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .invoice-total-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                margin-left: 0;
                padding-top: 100px;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 101;
                background: var(--primary);
                color: white;
                padding: 10px;
                border-radius: 8px;
                border: none;
                font-size: 20px;
                cursor: pointer;
            }
        }
        
        @media (min-width: 1201px) {
            .mobile-menu-toggle {
                display: none;
            }
        }
        
        .text-success {
            color: var(--success) !important;
        }
        
        .text-danger {
            color: var(--danger) !important;
        }
        
        .text-warning {
            color: var(--warning) !important;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <h3>Loading Inventory Pro...</h3>
        <p id="loadingMessage">Please wait while we load your data</p>
    </div>
    
    <!-- Animated Background -->
    <div class="background-animation"></div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-warehouse floating"></i> <span>INVENTORY PRO</span></h3>
            <p>Complete Management System</p>
        </div>
        
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" onclick="showDashboard()">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showInventory()">
                <i class="fas fa-boxes"></i>
                <span>Inventory</span>
                <span class="menu-badge" id="inventoryBadge">0</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showSales()">
                <i class="fas fa-shopping-cart"></i>
                <span>Sales</span>
                <span class="menu-badge" id="salesBadge">0</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showCustomers()">
                <i class="fas fa-users"></i>
                <span>Customers</span>
                <span class="menu-badge" id="customersBadge">0</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showBalance()">
                <i class="fas fa-balance-scale"></i>
                <span>Balance & Cash</span>
                <span class="menu-badge" id="balanceBadge">0</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showNotes()">
                <i class="fas fa-sticky-note"></i>
                <span>Notes</span>
                <span class="menu-badge" id="notesBadge">0</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showReports()">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
                <span class="menu-badge" id="reportsBadge">3</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showAnalytics()">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            
            <a href="#" class="menu-item" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
            
            <div style="margin-top: 50px; padding: 20px; border-top: 1px solid #eee;">
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <h5 id="userName">Loading...</h5>
                        <small id="userEmail">Loading...</small>
                    </div>
                </div>
                <a href="#" class="menu-item" onclick="logout()" style="margin-top: 15px;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <p class="pageSubtitle" id="pageSubtitle">Welcome to your inventory management system</p>
            </div>
            
            <div class="top-actions">
                <button class="action-btn pulse" onclick="openNewSaleModal()">
                    <i class="fas fa-cash-register"></i> New Sale
                </button>
                <button class="action-btn success" onclick="openNewItemModal()">
                    <i class="fas fa-plus"></i> Add Item
                </button>
                <button class="action-btn warning" onclick="openNewCustomerModal()">
                    <i class="fas fa-user-plus"></i> Add Customer
                </button>
                <button class="action-btn info" onclick="createTestData()">
                    <i class="fas fa-vial"></i> Test Data
                </button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-value" id="totalItemsStat">0</div>
                    <div class="stat-label">Total Items in Stock</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> <span id="itemsChange">0%</span> from last month
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-value" id="todaySalesStat">â‚¹0</div>
                    <div class="stat-label">Today's Sales</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> <span id="salesChange">0%</span> from yesterday
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value" id="lowStockStat">0</div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="lowStockProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card danger">
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-value" id="outOfStockStat">0</div>
                    <div class="stat-label">Out of Stock</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="outOfStockProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalCustomersStat">0</div>
                    <div class="stat-label">Total Customers</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> <span id="customersChange">0%</span> this month
                    </div>
                </div>
                
                <div class="stat-card purple">
                    <div class="stat-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-value" id="totalValueStat">â‚¹0</div>
                    <div class="stat-label">Total Inventory Value</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> <span id="valueChange">0%</span> growth
                    </div>
                </div>
                
                <div class="stat-card" style="border-left: 5px solid #e67e22;">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value" id="pendingPaymentsStat">â‚¹0</div>
                    <div class="stat-label">Pending Payments</div>
                    <div class="stat-change negative">
                        <i class="fas fa-exclamation-circle"></i> <span id="pendingChange">0</span> payments due
                    </div>
                </div>
                
                <div class="stat-card" style="border-left: 5px solid #9b59b6;">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="monthlyGrowthStat">0%</div>
                    <div class="stat-label">Monthly Growth</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Revenue increase
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-line"></i> Sales Overview</h3>
                        <div class="date-range">
                            <input type="date" class="form-control" id="salesDateFrom" style="width: 150px;">
                            <span>to</span>
                            <input type="date" class="form-control" id="salesDateTo" style="width: 150px;">
                            <button class="action-btn" onclick="updateSalesChart()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Top Selling Items</h3>
                        <select class="form-control" id="topItemsPeriod" onchange="updateTopItemsChart()" style="width: 150px;">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="topItemsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Category Distribution</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-area"></i> Monthly Performance</h3>
                        <select class="form-control" id="performanceYear" onchange="updatePerformanceChart()" style="width: 150px;">
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions & Low Stock -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <!-- Recent Sales -->
                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title"><i class="fas fa-history"></i> Recent Sales</h3>
                        <div class="table-actions">
                            <button class="action-btn" onclick="showSales()">
                                View All
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="recentSalesTable">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Low Stock Items -->
                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title"><i class="fas fa-exclamation-circle"></i> Low Stock Items</h3>
                        <button class="action-btn warning" onclick="showInventory()">
                            <i class="fas fa-box"></i> View All
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Stock</th>
                                    <th>Min</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockTable">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Pending Payments -->
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title"><i class="fas fa-clock"></i> Pending Payments</h3>
                    <button class="action-btn info" onclick="showSales()">
                        <i class="fas fa-eye"></i> View All
                    </button>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Customer</th>
                                <th>Total</th>
                                <th>Paid</th>
                                <th>Due</th>
                                <th>Due Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="pendingPaymentsTable">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i class="fas fa-check-circle"></i>
                                    <h4>No pending payments</h4>
                                    <p>All payments are cleared</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Balance & Cash Content -->
        <div id="balanceContent" style="display: none;">
            <div class="balance-section">
                <div class="balance-header">
                    <h3 class="balance-title"><i class="fas fa-balance-scale"></i> Balance & Cash Flow</h3>
                    <div class="balance-actions">
                        <button class="action-btn success" onclick="openAddTransactionModal()">
                            <i class="fas fa-plus"></i> Add Transaction
                        </button>
                        <button class="action-btn info" onclick="openTransferModal()">
                            <i class="fas fa-exchange-alt"></i> Transfer Funds
                        </button>
                        <button class="action-btn" onclick="exportBalanceReport()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="action-btn warning" onclick="printBalanceStatement()">
                            <i class="fas fa-print"></i> Print Statement
                        </button>
                    </div>
                </div>
                
                <div class="balance-grid">
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-wallet"></i> Cash in Hand
                        </div>
                        <div class="balance-card-value balance-card-positive" id="cashInHand">â‚¹0.00</div>
                        <div class="balance-card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="cashChange">0%</span> from last month
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            Available for daily operations
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-university"></i> Bank Balance
                        </div>
                        <div class="balance-card-value balance-card-neutral" id="bankBalance">â‚¹0.00</div>
                        <div class="balance-card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="bankChange">0%</span> from last month
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            Across all bank accounts
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-credit-card"></i> Credit Available
                        </div>
                        <div class="balance-card-value balance-card-positive" id="creditAvailable">â‚¹0.00</div>
                        <div class="balance-card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="creditChange">0%</span> limit used
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            Available credit from suppliers
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-hand-holding-usd"></i> Total Receivables
                        </div>
                        <div class="balance-card-value balance-card-negative" id="totalReceivables">â‚¹0.00</div>
                        <div class="balance-card-change negative">
                            <i class="fas fa-exclamation-circle"></i> <span id="receivablesCount">0</span> pending
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            Amount to be received from customers
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-file-invoice-dollar"></i> Total Payables
                        </div>
                        <div class="balance-card-value balance-card-negative" id="totalPayables">â‚¹0.00</div>
                        <div class="balance-card-change negative">
                            <i class="fas fa-exclamation-circle"></i> <span id="payablesCount">0</span> pending
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            Amount to be paid to suppliers
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-card-title">
                            <i class="fas fa-chart-line"></i> Net Profit
                        </div>
                        <div class="balance-card-value balance-card-positive" id="netProfit">â‚¹0.00</div>
                        <div class="balance-card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="profitChange">0%</span> this month
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            After all expenses and taxes
                        </div>
                    </div>
                </div>
                
                <!-- Monthly Cash Flow Chart -->
                <div class="chart-card" style="margin-top: 30px;">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-line"></i> Monthly Cash Flow</h3>
                        <select class="form-control" id="cashFlowYear" onchange="updateCashFlowChart()" style="width: 150px;">
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Transactions -->
                <div class="table-card balance-history-table">
                    <div class="table-header">
                        <h3 class="table-title"><i class="fas fa-history"></i> Recent Transactions</h3>
                        <div class="table-actions">
                            <button class="action-btn" onclick="viewAllTransactions()">
                                View All Transactions
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Type</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Balance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentTransactionsTable">
                                <tr>
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-exchange-alt"></i>
                                        <h4>No transactions yet</h4>
                                        <p>Start adding transactions to see them here</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Content -->
        <div id="notesContent" style="display: none;">
            <div class="notes-section">
                <div class="notes-header">
                    <h3 class="notes-title"><i class="fas fa-sticky-note"></i> Notes & Memos</h3>
                    <div class="notes-actions">
                        <button class="action-btn success" onclick="openNewNoteModal()">
                            <i class="fas fa-plus"></i> Add Note
                        </button>
                        <button class="action-btn info" onclick="openNoteCategoriesModal()">
                            <i class="fas fa-tags"></i> Manage Categories
                        </button>
                        <button class="action-btn" onclick="exportNotes()">
                            <i class="fas fa-download"></i> Export Notes
                        </button>
                    </div>
                </div>
                
                <!-- Notes Filter -->
                <div class="filter-controls" style="margin-bottom: 25px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-search"></i> Search Notes</label>
                            <input type="text" class="form-control" id="searchNotes" placeholder="Search in notes..." oninput="filterNotes()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-filter"></i> Category</label>
                            <select class="form-control" id="filterNoteCategory" onchange="filterNotes()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-calendar"></i> Date Range</label>
                            <select class="form-control" id="filterNoteDate" onchange="filterNotes()">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="action-btn" onclick="clearNoteFilters()">
                                <i class="fas fa-redo"></i> Clear Filters
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Notes Grid -->
                <div class="notes-grid" id="notesGrid">
                    <div class="empty-notes">
                        <i class="fas fa-sticky-note"></i>
                        <h4>No notes yet</h4>
                        <p>Create your first note to start organizing your thoughts</p>
                        <button class="action-btn success" onclick="openNewNoteModal()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Create Your First Note
                        </button>
                    </div>
                </div>
                
                <!-- Notes Statistics -->
                <div class="stats-grid" style="margin-top: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <div class="stat-value" id="totalNotesStat">0</div>
                        <div class="stat-label">Total Notes</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="notesChange">0%</span> this month
                        </div>
                    </div>
                    
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="completedNotesStat">0</div>
                        <div class="stat-label">Completed Notes</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="completedChange">0%</span> completion rate
                        </div>
                    </div>
                    
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="pendingNotesStat">0</div>
                        <div class="stat-label">Pending Notes</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="pendingNotesProgress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-value" id="noteCategoriesStat">0</div>
                        <div class="stat-label">Categories</div>
                        <div class="stat-change positive">
                            <i class="fas fa-plus"></i> <span id="categoriesChange">0</span> categories
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Content -->
        <div id="inventoryContent" style="display: none;">
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title"><i class="fas fa-boxes"></i> All Inventory Items</h3>
                    <div class="table-actions">
                        <div class="search-box">
                            <input type="text" placeholder="Search items..." id="searchInventory" oninput="updateInventoryTable(1)">
                            <i class="fas fa-search"></i>
                        </div>
                        <select class="form-control" id="filterCategory" style="width: 180px;" onchange="updateInventoryTable(1)">
                            <option value="">All Categories</option>
                        </select>
                        <select class="form-control" id="filterStatus" style="width: 150px;" onchange="updateInventoryTable(1)">
                            <option value="">All Status</option>
                            <option value="in_stock">In Stock</option>
                            <option value="low_stock">Low Stock</option>
                            <option value="out_of_stock">Out of Stock</option>
                        </select>
                        <button class="action-btn success" onclick="openNewItemModal()">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Cost</th>
                                <th>Price</th>
                                <th>Value</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <tr>
                                <td colspan="9" class="loading">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="inventoryPagination"></div>
            </div>
        </div>

        <!-- Sales Content -->
        <div id="salesContent" style="display: none;">
            <div class="tabs" id="salesTabs">
                <div class="tab active" onclick="showSalesTab('allSales')">All Sales</div>
                <div class="tab" onclick="showSalesTab('pendingSales')">Pending Payments</div>
                <div class="tab" onclick="showSalesTab('completedSales')">Completed Sales</div>
            </div>
            
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title"><i class="fas fa-shopping-cart"></i> Sales Transactions</h3>
                    <div class="table-actions">
                        <div class="filter-controls" style="margin: 0; padding: 0; background: transparent;">
                            <div class="form-row" style="margin: 0; gap: 10px;">
                                <div class="form-group" style="flex: none; width: 150px;">
                                    <input type="date" class="form-control" id="salesFilterDateFrom">
                                </div>
                                <div class="form-group" style="flex: none; width: 150px;">
                                    <input type="date" class="form-control" id="salesFilterDateTo">
                                </div>
                                <div class="form-group" style="flex: none; width: 150px;">
                                    <select class="form-control" id="salesFilterStatus">
                                        <option value="">All Status</option>
                                        <option value="paid">Paid</option>
                                        <option value="pending">Pending</option>
                                        <option value="partial">Partial</option>
                                    </select>
                                </div>
                                <button class="action-btn" onclick="loadSalesTable(1)">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <button class="action-btn success" onclick="openNewSaleModal()">
                            <i class="fas fa-plus"></i> New Sale
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Paid</th>
                                <th>Due</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTable">
                            <tr>
                                <td colspan="9" class="loading">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="salesPagination"></div>
            </div>
        </div>

        <!-- Customers Content -->
        <div id="customersContent" style="display: none;">
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title"><i class="fas fa-users"></i> All Customers</h3>
                    <div class="table-actions">
                        <div class="search-box">
                            <input type="text" placeholder="Search customers..." id="searchCustomers" oninput="updateCustomersTable(1)">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="action-btn success" onclick="openNewCustomerModal()">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Address</th>
                                <th>Total Spent</th>
                                <th>Last Purchase</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customersTable">
                            <tr>
                                <td colspan="7" class="loading">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="customersPagination"></div>
            </div>
        </div>

        <!-- Reports Content -->
        <div id="reportsContent" style="display: none;">
            <div class="tabs" id="reportTabs">
                <div class="tab active" onclick="showReportTab('salesReport')">Sales Report</div>
                <div class="tab" onclick="showReportTab('inventoryReport')">Inventory Report</div>
                <div class="tab" onclick="showReportTab('customerReport')">Customer Report</div>
                <div class="tab" onclick="showReportTab('profitLoss')">Profit & Loss</div>
            </div>
            
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title" id="reportTitle"><i class="fas fa-chart-bar"></i> Sales Report</h3>
                    <div class="table-actions">
                        <div class="form-row" style="margin: 0; gap: 10px;">
                            <div class="form-group" style="flex: none; width: 150px;">
                                <input type="date" class="form-control" id="reportDateFrom">
                            </div>
                            <div class="form-group" style="flex: none; width: 150px;">
                                <input type="date" class="form-control" id="reportDateTo">
                            </div>
                            <button class="action-btn" onclick="generateReport()">
                                <i class="fas fa-download"></i> Generate
                            </button>
                            <button class="action-btn info" onclick="printReport()">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="action-btn success" onclick="exportReport()">
                                <i class="fas fa-file-excel"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <div id="reportContent">
                        <!-- Report content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Content -->
        <div id="analyticsContent" style="display: none;">
            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-line"></i> Revenue Trend</h3>
                        <select class="form-control" id="revenuePeriod" onchange="updateRevenueChart()" style="width: 150px;">
                            <option value="monthly">Monthly</option>
                            <option value="weekly">Weekly</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Customer Segmentation</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="customerSegmentationChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Performance Metrics</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceMetricsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-area"></i> Growth Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="growthAnalysisChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-value" id="topProductStat">N/A</div>
                    <div class="stat-label">Top Product</div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-value" id="avgRatingStat">0.0</div>
                    <div class="stat-label">Average Rating</div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="growthRateStat">0%</div>
                    <div class="stat-label">Growth Rate</div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-retweet"></i>
                    </div>
                    <div class="stat-value" id="repeatRateStat">0%</div>
                    <div class="stat-label">Repeat Customer Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODALS ==================== -->

    <!-- Add Transaction Modal -->
    <div class="modal-overlay" id="addTransactionModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Add Transaction</h3>
                <button class="close-modal" onclick="closeModal('addTransactionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addTransactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-calendar"></i> Date *</label>
                            <input type="date" class="form-control" id="transactionDate" required value="">
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-rupee-sign"></i> Amount *</label>
                            <input type="number" class="form-control" id="transactionAmount" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-file-alt"></i> Description *</label>
                            <input type="text" class="form-control" id="transactionDescription" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-exchange-alt"></i> Transaction Type *</label>
                                <select class="form-control" id="transactionType" required onchange="toggleTransactionFields()">
                                    <option value="income">Income</option>
                                    <option value="expense">Expense</option>
                                    <option value="transfer">Transfer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tags"></i> Category *</label>
                                <select class="form-control" id="transactionCategory" required>
                                    <option value="sales">Sales</option>
                                    <option value="purchase">Purchase</option>
                                    <option value="salary">Salary</option>
                                    <option value="rent">Rent</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-wallet"></i> Payment Method *</label>
                                <select class="form-control" id="transactionPaymentMethod" required>
                                    <option value="cash">Cash</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="upi">UPI</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="cheque">Cheque</option>
                                </select>
                            </div>
                            <div class="form-group" id="transactionAccountGroup" style="display: none;">
                                <label class="form-label"><i class="fas fa-university"></i> Account</label>
                                <select class="form-control" id="transactionAccount">
                                    <option value="main">Main Account</option>
                                    <option value="savings">Savings Account</option>
                                    <option value="current">Current Account</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group" id="transferFields" style="display: none;">
                            <label class="form-label"><i class="fas fa-exchange-alt"></i> Transfer Details</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>From Account</label>
                                    <select class="form-control" id="transferFrom">
                                        <option value="cash">Cash</option>
                                        <option value="bank">Bank</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>To Account</label>
                                    <select class="form-control" id="transferTo">
                                        <option value="bank">Bank</option>
                                        <option value="cash">Cash</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Notes</label>
                            <textarea class="form-control" id="transactionNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group" id="attachmentSection">
                            <label class="form-label"><i class="fas fa-paperclip"></i> Attachment</label>
                            <input type="file" class="form-control" id="transactionAttachment" accept=".pdf,.jpg,.jpeg,.png">
                            <small class="text-muted">Upload receipt or document (PDF, JPG, PNG)</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('addTransactionModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="saveTransaction()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Save Transaction
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Transfer Funds Modal -->
        <div class="modal-overlay" id="transferModal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3 class="modal-title">Transfer Funds</h3>
                    <button class="close-modal" onclick="closeModal('transferModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="transferForm">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-calendar"></i> Transfer Date *</label>
                            <input type="date" class="form-control" id="transferDate" required value="">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-sign-out-alt"></i> From Account *</label>
                                <select class="form-control" id="fromAccount" required>
                                    <option value="cash">Cash</option>
                                    <option value="bank_main">Main Bank Account</option>
                                    <option value="bank_savings">Savings Account</option>
                                </select>
                                <div style="margin-top: 5px; font-size: 12px; color: #666;">
                                    Balance: <span id="fromAccountBalance">â‚¹0.00</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-sign-in-alt"></i> To Account *</label>
                                <select class="form-control" id="toAccount" required>
                                    <option value="bank_main">Main Bank Account</option>
                                    <option value="bank_savings">Savings Account</option>
                                    <option value="cash">Cash</option>
                                </select>
                                <div style="margin-top: 5px; font-size: 12px; color: #666;">
                                    Balance: <span id="toAccountBalance">â‚¹0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-rupee-sign"></i> Amount *</label>
                            <input type="number" class="form-control" id="transferAmount" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-file-alt"></i> Purpose *</label>
                            <input type="text" class="form-control" id="transferPurpose" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Reference/Notes</label>
                            <textarea class="form-control" id="transferNotes" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('transferModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="processTransfer()" style="width: 100%;">
                                    <i class="fas fa-exchange-alt"></i> Process Transfer
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- View All Transactions Modal -->
        <div class="modal-overlay" id="transactionsModal">
            <div class="modal-content" style="max-width: 1200px;">
                <div class="modal-header">
                    <h3 class="modal-title">All Transactions</h3>
                    <button class="close-modal" onclick="closeModal('transactionsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="filter-controls">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date From</label>
                                <input type="date" class="form-control" id="transactionsDateFrom">
                            </div>
                            <div class="form-group">
                                <label>Date To</label>
                                <input type="date" class="form-control" id="transactionsDateTo">
                            </div>
                            <div class="form-group">
                                <label>Type</label>
                                <select class="form-control" id="transactionsType">
                                    <option value="">All Types</option>
                                    <option value="income">Income</option>
                                    <option value="expense">Expense</option>
                                    <option value="transfer">Transfer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select class="form-control" id="transactionsCategory">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button class="action-btn" onclick="filterTransactions()">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-card">
                        <div class="table-header">
                            <h3 class="table-title"><i class="fas fa-history"></i> Transaction History</h3>
                            <div class="table-actions">
                                <button class="action-btn info" onclick="exportTransactions()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                                <button class="action-btn" onclick="printTransactionReport()">
                                    <i class="fas fa-print"></i> Print
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Type</th>
                                        <th>Category</th>
                                        <th>Payment Method</th>
                                        <th>Amount</th>
                                        <th>Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allTransactionsTable">
                                    <tr>
                                        <td colspan="8" class="loading">
                                            <div class="spinner"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="transactionsPagination"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Note Modal -->
        <div class="modal-overlay" id="newNoteModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Create New Note</h3>
                    <button class="close-modal" onclick="closeModal('newNoteModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="newNoteForm">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-heading"></i> Title *</label>
                            <input type="text" class="form-control" id="noteTitle" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tags"></i> Category *</label>
                                <select class="form-control" id="noteCategory" required>
                                    <option value="general">General</option>
                                    <option value="important">Important</option>
                                    <option value="todo">To-Do</option>
                                    <option value="idea">Idea</option>
                                    <option value="reminder">Reminder</option>
                                    <option value="meeting">Meeting Notes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-calendar"></i> Due Date</label>
                                <input type="date" class="form-control" id="noteDueDate">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Content *</label>
                            <textarea class="form-control" id="noteContent" rows="8" required></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-palette"></i> Color</label>
                                <div class="color-picker">
                                    <div class="color-option" style="background: #ffffff;" onclick="selectNoteColor('#ffffff')"></div>
                                    <div class="color-option" style="background: #f8f9fa;" onclick="selectNoteColor('#f8f9fa')"></div>
                                    <div class="color-option" style="background: #e3f2fd;" onclick="selectNoteColor('#e3f2fd')"></div>
                                    <div class="color-option" style="background: #f3e5f5;" onclick="selectNoteColor('#f3e5f5')"></div>
                                    <div class="color-option" style="background: #e8f5e9;" onclick="selectNoteColor('#e8f5e9')"></div>
                                    <div class="color-option" style="background: #fff3e0;" onclick="selectNoteColor('#fff3e0')"></div>
                                    <div class="color-option" style="background: #fce4ec;" onclick="selectNoteColor('#fce4ec')"></div>
                                </div>
                                <input type="hidden" id="noteColor" value="#ffffff">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-bell"></i> Reminder</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="datetime-local" class="form-control" id="noteReminder">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="noteReminderEnabled">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-paperclip"></i> Attachments</label>
                            <input type="file" class="form-control" id="noteAttachments" multiple>
                            <small class="text-muted">You can attach multiple files</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('newNoteModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="saveNote()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Save Note
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn info" onclick="saveNoteAsDraft()" style="width: 100%;">
                                    <i class="fas fa-file-alt"></i> Save as Draft
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- View Note Modal -->
        <div class="modal-overlay" id="viewNoteModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title" id="viewNoteTitle">Note Details</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="action-btn" onclick="editCurrentNote()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn success" onclick="markNoteComplete()">
                            <i class="fas fa-check"></i> Complete
                        </button>
                        <button class="action-btn info" onclick="printNote()">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="close-modal" onclick="closeModal('viewNoteModal')">&times;</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="noteDetails">
                        <!-- Note details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Note Categories Modal -->
        <div class="modal-overlay" id="noteCategoriesModal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3 class="modal-title">Manage Note Categories</h3>
                    <button class="close-modal" onclick="closeModal('noteCategoriesModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-plus"></i> Add New Category</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="newCategoryName" placeholder="Category name">
                            <input type="color" class="form-control" id="newCategoryColor" value="#4e54c8" style="width: 60px;">
                            <button class="action-btn success" onclick="addNoteCategory()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-card" style="margin-top: 20px;">
                        <div class="table-header">
                            <h3 class="table-title"><i class="fas fa-tags"></i> Existing Categories</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Color</th>
                                        <th>Notes Count</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="noteCategoriesTable">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Item Modal -->
        <div class="modal-overlay" id="newItemModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Item</h3>
                    <button class="close-modal" onclick="closeModal('newItemModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="newItemForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-box"></i> Item Name *</label>
                                <input type="text" class="form-control" id="itemName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-barcode"></i> SKU/Code</label>
                                <input type="text" class="form-control" id="itemSku" placeholder="Auto-generated">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tags"></i> Category *</label>
                                <select class="form-control" id="itemCategory" required onchange="updateSubCategories()">
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tag"></i> Sub-Category</label>
                                <select class="form-control" id="itemSubCategory">
                                    <option value="">Select Sub-Category</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-sort-numeric-up"></i> Current Stock *</label>
                                <input type="number" class="form-control" id="itemStock" required min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-exclamation-triangle"></i> Min Stock Alert</label>
                                <input type="number" class="form-control" id="itemMinStock" min="0" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-weight"></i> Unit</label>
                                <select class="form-control" id="itemUnit">
                                    <option value="pcs">Pieces</option>
                                    <option value="kg">Kilogram</option>
                                    <option value="g">Gram</option>
                                    <option value="l">Liter</option>
                                    <option value="ml">Milliliter</option>
                                    <option value="m">Meter</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-money-bill-wave"></i> Cost Price *</label>
                                <input type="number" class="form-control" id="itemCost" required step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tag"></i> Selling Price *</label>
                                <input type="number" class="form-control" id="itemPrice" required step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-percentage"></i> Tax Rate (%)</label>
                                <input type="number" class="form-control" id="itemTax" step="0.01" value="18">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-align-left"></i> Description</label>
                            <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-image"></i> Image URL</label>
                            <input type="text" class="form-control" id="itemImage" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('newItemModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="saveItem()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Save Item
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Item Modal -->
        <div class="modal-overlay" id="editItemModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Item</h3>
                    <button class="close-modal" onclick="closeModal('editItemModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editItemForm">
                        <input type="hidden" id="editItemId">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-box"></i> Item Name *</label>
                                <input type="text" class="form-control" id="editItemName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-barcode"></i> SKU/Code</label>
                                <input type="text" class="form-control" id="editItemSku" placeholder="Auto-generated">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tags"></i> Category *</label>
                                <select class="form-control" id="editItemCategory" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tag"></i> Sub-Category</label>
                                <select class="form-control" id="editItemSubCategory">
                                    <option value="">Select Sub-Category</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-sort-numeric-up"></i> Current Stock *</label>
                                <input type="number" class="form-control" id="editItemStock" required min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-exclamation-triangle"></i> Min Stock Alert</label>
                                <input type="number" class="form-control" id="editItemMinStock" min="0" value="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-weight"></i> Unit</label>
                                <select class="form-control" id="editItemUnit">
                                    <option value="pcs">Pieces</option>
                                    <option value="kg">Kilogram</option>
                                    <option value="g">Gram</option>
                                    <option value="l">Liter</option>
                                    <option value="ml">Milliliter</option>
                                    <option value="m">Meter</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-money-bill-wave"></i> Cost Price *</label>
                                <input type="number" class="form-control" id="editItemCost" required step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-tag"></i> Selling Price *</label>
                                <input type="number" class="form-control" id="editItemPrice" required step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-percentage"></i> Tax Rate (%)</label>
                                <input type="number" class="form-control" id="editItemTax" step="0.01" value="18">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-align-left"></i> Description</label>
                            <textarea class="form-control" id="editItemDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-image"></i> Image URL</label>
                            <input type="text" class="form-control" id="editItemImage" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('editItemModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="updateItem()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Update Item
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- New Sale Modal -->
        <div class="modal-overlay" id="newSaleModal">
            <div class="modal-content" style="max-width: 1000px;">
                <div class="modal-header">
                    <h3 class="modal-title">New Sale</h3>
                    <button class="close-modal" onclick="closeModal('newSaleModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="sale-cart" id="saleCart">
                        <h4>Shopping Cart</h4>
                        <div id="cartItems">
                            <div class="empty-state" style="padding: 20px;">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Cart is empty. Add items to start a sale.</p>
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <h4>Total: â‚¹<span id="cartTotal">0.00</span></h4>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-user"></i> Customer</label>
                            <select class="form-control" id="saleCustomer">
                                <option value="">Walk-in Customer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-calendar"></i> Sale Date</label>
                            <input type="date" class="form-control" id="saleDate" value="">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-box"></i> Add Item</label>
                            <select class="form-control" id="saleItemSelect">
                                <option value="">Select Item</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sort-numeric-up"></i> Quantity</label>
                            <input type="number" class="form-control" id="saleQuantity" value="1" min="1">
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="action-btn success" onclick="addItemToCart()">
                                <i class="fas fa-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-sticky-note"></i> Notes</label>
                        <textarea class="form-control" id="saleNotes" rows="2"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <button class="action-btn" onclick="clearCart()">
                                <i class="fas fa-trash"></i> Clear Cart
                            </button>
                        </div>
                        <div class="form-group">
                            <button class="action-btn success" onclick="processSale()">
                                <i class="fas fa-cash-register"></i> Process Sale
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Modal -->
        <div class="modal-overlay" id="paymentModal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3 class="modal-title">Record Payment</h3>
                    <button class="close-modal" onclick="closeModal('paymentModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <input type="hidden" id="paymentSaleId">
                        
                        <div class="form-group">
                            <label class="form-label">Invoice #</label>
                            <input type="text" class="form-control" id="paymentInvoice" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Total Amount</label>
                            <input type="text" class="form-control" id="paymentTotal" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Already Paid</label>
                            <input type="text" class="form-control" id="paymentPaid" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Due Amount</label>
                            <input type="text" class="form-control" id="paymentDue" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-rupee-sign"></i> Payment Amount *</label>
                            <input type="number" class="form-control" id="paymentAmount" required step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-wallet"></i> Payment Method *</label>
                            <select class="form-control" id="paymentMethod" required>
                                <option value="cash">Cash</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="upi">UPI</option>
                                <option value="card">Credit/Debit Card</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-calendar"></i> Payment Date</label>
                            <input type="date" class="form-control" id="paymentDate" value="">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Reference/Notes</label>
                            <textarea class="form-control" id="paymentNotes" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('paymentModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="savePayment()" style="width: 100%;">
                                    <i class="fas fa-check"></i> Record Payment
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Invoice Modal -->
        <div class="modal-overlay" id="invoiceModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Invoice</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="action-btn" onclick="printInvoice()">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="action-btn info" onclick="downloadInvoice()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="close-modal" onclick="closeModal('invoiceModal')">&times;</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="invoiceContent">
                        <!-- Invoice will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- New Customer Modal -->
        <div class="modal-overlay" id="newCustomerModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Add New Customer</h3>
                    <button class="close-modal" onclick="closeModal('newCustomerModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="newCustomerForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-user"></i> Customer Name *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" class="form-control" id="customerEmail">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-phone"></i> Phone *</label>
                                <input type="tel" class="form-control" id="customerPhone" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-map-marker-alt"></i> City</label>
                                <input type="text" class="form-control" id="customerCity">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-map"></i> Address</label>
                            <textarea class="form-control" id="customerAddress" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-credit-card"></i> GST Number</label>
                                <input type="text" class="form-control" id="customerGST">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-percent"></i> Discount (%)</label>
                                <input type="number" class="form-control" id="customerDiscount" step="0.01" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Notes</label>
                            <textarea class="form-control" id="customerNotes" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('newCustomerModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="saveCustomer()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Save Customer
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Customer Modal -->
        <div class="modal-overlay" id="editCustomerModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Customer</h3>
                    <button class="close-modal" onclick="closeModal('editCustomerModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editCustomerForm">
                        <input type="hidden" id="editCustomerId">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-user"></i> Customer Name *</label>
                                <input type="text" class="form-control" id="editCustomerName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" class="form-control" id="editCustomerEmail">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-phone"></i> Phone *</label>
                                <input type="tel" class="form-control" id="editCustomerPhone" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-map-marker-alt"></i> City</label>
                                <input type="text" class="form-control" id="editCustomerCity">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-map"></i> Address</label>
                            <textarea class="form-control" id="editCustomerAddress" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-credit-card"></i> GST Number</label>
                                <input type="text" class="form-control" id="editCustomerGST">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-percent"></i> Discount (%)</label>
                                <input type="number" class="form-control" id="editCustomerDiscount" step="0.01" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-sticky-note"></i> Notes</label>
                            <textarea class="form-control" id="editCustomerNotes" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('editCustomerModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="updateCustomer()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Update Customer
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Company Details Modal -->
        <div class="modal-overlay" id="companyDetailsModal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title">Company Details</h3>
                    <button class="close-modal" onclick="closeModal('companyDetailsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="companyDetailsForm">
                        <div class="form-group">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-control" id="companyName" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Address Line 1 *</label>
                            <input type="text" class="form-control" id="companyAddress1" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Address Line 2</label>
                            <input type="text" class="form-control" id="companyAddress2">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City *</label>
                                <input type="text" class="form-control" id="companyCity" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">State *</label>
                                <input type="text" class="form-control" id="companyState" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pincode *</label>
                                <input type="text" class="form-control" id="companyPincode" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Phone *</label>
                                <input type="tel" class="form-control" id="companyPhone" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" id="companyEmail" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">GST Number</label>
                                <input type="text" class="form-control" id="companyGST">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PAN Number</label>
                                <input type="text" class="form-control" id="companyPAN">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Terms & Conditions</label>
                            <textarea class="form-control" id="companyTerms" rows="4"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Footer Message</label>
                            <textarea class="form-control" id="companyFooter" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="button" class="action-btn" onclick="closeModal('companyDetailsModal')" style="width: 100%;">
                                    Cancel
                                </button>
                            </div>
                            <div class="form-group">
                                <button type="button" class="action-btn success" onclick="saveCompanyDetails()" style="width: 100%;">
                                    <i class="fas fa-save"></i> Save Details
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal">
            <div class="modal-content" style="max-width: 1000px;">
                <div class="modal-header">
                    <h3 class="modal-title">Settings</h3>
                    <button class="close-modal" onclick="closeModal('settingsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tabs" id="settingsTabs">
                        <div class="tab active" onclick="showSettingsTab('general')">General</div>
                        <div class="tab" onclick="showSettingsTab('notifications')">Notifications</div>
                        <div class="tab" onclick="showSettingsTab('invoice')">Invoice</div>
                        <div class="tab" onclick="showSettingsTab('backup')">Backup</div>
                    </div>
                    
                    <div id="settingsContent">
                        <!-- Settings content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Firebase Configuration - UPDATE THIS WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
            authDomain: "budget-app-1365f.firebaseapp.com",
            projectId: "budget-app-1365f",
            storageBucket: "budget-app-1365f.firebasestorage.app",
            messagingSenderId: "1036194450411",
            appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
            measurementId: "G-YFFJL2H54X"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global variables
        let currentUser = null;
        let inventoryItems = [];
        let customers = [];
        let sales = [];
        let transactions = [];
        let notes = [];
        let noteCategories = [];
        let categories = [];
        let saleCart = [];
        let charts = {};
        let currentReportType = 'salesReport';
        let currentSalesTab = 'allSales';
        let currentEditingCustomerId = null;
        let currentEditingItemId = null;
        let companyDetails = null;
        let appSettings = null;
        let currentInvoiceNumber = 1001;

        // Category structure
        const categoryStructure = {
            "Electronics": ["Mobile Phones", "Laptops", "Tablets", "Headphones", "Speakers", "Smart Watches", "Cameras", "Accessories"],
            "Clothing": ["Men's Wear", "Women's Wear", "Kids Wear", "Footwear", "Accessories", "Sports Wear"],
            "Food & Beverages": ["Snacks", "Beverages", "Dairy", "Frozen Foods", "Bakery", "Canned Goods"],
            "Home & Kitchen": ["Cookware", "Utensils", "Appliances", "Furniture", "Decor", "Cleaning Supplies"],
            "Furniture": ["Living Room", "Bedroom", "Office", "Outdoor", "Kitchen", "Storage"],
            "Stationery": ["Pens & Pencils", "Notebooks", "Office Supplies", "Art Supplies", "Educational"],
            "Beauty & Personal Care": ["Skincare", "Haircare", "Makeup", "Fragrances", "Personal Hygiene"],
            "Sports & Fitness": ["Equipment", "Apparel", "Accessories", "Nutrition", "Footwear"],
            "Books & Media": ["Books", "Magazines", "Movies", "Music", "Games"],
            "Other": ["Miscellaneous"]
        };

        // Check authentication
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('userName').textContent = user.displayName || user.email.split('@')[0];
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userAvatar').textContent = user.email.charAt(0).toUpperCase();
                
                showLoading('Initializing application...');
                initializeApp();
            } else {
                // Redirect to login page
                window.location.href = 'index.html';
            }
        });

        // Initialize application
        async function initializeApp() {
            try {
                await Promise.all([
                    loadInventory(),
                    loadCustomers(),
                    loadSales(),
                    loadTransactions(),
                    loadNotes(),
                    loadCompanyDetails(),
                    loadSettings()
                ]);
                
                updateDashboardStats();
                initializeCharts();
                populateCategoryFilters();
                populateCustomerSelect();
                updateRecentSalesTable();
                updateLowStockTable();
                updatePendingPaymentsTable();
                updateBadges();
                updateBalanceStats();
                updateRecentTransactionsTable();
                updateNoteCategories();
                loadNotesGrid();
                
                // Set default dates
                const today = new Date().toISOString().split('T')[0];
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                document.getElementById('salesDateFrom').value = thirtyDaysAgo.toISOString().split('T')[0];
                document.getElementById('salesDateTo').value = today;
                document.getElementById('salesFilterDateFrom').value = thirtyDaysAgo.toISOString().split('T')[0];
                document.getElementById('salesFilterDateTo').value = today;
                document.getElementById('saleDate').value = today;
                document.getElementById('transactionDate').value = today;
                document.getElementById('transferDate').value = today;
                document.getElementById('paymentDate').value = today;
                
                setTimeout(() => {
                    hideLoading();
                    showToast('System loaded successfully!', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Failed to initialize application', 'error');
                hideLoading();
            }
        }

        // Utility Functions
        function showLoading(message = 'Loading...') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
                document.getElementById('loadingMessage').textContent = message;
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function formatDate(date) {
            if (!date) return 'N/A';
            const d = new Date(date);
            return d.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        function formatDateTime(date) {
            if (!date) return 'N/A';
            const d = new Date(date);
            return d.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Data Loading Functions
        async function loadInventory() {
            try {
                const userId = currentUser.uid;
                const snapshot = await db.collection('users').doc(userId).collection('inventory').get();
                
                inventoryItems = [];
                snapshot.forEach(doc => {
                    inventoryItems.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
            } catch (error) {
                console.error('Error loading inventory:', error);
                showToast('Failed to load inventory', 'error');
            }
        }

        async function loadCustomers() {
            try {
                const userId = currentUser.uid;
                const snapshot = await db.collection('users').doc(userId).collection('customers').get();
                
                customers = [];
                snapshot.forEach(doc => {
                    customers.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
            } catch (error) {
                console.error('Error loading customers:', error);
                showToast('Failed to load customers', 'error');
            }
        }

        async function loadSales() {
            try {
                const userId = currentUser.uid;
                const snapshot = await db.collection('users').doc(userId).collection('sales').get();
                
                sales = [];
                snapshot.forEach(doc => {
                    sales.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
            } catch (error) {
                console.error('Error loading sales:', error);
                showToast('Failed to load sales', 'error');
            }
        }

        async function loadTransactions() {
            try {
                const userId = currentUser.uid;
                const snapshot = await db.collection('users').doc(userId).collection('transactions').get();
                
                transactions = [];
                snapshot.forEach(doc => {
                    transactions.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                showToast('Failed to load transactions', 'error');
            }
        }

        async function loadNotes() {
            try {
                const userId = currentUser.uid;
                const snapshot = await db.collection('users').doc(userId).collection('notes').get();
                
                notes = [];
                snapshot.forEach(doc => {
                    notes.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
            } catch (error) {
                console.error('Error loading notes:', error);
                showToast('Failed to load notes', 'error');
            }
        }

        async function loadCompanyDetails() {
            try {
                const userId = currentUser.uid;
                const doc = await db.collection('users').doc(userId).collection('settings').doc('companyDetails').get();
                
                if (doc.exists) {
                    companyDetails = doc.data();
                } else {
                    companyDetails = {
                        companyName: "Your Company Name",
                        companyAddress1: "123 Business Street",
                        companyAddress2: "Commercial Area",
                        companyCity: "Your City",
                        companyState: "Your State",
                        companyPincode: "123456",
                        companyPhone: "+91 9876543210",
                        companyEmail: "info@yourcompany.com",
                        companyGST: "22AAAAA0000A1Z5",
                        companyPAN: "AAAAA1234A",
                        companyTerms: "1. Goods once sold will not be taken back.\n2. All disputes subject to jurisdiction.\n3. Payment due within 30 days of invoice date.",
                        companyFooter: "Thank you for your business! Please visit again."
                    };
                }
                
            } catch (error) {
                console.error('Error loading company details:', error);
                companyDetails = defaultCompanyDetails;
            }
        }

        async function loadSettings() {
            try {
                const userId = currentUser.uid;
                const doc = await db.collection('users').doc(userId).collection('settings').doc('appSettings').get();
                
                if (doc.exists) {
                    appSettings = doc.data();
                    currentInvoiceNumber = appSettings.nextInvoiceNumber || 1001;
                } else {
                    appSettings = {
                        emailNotifications: true,
                        lowStockAlerts: true,
                        autoBackup: false,
                        invoicePrefix: "INV",
                        nextInvoiceNumber: 1001,
                        defaultTaxRate: 18
                    };
                    currentInvoiceNumber = 1001;
                }
                
            } catch (error) {
                console.error('Error loading settings:', error);
                appSettings = defaultSettings;
                currentInvoiceNumber = 1001;
            }
        }

        // Navigation Functions
        function showDashboard() {
            setActivePage('Dashboard', 'Welcome to your inventory management system', 'dashboardContent');
            updateDashboardStats();
        }

        function showInventory() {
            setActivePage('Inventory', 'Manage your inventory items', 'inventoryContent');
            updateInventoryTable();
        }

        function showSales() {
            setActivePage('Sales', 'View and manage sales transactions', 'salesContent');
            loadSalesTable();
        }

        function showCustomers() {
            setActivePage('Customers', 'Manage your customers', 'customersContent');
            updateCustomersTable();
        }

        function showBalance() {
            setActivePage('Balance & Cash', 'Manage cash flow and transactions', 'balanceContent');
            updateBalanceStats();
            updateRecentTransactionsTable();
        }

        function showNotes() {
            setActivePage('Notes & Memos', 'Organize your thoughts and reminders', 'notesContent');
            loadNotesGrid();
        }

        function showReports() {
            setActivePage('Reports', 'Generate detailed reports and analytics', 'reportsContent');
        }

        function showAnalytics() {
            setActivePage('Analytics', 'Advanced analytics and insights', 'analyticsContent');
        }

        function showSettings() {
            openModal('settingsModal');
            showSettingsTab('general');
        }

        function setActivePage(title, subtitle, contentId) {
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('[id$="Content"]').forEach(section => {
                section.style.display = 'none';
            });
            
            const activeSection = document.getElementById(contentId);
            if (activeSection) {
                activeSection.style.display = 'block';
            }
            
            let menuItem = null;
            if (contentId === 'dashboardContent') menuItem = document.querySelector('.menu-item:nth-child(1)');
            else if (contentId === 'inventoryContent') menuItem = document.querySelector('.menu-item:nth-child(2)');
            else if (contentId === 'salesContent') menuItem = document.querySelector('.menu-item:nth-child(3)');
            else if (contentId === 'customersContent') menuItem = document.querySelector('.menu-item:nth-child(4)');
            else if (contentId === 'balanceContent') menuItem = document.querySelector('.menu-item:nth-child(5)');
            else if (contentId === 'notesContent') menuItem = document.querySelector('.menu-item:nth-child(6)');
            else if (contentId === 'reportsContent') menuItem = document.querySelector('.menu-item:nth-child(7)');
            
            if (menuItem) {
                menuItem.classList.add('active');
            }
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 1200) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                });
            }
        }

        // Update Dashboard Stats
        function updateDashboardStats() {
            // Total Items
            document.getElementById('totalItemsStat').textContent = inventoryItems.length;
            
            // Today's Sales
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales
                .filter(sale => sale.date === today)
                .reduce((sum, sale) => sum + (sale.totalAmount || 0), 0);
            document.getElementById('todaySalesStat').textContent = `â‚¹${todaySales.toFixed(2)}`;
            
            // Low Stock Items
            const lowStockItems = inventoryItems.filter(item => 
                item.currentStock > 0 && item.currentStock <= (item.minStock || 5)
            ).length;
            document.getElementById('lowStockStat').textContent = lowStockItems;
            document.getElementById('lowStockProgress').style.width = 
                `${(lowStockItems / Math.max(inventoryItems.length, 1) * 100).toFixed(0)}%`;
            
            // Out of Stock
            const outOfStockItems = inventoryItems.filter(item => item.currentStock === 0).length;
            document.getElementById('outOfStockStat').textContent = outOfStockItems;
            document.getElementById('outOfStockProgress').style.width = 
                `${(outOfStockItems / Math.max(inventoryItems.length, 1) * 100).toFixed(0)}%`;
            
            // Total Customers
            document.getElementById('totalCustomersStat').textContent = customers.length;
            
            // Total Inventory Value
            const totalValue = inventoryItems.reduce((sum, item) => 
                sum + (item.currentStock * (item.costPrice || 0)), 0);
            document.getElementById('totalValueStat').textContent = `â‚¹${totalValue.toFixed(2)}`;
            
            // Pending Payments
            const pendingPayments = sales
                .filter(sale => sale.dueAmount > 0)
                .reduce((sum, sale) => sum + sale.dueAmount, 0);
            document.getElementById('pendingPaymentsStat').textContent = `â‚¹${pendingPayments.toFixed(2)}`;
            const pendingCount = sales.filter(sale => sale.dueAmount > 0).length;
            document.getElementById('pendingChange').textContent = pendingCount;
            
            // Monthly Growth (simplified)
            document.getElementById('monthlyGrowthStat').textContent = '12%';
        }

        // Initialize Charts
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                charts.salesChart = new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Sales',
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: '#4e54c8',
                            backgroundColor: 'rgba(78, 84, 200, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString('en-IN');
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Top Items Chart
            const topItemsCtx = document.getElementById('topItemsChart');
            if (topItemsCtx) {
                charts.topItemsChart = new Chart(topItemsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Product A', 'Product B', 'Product C', 'Product D'],
                        datasets: [{
                            data: [35, 25, 20, 20],
                            backgroundColor: [
                                '#4e54c8',
                                '#8f94fb',
                                '#00b09b',
                                '#f46b45'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                charts.categoryChart = new Chart(categoryCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Electronics', 'Clothing', 'Home', 'Food', 'Other'],
                        datasets: [{
                            label: 'Items',
                            data: [12, 19, 8, 15, 7],
                            backgroundColor: '#4e54c8'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                charts.performanceChart = new Chart(performanceCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        datasets: [
                            {
                                label: 'Revenue',
                                data: [45000, 52000, 48000, 60000],
                                backgroundColor: '#4e54c8'
                            },
                            {
                                label: 'Profit',
                                data: [12000, 15000, 13000, 18000],
                                backgroundColor: '#00b09b'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString('en-IN');
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Sales Functions
        function openNewSaleModal() {
            saleCart = [];
            updateCartDisplay();
            populateSaleItemSelect();
            openModal('newSaleModal');
        }

        function populateSaleItemSelect() {
            const select = document.getElementById('saleItemSelect');
            select.innerHTML = '<option value="">Select Item</option>';
            
            inventoryItems.forEach(item => {
                if (item.currentStock > 0) {
                    select.innerHTML += `<option value="${item.id}">${item.name} - Stock: ${item.currentStock} - Price: â‚¹${item.sellingPrice}</option>`;
                }
            });
        }

        function addItemToCart() {
            const itemId = document.getElementById('saleItemSelect').value;
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            
            if (!itemId || quantity < 1) {
                showToast('Please select an item and enter quantity', 'error');
                return;
            }
            
            const item = inventoryItems.find(i => i.id === itemId);
            if (!item) {
                showToast('Item not found', 'error');
                return;
            }
            
            if (item.currentStock < quantity) {
                showToast(`Only ${item.currentStock} items available in stock`, 'error');
                return;
            }
            
            // Check if item already in cart
            const existingItemIndex = saleCart.findIndex(cartItem => cartItem.id === itemId);
            
            if (existingItemIndex > -1) {
                const newQuantity = saleCart[existingItemIndex].quantity + quantity;
                if (newQuantity > item.currentStock) {
                    showToast(`Cannot add more than ${item.currentStock} items`, 'error');
                    return;
                }
                saleCart[existingItemIndex].quantity = newQuantity;
                saleCart[existingItemIndex].total = newQuantity * item.sellingPrice;
            } else {
                saleCart.push({
                    id: itemId,
                    name: item.name,
                    price: item.sellingPrice,
                    quantity: quantity,
                    total: quantity * item.sellingPrice,
                    stock: item.currentStock
                });
            }
            
            updateCartDisplay();
            document.getElementById('saleQuantity').value = 1;
            showToast('Item added to cart', 'success');
        }

        function updateCartDisplay() {
            const cartItemsDiv = document.getElementById('cartItems');
            const cartTotal = saleCart.reduce((sum, item) => sum + item.total, 0);
            
            if (saleCart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Cart is empty. Add items to start a sale.</p>
                    </div>
                `;
            } else {
                let html = '';
                saleCart.forEach((item, index) => {
                    html += `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">â‚¹${item.price} x ${item.quantity}</div>
                            </div>
                            <div class="cart-item-quantity">
                                <button onclick="updateCartItemQuantity(${index}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button onclick="updateCartItemQuantity(${index}, 1)">+</button>
                            </div>
                            <div class="cart-item-total">â‚¹${item.total.toFixed(2)}</div>
                            <button class="remove-from-cart" onclick="removeFromCart(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                });
                cartItemsDiv.innerHTML = html;
            }
            
            document.getElementById('cartTotal').textContent = cartTotal.toFixed(2);
        }

        function updateCartItemQuantity(index, change) {
            const item = saleCart[index];
            const inventoryItem = inventoryItems.find(i => i.id === item.id);
            
            const newQuantity = item.quantity + change;
            if (newQuantity < 1) {
                removeFromCart(index);
                return;
            }
            
            if (newQuantity > inventoryItem.currentStock) {
                showToast(`Only ${inventoryItem.currentStock} items available in stock`, 'error');
                return;
            }
            
            saleCart[index].quantity = newQuantity;
            saleCart[index].total = newQuantity * item.price;
            updateCartDisplay();
        }

        function removeFromCart(index) {
            saleCart.splice(index, 1);
            updateCartDisplay();
        }

        function clearCart() {
            if (saleCart.length === 0) {
                showToast('Cart is already empty', 'info');
                return;
            }
            
            if (confirm('Clear all items from cart?')) {
                saleCart = [];
                updateCartDisplay();
                showToast('Cart cleared', 'success');
            }
        }

        async function processSale() {
            if (saleCart.length === 0) {
                showToast('Add items to cart before processing sale', 'error');
                return;
            }
            
            const customerId = document.getElementById('saleCustomer').value;
            const saleDate = document.getElementById('saleDate').value;
            const notes = document.getElementById('saleNotes').value;
            
            showLoading('Processing sale...');
            
            try {
                // Update inventory
                for (const cartItem of saleCart) {
                    const item = inventoryItems.find(i => i.id === cartItem.id);
                    if (item) {
                        const newStock = item.currentStock - cartItem.quantity;
                        await db.collection('users').doc(currentUser.uid).collection('inventory').doc(item.id).update({
                            currentStock: newStock
                        });
                    }
                }
                
                // Create sale record
                const totalAmount = saleCart.reduce((sum, item) => sum + item.total, 0);
                const invoiceNumber = `INV-${currentInvoiceNumber.toString().padStart(5, '0')}`;
                
                const saleData = {
                    invoiceNumber: invoiceNumber,
                    date: saleDate,
                    customerId: customerId || null,
                    customerName: customerId ? customers.find(c => c.id === customerId)?.name : 'Walk-in Customer',
                    items: saleCart,
                    totalAmount: totalAmount,
                    paidAmount: totalAmount,
                    dueAmount: 0,
                    status: 'paid',
                    notes: notes,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).collection('sales').add(saleData);
                
                // Create transaction record
                const transactionData = {
                    date: saleDate,
                    amount: totalAmount,
                    description: `Sale - Invoice ${invoiceNumber}`,
                    type: 'income',
                    category: 'sales',
                    paymentMethod: 'cash',
                    notes: `Sale to ${saleData.customerName}`,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('users').doc(currentUser.uid).collection('transactions').add(transactionData);
                
                // Update invoice number
                currentInvoiceNumber++;
                await db.collection('users').doc(currentUser.uid).collection('settings').doc('appSettings').update({
                    nextInvoiceNumber: currentInvoiceNumber
                });
                
                // Reload data
                await Promise.all([
                    loadInventory(),
                    loadSales(),
                    loadTransactions()
                ]);
                
                // Generate invoice
                generateInvoice(invoiceNumber, saleData);
                
                hideLoading();
                showToast('Sale processed successfully!', 'success');
                closeModal('newSaleModal');
                
                // Reset cart
                saleCart = [];
                updateCartDisplay();
                
            } catch (error) {
                hideLoading();
                console.error('Error processing sale:', error);
                showToast('Failed to process sale', 'error');
            }
        }

        function generateInvoice(invoiceNumber, saleData) {
            const invoiceContent = document.getElementById('invoiceContent');
            
            let itemsHtml = '';
            saleData.items.forEach(item => {
                itemsHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>â‚¹${item.price.toFixed(2)}</td>
                        <td>â‚¹${item.total.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            const invoiceHtml = `
                <div class="invoice-container">
                    <div class="invoice-header">
                        <h2>${companyDetails.companyName}</h2>
                        <p>${companyDetails.companyAddress1}</p>
                        <p>${companyDetails.companyAddress2}, ${companyDetails.companyCity} - ${companyDetails.companyPincode}</p>
                        <p>Phone: ${companyDetails.companyPhone} | Email: ${companyDetails.companyEmail}</p>
                        <p>GST: ${companyDetails.companyGST}</p>
                    </div>
                    
                    <div class="invoice-details">
                        <div>
                            <h3>Invoice Details</h3>
                            <p><strong>Invoice #:</strong> ${invoiceNumber}</p>
                            <p><strong>Date:</strong> ${formatDate(saleData.date)}</p>
                        </div>
                        <div>
                            <h3>Customer Details</h3>
                            <p><strong>Name:</strong> ${saleData.customerName}</p>
                            <p><strong>Date:</strong> ${formatDate(saleData.date)}</p>
                        </div>
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>
                    
                    <div class="invoice-totals">
                        <div class="invoice-total-row">
                            <span>Subtotal:</span>
                            <span>â‚¹${saleData.totalAmount.toFixed(2)}</span>
                        </div>
                        <div class="invoice-total-row">
                            <span>Tax (18%):</span>
                            <span>â‚¹${(saleData.totalAmount * 0.18).toFixed(2)}</span>
                        </div>
                        <div class="invoice-total-row">
                            <span>Total:</span>
                            <span>â‚¹${(saleData.totalAmount * 1.18).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                        <p><strong>Terms & Conditions:</strong></p>
                        <p>${companyDetails.companyTerms.replace(/\n/g, '<br>')}</p>
                        <p style="margin-top: 20px; font-style: italic;">${companyDetails.companyFooter}</p>
                    </div>
                </div>
            `;
            
            invoiceContent.innerHTML = invoiceHtml;
            openModal('invoiceModal');
        }

        // Inventory Functions
        function updateInventoryTable(page = 1) {
            const searchTerm = document.getElementById('searchInventory').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;
            const statusFilter = document.getElementById('filterStatus').value;
            
            let filteredItems = inventoryItems.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.sku?.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                
                let matchesStatus = true;
                if (statusFilter === 'in_stock') {
                    matchesStatus = item.currentStock > (item.minStock || 5);
                } else if (statusFilter === 'low_stock') {
                    matchesStatus = item.currentStock > 0 && item.currentStock <= (item.minStock || 5);
                } else if (statusFilter === 'out_of_stock') {
                    matchesStatus = item.currentStock === 0;
                }
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            const tableBody = document.getElementById('inventoryTable');
            let html = '';
            
            if (filteredItems.length === 0) {
                html = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <i class="fas fa-box"></i>
                            <h4>No items found</h4>
                            <p>Try adjusting your search or filters</p>
                        </td>
                    </tr>
                `;
            } else {
                filteredItems.forEach(item => {
                    const stockValue = item.currentStock * (item.costPrice || 0);
                    let statusClass = 'status-in-stock';
                    let statusText = 'In Stock';
                    
                    if (item.currentStock === 0) {
                        statusClass = 'status-out-of-stock';
                        statusText = 'Out of Stock';
                    } else if (item.currentStock <= (item.minStock || 5)) {
                        statusClass = 'status-low-stock';
                        statusText = 'Low Stock';
                    }
                    
                    html += `
                        <tr>
                            <td><strong>${item.name}</strong><br><small>${item.description || ''}</small></td>
                            <td>${item.sku || 'N/A'}</td>
                            <td>${item.category || 'N/A'}</td>
                            <td>${item.currentStock} ${item.unit || 'pcs'}</td>
                            <td>â‚¹${item.costPrice?.toFixed(2) || '0.00'}</td>
                            <td>â‚¹${item.sellingPrice?.toFixed(2) || '0.00'}</td>
                            <td>â‚¹${stockValue.toFixed(2)}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="action-btn" style="padding: 5px 10px;" onclick="editItem('${item.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn danger" style="padding: 5px 10px;" onclick="deleteItem('${item.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tableBody.innerHTML = html;
        }

        function populateCategoryFilters() {
            const categorySelect = document.getElementById('filterCategory');
            const itemCategorySelect = document.getElementById('itemCategory');
            const editItemCategorySelect = document.getElementById('editItemCategory');
            
            categorySelect.innerHTML = '<option value="">All Categories</option>';
            itemCategorySelect.innerHTML = '<option value="">Select Category</option>';
            editItemCategorySelect.innerHTML = '<option value="">Select Category</option>';
            
            Object.keys(categoryStructure).forEach(category => {
                categorySelect.innerHTML += `<option value="${category}">${category}</option>`;
                itemCategorySelect.innerHTML += `<option value="${category}">${category}</option>`;
                editItemCategorySelect.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }

        function updateSubCategories() {
            const category = document.getElementById('itemCategory').value;
            const subCategorySelect = document.getElementById('itemSubCategory');
            
            subCategorySelect.innerHTML = '<option value="">Select Sub-Category</option>';
            
            if (category && categoryStructure[category]) {
                categoryStructure[category].forEach(subCategory => {
                    subCategorySelect.innerHTML += `<option value="${subCategory}">${subCategory}</option>`;
                });
            }
        }

        async function saveItem() {
            const name = document.getElementById('itemName').value;
            const sku = document.getElementById('itemSku').value || `ITEM-${Date.now()}`;
            const category = document.getElementById('itemCategory').value;
            const subCategory = document.getElementById('itemSubCategory').value;
            const stock = parseInt(document.getElementById('itemStock').value);
            const minStock = parseInt(document.getElementById('itemMinStock').value);
            const unit = document.getElementById('itemUnit').value;
            const cost = parseFloat(document.getElementById('itemCost').value);
            const price = parseFloat(document.getElementById('itemPrice').value);
            const tax = parseFloat(document.getElementById('itemTax').value);
            const description = document.getElementById('itemDescription').value;
            const image = document.getElementById('itemImage').value;
            
            if (!name || !category || !cost || !price) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            showLoading('Saving item...');
            
            try {
                const itemData = {
                    name: name,
                    sku: sku,
                    category: category,
                    subCategory: subCategory,
                    currentStock: stock,
                    minStock: minStock,
                    unit: unit,
                    costPrice: cost,
                    sellingPrice: price,
                    taxRate: tax,
                    description: description,
                    image: image,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).collection('inventory').add(itemData);
                
                await loadInventory();
                updateInventoryTable();
                updateDashboardStats();
                updateBadges();
                
                hideLoading();
                showToast('Item saved successfully!', 'success');
                closeModal('newItemModal');
                
                // Reset form
                document.getElementById('newItemForm').reset();
                
            } catch (error) {
                hideLoading();
                console.error('Error saving item:', error);
                showToast('Failed to save item', 'error');
            }
        }

        function editItem(itemId) {
            const item = inventoryItems.find(i => i.id === itemId);
            if (!item) {
                showToast('Item not found', 'error');
                return;
            }
            
            currentEditingItemId = itemId;
            
            document.getElementById('editItemId').value = itemId;
            document.getElementById('editItemName').value = item.name;
            document.getElementById('editItemSku').value = item.sku || '';
            document.getElementById('editItemCategory').value = item.category || '';
            document.getElementById('editItemSubCategory').value = item.subCategory || '';
            document.getElementById('editItemStock').value = item.currentStock;
            document.getElementById('editItemMinStock').value = item.minStock || 5;
            document.getElementById('editItemUnit').value = item.unit || 'pcs';
            document.getElementById('editItemCost').value = item.costPrice || 0;
            document.getElementById('editItemPrice').value = item.sellingPrice || 0;
            document.getElementById('editItemTax').value = item.taxRate || 18;
            document.getElementById('editItemDescription').value = item.description || '';
            document.getElementById('editItemImage').value = item.image || '';
            
            openModal('editItemModal');
        }

        async function updateItem() {
            const itemId = currentEditingItemId;
            const name = document.getElementById('editItemName').value;
            const sku = document.getElementById('editItemSku').value;
            const category = document.getElementById('editItemCategory').value;
            const subCategory = document.getElementById('editItemSubCategory').value;
            const stock = parseInt(document.getElementById('editItemStock').value);
            const minStock = parseInt(document.getElementById('editItemMinStock').value);
            const unit = document.getElementById('editItemUnit').value;
            const cost = parseFloat(document.getElementById('editItemCost').value);
            const price = parseFloat(document.getElementById('editItemPrice').value);
            const tax = parseFloat(document.getElementById('editItemTax').value);
            const description = document.getElementById('editItemDescription').value;
            const image = document.getElementById('editItemImage').value;
            
            if (!name || !category || !cost || !price) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            showLoading('Updating item...');
            
            try {
                const itemData = {
                    name: name,
                    sku: sku,
                    category: category,
                    subCategory: subCategory,
                    currentStock: stock,
                    minStock: minStock,
                    unit: unit,
                    costPrice: cost,
                    sellingPrice: price,
                    taxRate: tax,
                    description: description,
                    image: image,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).collection('inventory').doc(itemId).update(itemData);
                
                await loadInventory();
                updateInventoryTable();
                updateDashboardStats();
                updateBadges();
                
                hideLoading();
                showToast('Item updated successfully!', 'success');
                closeModal('editItemModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error updating item:', error);
                showToast('Failed to update item', 'error');
            }
        }

        async function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this item?')) {
                return;
            }
            
            showLoading('Deleting item...');
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('inventory').doc(itemId).delete();
                
                await loadInventory();
                updateInventoryTable();
                updateDashboardStats();
                updateBadges();
                
                hideLoading();
                showToast('Item deleted successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Error deleting item:', error);
                showToast('Failed to delete item', 'error');
            }
        }

        // Customer Functions
        function updateCustomersTable(page = 1) {
            const searchTerm = document.getElementById('searchCustomers').value.toLowerCase();
            
            let filteredCustomers = customers.filter(customer => {
                return !searchTerm || 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.email?.toLowerCase().includes(searchTerm) ||
                    customer.phone?.includes(searchTerm);
            });
            
            const tableBody = document.getElementById('customersTable');
            let html = '';
            
            if (filteredCustomers.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-users"></i>
                            <h4>No customers found</h4>
                            <p>Try adjusting your search</p>
                        </td>
                    </tr>
                `;
            } else {
                filteredCustomers.forEach(customer => {
                    const customerSales = sales.filter(sale => sale.customerId === customer.id);
                    const totalSpent = customerSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
                    const lastPurchase = customerSales.length > 0 ? 
                        Math.max(...customerSales.map(s => new Date(s.date))) : null;
                    
                    html += `
                        <tr>
                            <td><strong>${customer.name}</strong></td>
                            <td>${customer.email || 'N/A'}</td>
                            <td>${customer.phone || 'N/A'}</td>
                            <td>${customer.address || 'N/A'}</td>
                            <td>â‚¹${totalSpent.toFixed(2)}</td>
                            <td>${lastPurchase ? formatDate(lastPurchase) : 'Never'}</td>
                            <td>
                                <button class="action-btn" style="padding: 5px 10px;" onclick="editCustomer('${customer.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn danger" style="padding: 5px 10px;" onclick="deleteCustomer('${customer.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tableBody.innerHTML = html;
        }

        function openNewCustomerModal() {
            document.getElementById('newCustomerForm').reset();
            openModal('newCustomerModal');
        }

        async function saveCustomer() {
            const name = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const phone = document.getElementById('customerPhone').value;
            const city = document.getElementById('customerCity').value;
            const address = document.getElementById('customerAddress').value;
            const gst = document.getElementById('customerGST').value;
            const discount = parseFloat(document.getElementById('customerDiscount').value);
            const notes = document.getElementById('customerNotes').value;
            
            if (!name || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            showLoading('Saving customer...');
            
            try {
                const customerData = {
                    name: name,
                    email: email,
                    phone: phone,
                    city: city,
                    address: address,
                    gstNumber: gst,
                    discount: discount,
                    notes: notes,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).collection('customers').add(customerData);
                
                await loadCustomers();
                updateCustomersTable();
                updateDashboardStats();
                updateBadges();
                populateCustomerSelect();
                
                hideLoading();
                showToast('Customer saved successfully!', 'success');
                closeModal('newCustomerModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error saving customer:', error);
                showToast('Failed to save customer', 'error');
            }
        }

        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) {
                showToast('Customer not found', 'error');
                return;
            }
            
            currentEditingCustomerId = customerId;
            
            document.getElementById('editCustomerId').value = customerId;
            document.getElementById('editCustomerName').value = customer.name;
            document.getElementById('editCustomerEmail').value = customer.email || '';
            document.getElementById('editCustomerPhone').value = customer.phone;
            document.getElementById('editCustomerCity').value = customer.city || '';
            document.getElementById('editCustomerAddress').value = customer.address || '';
            document.getElementById('editCustomerGST').value = customer.gstNumber || '';
            document.getElementById('editCustomerDiscount').value = customer.discount || 0;
            document.getElementById('editCustomerNotes').value = customer.notes || '';
            
            openModal('editCustomerModal');
        }

        async function updateCustomer() {
            const customerId = currentEditingCustomerId;
            const name = document.getElementById('editCustomerName').value;
            const email = document.getElementById('editCustomerEmail').value;
            const phone = document.getElementById('editCustomerPhone').value;
            const city = document.getElementById('editCustomerCity').value;
            const address = document.getElementById('editCustomerAddress').value;
            const gst = document.getElementById('editCustomerGST').value;
            const discount = parseFloat(document.getElementById('editCustomerDiscount').value);
            const notes = document.getElementById('editCustomerNotes').value;
            
            if (!name || !phone) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            showLoading('Updating customer...');
            
            try {
                const customerData = {
                    name: name,
                    email: email,
                    phone: phone,
                    city: city,
                    address: address,
                    gstNumber: gst,
                    discount: discount,
                    notes: notes,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).collection('customers').doc(customerId).update(customerData);
                
                await loadCustomers();
                updateCustomersTable();
                populateCustomerSelect();
                
                hideLoading();
                showToast('Customer updated successfully!', 'success');
                closeModal('editCustomerModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error updating customer:', error);
                showToast('Failed to update customer', 'error');
            }
        }

        async function deleteCustomer(customerId) {
            if (!confirm('Are you sure you want to delete this customer?')) {
                return;
            }
            
            showLoading('Deleting customer...');
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('customers').doc(customerId).delete();
                
                await loadCustomers();
                updateCustomersTable();
                updateDashboardStats();
                updateBadges();
                populateCustomerSelect();
                
                hideLoading();
                showToast('Customer deleted successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Error deleting customer:', error);
                showToast('Failed to delete customer', 'error');
            }
        }

        function populateCustomerSelect() {
            const saleCustomerSelect = document.getElementById('saleCustomer');
            saleCustomerSelect.innerHTML = '<option value="">Walk-in Customer</option>';
            
            customers.forEach(customer => {
                saleCustomerSelect.innerHTML += `<option value="${customer.id}">${customer.name} - ${customer.phone}</option>`;
            });
        }

        // Sales Table Functions
        function loadSalesTable(page = 1) {
            const dateFrom = document.getElementById('salesFilterDateFrom').value;
            const dateTo = document.getElementById('salesFilterDateTo').value;
            const statusFilter = document.getElementById('salesFilterStatus').value;
            
            let filteredSales = sales.filter(sale => {
                const matchesDate = (!dateFrom || sale.date >= dateFrom) && (!dateTo || sale.date <= dateTo);
                const matchesStatus = !statusFilter || sale.status === statusFilter;
                
                return matchesDate && matchesStatus;
            });
            
            const tableBody = document.getElementById('salesTable');
            let html = '';
            
            if (filteredSales.length === 0) {
                html = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <h4>No sales found</h4>
                            <p>Try adjusting your filters</p>
                        </td>
                    </tr>
                `;
            } else {
                filteredSales.forEach(sale => {
                    const statusClass = sale.status === 'paid' ? 'status-in-stock' : 
                                      sale.status === 'partial' ? 'status-low-stock' : 'status-out-of-stock';
                    const statusText = sale.status === 'paid' ? 'Paid' : 
                                     sale.status === 'partial' ? 'Partial' : 'Pending';
                    
                    html += `
                        <tr>
                            <td><strong>${sale.invoiceNumber}</strong></td>
                            <td>${formatDate(sale.date)}</td>
                            <td>${sale.customerName}</td>
                            <td>${sale.items.length} items</td>
                            <td>â‚¹${sale.totalAmount.toFixed(2)}</td>
                            <td>â‚¹${sale.paidAmount?.toFixed(2) || '0.00'}</td>
                            <td>â‚¹${sale.dueAmount?.toFixed(2) || '0.00'}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="action-btn" style="padding: 5px 10px;" onclick="viewInvoice('${sale.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${sale.dueAmount > 0 ? `
                                <button class="action-btn success" style="padding: 5px 10px;" onclick="recordPayment('${sale.id}')">
                                    <i class="fas fa-money-bill"></i>
                                </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                });
            }
            
            tableBody.innerHTML = html;
        }

        function showSalesTab(tab) {
            currentSalesTab = tab;
            
            document.querySelectorAll('#salesTabs .tab').forEach(t => {
                t.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Implement tab filtering if needed
            loadSalesTable();
        }

        function recordPayment(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) {
                showToast('Sale not found', 'error');
                return;
            }
            
            document.getElementById('paymentSaleId').value = saleId;
            document.getElementById('paymentInvoice').value = sale.invoiceNumber;
            document.getElementById('paymentTotal').value = sale.totalAmount.toFixed(2);
            document.getElementById('paymentPaid').value = sale.paidAmount?.toFixed(2) || '0.00';
            document.getElementById('paymentDue').value = sale.dueAmount?.toFixed(2) || '0.00';
            document.getElementById('paymentAmount').value = sale.dueAmount?.toFixed(2) || '0.00';
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            
            openModal('paymentModal');
        }

        async function savePayment() {
            const saleId = document.getElementById('paymentSaleId').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const method = document.getElementById('paymentMethod').value;
            const date = document.getElementById('paymentDate').value;
            const notes = document.getElementById('paymentNotes').value;
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid payment amount', 'error');
                return;
            }
            
            showLoading('Recording payment...');
            
            try {
                const sale = sales.find(s => s.id === saleId);
                if (!sale) {
                    throw new Error('Sale not found');
                }
                
                const newPaidAmount = (sale.paidAmount || 0) + amount;
                const newDueAmount = Math.max(sale.totalAmount - newPaidAmount, 0);
                const newStatus = newDueAmount === 0 ? 'paid' : 'partial';
                
                // Update sale record
                await db.collection('users').doc(currentUser.uid).collection('sales').doc(saleId).update({
                    paidAmount: newPaidAmount,
                    dueAmount: newDueAmount,
                    status: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Create transaction record
                const transactionData = {
                    date: date,
                    amount: amount,
                    description: `Payment for Invoice ${sale.invoiceNumber}`,
                    type: 'income',
                    category: 'sales',
                    paymentMethod: method,
                    notes: notes,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('users').doc(currentUser.uid).collection('transactions').add(transactionData);
                
                // Reload data
                await Promise.all([
                    loadSales(),
                    loadTransactions()
                ]);
                
                updateDashboardStats();
                updateBalanceStats();
                updateRecentTransactionsTable();
                loadSalesTable();
                
                hideLoading();
                showToast('Payment recorded successfully!', 'success');
                closeModal('paymentModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error recording payment:', error);
                showToast('Failed to record payment', 'error');
            }
        }

        function viewInvoice(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) {
                showToast('Sale not found', 'error');
                return;
            }
            
            generateInvoice(sale.invoiceNumber, sale);
        }

        // Balance Functions
        function updateBalanceStats() {
            let cashInHand = 0;
            let bankBalance = 0;
            let totalReceivables = 0;
            let totalPayables = 0;
            
            // Calculate from transactions
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    if (transaction.paymentMethod === 'cash') {
                        cashInHand += transaction.amount;
                    } else {
                        bankBalance += transaction.amount;
                    }
                } else if (transaction.type === 'expense') {
                    if (transaction.paymentMethod === 'cash') {
                        cashInHand -= transaction.amount;
                    } else {
                        bankBalance -= transaction.amount;
                    }
                }
            });
            
            // Calculate receivables
            totalReceivables = sales
                .filter(sale => sale.dueAmount > 0)
                .reduce((sum, sale) => sum + sale.dueAmount, 0);
            
            // Update UI
            document.getElementById('cashInHand').textContent = `â‚¹${cashInHand.toFixed(2)}`;
            document.getElementById('bankBalance').textContent = `â‚¹${bankBalance.toFixed(2)}`;
            document.getElementById('totalReceivables').textContent = `â‚¹${totalReceivables.toFixed(2)}`;
            document.getElementById('receivablesCount').textContent = 
                sales.filter(sale => sale.dueAmount > 0).length;
            
            // Calculate net profit
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const netProfit = totalIncome - totalExpense;
            document.getElementById('netProfit').textContent = `â‚¹${netProfit.toFixed(2)}`;
        }

        function updateRecentTransactionsTable() {
            const table = document.getElementById('recentTransactionsTable');
            const recentTransactions = transactions.slice(0, 10);
            
            let html = '';
            if (recentTransactions.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-exchange-alt"></i>
                            <h4>No transactions yet</h4>
                            <p>Start adding transactions to see them here</p>
                        </td>
                    </tr>
                `;
            } else {
                recentTransactions.forEach(transaction => {
                    const typeClass = transaction.type === 'income' ? 'transaction-income' : 
                                    transaction.type === 'expense' ? 'transaction-expense' : 'transaction-transfer';
                    const typeText = transaction.type === 'income' ? 'Income' : 
                                   transaction.type === 'expense' ? 'Expense' : 'Transfer';
                    
                    html += `
                        <tr>
                            <td>${formatDate(transaction.date)}</td>
                            <td>${transaction.description}</td>
                            <td><span class="transaction-type ${typeClass}">${typeText}</span></td>
                            <td>${transaction.category}</td>
                            <td class="${transaction.type === 'income' ? 'text-success' : 'text-danger'}">
                                <strong>${transaction.type === 'income' ? '+' : '-'}â‚¹${transaction.amount.toFixed(2)}</strong>
                            </td>
                            <td>â‚¹${transaction.amount.toFixed(2)}</td>
                            <td>
                                <button class="action-btn danger" style="padding: 5px 10px;" onclick="deleteTransaction('${transaction.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            table.innerHTML = html;
        }

        function openAddTransactionModal() {
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionDescription').value = '';
            document.getElementById('transactionType').value = 'income';
            document.getElementById('transactionCategory').value = 'sales';
            document.getElementById('transactionPaymentMethod').value = 'cash';
            document.getElementById('transactionNotes').value = '';
            openModal('addTransactionModal');
        }

        async function saveTransaction() {
            try {
                showLoading('Saving transaction...');
                
                const transactionData = {
                    date: document.getElementById('transactionDate').value,
                    amount: parseFloat(document.getElementById('transactionAmount').value),
                    description: document.getElementById('transactionDescription').value,
                    type: document.getElementById('transactionType').value,
                    category: document.getElementById('transactionCategory').value,
                    paymentMethod: document.getElementById('transactionPaymentMethod').value,
                    notes: document.getElementById('transactionNotes').value,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('users').doc(currentUser.uid).collection('transactions').add(transactionData);
                
                await loadTransactions();
                updateBalanceStats();
                updateRecentTransactionsTable();
                updateBadges();
                
                hideLoading();
                showToast('Transaction saved successfully!', 'success');
                closeModal('addTransactionModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error saving transaction:', error);
                showToast('Failed to save transaction', 'error');
            }
        }

        async function deleteTransaction(transactionId) {
            if (!confirm('Are you sure you want to delete this transaction?')) {
                return;
            }
            
            showLoading('Deleting transaction...');
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('transactions').doc(transactionId).delete();
                
                await loadTransactions();
                updateBalanceStats();
                updateRecentTransactionsTable();
                updateBadges();
                
                hideLoading();
                showToast('Transaction deleted successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Error deleting transaction:', error);
                showToast('Failed to delete transaction', 'error');
            }
        }

        // Notes Functions
        function updateNoteCategories() {
            const categorySelect = document.getElementById('filterNoteCategory');
            categorySelect.innerHTML = '<option value="">All Categories</option>';
            
            const categories = ['general', 'important', 'todo', 'idea', 'reminder', 'meeting'];
            categories.forEach(category => {
                const count = notes.filter(note => note.category === category).length;
                categorySelect.innerHTML += `<option value="${category}">${category.charAt(0).toUpperCase() + category.slice(1)} (${count})</option>`;
            });
        }

        function loadNotesGrid() {
            const grid = document.getElementById('notesGrid');
            const searchTerm = document.getElementById('searchNotes')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('filterNoteCategory')?.value || '';
            const dateFilter = document.getElementById('filterNoteDate')?.value || 'all';
            
            let filteredNotes = notes.filter(note => {
                const matchesSearch = !searchTerm || 
                    (note.title && note.title.toLowerCase().includes(searchTerm)) ||
                    (note.content && note.content.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || note.category === categoryFilter;
                
                let matchesDate = true;
                if (dateFilter !== 'all') {
                    const noteDate = new Date(note.createdAt);
                    const now = new Date();
                    
                    if (dateFilter === 'today') {
                        matchesDate = noteDate.toDateString() === now.toDateString();
                    } else if (dateFilter === 'week') {
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        matchesDate = noteDate >= weekAgo;
                    } else if (dateFilter === 'month') {
                        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        matchesDate = noteDate >= monthAgo;
                    } else if (dateFilter === 'year') {
                        const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                        matchesDate = noteDate >= yearAgo;
                    }
                }
                
                return matchesSearch && matchesCategory && matchesDate;
            });
            
            let html = '';
            if (filteredNotes.length === 0) {
                html = `
                    <div class="empty-notes">
                        <i class="fas fa-sticky-note"></i>
                        <h4>No notes found</h4>
                        <p>Try adjusting your search or filters</p>
                        <button class="action-btn success" onclick="openNewNoteModal()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Create New Note
                        </button>
                    </div>
                `;
            } else {
                filteredNotes.forEach(note => {
                    const category = note.category || 'general';
                    const date = formatDate(note.createdAt);
                    const contentPreview = note.content ? 
                        (note.content.length > 150 ? note.content.substring(0, 150) + '...' : note.content) : '';
                    
                    html += `
                        <div class="note-card" style="background-color: ${note.color || '#ffffff'}">
                            <div class="note-card-header">
                                <h4 class="note-card-title">${note.title || 'Untitled'}</h4>
                                <span class="note-card-category" style="background-color: #f0f0f0; color: #333; padding: 4px 12px; border-radius: 20px;">
                                    ${category.charAt(0).toUpperCase() + category.slice(1)}
                                </span>
                            </div>
                            <div class="note-card-content">
                                ${contentPreview.replace(/\n/g, '<br>')}
                            </div>
                            <div class="note-card-footer">
                                <div class="note-card-date">${date}</div>
                                <div class="note-card-actions">
                                    <button class="action-btn" style="padding: 5px 10px;" onclick="viewNote('${note.id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn danger" style="padding: 5px 10px;" onclick="deleteNote('${note.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            grid.innerHTML = html;
        }

        function filterNotes() {
            loadNotesGrid();
        }

        function clearNoteFilters() {
            document.getElementById('searchNotes').value = '';
            document.getElementById('filterNoteCategory').value = '';
            document.getElementById('filterNoteDate').value = 'all';
            loadNotesGrid();
        }

        function openNewNoteModal() {
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteCategory').value = 'general';
            document.getElementById('noteContent').value = '';
            document.getElementById('noteColor').value = '#ffffff';
            document.getElementById('noteDueDate').value = '';
            openModal('newNoteModal');
        }

        async function saveNote() {
            try {
                showLoading('Saving note...');
                
                const noteData = {
                    title: document.getElementById('noteTitle').value,
                    category: document.getElementById('noteCategory').value,
                    content: document.getElementById('noteContent').value,
                    color: document.getElementById('noteColor').value,
                    dueDate: document.getElementById('noteDueDate').value || null,
                    status: 'active',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('users').doc(currentUser.uid).collection('notes').add(noteData);
                
                await loadNotes();
                updateNoteCategories();
                loadNotesGrid();
                updateBadges();
                
                hideLoading();
                showToast('Note saved successfully!', 'success');
                closeModal('newNoteModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error saving note:', error);
                showToast('Failed to save note', 'error');
            }
        }

        function viewNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) {
                showToast('Note not found', 'error');
                return;
            }
            
            const category = note.category || 'general';
            const date = formatDate(note.createdAt);
            
            const noteDetails = `
                <div class="note-details" style="background-color: ${note.color || '#ffffff'}; padding: 20px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--dark); margin: 0;">${note.title || 'Untitled'}</h3>
                        <span class="note-card-category" style="background-color: #f0f0f0; color: #333; padding: 5px 15px; border-radius: 20px;">
                            ${category.charAt(0).toUpperCase() + category.slice(1)}
                        </span>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>Created:</strong> ${date}
                        ${note.dueDate ? `<br><strong>Due Date:</strong> ${formatDate(note.dueDate)}` : ''}
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="white-space: pre-line; line-height: 1.6;">
                            ${note.content || ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('viewNoteTitle').textContent = note.title || 'Note Details';
            document.getElementById('noteDetails').innerHTML = noteDetails;
            window.currentViewingNoteId = noteId;
            
            openModal('viewNoteModal');
        }

        async function deleteNote(noteId) {
            if (!confirm('Are you sure you want to delete this note?')) {
                return;
            }
            
            try {
                showLoading('Deleting note...');
                
                await db.collection('users').doc(currentUser.uid).collection('notes').doc(noteId).delete();
                
                await loadNotes();
                updateNoteCategories();
                loadNotesGrid();
                updateBadges();
                
                hideLoading();
                showToast('Note deleted successfully!', 'success');
                closeModal('viewNoteModal');
                
            } catch (error) {
                hideLoading();
                console.error('Error deleting note:', error);
                showToast('Failed to delete note', 'error');
            }
        }

        function selectNoteColor(color) {
            document.getElementById('noteColor').value = color;
        }

        // Update badges
        function updateBadges() {
            document.getElementById('inventoryBadge').textContent = inventoryItems.length;
            document.getElementById('salesBadge').textContent = sales.length;
            document.getElementById('customersBadge').textContent = customers.length;
            document.getElementById('balanceBadge').textContent = transactions.length;
            
            const pendingNotes = notes.filter(note => note.status !== 'completed').length;
            document.getElementById('notesBadge').textContent = pendingNotes > 0 ? pendingNotes : '0';
            
            const lowStockCount = inventoryItems.filter(item => 
                item.currentStock > 0 && item.currentStock <= (item.minStock || 5)
            ).length;
            document.getElementById('reportsBadge').textContent = lowStockCount > 0 ? lowStockCount : '0';
        }

        // Create Test Data
        async function createTestData() {
            if (!confirm('Create test data? This will add sample items, customers, and transactions.')) {
                return;
            }
            
            try {
                showLoading('Creating test data...');
                
                const userId = currentUser.uid;
                
                // Add test inventory items
                const testItems = [
                    {
                        name: "Premium Laptop",
                        sku: "LP001",
                        category: "Electronics",
                        subCategory: "Laptops",
                        currentStock: 15,
                        costPrice: 45000,
                        sellingPrice: 55000,
                        minStock: 5,
                        unit: "pcs",
                        description: "High-performance laptop with 16GB RAM"
                    },
                    {
                        name: "Wireless Headphones",
                        sku: "HP002",
                        category: "Electronics",
                        subCategory: "Headphones",
                        currentStock: 8,
                        costPrice: 2500,
                        sellingPrice: 3500,
                        minStock: 3,
                        unit: "pcs",
                        description: "Noise-cancelling wireless headphones"
                    },
                    {
                        name: "Office Chair",
                        sku: "OC003",
                        category: "Furniture",
                        subCategory: "Office",
                        currentStock: 5,
                        costPrice: 8000,
                        sellingPrice: 12000,
                        minStock: 2,
                        unit: "pcs",
                        description: "Ergonomic office chair"
                    }
                ];
                
                for (const item of testItems) {
                    await db.collection('users').doc(userId).collection('inventory').add({
                        ...item,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Add test customers
                const testCustomers = [
                    {
                        name: "John Doe",
                        email: "john@example.com",
                        phone: "+91 9876543210",
                        address: "123 Main Street, Mumbai",
                        city: "Mumbai",
                        gstNumber: "22ABCDE1234F1Z5"
                    },
                    {
                        name: "Jane Smith",
                        email: "jane@example.com",
                        phone: "+91 9876543211",
                        address: "456 Park Avenue, Delhi",
                        city: "Delhi",
                        discount: 5
                    }
                ];
                
                for (const customer of testCustomers) {
                    await db.collection('users').doc(userId).collection('customers').add({
                        ...customer,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Add test transactions
                const testTransactions = [
                    {
                        date: new Date().toISOString().split('T')[0],
                        amount: 55000,
                        description: "Laptop Sale",
                        type: "income",
                        category: "sales",
                        paymentMethod: "bank"
                    },
                    {
                        date: new Date().toISOString().split('T')[0],
                        amount: 3500,
                        description: "Headphones Sale",
                        type: "income",
                        category: "sales",
                        paymentMethod: "cash"
                    },
                    {
                        date: new Date().toISOString().split('T')[0],
                        amount: 5000,
                        description: "Office Rent",
                        type: "expense",
                        category: "rent",
                        paymentMethod: "bank"
                    }
                ];
                
                for (const transaction of testTransactions) {
                    await db.collection('users').doc(userId).collection('transactions').add({
                        ...transaction,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        createdBy: userId
                    });
                }
                
                // Add test notes
                const testNotes = [
                    {
                        title: "Meeting Notes",
                        category: "meeting",
                        content: "Discussed new product launch\nAction items:\n1. Prepare marketing materials\n2. Update website\n3. Contact distributors",
                        color: "#e8f5e9"
                    },
                    {
                        title: "Important Reminder",
                        category: "important",
                        content: "Submit quarterly taxes by end of month\nRenew business license\nSchedule team meeting",
                        color: "#fff3e0"
                    }
                ];
                
                for (const note of testNotes) {
                    await db.collection('users').doc(userId).collection('notes').add({
                        ...note,
                        status: "active",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        createdBy: userId
                    });
                }
                
                // Reload all data
                await Promise.all([
                    loadInventory(),
                    loadCustomers(),
                    loadTransactions(),
                    loadNotes()
                ]);
                
                updateDashboardStats();
                updateBalanceStats();
                updateRecentTransactionsTable();
                updateNoteCategories();
                loadNotesGrid();
                updateBadges();
                populateCustomerSelect();
                populateCategoryFilters();
                
                hideLoading();
                showToast('Test data created successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Error creating test data:', error);
                showToast('Failed to create test data', 'error');
            }
        }

        // Other table updates
        function updateRecentSalesTable() {
            const table = document.getElementById('recentSalesTable');
            const recentSales = sales.slice(0, 5);
            
            let html = '';
            if (recentSales.length === 0) {
                html = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <h4>No recent sales</h4>
                            <p>Start making sales to see them here</p>
                        </td>
                    </tr>
                `;
            } else {
                recentSales.forEach(sale => {
                    const statusClass = sale.status === 'paid' ? 'status-in-stock' : 
                                      sale.status === 'partial' ? 'status-low-stock' : 'status-out-of-stock';
                    const statusText = sale.status === 'paid' ? 'Paid' : 
                                     sale.status === 'partial' ? 'Partial' : 'Pending';
                    
                    html += `
                        <tr>
                            <td><strong>${sale.invoiceNumber}</strong></td>
                            <td>${sale.customerName}</td>
                            <td>â‚¹${sale.totalAmount.toFixed(2)}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="action-btn" style="padding: 5px 10px;" onclick="viewInvoice('${sale.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            table.innerHTML = html;
        }

        function updateLowStockTable() {
            const table = document.getElementById('lowStockTable');
            const lowStockItems = inventoryItems.filter(item => 
                item.currentStock > 0 && item.currentStock <= (item.minStock || 5)
            ).slice(0, 5);
            
            let html = '';
            if (lowStockItems.length === 0) {
                html = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <h4>All items are well stocked</h4>
                            <p>No low stock items to display</p>
                        </td>
                    </tr>
                `;
            } else {
                lowStockItems.forEach(item => {
                    const statusClass = item.currentStock === 0 ? 'status-out-of-stock' : 'status-low-stock';
                    const statusText = item.currentStock === 0 ? 'Out of Stock' : 'Low Stock';
                    
                    html += `
                        <tr>
                            <td><strong>${item.name}</strong></td>
                            <td>${item.currentStock} ${item.unit || 'pcs'}</td>
                            <td>${item.minStock || 5}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <button class="action-btn" style="padding: 5px 10px;" onclick="editItem('${item.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            table.innerHTML = html;
        }

        function updatePendingPaymentsTable() {
            const table = document.getElementById('pendingPaymentsTable');
            const pendingSales = sales.filter(sale => sale.dueAmount > 0).slice(0, 5);
            
            let html = '';
            if (pendingSales.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <h4>No pending payments</h4>
                            <p>All payments are cleared</p>
                        </td>
                    </tr>
                `;
            } else {
                pendingSales.forEach(sale => {
                    const dueDate = new Date(sale.date);
                    dueDate.setDate(dueDate.getDate() + 30); // 30 days credit
                    
                    html += `
                        <tr>
                            <td><strong>${sale.invoiceNumber}</strong></td>
                            <td>${sale.customerName}</td>
                            <td>â‚¹${sale.totalAmount.toFixed(2)}</td>
                            <td>â‚¹${(sale.totalAmount - sale.dueAmount).toFixed(2)}</td>
                            <td>â‚¹${sale.dueAmount.toFixed(2)}</td>
                            <td>${formatDate(dueDate)}</td>
                            <td>
                                <button class="action-btn success" style="padding: 5px 10px;" onclick="recordPayment('${sale.id}')">
                                    <i class="fas fa-money-bill"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            table.innerHTML = html;
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            // Set today's date in all date inputs
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Prevent form submission
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                });
            });
        });

        // Placeholder functions for future implementation
        window.exportBalanceReport = function() {
            showToast('Export feature coming soon!', 'info');
        };

        window.printBalanceStatement = function() {
            showToast('Print feature coming soon!', 'info');
        };

        window.exportNotes = function() {
            showToast('Export feature coming soon!', 'info');
        };

        window.printNote = function() {
            showToast('Print feature coming soon!', 'info');
        };

        window.exportTransactions = function() {
            showToast('Export feature coming soon!', 'info');
        };

        window.printTransactionReport = function() {
            showToast('Print feature coming soon!', 'info');
        };

        window.filterTransactions = function() {
            showToast('Filter feature coming soon!', 'info');
        };

        window.viewAllTransactions = function() {
            openModal('transactionsModal');
        };

        window.openTransferModal = function() {
            openModal('transferModal');
        };

        window.processTransfer = function() {
            showToast('Transfer feature coming soon!', 'info');
        };

        window.openNoteCategoriesModal = function() {
            openModal('noteCategoriesModal');
        };

        window.addNoteCategory = function() {
            showToast('Category feature coming soon!', 'info');
        };

        window.editCurrentNote = function() {
            showToast('Edit feature coming soon!', 'info');
        };

        window.markNoteComplete = function() {
            showToast('Complete feature coming soon!', 'info');
        };

        window.saveNoteAsDraft = function() {
            showToast('Draft feature coming soon!', 'info');
        };

        window.toggleTransactionFields = function() {
            // Implementation for transaction fields toggle
        };

        window.printInvoice = function() {
            window.print();
        };

        window.downloadInvoice = function() {
            showToast('Download feature coming soon!', 'info');
        };

        window.showSettingsTab = function(tab) {
            showToast('Settings feature coming soon!', 'info');
        };

        window.saveCompanyDetails = function() {
            showToast('Company details feature coming soon!', 'info');
        };

        window.showReportTab = function(tab) {
            showToast('Reports feature coming soon!', 'info');
        };

        window.generateReport = function() {
            showToast('Report generation feature coming soon!', 'info');
        };

        window.printReport = function() {
            showToast('Print report feature coming soon!', 'info');
        };

        window.exportReport = function() {
            showToast('Export report feature coming soon!', 'info');
        };

        window.updateRevenueChart = function() {
            showToast('Revenue chart update feature coming soon!', 'info');
        };

    </script>
</body>
</html>