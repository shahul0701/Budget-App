<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Balance Sheet</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
/* Basic Styles */
body{font-family:'Segoe UI',sans-serif;background:#f5f7fa;color:#333;line-height:1.6;margin:0;padding:0;}
.container{max-width:1200px;margin:0 auto;padding:20px;}
header{background:white;padding:15px 20px;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;border-radius:8px;}
.header-left a{text-decoration:none;color:#3498db;font-weight:bold;font-size:18px;display:flex;align-items:center;gap:8px;}
.header-right{display:flex;align-items:center;gap:15px;}
#userInitials{background:#3498db;color:white;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-weight:bold;}
#logoutBtn{background:#e74c3c;color:white;border:none;border-radius:4px;padding:8px 15px;cursor:pointer;}
#logoutBtn:hover{background:#c0392b;}
h1{text-align:center;margin-bottom:30px;}
.date-controls{background:white;padding:20px;border-radius:8px;display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.date-controls select,input{padding:6px 10px;border-radius:4px;border:1px solid #ddd;}
#generateReportBtn{background:#3498db;color:white;border:none;padding:8px 14px;border-radius:4px;cursor:pointer;}
#generateReportBtn:hover{background:#2980b9;}
.export-buttons{display:flex;gap:10px;margin-bottom:20px;}
.export-buttons button{background:#3498db;color:white;border:none;padding:8px 14px;border-radius:4px;cursor:pointer;}
.export-buttons button:hover{background:#2980b9;}
.summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px;}
.summary-card{background:white;border-radius:8px;padding:20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.summary-card.assets{border-top:4px solid #2ecc71;}
.summary-card.liabilities{border-top:4px solid #e74c3c;}
.summary-card.equity{border-top:4px solid #3498db;}
.card-title{font-size:16px;color:#95a5a6;margin-bottom:10px;}
.card-value{font-size:24px;font-weight:700;}
.assets .card-value{color:#2ecc71;}
.liabilities .card-value{color:#e74c3c;}
.equity .card-value{color:#3498db;}
.chart-container{background:white;border-radius:8px;padding:20px;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.details-section{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
@media(max-width:768px){.details-section{grid-template-columns:1fr;}}
.assets-details,.liabilities-details,.equity-details{background:white;border-radius:8px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.section-title{font-size:18px;color:#2c3e50;margin-bottom:10px;border-bottom:1px solid #ecf0f1;padding-bottom:5px;}
.account-item{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #f1f1f1;}
.account-item:last-child{border-bottom:none;}
.account-name{font-weight:600;}
.account-amount{font-weight:600;}
.assets-details .account-amount{color:#2ecc71;}
.liabilities-details .account-amount{color:#e74c3c;}
.equity-details .account-amount{color:#3498db;}
.loading-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center;}
.loading-content{background:white;padding:30px;border-radius:8px;text-align:center;}
.empty-state{text-align:center;padding:20px;color:#95a5a6;}
.report-period{text-align:center;margin-bottom:20px;font-style:italic;color:#95a5a6;}
.balance-validation{text-align:center;padding:15px;margin:20px 0;border-radius:8px;font-weight:bold;}
.balance-valid{background:#d4edda;color:#155724;}
.balance-invalid{background:#f8d7da;color:#721c24;}
</style>
</head>
<body>

<header>
<div class="header-left"><a href="home.html"><i class="fa fa-home"></i> Home</a></div>
<div class="header-right">
<div id="userInitials">U</div>
<div id="username">User</div>
<button id="logoutBtn">Logout</button>
</div>
</header>

<div class="container">
<h1><i class="fas fa-balance-scale"></i> Balance Sheet</h1>

<div class="date-controls">
<label>As of:
<input type="date" id="balanceSheetDate">
</label>

<button id="generateReportBtn">Generate</button>

<label>Chart Type:
<select id="chartType">
<option value="doughnut">Doughnut</option>
<option value="pie">Pie</option>
<option value="bar">Bar</option>
</select>
</label>
</div>

<div class="export-buttons">
<button id="exportCSV"><i class="fa fa-file-csv"></i> CSV</button>
<button id="exportPDF"><i class="fa fa-file-pdf"></i> PDF</button>
</div>

<div id="reportPeriodDisplay" class="report-period"></div>

<div class="summary-cards">
<div class="summary-card assets"><div class="card-title">Total Assets</div><div class="card-value" id="totalAssets">₹0.00</div></div>
<div class="summary-card liabilities"><div class="card-title">Total Liabilities</div><div class="card-value" id="totalLiabilities">₹0.00</div></div>
<div class="summary-card equity"><div class="card-title">Total Equity</div><div class="card-value" id="totalEquity">₹0.00</div></div>
</div>

<div id="balanceValidation" class="balance-validation">
Balance Sheet: <span id="balanceStatus">Not Calculated</span>
</div>

<div class="chart-container">
<canvas id="balanceSheetChart"></canvas>
</div>

<div class="details-section">
<div class="assets-details">
<h3 class="section-title">Assets</h3>
<div id="assetsBreakdown"></div>
</div>
<div class="liabilities-details">
<h3 class="section-title">Liabilities</h3>
<div id="liabilitiesBreakdown"></div>
</div>
</div>

<div class="equity-details">
<h3 class="section-title">Equity</h3>
<div id="equityBreakdown"></div>
</div>
</div>

<div id="loadingModal" class="loading-modal">
<div class="loading-content"><i class="fa fa-spinner fa-spin" style="font-size:40px;margin-bottom:15px;"></i><p>Generating balance sheet...</p></div>
</div>

<script type="module">
// ===== Firebase =====
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, query, getDocs, orderBy, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const app = initializeApp({
    apiKey: "AIzaSyBhjgu6vpBRhMVjMs5RgSL4aViJq6GYy1A",
    authDomain: "budget-app-1365f.firebaseapp.com",
    projectId: "budget-app-1365f",
    storageBucket: "budget-app-1365f.appspot.com",
    messagingSenderId: "1036194450411",
    appId: "1:1036194450411:web:78ca39a5a82ab9db6c67ae",
    measurementId: "G-YFFJL2H54X"
});

const db = getFirestore(app);
const auth = getAuth(app);

// DOM Elements
const usernameElem = document.getElementById("username");
const initialsElem = document.getElementById("userInitials");
const logoutBtn = document.getElementById("logoutBtn");
const balanceSheetDateInput = document.getElementById("balanceSheetDate");
const generateReportBtn = document.getElementById("generateReportBtn");
const reportPeriodDisplay = document.getElementById("reportPeriodDisplay");
const totalAssetsElem = document.getElementById("totalAssets");
const totalLiabilitiesElem = document.getElementById("totalLiabilities");
const totalEquityElem = document.getElementById("totalEquity");
const balanceValidation = document.getElementById("balanceValidation");
const balanceStatus = document.getElementById("balanceStatus");
const assetsBreakdownElem = document.getElementById("assetsBreakdown");
const liabilitiesBreakdownElem = document.getElementById("liabilitiesBreakdown");
const equityBreakdownElem = document.getElementById("equityBreakdown");
const chartTypeSelect = document.getElementById("chartType");
const exportCSVBtn = document.getElementById("exportCSV");
const exportPDFBtn = document.getElementById("exportPDF");
const loadingModal = document.getElementById("loadingModal");

let currentUser = null;
let balanceSheetData = {
    assets: {},
    liabilities: {},
    equity: {}
};
let balanceSheetChart = null;

// ===== Auth Listener =====
onAuthStateChanged(auth, user => {
    if (user) {
        currentUser = user;
        const name = user.displayName || user.email || "User";
        usernameElem.textContent = name;
        initialsElem.textContent = name.charAt(0).toUpperCase();
        setDefaultDate();
        generateBalanceSheet();
    } else {
        alert("Login first.");
        window.location.href = "index.html";
    }
});

// ===== Logout =====
logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
});

// ===== Event Listeners =====
generateReportBtn.addEventListener("click", generateBalanceSheet);
chartTypeSelect.addEventListener("change", () => {
    if (Object.keys(balanceSheetData.assets).length > 0 || 
        Object.keys(balanceSheetData.liabilities).length > 0) {
        updateChart();
    }
});
exportCSVBtn.addEventListener("click", exportCSV);
exportPDFBtn.addEventListener("click", exportPDF);

function setDefaultDate() {
    const today = new Date();
    balanceSheetDateInput.value = formatDate(today);
}

function formatDate(date) {
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;
}

function formatDisplay(date) {
    return date.toLocaleDateString("en-IN", { year: "numeric", month: "long", day: "numeric" });
}

// ===== Load Balance Sheet Data =====
async function loadBalanceSheetData(asOfDate) {
    loadingModal.style.display = "flex";
    try {
        // Convert to Firestore timestamp format
        const asOfTimestamp = new Date(asOfDate);
        asOfTimestamp.setHours(23, 59, 59, 999);
        
        // Load all transactions up to the selected date
        const transactionsRef = collection(db, "users", currentUser.uid, "transactions");
        const q = query(
            transactionsRef, 
            orderBy("DATE", "asc")
        );
        
        const snap = await getDocs(q);
        
        // Filter transactions that occurred on or before the selected date
        const allTransactions = snap.docs
            .map(d => ({ id: d.id, ...d.data() }))
            .filter(tx => {
                if (!tx.DATE) return false;
                
                let transactionDate;
                if (typeof tx.DATE === 'string') {
                    transactionDate = new Date(tx.DATE);
                } else if (tx.DATE && typeof tx.DATE.toDate === 'function') {
                    transactionDate = tx.DATE.toDate();
                } else if (tx.DATE && typeof tx.DATE === 'object') {
                    transactionDate = new Date(tx.DATE);
                } else {
                    return false;
                }
                
                return transactionDate <= asOfTimestamp;
            });
        
        return allTransactions;
    } catch (err) {
        console.error("Error loading transactions:", err);
        Swal.fire("Error", "Failed to load transactions: " + err.message, "error");
        return [];
    } finally {
        loadingModal.style.display = "none";
    }
}

// ===== Generate Balance Sheet =====
async function generateBalanceSheet() {
    const asOfDate = new Date(balanceSheetDateInput.value);
    reportPeriodDisplay.textContent = `As of: ${formatDisplay(asOfDate)}`;
    
    const transactions = await loadBalanceSheetData(asOfDate);
    
    if (transactions.length === 0) {
        resetBalanceSheet();
        Swal.fire("Info", "No transactions found up to the selected date.", "info");
        return;
    }

    // Process transactions to create balance sheet
    processBalanceSheetData(transactions);
    
    // Calculate totals
    const totalAssets = calculateTotal(balanceSheetData.assets);
    const totalLiabilities = calculateTotal(balanceSheetData.liabilities);
    const totalEquity = calculateTotal(balanceSheetData.equity);
    
    // Update UI
    totalAssetsElem.textContent = `₹${totalAssets.toFixed(2)}`;
    totalLiabilitiesElem.textContent = `₹${totalLiabilities.toFixed(2)}`;
    totalEquityElem.textContent = `₹${totalEquity.toFixed(2)}`;
    
    // Check if balance sheet balances
    const netWorth = totalAssets - totalLiabilities - totalEquity;
    const isBalanced = Math.abs(netWorth) < 0.01; // Allow for small rounding errors
    
    if (isBalanced) {
        balanceValidation.className = "balance-validation balance-valid";
        balanceStatus.textContent = "BALANCED ✓";
        balanceStatus.style.color = "#155724";
    } else {
        balanceValidation.className = "balance-validation balance-invalid";
        balanceStatus.textContent = `NOT BALANCED (Difference: ₹${Math.abs(netWorth).toFixed(2)}) ✗`;
        balanceStatus.style.color = "#721c24";
    }
    
    // Update breakdowns
    updateBreakdown(balanceSheetData.assets, assetsBreakdownElem, "assets");
    updateBreakdown(balanceSheetData.liabilities, liabilitiesBreakdownElem, "liabilities");
    updateBreakdown(balanceSheetData.equity, equityBreakdownElem, "equity");
    
    // Update chart
    updateChart();
}

function processBalanceSheetData(transactions) {
    // Reset balance sheet data
    balanceSheetData = {
        assets: {},
        liabilities: {},
        equity: {}
    };
    
    // Process each transaction
    transactions.forEach(tx => {
        const category = tx.ACCOUNT_HEADER || "Uncategorized";
        const amount = parseFloat(tx.INCOME || 0) - parseFloat(tx.EXPENSE || 0);
        
        if (amount === 0) return;
        
        // Determine if this is an asset, liability, or equity transaction
        // This is a simplified classification - you might need to adjust based on your account structure
        if (category.toLowerCase().includes("cash") || 
            category.toLowerCase().includes("bank") ||
            category.toLowerCase().includes("savings") ||
            category.toLowerCase().includes("investment") ||
            category.toLowerCase().includes("property") ||
            category.toLowerCase().includes("equipment") ||
            category.toLowerCase().includes("asset")) {
            // Asset account
            balanceSheetData.assets[category] = (balanceSheetData.assets[category] || 0) + amount;
        } else if (category.toLowerCase().includes("loan") || 
                  category.toLowerCase().includes("debt") ||
                  category.toLowerCase().includes("credit") ||
                  category.toLowerCase().includes("payable") ||
                  category.toLowerCase().includes("liability")) {
            // Liability account
            balanceSheetData.liabilities[category] = (balanceSheetData.liabilities[category] || 0) + amount;
        } else if (category.toLowerCase().includes("equity") || 
                  category.toLowerCase().includes("capital") ||
                  category.toLowerCase().includes("retained")) {
            // Equity account
            balanceSheetData.equity[category] = (balanceSheetData.equity[category] || 0) + amount;
        } else if (amount > 0) {
            // Positive amount - treat as income which increases equity (retained earnings)
            balanceSheetData.equity["Retained Earnings"] = (balanceSheetData.equity["Retained Earnings"] || 0) + amount;
        } else {
            // Negative amount - treat as expense which decreases equity (retained earnings)
            balanceSheetData.equity["Retained Earnings"] = (balanceSheetData.equity["Retained Earnings"] || 0) + amount;
        }
    });
}

function calculateTotal(accounts) {
    return Object.values(accounts).reduce((total, amount) => total + amount, 0);
}

function resetBalanceSheet() {
    totalAssetsElem.textContent = "₹0.00";
    totalLiabilitiesElem.textContent = "₹0.00";
    totalEquityElem.textContent = "₹0.00";
    assetsBreakdownElem.innerHTML = "";
    liabilitiesBreakdownElem.innerHTML = "";
    equityBreakdownElem.innerHTML = "";
    balanceValidation.className = "balance-validation";
    balanceStatus.textContent = "Not Calculated";
    
    if (balanceSheetChart) {
        balanceSheetChart.destroy();
    }
}

function updateBreakdown(accounts, container, type) {
    if (Object.keys(accounts).length === 0) {
        container.innerHTML = '<p class="empty-state"><i class="fa fa-info-circle"></i> No data</p>';
        return;
    }
    
    container.innerHTML = Object.entries(accounts)
        .map(([name, amount]) => `
            <div class="account-item">
                <div class="account-name">${name}</div>
                <div class="account-amount">₹${amount.toFixed(2)}</div>
            </div>
        `)
        .join("");
}

function updateChart() {
    const totalAssets = calculateTotal(balanceSheetData.assets);
    const totalLiabilities = calculateTotal(balanceSheetData.liabilities);
    const totalEquity = calculateTotal(balanceSheetData.equity);
    
    const ctx = document.getElementById("balanceSheetChart").getContext("2d");
    
    if (balanceSheetChart) {
        balanceSheetChart.destroy();
    }
    
    if (totalAssets === 0 && totalLiabilities === 0 && totalEquity === 0) {
        return;
    }
    
    const chartType = chartTypeSelect.value;
    
    if (chartType === "doughnut" || chartType === "pie") {
        // For pie/doughnut charts, show assets vs liabilities + equity
        balanceSheetChart = new Chart(ctx, {
            type: chartType,
            data: {
                labels: ["Assets", "Liabilities", "Equity"],
                datasets: [{
                    data: [totalAssets, totalLiabilities, totalEquity],
                    backgroundColor: ["#2ecc71", "#e74c3c", "#3498db"]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Balance Sheet Composition'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ₹' + context.raw.toFixed(2);
                            }
                        }
                    }
                }
            }
        });
    } else {
        // For bar charts, show a more detailed breakdown
        const assetLabels = Object.keys(balanceSheetData.assets);
        const liabilityLabels = Object.keys(balanceSheetData.liabilities);
        const equityLabels = Object.keys(balanceSheetData.equity);
        
        const allLabels = [...assetLabels, ...liabilityLabels, ...equityLabels];
        const allData = [
            ...Object.values(balanceSheetData.assets),
            ...Object.values(balanceSheetData.liabilities),
            ...Object.values(balanceSheetData.equity)
        ];
        
        const backgroundColors = [
            ...Array(assetLabels.length).fill("#2ecc71"),
            ...Array(liabilityLabels.length).fill("#e74c3c"),
            ...Array(equityLabels.length).fill("#3498db")
        ];
        
        balanceSheetChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: allLabels,
                datasets: [{
                    label: "Amount",
                    data: allData,
                    backgroundColor: backgroundColors
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Balance Sheet Details'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ₹' + context.raw.toFixed(2);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '₹' + value;
                            }
                        }
                    }
                }
            }
        });
    }
}

// ===== Export Functions =====
function exportCSV() {
    const totalAssets = calculateTotal(balanceSheetData.assets);
    const totalLiabilities = calculateTotal(balanceSheetData.liabilities);
    const totalEquity = calculateTotal(balanceSheetData.equity);
    
    if (totalAssets === 0 && totalLiabilities === 0 && totalEquity === 0) {
        alert("No data to export.");
        return;
    }
    
    let csv = "Category,Account,Amount\n";
    
    // Add assets
    csv += "Assets,,,\n";
    Object.entries(balanceSheetData.assets).forEach(([name, amount]) => {
        csv += `,${name},${amount.toFixed(2)}\n`;
    });
    csv += `,Total Assets,${totalAssets.toFixed(2)}\n\n`;
    
    // Add liabilities
    csv += "Liabilities,,,\n";
    Object.entries(balanceSheetData.liabilities).forEach(([name, amount]) => {
        csv += `,${name},${amount.toFixed(2)}\n`;
    });
    csv += `,Total Liabilities,${totalLiabilities.toFixed(2)}\n\n`;
    
    // Add equity
    csv += "Equity,,,\n";
    Object.entries(balanceSheetData.equity).forEach(([name, amount]) => {
        csv += `,${name},${amount.toFixed(2)}\n`;
    });
    csv += `,Total Equity,${totalEquity.toFixed(2)}\n\n`;
    
    // Add totals
    csv += `,Total Liabilities & Equity,${(totalLiabilities + totalEquity).toFixed(2)}\n`;
    
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "BalanceSheet.csv";
    a.click();
    URL.revokeObjectURL(url);
}

function exportPDF() {
    const totalAssets = calculateTotal(balanceSheetData.assets);
    const totalLiabilities = calculateTotal(balanceSheetData.liabilities);
    const totalEquity = calculateTotal(balanceSheetData.equity);
    
    if (totalAssets === 0 && totalLiabilities === 0 && totalEquity === 0) {
        alert("No data to export.");
        return;
    }
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Title
    doc.setFontSize(18);
    doc.text("Balance Sheet", 105, 15, null, null, "center");
    doc.setFontSize(12);
    doc.text(`Generated for ${currentUser.email || "User"}`, 105, 22, null, null, "center");
    doc.text(reportPeriodDisplay.textContent, 105, 29, null, null, "center");
    
    // Summary
    doc.setFontSize(14);
    doc.text("Summary", 14, 40);
    doc.setFontSize(12);
    doc.text(`Total Assets: ₹${totalAssets.toFixed(2)}`, 14, 48);
    doc.text(`Total Liabilities: ₹${totalLiabilities.toFixed(2)}`, 14, 56);
    doc.text(`Total Equity: ₹${totalEquity.toFixed(2)}`, 14, 64);
    
    // Check if balanced
    const netWorth = totalAssets - totalLiabilities - totalEquity;
    const isBalanced = Math.abs(netWorth) < 0.01;
    
    doc.setTextColor(isBalanced ? 21, 87, 36 : 114, 28, 36);
    doc.text(`Balance Check: ${isBalanced ? "BALANCED ✓" : `NOT BALANCED (Difference: ₹${Math.abs(netWorth).toFixed(2)}) ✗`}`, 14, 72);
    doc.setTextColor(0, 0, 0); // Reset color
    
    // Assets table
    doc.autoTable({
        startY: 80,
        head: [["Assets", "Amount"]],
        body: [
            ...Object.entries(balanceSheetData.assets).map(([name, amount]) => [name, `₹${amount.toFixed(2)}`]),
            ["Total Assets", `₹${totalAssets.toFixed(2)}`]
        ],
        theme: "grid"
    });
    
    // Liabilities table
    doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Liabilities", "Amount"]],
        body: [
            ...Object.entries(balanceSheetData.liabilities).map(([name, amount]) => [name, `₹${amount.toFixed(2)}`]),
            ["Total Liabilities", `₹${totalLiabilities.toFixed(2)}`]
        ],
        theme: "grid"
    });
    
    // Equity table
    doc.autoTable({
        startY: doc.lastAutoTable.finalY + 10,
        head: [["Equity", "Amount"]],
        body: [
            ...Object.entries(balanceSheetData.equity).map(([name, amount]) => [name, `₹${amount.toFixed(2)}`]),
            ["Total Equity", `₹${totalEquity.toFixed(2)}`],
            ["Total Liabilities & Equity", `₹${(totalLiabilities + totalEquity).toFixed(2)}`]
        ],
        theme: "grid"
    });
    
    doc.save("BalanceSheet.pdf");
}
</script>
</body>
</html>